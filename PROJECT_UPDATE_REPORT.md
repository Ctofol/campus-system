# 灵析运动 (Lingxi Sports) 项目更新报告

**报告日期**：2026-02-06  
**版本**：1.0.1 (Stable Fix)

## 1. 核心修复与优化 (Critical Fixes)

### 1.1 网络连接修复 (Network)
- **问题**：Android 9.0+ 系统默认拦截 HTTP 请求，导致真机“网络连接错误”。
- **修复**：在 `manifest.json` 中显式开启 `usesCleartextTraffic: true`，强制允许明文 HTTP 流量。
- **结果**：正式包（Release Build）现可正常连接 HTTP 服务器，无需降级 SDK。

### 1.2 定位系统重构 (Location System)
- **去伪存真**：彻底移除了定位失败时“强制回退到北京”的逻辑，确保位置数据的真实性。
- **状态机管理**：引入 `idle` / `locating` / `success` / `fail` 状态机，仅在定位成功时允许打卡/跑步。
- **Android 轮询**：针对 Android 设备添加了 3秒/次 的定位轮询机制，解决首次定位慢的问题。
- **防漂移算法**：
  - **精度过滤**：自动丢弃精度差于 40米 的弱信号点。
  - **微动过滤**：忽略 4米 以内的微小跳动，防止静止时轨迹乱跑。
- **选点优化**：新增 `choose-location.vue` 自定义选点页面，绕过腾讯地图 SDK 的权限验证痛点。

### 1.3 登录体验优化 (Auth)
- **智能跳转**：移除“角色不匹配”的阻断式报错。当检测到学生在教师端登录（或反之）时，系统会自动识别身份并平滑跳转至对应首页。

## 2. 功能与界面更新 (Features & UI)

### 2.1 品牌升级
- **应用名称**：正式更名为 **“灵析运动”**。
- **图标**：支持自定义品牌 LOGO。

### 2.2 界面细节
- **个人中心**：修复底部“退出登录”按钮被导航栏遮挡的问题（增加底部内边距）。
- **任务弹窗**：优化首页任务弹窗逻辑，引入本地缓存记录，避免每次返回首页重复弹窗打扰用户。
- **记录分离**：将“老师发布的任务”与“个人自主运动”在历史记录中彻底分离，数据展示更清晰。

### 2.3 部署与运维
- **Docker 修复**：解决了服务器部署时的 `KeyError: 'ContainerConfig'` 报错，确立了容器清理与重建的标准流程。
- **配置规范**：标准化了 `manifest.json` 的权限配置，确保 INTERNET 和 Location 权限在打包时正确注入。

## 3. 接下来的建议 (Next Steps)

1.  **HTTPS 升级**：虽然目前通过配置允许了 HTTP，但建议未来在服务器配置 SSL 证书（Nginx），升级为 HTTPS，提高安全性和系统兼容性。
2.  **App 商店上架**：如需上架应用宝或华为市场，需补充“隐私政策”弹窗及相关合规文档。

---
**总结**：
本次更新彻底解决了阻碍 App 上线的核心“网络”与“定位”问题，并显著提升了用户体验的流畅度。App 现已具备稳定发布的能力。
