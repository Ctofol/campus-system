import{r as e,a1 as a,c as l,w as t,i as s,o as u,d,e as r,t as o,p as c,G as n,H as i,W as f,q as m,I as p,a3 as _,a0 as v,u as b}from"./index-D4dSIJeF.js";import{r as g,h as y}from"./request.Da1Pdojv.js";import{_ as h}from"./_plugin-vue_export-helper.BCo6x5W8.js";const V=h({__name:"create",setup(h){const V=["run","test"],w=["跑步任务","体能测试"],x=e(["all"]),k=e(["全员"]),L=e([]),C=e({title:"",type:"",typeLabel:"",distance:"",deadline:"",target:"all",targetLabel:"全员",description:""});a((()=>{j()}));const j=async()=>{try{const e=await g({url:"/teacher/classes"});L.value=e,k.value=["全员",...e.map((e=>`班级: ${e.name}`))],x.value=["all",...e.map((e=>e.id))]}catch(e){console.error("Fetch classes failed",e)}},I=e=>{const a=e.detail.value;C.value.type=V[a],C.value.typeLabel=w[a]},U=e=>{C.value.deadline=e.detail.value},q=e=>{const a=e.detail.value;C.value.target=x.value[a],C.value.targetLabel=k.value[a]},D=async()=>{if(!C.value.title||!C.value.type||!C.value.deadline)return c({title:"请完善任务信息",icon:"none"});n({title:"发布中..."});try{const e={title:C.value.title,type:C.value.type,min_distance:"run"===C.value.type?Number(C.value.distance):0,min_duration:0,min_count:0,deadline:new Date(C.value.deadline).toISOString(),description:C.value.description,target_group:"all"===C.value.target?"all":null,class_id:"number"==typeof C.value.target?C.value.target:null};await y(e),i(),c({title:"任务发布成功",icon:"success"}),setTimeout((()=>{f()}),1500)}catch(e){i(),console.error(e)}};return(e,a)=>{const c=m,n=p,i=s,f=_,g=v,y=b;return u(),l(i,{class:"create-task-page"},{default:t((()=>[d(i,{class:"form-card"},{default:t((()=>[d(i,{class:"form-item"},{default:t((()=>[d(c,{class:"label"},{default:t((()=>[r("任务标题")])),_:1}),d(n,{class:"input",modelValue:C.value.title,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value.title=e),placeholder:"例如：本周5公里耐力跑"},null,8,["modelValue"])])),_:1}),d(i,{class:"form-item"},{default:t((()=>[d(c,{class:"label"},{default:t((()=>[r("任务类型")])),_:1}),d(f,{mode:"selector",range:w,onChange:I},{default:t((()=>[d(i,{class:"picker-box"},{default:t((()=>[d(c,null,{default:t((()=>[r(o(C.value.typeLabel||"请选择任务类型"),1)])),_:1}),d(c,{class:"arrow"},{default:t((()=>[r(">")])),_:1})])),_:1})])),_:1})])),_:1}),d(i,{class:"form-item"},{default:t((()=>[d(c,{class:"label"},{default:t((()=>[r("目标距离 (km)")])),_:1}),d(n,{class:"input",type:"digit",modelValue:C.value.distance,"onUpdate:modelValue":a[1]||(a[1]=e=>C.value.distance=e),placeholder:"0.0"},null,8,["modelValue"])])),_:1}),d(i,{class:"form-item"},{default:t((()=>[d(c,{class:"label"},{default:t((()=>[r("截止日期")])),_:1}),d(f,{mode:"date",onChange:U},{default:t((()=>[d(i,{class:"picker-box"},{default:t((()=>[d(c,null,{default:t((()=>[r(o(C.value.deadline||"请选择截止日期"),1)])),_:1}),d(c,{class:"arrow"},{default:t((()=>[r(">")])),_:1})])),_:1})])),_:1})])),_:1}),d(i,{class:"form-item"},{default:t((()=>[d(c,{class:"label"},{default:t((()=>[r("指派对象")])),_:1}),d(f,{mode:"selector",range:k.value,onChange:q},{default:t((()=>[d(i,{class:"picker-box"},{default:t((()=>[d(c,null,{default:t((()=>[r(o(C.value.targetLabel||"全员"),1)])),_:1}),d(c,{class:"arrow"},{default:t((()=>[r(">")])),_:1})])),_:1})])),_:1},8,["range"])])),_:1}),d(i,{class:"form-item vertical"},{default:t((()=>[d(c,{class:"label"},{default:t((()=>[r("任务说明")])),_:1}),d(g,{class:"textarea",modelValue:C.value.description,"onUpdate:modelValue":a[2]||(a[2]=e=>C.value.description=e),placeholder:"请输入任务的具体要求和注意事项..."},null,8,["modelValue"])])),_:1})])),_:1}),d(i,{class:"footer-btn"},{default:t((()=>[d(y,{class:"submit-btn",onClick:D},{default:t((()=>[r("发布任务")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-29e3fd03"]]);export{V as default};
