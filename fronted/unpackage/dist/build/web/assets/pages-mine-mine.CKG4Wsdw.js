import{r as e,z as t,g as a,a as s,c as l,w as u,G as c,i as r,o as d,d as n,e as o,n as i,t as f,j as _,k as m,F as p,s as v,m as g,J as y,C as k,b as h,p as x,R as w,v as C,f as b}from"./index-C5iLBQvu.js";import{_ as F}from"./avatar.WOnTDsO9.js";import{o as T}from"./uni-app.es.BEWjhZNk.js";import{C as N}from"./CustomTabBar.C3uGOtvP.js";import{r as S}from"./request.BfbRFve_.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";const $=j({__name:"mine",setup(j){const $=e(20),M=e("åŒå­¦"),I=e("å­¦ç”Ÿ"),B=e(""),q=e(0),z=e(0),G=e(0),J=e("æœ¬å‘¨"),D=e(3),E=e(0),H=e(0),O=e(0),R=e(0),A=e([]),K=t((()=>A.value.slice(0,5))),L=e(""),P=e=>{const t=Number(e);return isNaN(t)?"0.00":t.toFixed(2)},Q=e=>{const t=Math.floor(e/3600),a=e%60;return`${t>0?t+":":""}${Math.floor(e%3600/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`};T((()=>{$.value=a().statusBarHeight||20;const e=s("userInfo");if(e){let a=e;if("string"==typeof e)try{a=JSON.parse(e)}catch(t){}a&&(a.name&&(M.value=a.name),a.class_name&&(B.value=a.class_name))}(async()=>{try{const e=await S({url:"/activity/history",method:"GET",data:{page:1,size:20}});if(e.items){A.value=e.items.map((e=>{var t,a,s,l,u;const c="run"===e.type,r=new Date(e.started_at),d=`${r.getMonth()+1}-${r.getDate()} ${r.getHours()}:${r.getMinutes().toString().padStart(2,"0")}`;return{type:e.type,modeBg:c?"#20C997":"#FF9F43",modeText:c?"è·‘æ­¥":"ä½“æµ‹",testName:"ä½“èƒ½æµ‹è¯•",createTime:d,distance:(null==(t=e.metrics)?void 0:t.distance)?Number(e.metrics.distance).toFixed(2):0,duration:Q((null==(a=e.metrics)?void 0:a.duration)||0),pace:null==(s=e.metrics)?void 0:s.pace,testCount:(null==(l=e.metrics)?void 0:l.count)||0,result:(null==(u=e.metrics)?void 0:u.qualified)?"è¾¾æ ‡":"æœªè¾¾æ ‡",statusText:"finished"===e.status?"æœ‰æ•ˆ":"å¾…å®¡æ ¸",statusColor:"#20C997"}}));const t=A.value.filter((e=>"run"===e.type));q.value=t.length,z.value=t.reduce(((e,t)=>e+Number(t.distance||0)),0).toFixed(2),G.value=A.value.filter((e=>"test"===e.type&&"è¾¾æ ‡"===e.result)).length,E.value=t.length,H.value=z.value,O.value=G.value,R.value=Math.min(t.length/D.value*100,100)}}catch(t){console.error("Fetch history failed",t)}})(),(async()=>{try{const e=await S({url:"/users/profile",method:"GET"});if(e){e.name&&(M.value=e.name),e.class_name&&(B.value=e.class_name);let a=s("userInfo");if("string"==typeof a)try{a=JSON.parse(a)}catch(t){a={}}const l={...a,...e};c("userInfo",l)}}catch(t){console.error("Fetch profile failed",t)}})()}));const U=()=>{v({title:"ç¼–è¾‘èµ„æ–™åŠŸèƒ½å¾…å¼€å‘",icon:"none"})},V=()=>{g({url:"/pages/health/request"})},W=()=>{v({title:"åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},X=()=>{v({title:"è®¾å¤‡ç»‘å®šåŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},Y=()=>{y({title:"æç¤º",content:"ç¡®å®šè¦æ¸…é™¤ç¼“å­˜å—ï¼Ÿ",success:e=>{e.confirm&&v({title:"æ¸…ç†å®Œæˆ"})}})},Z=()=>{v({title:"å½“å‰ç‰ˆæœ¬ v1.0.0",icon:"none"})},ee=()=>{y({title:"æç¤º",content:"ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ",success:e=>{e.confirm&&(k("token"),k("userInfo"),k("userRole"),h({url:"/pages/login/login"}))}})};return(e,t)=>{const a=x,s=r,c=w,v=C;return d(),l(s,{class:"mine-page"},{default:u((()=>[n(s,{class:"custom-navbar",style:i({paddingTop:$.value+"px"})},{default:u((()=>[n(s,{class:"navbar-content"},{default:u((()=>[n(a,{class:"navbar-title"},{default:u((()=>[o("ä¸ªäººä¸­å¿ƒ")])),_:1})])),_:1})])),_:1},8,["style"]),n(s,{class:"content-wrapper",style:i({paddingTop:$.value+44+"px"})},{default:u((()=>[n(s,{class:"user-header"},{default:u((()=>[n(s,{class:"avatar-box"},{default:u((()=>[n(c,{class:"avatar",src:F,mode:"aspectFill"}),n(v,{class:"edit-avatar",onClick:U},{default:u((()=>[o("ç¼–è¾‘èµ„æ–™")])),_:1})])),_:1}),n(s,{class:"user-info"},{default:u((()=>[n(a,{class:"username"},{default:u((()=>[o(f(M.value),1)])),_:1}),n(a,{class:"user-desc"},{default:u((()=>[o(f(B.value?B.value+" Â· ":"æ ¡å›­è¿åŠ¨æ‰“å¡ Â· ")+f(I.value),1)])),_:1})])),_:1}),n(s,{class:"user-stats"},{default:u((()=>[n(s,{class:"stats-item"},{default:u((()=>[n(a,{class:"stats-num"},{default:u((()=>[o(f(q.value),1)])),_:1}),n(a,{class:"stats-text"},{default:u((()=>[o("æ€»æ¬¡æ•°")])),_:1})])),_:1}),n(s,{class:"stats-item"},{default:u((()=>[n(a,{class:"stats-num"},{default:u((()=>[o(f(z.value)+"km",1)])),_:1}),n(a,{class:"stats-text"},{default:u((()=>[o("æ€»è·ç¦»")])),_:1})])),_:1}),n(s,{class:"stats-item"},{default:u((()=>[n(a,{class:"stats-num"},{default:u((()=>[o(f(G.value),1)])),_:1}),n(a,{class:"stats-text"},{default:u((()=>[o("ä½“æµ‹è¾¾æ ‡")])),_:1})])),_:1})])),_:1})])),_:1}),n(s,{class:"week-run-card"},{default:u((()=>[n(s,{class:"card-header"},{default:u((()=>[n(s,{class:"header-left"},{default:u((()=>[n(a,{class:"card-title"},{default:u((()=>[o("æœ¬å‘¨è·‘æ­¥")])),_:1}),n(a,{class:"target-tag"},{default:u((()=>[o("ç›®æ ‡ "+f(D.value)+" æ¬¡",1)])),_:1})])),_:1}),n(a,{class:"date-range"},{default:u((()=>[o(f(J.value),1)])),_:1})])),_:1}),n(s,{class:"week-stats"},{default:u((()=>[n(s,{class:"week-item"},{default:u((()=>[n(a,{class:"week-num"},{default:u((()=>[o(f(E.value),1)])),_:1}),n(a,{class:"week-text"},{default:u((()=>[o("è·‘æ­¥æ¬¡æ•°")])),_:1})])),_:1}),n(s,{class:"week-item"},{default:u((()=>[n(a,{class:"week-num"},{default:u((()=>[o(f(P(H.value)),1)])),_:1}),n(a,{class:"week-text"},{default:u((()=>[o("æ€»è·ç¦»(km)")])),_:1})])),_:1}),n(s,{class:"week-item"},{default:u((()=>[n(a,{class:"week-num"},{default:u((()=>[o(f(O.value),1)])),_:1}),n(a,{class:"week-text"},{default:u((()=>[o("ä½“æµ‹è¾¾æ ‡")])),_:1})])),_:1})])),_:1}),n(s,{class:"progress-box"},{default:u((()=>[n(s,{class:"progress-header"},{default:u((()=>[n(a,{class:"progress-info"},{default:u((()=>[o("å·²å®Œæˆ "+f(E.value)+"/"+f(D.value),1)])),_:1}),n(a,{class:"progress-percent"},{default:u((()=>[o(f(Math.round(R.value))+"%",1)])),_:1})])),_:1}),n(s,{class:"progress-bar"},{default:u((()=>[n(s,{class:"progress-fill",style:i({width:R.value+"%"})},null,8,["style"])])),_:1})])),_:1})])),_:1}),n(s,{class:"record-card"},{default:u((()=>[n(s,{class:"card-header"},{default:u((()=>[n(a,{class:"card-title"},{default:u((()=>[o("è¿åŠ¨è®°å½•")])),_:1}),n(v,{class:"view-all",onClick:W},{default:u((()=>[o("æŸ¥çœ‹å…¨éƒ¨")])),_:1})])),_:1}),A.value.length>0?(d(),l(s,{key:0,class:"record-list"},{default:u((()=>[(d(!0),_(p,null,m(K.value,((e,t)=>(d(),l(s,{class:"record-item",key:t,onClick:e=>{}},{default:u((()=>[n(s,{class:"record-type",style:i({backgroundColor:e.modeBg})},{default:u((()=>[n(a,{class:"type-text"},{default:u((()=>[o(f(e.modeText),1)])),_:2},1024)])),_:2},1032,["style"]),n(s,{class:"record-info"},{default:u((()=>[n(a,{class:"record-date"},{default:u((()=>[o(f(e.createTime),1)])),_:2},1024),"run"===e.type?(d(),l(a,{key:0,class:"record-data"},{default:u((()=>[o(f(e.distance)+"km | "+f(e.duration),1),e.pace?(d(),l(a,{key:0},{default:u((()=>[o(" | é…é€Ÿï¼š"+f(Number(e.pace).toFixed(1))+" åˆ†/å…¬é‡Œ",1)])),_:2},1024)):b("",!0)])),_:2},1024)):(d(),l(a,{key:1,class:"record-data"},{default:u((()=>[o(f(e.testName)+" | æ¬¡æ•°ï¼š"+f(e.testCount)+" | "+f(e.result),1)])),_:2},1024))])),_:2},1024),n(s,{class:"record-status"},{default:u((()=>[n(a,{class:"status-text",style:i({color:e.statusColor})},{default:u((()=>[o(f(e.statusText),1)])),_:2},1032,["style"])])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):(d(),l(s,{key:1,class:"empty-record"},{default:u((()=>[n(a,{class:"empty-icon"},{default:u((()=>[o("ðŸƒ")])),_:1}),n(a,{class:"empty-text"},{default:u((()=>[o("æš‚æ— è¿åŠ¨è®°å½•ï¼Œå¿«åŽ»è·‘æ­¥æ‰“å¡å§ï½ž")])),_:1})])),_:1}))])),_:1}),n(s,{class:"setting-card"},{default:u((()=>[n(s,{class:"setting-item",onClick:V},{default:u((()=>[n(a,{class:"setting-icon"},{default:u((()=>[o("ðŸ©º")])),_:1}),n(a,{class:"setting-text"},{default:u((()=>[o("å¥åº·æŠ¥å¤‡")])),_:1}),n(a,{class:"setting-desc"},{default:u((()=>[o("è¯·å‡/ä¼¤ç—…ç”³è¯·")])),_:1}),n(a,{class:"arrow"},{default:u((()=>[o("ï¼ž")])),_:1})])),_:1}),n(s,{class:"setting-item",onClick:X},{default:u((()=>[n(a,{class:"setting-icon"},{default:u((()=>[o("ðŸ“±")])),_:1}),n(a,{class:"setting-text"},{default:u((()=>[o("è®¾å¤‡ç»‘å®šï¼ˆé˜²ä»£è·‘ï¼‰")])),_:1}),n(a,{class:"setting-desc"},{default:u((()=>[o(f(L.value||"æœªç»‘å®š"),1)])),_:1}),n(a,{class:"arrow"},{default:u((()=>[o("ï¼ž")])),_:1})])),_:1}),n(s,{class:"setting-item",onClick:Y},{default:u((()=>[n(a,{class:"setting-icon"},{default:u((()=>[o("ðŸ—‘ï¸")])),_:1}),n(a,{class:"setting-text"},{default:u((()=>[o("æ¸…é™¤ç¼“å­˜")])),_:1}),n(a,{class:"setting-desc"},{default:u((()=>[o("é‡Šæ”¾æœ¬åœ°å­˜å‚¨ç©ºé—´")])),_:1}),n(a,{class:"arrow"},{default:u((()=>[o("ï¼ž")])),_:1})])),_:1}),n(s,{class:"setting-item",onClick:Z},{default:u((()=>[n(a,{class:"setting-icon"},{default:u((()=>[o("â„¹ï¸")])),_:1}),n(a,{class:"setting-text"},{default:u((()=>[o("å…³äºŽæˆ‘ä»¬")])),_:1}),n(a,{class:"setting-desc"},{default:u((()=>[o("ç‰ˆæœ¬ v1.0.0")])),_:1}),n(a,{class:"arrow"},{default:u((()=>[o("ï¼ž")])),_:1})])),_:1}),n(s,{class:"setting-item logout",onClick:ee},{default:u((()=>[n(a,{class:"setting-icon"},{default:u((()=>[o("ðŸšª")])),_:1}),n(a,{class:"setting-text"},{default:u((()=>[o("é€€å‡ºç™»å½•")])),_:1}),n(a,{class:"arrow"},{default:u((()=>[o("ï¼ž")])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),n(N,{current:"/pages/mine/mine"})])),_:1})}}},[["__scopeId","data-v-2e1e6b62"]]);export{$ as default};
