import{r as e,u as a,o as l,c as t,w as s,d as u,e as n,j as o,F as c,k as i,q as r,f as d,t as v,n as f,s as p,i as h,p as g,v as m,S as _,I as k,x as b,g as y,y as x,z as w,A as C,B as F,a as M,h as D,C as T,D as I,E as S,G as N,H as R,J as O,b as $,K as j,L as P,M as J,N as L,O as B,P as q,Q as A}from"./index-C5iLBQvu.js";import{a as V,o as z}from"./uni-app.es.BEWjhZNk.js";import{_ as H}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{C as U}from"./CustomTabBar.C3uGOtvP.js";import{a as E,s as Y,c as G}from"./request.BfbRFve_.js";const K=H({__name:"ai-chat-robot",props:{visible:Boolean,runData:{type:Object,default:()=>({distance:0,pace:0,heartRate:0})}},emits:["update:visible","share"],setup(y,{emit:x}){const w=y,C=x,F=e([{type:"robot",text:"ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ä¸“å±è¿åŠ¨å°åŠ©æ‰‹ã€‚æˆ‘æ­£åœ¨å®æ—¶åˆ†æä½ çš„è·‘æ­¥æ•°æ®ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"}]),M=e(""),D=e(0),T=()=>{C("update:visible",!1)},I=()=>{b((()=>{D.value=99999}))},S=()=>{M.value.trim()&&(N(M.value),M.value="")},N=e=>{F.value.push({type:"user",text:e}),I(),setTimeout((()=>{R(e)}),800)},R=e=>{let a={type:"robot",text:"",card:null};const{distance:l,pace:t,heartRate:s}=w.runData;if(e.includes("é…é€Ÿ")){a.text=`å½“å‰é…é€Ÿ ${t.toFixed(2)} åˆ†é’Ÿ/å…¬é‡Œã€‚`;let e="",l="#20C997";t<4?(e="é€Ÿåº¦å¾ˆå¿«ï¼Œè¯·æ³¨æ„ä¿æŒå¿ƒç‡ç¨³å®šï¼",l="#FF6B6B"):t>8?(e="é€Ÿåº¦ç¨æ…¢ï¼Œå»ºè®®åŠ å¿«æ‘†è‡‚é¢‘ç‡æ¥æå‡é€Ÿåº¦ã€‚",l="#FF9F43"):e="é…é€Ÿä¿æŒå¾—å¾ˆå¥½ï¼Œç»§ç»­åŠ æ²¹ï¼",a.card={title:"ğŸƒ é…é€Ÿåˆ†æ",chartData:[{label:"å½“å‰",value:Math.min(100,10/t*50),valText:`${t.toFixed(1)}`,color:l},{label:"ç›®æ ‡",value:70,valText:"6.0",color:"#3A7BD5"}],suggestion:e,shareable:!0}}else if(e.includes("è¿åŠ¨é‡")||e.includes("å¤Ÿå—")){const e=(l/1e3).toFixed(2);a.text=`ä½ ä»Šå¤©å·²ç»è·‘äº† ${e} å…¬é‡Œã€‚`;let t="";t=e<2?"å»ºè®®ä»Šå¤©è‡³å°‘å®Œæˆ 3 å…¬é‡Œï¼ŒåŠ æ²¹ï¼":e>10?"è¿åŠ¨é‡éå¸¸å……è¶³ï¼Œæ³¨æ„è·‘åæ‹‰ä¼¸ã€‚":"è¿åŠ¨é‡é€‚ä¸­ï¼Œä¿æŒè¿™ä¸ªèŠ‚å¥ã€‚",a.card={title:"ğŸ“Š è¿åŠ¨é‡è¯„ä¼°",chartData:[{label:"ä»Šæ—¥",value:Math.min(100,e/5*100),valText:`${e}km`,color:"#20C997"},{label:"ç›®æ ‡",value:100,valText:"5.0km",color:"#eee"}],suggestion:t,shareable:!0}}else e.includes("å»ºè®®")||e.includes("åˆ†æ")?(a.text="åŸºäºä½ çš„å®æ—¶æ•°æ®ï¼Œæˆ‘ç”Ÿæˆäº†ä¸€ä»½ç®€æŠ¥ï¼š",a.card={title:"ğŸ’¡ ç»¼åˆæ”¹è¿›å»ºè®®",suggestion:s>160?"å¿ƒç‡åé«˜ï¼Œå»ºè®®é€‚å½“æ”¾æ…¢é€Ÿåº¦ï¼Œè°ƒæ•´å‘¼å¸ã€‚":"å¿ƒç‡æ§åˆ¶è‰¯å¥½ï¼Œå¯ä»¥å°è¯•è¿›è¡Œé—´æ­‡è·‘è®­ç»ƒæå‡è€åŠ›ã€‚",chartData:[{label:"å¿ƒç‡",value:Math.min(100,s/200*100),valText:`${s}bpm`,color:s>160?"#FF4757":"#20C997"},{label:"é…é€Ÿ",value:Math.min(100,10/t*50),valText:`${t.toFixed(1)}`,color:"#3A7BD5"}],shareable:!0}):a.text="æŠ±æ­‰ï¼Œæˆ‘è¿˜åœ¨å­¦ä¹ ä¸­ï¼Œæš‚æ—¶åªèƒ½å›ç­”å…³äºé…é€Ÿã€è¿åŠ¨é‡å’Œæ”¹è¿›å»ºè®®çš„é—®é¢˜ã€‚";F.value.push(a),I()};return a((()=>w.visible),(e=>{e&&0===F.value.length&&F.value.push({type:"robot",text:"ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ä¸“å±è¿åŠ¨å°åŠ©æ‰‹ã€‚"})})),(e,a)=>{const b=h,x=g,w=m,I=_,R=k;return y.visible?(l(),t(b,{key:0,class:"ai-robot-container"},{default:s((()=>[u(b,{class:"robot-mask",onClick:T}),u(b,{class:"robot-window"},{default:s((()=>[u(b,{class:"robot-header"},{default:s((()=>[u(b,{class:"header-left"},{default:s((()=>[u(b,{class:"robot-avatar"},{default:s((()=>[n("ğŸ¤–")])),_:1}),u(b,{class:"robot-info"},{default:s((()=>[u(x,{class:"robot-name"},{default:s((()=>[n("è¿åŠ¨å°åŠ©æ‰‹")])),_:1}),u(x,{class:"robot-status"},{default:s((()=>[n("åœ¨çº¿åˆ†æä¸­...")])),_:1})])),_:1})])),_:1}),u(b,{class:"header-right"},{default:s((()=>[u(x,{class:"close-btn",onClick:T},{default:s((()=>[n("Ã—")])),_:1})])),_:1})])),_:1}),u(I,{"scroll-y":"",class:"chat-area","scroll-top":D.value},{default:s((()=>[u(b,{class:"message-list"},{default:s((()=>[(l(!0),o(c,null,i(F.value,((e,a)=>(l(),t(b,{key:a,class:r(["message-item",e.type])},{default:s((()=>["robot"===e.type?(l(),t(b,{key:0,class:"msg-avatar"},{default:s((()=>[n("ğŸ¤–")])),_:1})):d("",!0),u(b,{class:"msg-content-box"},{default:s((()=>[u(b,{class:"msg-content"},{default:s((()=>[u(x,null,{default:s((()=>[n(v(e.text),1)])),_:2},1024)])),_:2},1024),e.card?(l(),t(b,{key:0,class:"msg-card"},{default:s((()=>[u(b,{class:"card-title"},{default:s((()=>[n(v(e.card.title),1)])),_:2},1024),e.card.chartData?(l(),t(b,{key:0,class:"card-chart"},{default:s((()=>[(l(!0),o(c,null,i(e.card.chartData,((e,a)=>(l(),t(b,{class:"chart-bar-item",key:a},{default:s((()=>[u(x,{class:"bar-label"},{default:s((()=>[n(v(e.label),1)])),_:2},1024),u(b,{class:"bar-track"},{default:s((()=>[u(b,{class:"bar-fill",style:f({width:e.value+"%",background:e.color})},null,8,["style"])])),_:2},1024),u(x,{class:"bar-val"},{default:s((()=>[n(v(e.valText),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)):d("",!0),e.card.suggestion?(l(),t(b,{key:1,class:"card-suggestion"},{default:s((()=>[u(x,{class:"suggestion-icon"},{default:s((()=>[n("ğŸ’¡")])),_:1}),u(x,null,{default:s((()=>[n(v(e.card.suggestion),1)])),_:2},1024)])),_:2},1024)):d("",!0),e.card.shareable?(l(),t(w,{key:2,class:"share-btn",size:"mini",onClick:a=>{return l=e.card,p({title:"å·²å‘é€ç»™æ•™å®˜",icon:"success"}),void C("share",l);var l}},{default:s((()=>[n("åˆ†äº«ç»™æ•™å®˜")])),_:2},1032,["onClick"])):d("",!0)])),_:2},1024)):d("",!0)])),_:2},1024),"user"===e.type?(l(),t(b,{key:1,class:"msg-avatar"},{default:s((()=>[n("ğŸ‘¤")])),_:1})):d("",!0)])),_:2},1032,["class"])))),128))])),_:1})])),_:1},8,["scroll-top"]),u(b,{class:"input-area"},{default:s((()=>[u(I,{"scroll-x":"",class:"quick-replies","show-scrollbar":!1},{default:s((()=>[u(b,{class:"chip",onClick:a[0]||(a[0]=e=>N("æˆ‘çš„é…é€Ÿæ€ä¹ˆæ ·ï¼Ÿ"))},{default:s((()=>[n("é…é€Ÿåˆ†æ")])),_:1}),u(b,{class:"chip",onClick:a[1]||(a[1]=e=>N("ä»Šå¤©è¿åŠ¨é‡å¤Ÿå—ï¼Ÿ"))},{default:s((()=>[n("è¿åŠ¨é‡è¯„ä¼°")])),_:1}),u(b,{class:"chip",onClick:a[2]||(a[2]=e=>N("ç»™ç‚¹å»ºè®®"))},{default:s((()=>[n("æ”¹è¿›å»ºè®®")])),_:1})])),_:1}),u(b,{class:"input-box"},{default:s((()=>[u(R,{class:"text-input",modelValue:M.value,"onUpdate:modelValue":a[3]||(a[3]=e=>M.value=e),placeholder:"è¾“å…¥é—®é¢˜...","confirm-type":"send",onConfirm:S},null,8,["modelValue"]),u(b,{class:"send-btn",onClick:S},{default:s((()=>[n("å‘é€")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):d("",!0)}}},[["__scopeId","data-v-79d7ba8d"]]),Q=H({__name:"run",setup(a){const b=e(20);V((()=>{const e=y();b.value=e.statusBarHeight||20})),x((()=>{Oe&&clearInterval(Oe),ea()}));const H=e(!1),Q=w((()=>({distance:De.value,pace:qe.value||(De.value>0?Me.value/60/(De.value/1e3):0),heartRate:Ne.value,stepCount:Se.value}))),W=()=>{H.value=!0};z((()=>{console.log("run.vue onShow triggered"),C({title:"è·‘æ­¥"}),F({frontColor:"#ffffff",backgroundColor:"#20C997"});if("teacher"===(M("userRole")||M("role")))return p({title:"è¯¥åŠŸèƒ½ä»…å¯¹å­¦ç”Ÿå¼€æ”¾",icon:"none"}),void setTimeout((()=>{D({url:"/pages/teacher/home/home"})}),800);const e=M("runMode");e&&(Qe(e),T("runMode")),ze(),E().then((e=>{re.value=e})).catch((e=>{console.error("Failed to load checkpoints",e)})),_e.value=M("checkpoint")||{},_e.value.name&&Ke(_e.value.lat,_e.value.lng,_e.value.name);const a=M("runRecordsList")||[],l=new Date,t=new Date(l.getFullYear(),l.getMonth(),l.getDate()).getTime(),s=t+864e5;let u=0,n=0;if(a.forEach((e=>{const a=new Date(e.createTime).getTime();(!e.type||"run"===e.type)&&a>=t&&a<s&&(u+=1,n+=Number(e.distance)||0)})),Z.value=u,ee.value=Number(n.toFixed(2)),ue.value=oa(a),!Le.value){const e=M("teacherTask");if(e)try{const a="string"==typeof e?JSON.parse(e):e;ae.value=a.title||""}catch(o){ae.value=""}}}));const X=e=>{var a;const l={studentName:(null==(a=M("userInfo"))?void 0:a.name)||"å­¦å‘˜",time:(new Date).toLocaleString(),card:e};let t=M("mockSharedReports")||[];t.unshift(l),N("mockSharedReports",t)},Z=e(0),ee=e(0),ae=e(""),le=e(5),te=e(0),se=e(0),ue=e([]),ne=e([{name:"åˆæ¬¡å¼€è·‘",icon:"ğŸ…"},{name:"äº”å…¬é‡Œè¾¾äºº",icon:"ğŸƒâ€â™‚ï¸"},{name:"å…¨å‹¤å‘¨",icon:"ğŸ”¥"},{name:"æ—©èµ·é¸Ÿ",icon:"ğŸ¦"}]),oe=e(!1),ce=e([{name:"ç¯æ ¡å¤–åœˆè·‘",distance:5.2,difficulty:"ä¸­ç­‰"},{name:"æ¹–ç•”æ—è«é“",distance:3,difficulty:"ç®€å•"},{name:"ä½“è‚²åœºå†²åˆº",distance:1.5,difficulty:"å›°éš¾"}]),ie=()=>oe.value=!oe.value,re=e([]),de=e(""),ve=e(39.909),fe=e(116.397),pe=e([]),he=e({points:[],color:"#007AFF",width:4,arrowLine:!0}),ge=e(null),me=e([]),_e=e({}),ke=e([]),be=e([]),ye=()=>{const e=[];he.value.points.length>0?e.push(JSON.parse(JSON.stringify(he.value))):e.push({...he.value,points:[]}),ge.value&&e.push(JSON.parse(JSON.stringify(ge.value))),me.value=e},xe=(e,a,l,t)=>{const s=(l-e)*Math.PI/180,u=(t-a)*Math.PI/180,n=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e*Math.PI/180)*Math.cos(l*Math.PI/180)*Math.sin(u/2)*Math.sin(u/2);return 6371e3*(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)))},we=()=>{je&&clearInterval(je);let e=Date.now();je=setInterval((()=>{I({type:"gcj02",accuracy:"high",success:a=>{const l=a.latitude,t=a.longitude;let s=0;if(Fe.value&&ke.value.length>0){const a=ke.value[ke.value.length-1],u=xe(a.latitude,a.longitude,l,t),n=(Date.now()-e)/1e3;n>0&&(s=u/n)}Re.value=s,((e,a,l)=>{if(ve.value=e,fe.value=a,pe.value[0]={id:0,latitude:e,longitude:a,title:"æˆ‘çš„ä½ç½®",iconPath:"/static/location.png",width:30,height:30},Fe.value){if(ke.value.length>0){const l=ke.value[ke.value.length-1],t=xe(l.latitude,l.longitude,e,a);t>2&&t<100&&(De.value+=t)}const t={latitude:e,longitude:a,timestamp:Date.now(),speed:l||Re.value};ke.value.push(t),he.value.points.push({latitude:e,longitude:a}),ye(),"campus"===Ce.value&&_e.value.lat&&(Te.value=Math.floor(xe(e,a,_e.value.lat,_e.value.lng)),Te.value<=(_e.value.radius||50)?(Ie.value=!0,M("checkpointReached")||(_e.value.id?G({lat:e,lng:a,checkpoint_id:_e.value.id}).then((l=>{l.success&&(p({title:"æ‰“å¡æˆåŠŸï¼",icon:"success"}),be.value.push({checkpoint_id:_e.value.id,time:(new Date).toISOString(),lat:e,lng:a}))})).catch((()=>{})):p({title:"å·²åˆ°è¾¾æ‰“å¡ç‚¹èŒƒå›´ï¼",icon:"success"}),N("checkpointReached","1"))):Ie.value=!1),"normal"===Ce.value?te.value=Math.min(100,De.value/1e3/le.value*100):"police"===Ce.value&&(se.value=Math.min(100,De.value/Pe.value*100))}})(l,t,s),e=Date.now()},fail:()=>{}})}),1e3)},Ce=e("normal"),Fe=e(!1),Me=e(0),De=e(0),Te=e(0),Ie=e(!1),Se=e(0),Ne=e(80),Re=e(0);e(0);let Oe=null,$e=null,je=null;const Pe=e(2e3),Je=e(6.5),Le=e(null),Be=e(null),qe=w((()=>{const e=De.value/1e3,a=Me.value/60;if(0===e)return 0;const l=a/e;return l>999?999:l})),Ae=w((()=>(3.6*Re.value).toFixed(1))),Ve=w((()=>0===Me.value?0:(De.value/1e3/(Me.value/3600)).toFixed(1)));V((e=>{e.mode&&(Ce.value=e.mode),e.target&&(Pe.value=parseInt(e.target)),e.pace&&(Je.value=parseFloat(e.pace)),e.taskId&&(Le.value=e.taskId,e.taskType&&(Be.value=e.taskType)),e.taskTitle&&(ae.value=decodeURIComponent(e.taskTitle)),e.course&&p({title:`å¼€å§‹è¯¾ç¨‹ï¼š${e.course}`,icon:"none"})}));const ze=()=>{Ee()},He=e=>{ve.value=e.latitude,fe.value=e.longitude,pe.value=[{id:0,latitude:e.latitude,longitude:e.longitude,title:"æˆ‘çš„ä½ç½®",iconPath:"/static/location.png",width:30,height:30}];e.latitude>=39.9&&e.latitude<=39.92&&e.longitude>=116.39&&e.longitude<=116.41||"campus"!==Ce.value||p({title:"ä»…æ ¡å›­å†…å¯è¿›è¡Œæ‰“å¡",icon:"none"})},Ue=e=>{console.error("Location failed:",e);let a="å®šä½å¤±è´¥ï¼Œå·²ä½¿ç”¨æ¨¡æ‹Ÿä½ç½®";"https:"!==location.protocol&&"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname?a="H5å®šä½éœ€HTTPSï¼Œå·²åˆ‡æ¨¡æ‹Ÿä½ç½®":e.errMsg&&-1!==e.errMsg.indexOf("auth")&&(a="å®šä½æƒé™è¢«æ‹’ï¼Œå·²åˆ‡æ¨¡æ‹Ÿä½ç½®"),p({title:a,icon:"none",duration:3e3}),ve.value=39.908823,fe.value=116.39747,pe.value=[{id:0,latitude:39.908823,longitude:116.39747,title:"æˆ‘çš„ä½ç½® (æ¨¡æ‹Ÿ)",iconPath:"/static/location.png",width:30,height:30}]},Ee=()=>{const e=M("lastLocation");e&&(ve.value=e.lat,fe.value=e.lng,pe.value=[{id:0,latitude:e.lat,longitude:e.lng,title:"æˆ‘çš„ä½ç½®",iconPath:"/static/location.png",width:30,height:30}]),I({type:"gcj02",accuracy:"high",success:He,fail:e=>{if(e.errMsg&&(e.errMsg.includes("not support gcj02")||e.errMsg.includes("system location")))return console.log("GCJ02 not supported, falling back to wgs84..."),void I({type:"wgs84",success:He,fail:Ue});Ue(e)}})},Ye=()=>{if(!de.value)return void p({title:"è¯·è¾“å…¥æ‰“å¡ç‚¹åç§°",icon:"none"});const e=re.value.find((e=>e.name.includes(de.value)));if(!e)return void p({title:"æœªæ‰¾åˆ°è¯¥æ‰“å¡ç‚¹",icon:"none"});const a={name:e.name,lat:e.latitude,lng:e.longitude,radius:e.radius};N("checkpoint",a),_e.value=a,Ke(a.lat,a.lng,a.name),ge.value={points:[{latitude:ve.value,longitude:fe.value},{latitude:a.lat,longitude:a.lng}],color:"#FF0000",width:2,dottedLine:!0},ye(),p({title:`æ‰¾åˆ°${a.name}`,icon:"success"})},Ge=()=>{R({success:e=>{console.log("Selected location:",e);const a=e.latitude,l=e.longitude;let t=null,s=1/0;if(re.value.forEach((e=>{const u=xe(a,l,e.latitude,e.longitude);u<s&&(s=u,t=e)})),t&&s<=200){de.value=t.name;const e={name:t.name,lat:t.latitude,lng:t.longitude,radius:t.radius,id:t.id};N("checkpoint",e),_e.value=e,Ke(e.lat,e.lng,e.name),ge.value={points:[{latitude:ve.value,longitude:fe.value},{latitude:e.lat,longitude:e.lng}],color:"#FF0000",width:2,dottedLine:!0},ye(),p({title:`å·²å®šä½åˆ°ï¼š${t.name}`,icon:"success"})}else O({title:"æç¤º",content:"æ‚¨é€‰æ‹©çš„åœ°ç‚¹ä¸åœ¨æ ¡å›­æ‰“å¡ç‚¹èŒƒå›´å†…ï¼Œæ˜¯å¦ä»è¦è®¾ä¸ºç›®æ ‡ï¼Ÿ(æ— æ³•è¿›è¡Œæœ‰æ•ˆæ‰“å¡)",success:t=>{if(t.confirm){de.value=e.name||"è‡ªå®šä¹‰ä½ç½®";const t={name:e.name||"è‡ªå®šä¹‰ä½ç½®",lat:a,lng:l,radius:50,id:null};N("checkpoint",t),_e.value=t,Ke(a,l,t.name),ge.value={points:[{latitude:ve.value,longitude:fe.value},{latitude:a,longitude:l}],color:"#FF0000",width:2,dottedLine:!0},ye()}}})},fail:e=>{console.error("Choose location failed",e)}})},Ke=(e,a,l)=>{pe.value.push({id:1,latitude:e,longitude:a,title:l,iconPath:"/static/checkpoint.png",width:40,height:40})},Qe=e=>{Fe.value=!1,clearInterval(Oe),ea(),Me.value=0,De.value=0,Se.value=0,Ne.value=80,Ce.value=e};let We=!1,Xe=0;const Ze=()=>{L(),B({interval:"game",success:()=>{console.log("Accelerometer started"),We=!1,Xe=Date.now()},fail:e=>{console.error("Start Accelerometer failed:",e)}}),$e=e=>{let a=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);a>5&&(a/=9.8);const l=Date.now();We&&l-Xe>1500&&(We=!1),!We&&a>1.25?l-Xe>300&&(Se.value+=1,Xe=l,We=!0):We&&a<1.05&&(We=!1)},q($e)},ea=()=>{$e&&(L(),A($e),$e=null)},aa=()=>{Ne.value=80+Math.floor(Me.value/10),Ne.value>180&&O({title:"å¥åº·é¢„è­¦",content:`å½“å‰å¿ƒç‡è¿‡é«˜ï¼ˆ${Ne.value}æ¬¡/åˆ†ï¼‰ï¼Œå»ºè®®é™é€Ÿä¼‘æ¯`,showCancel:!1})},la=()=>{if(Fe.value=!0,Me.value=0,De.value=0,Se.value=0,Ne.value=80,he.value.points=[],ke.value=[],ve.value&&fe.value){const e={latitude:ve.value,longitude:fe.value,timestamp:Date.now(),speed:0};ke.value.push(e),he.value.points.push({latitude:ve.value,longitude:fe.value}),ye()}},ta=()=>{ge.value=null,la(),T("checkpointReached"),we(),Ze(),Oe=setInterval((()=>{Me.value+=1,aa()}),1e3)},sa=()=>{la(),T("policeFinishTip"),we(),Ze(),Oe=setInterval((()=>{Me.value+=1,aa(),De.value>=Pe.value&&!M("policeFinishTip")&&(p({title:"å·²å®Œæˆ2000ç±³ç›®æ ‡ï¼",icon:"success"}),N("policeFinishTip","1"))}),1e3)},ua=()=>{la(),Ie.value=!1,T("checkpointReached"),we(),Ze(),Oe=setInterval((()=>{Me.value+=1,aa()}),1e3)},na=async()=>{if(!Fe.value)return;Fe.value=!1,clearInterval(Oe),ea(),je&&(clearInterval(je),je=null);if(!M("token"))return p({title:"è¯·å…ˆç™»å½•",icon:"none"}),void setTimeout((()=>{$({url:"/pages/login/login"})}),800);const e={type:Be.value?Be.value:"police"===Ce.value?"test":"run",source:Le.value?"task":"free",started_at:new Date(Date.now()-1e3*Me.value).toISOString(),ended_at:(new Date).toISOString(),metrics:{distance:De.value/1e3,duration:Me.value,pace:qe.value.toFixed(1),count:"police"===Ce.value?1:null,qualified:"police"===Ce.value&&qe.value<=Je.value,trajectory:JSON.stringify(ke.value),checkpoints:JSON.stringify(be.value)},evidence:[]};try{j({title:"æäº¤ä¸­..."});const a=await Y(e);P(),console.log("Submit success:",a),N("tempRunResult",e),D({url:"/pages/result/result?useStorage=true",fail:e=>{console.error("Navigate failed:",e),p({title:"é¡µé¢è·³è½¬å¤±è´¥",icon:"none"})}})}catch(a){P(),console.error("Submit failed:",a),O({title:"æäº¤å¤±è´¥",content:a&&a.detail?a.detail:"ç½‘ç»œæˆ–æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·é‡è¯•",confirmText:"é‡è¯•",cancelText:"å¼ºåˆ¶ç»“æŸ",success:e=>{e.confirm||e.cancel&&(p({title:"å·²å¼ºåˆ¶ç»“æŸ",icon:"none"}),setTimeout((()=>{$({url:"/pages/home/home"})}),800))}})}},oa=e=>{const a=new Date,l=[];for(let t=0;t<7;t++){const s=new Date(a.getFullYear(),a.getMonth(),a.getDate()-t),u=new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime(),n=u+864e5,o=e.filter((e=>{const a=new Date(e.createTime).getTime();return(!e.type||"run"===e.type)&&a>=u&&a<n})),c=o.length,i=o.reduce(((e,a)=>e+Number(a.distance||0)),0);l.push({date:`${s.getMonth()+1}/${s.getDate()}`,count:c,distance:Number(i.toFixed(2))})}return l.reverse()};return(e,a)=>{const y=g,x=h,w=_,C=k,F=m,M=J;return l(),t(x,{class:"run"},{default:s((()=>[u(x,{class:"custom-navbar",style:f({paddingTop:b.value+"px"})},{default:s((()=>[u(x,{class:"navbar-content"},{default:s((()=>[u(y,{class:"navbar-title"},{default:s((()=>[n("è·‘æ­¥")])),_:1})])),_:1})])),_:1},8,["style"]),u(x,{class:"content-spacer",style:f({height:b.value+44+"px"})},null,8,["style"]),u(K,{visible:H.value,"onUpdate:visible":a[0]||(a[0]=e=>H.value=e),"run-data":Q.value,onShare:X},null,8,["visible","run-data"]),Fe.value||De.value>0?(l(),t(x,{key:0,class:"ai-float-btn",onClick:W},{default:s((()=>[u(y,{class:"ai-btn-icon"},{default:s((()=>[n("ğŸ¤–")])),_:1}),u(y,{class:"ai-btn-text"},{default:s((()=>[n("AIåŠ©æ‰‹")])),_:1})])),_:1})):d("",!0),u(x,{class:"top-widgets"},{default:s((()=>[u(x,{class:"weather-widget"},{default:s((()=>[u(x,{class:"weather-left"},{default:s((()=>[u(y,{class:"weather-temp"},{default:s((()=>[n("24Â°C")])),_:1}),u(y,{class:"weather-status"},{default:s((()=>[n("â˜€ï¸ æ™´æœ—")])),_:1})])),_:1}),u(x,{class:"weather-right"},{default:s((()=>[u(y,{class:"weather-tips"},{default:s((()=>[n("ç©ºæ°”ä¼˜ Â· é€‚å®œè·‘æ­¥")])),_:1})])),_:1})])),_:1}),u(w,{"scroll-x":"",class:"achievements-scroll","show-scrollbar":!1},{default:s((()=>[(l(!0),o(c,null,i(ne.value,((e,a)=>(l(),t(x,{class:"badge-item",key:a},{default:s((()=>[u(y,{class:"badge-icon"},{default:s((()=>[n(v(e.icon),1)])),_:2},1024),u(y,{class:"badge-name"},{default:s((()=>[n(v(e.name),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),"campus"===Ce.value?(l(),t(x,{key:1,class:"search-bar"},{default:s((()=>[u(C,{modelValue:de.value,"onUpdate:modelValue":a[1]||(a[1]=e=>de.value=e),placeholder:"è¾“å…¥æ ¡å›­æ‰“å¡ç‚¹ï¼ˆå¦‚ï¼šæ“åœº/è·‘é“ï¼‰",class:"search-input"},null,8,["modelValue"]),u(x,{class:"map-select-btn",onClick:Ge},{default:s((()=>[u(y,{class:"map-icon"},{default:s((()=>[n("ğŸ—ºï¸")])),_:1})])),_:1}),u(F,{onClick:Ye,class:"search-btn"},{default:s((()=>[n("æœç´¢")])),_:1})])),_:1})):d("",!0),u(x,{class:"overview-card"},{default:s((()=>[u(y,{class:"overview-title"},{default:s((()=>[n("ä»Šæ—¥è·‘æ­¥æ¦‚è§ˆ")])),_:1}),u(x,{class:"overview-meta"},{default:s((()=>[u(y,null,{default:s((()=>[n("æ¬¡æ•°ï¼š"+v(Z.value),1)])),_:1}),u(y,null,{default:s((()=>[n("é‡Œç¨‹ï¼š"+v(ee.value)+" km",1)])),_:1})])),_:1}),ae.value?(l(),t(y,{key:0,class:"task-tip"},{default:s((()=>[n("æ•™å¸ˆä»»åŠ¡ï¼š"+v(ae.value),1)])),_:1})):d("",!0)])),_:1}),u(M,{class:"map",latitude:ve.value,longitude:fe.value,markers:pe.value,polyline:me.value},null,8,["latitude","longitude","markers","polyline"]),"normal"===Ce.value?(l(),t(x,{key:2,class:"routes-card"},{default:s((()=>[u(x,{class:"card-header",onClick:ie},{default:s((()=>[u(y,{class:"card-title"},{default:s((()=>[n("ğŸƒ æ¨èè·¯çº¿")])),_:1}),u(y,{class:"card-toggle"},{default:s((()=>[n(v(oe.value?"æ”¶èµ·":"å±•å¼€"),1)])),_:1})])),_:1}),oe.value?(l(),t(x,{key:0,class:"routes-list"},{default:s((()=>[(l(!0),o(c,null,i(ce.value,((e,a)=>(l(),t(x,{class:"route-item",key:a,onClick:a=>(e=>{p({title:`å·²åŠ è½½è·¯çº¿ï¼š${e.name}`,icon:"none"}),le.value=e.distance})(e)},{default:s((()=>[u(x,{class:"route-info"},{default:s((()=>[u(y,{class:"route-name"},{default:s((()=>[n(v(e.name),1)])),_:2},1024),u(y,{class:"route-meta"},{default:s((()=>[n(v(e.distance)+"km Â· "+v(e.difficulty),1)])),_:2},1024)])),_:2},1024),u(y,{class:"route-action"},{default:s((()=>[n("å»è·‘æ­¥ >")])),_:1})])),_:2},1032,["onClick"])))),128))])),_:1})):d("",!0)])),_:1})):d("",!0),u(x,{class:"mode-switch"},{default:s((()=>[u(y,{class:r(["mode-item",{active:"normal"===Ce.value}]),onClick:a[2]||(a[2]=e=>Qe("normal"))},{default:s((()=>[n("æ™®é€šè·‘æ­¥")])),_:1},8,["class"]),u(y,{class:r(["mode-item",{active:"police"===Ce.value}]),onClick:a[3]||(a[3]=e=>Qe("police"))},{default:s((()=>[n("ä¸“é¡¹æµ‹è¯•")])),_:1},8,["class"]),u(y,{class:r(["mode-item",{active:"campus"===Ce.value}]),onClick:a[4]||(a[4]=e=>Qe("campus"))},{default:s((()=>[n("æ ¡å›­æ‰“å¡")])),_:1},8,["class"])])),_:1}),"police"===Ce.value?(l(),t(x,{key:3,class:"police-plan"},{default:s((()=>[u(y,{class:"plan-title"},{default:s((()=>[n("ğŸ¯ 2000ç±³ä½“èƒ½ä¸“é¡¹è®­ç»ƒ")])),_:1}),u(x,{class:"plan-info"},{default:s((()=>[u(y,{class:"info-item"},{default:s((()=>[n("ç›®æ ‡è·ç¦»ï¼š"),S("span",{class:"highlight"},v(Pe.value/1e3)+"å…¬é‡Œ",1)])),_:1}),u(y,{class:"info-item"},{default:s((()=>[n("è¾¾æ ‡é…é€Ÿï¼š"),S("span",{class:"highlight"},v(Je.value)+"åˆ†é’Ÿ/å…¬é‡Œ",1)])),_:1}),u(y,{class:"info-item"},{default:s((()=>[n("å»ºè®®æ ‡å‡†ï¼š"),S("span",{class:"highlight"},"å¯æŒ‰å­¦æ ¡æˆ–è¯¾ç¨‹è¦æ±‚é…ç½®")])),_:1})])),_:1})])),_:1})):d("",!0),"normal"===Ce.value?(l(),t(x,{key:4,class:"run-mode-box"},{default:s((()=>[Fe.value?(l(),t(x,{key:1,class:"running-box"},{default:s((()=>[u(y,{class:"data"},{default:s((()=>[n("æ—¶é•¿ï¼š"+v(Me.value)+"ç§’ | å·²è·‘ï¼š"+v(((De.value||0)/1e3).toFixed(2))+"km | é€Ÿåº¦ï¼š"+v(Ae.value)+"km/h",1)])),_:1}),u(y,{class:"data"},{default:s((()=>[n("æ­¥æ•°ï¼š"+v(Se.value)+" | å¿ƒç‡ï¼š"+v(Ne.value)+"æ¬¡/åˆ† | å¹³å‡é€Ÿåº¦ï¼š"+v(Ve.value)+"km/h",1)])),_:1}),u(x,{class:"progress-wrap"},{default:s((()=>[u(x,{class:"progress-bar"},{default:s((()=>[u(x,{class:"progress-fill",style:f({width:te.value+"%"})},null,8,["style"])])),_:1}),u(y,{class:"progress-text"},{default:s((()=>[n("ä»Šæ—¥ç›®æ ‡ "+v(le.value)+" km Â· å®Œæˆ "+v(((De.value||0)/1e3).toFixed(2))+" km",1)])),_:1})])),_:1}),u(F,{onClick:na,class:"stop-btn"},{default:s((()=>[n("ç»“æŸè·‘æ­¥")])),_:1})])),_:1})):(l(),t(x,{key:0,class:"start-box"},{default:s((()=>[u(y,{class:"tip"},{default:s((()=>[n("æ— åœ°ç‚¹/è·ç¦»é™åˆ¶ï¼Œè‡ªç”±è®°å½•è·‘æ­¥è½¨è¿¹")])),_:1}),u(F,{onClick:ta,class:"start-btn"},{default:s((()=>[n("å¼€å§‹è·‘æ­¥")])),_:1})])),_:1}))])),_:1})):d("",!0),"police"===Ce.value?(l(),t(x,{key:5,class:"run-mode-box"},{default:s((()=>[Fe.value?(l(),t(x,{key:1,class:"running-box"},{default:s((()=>[u(y,{class:"data"},{default:s((()=>[n("æ—¶é•¿ï¼š"+v(Me.value)+"ç§’ | å·²è·‘ï¼š"+v((De.value/1e3).toFixed(2))+"km / ç›®æ ‡ï¼š2km",1)])),_:1}),u(y,{class:"data"},{default:s((()=>[n("å‰©ä½™ï¼š"+v(((Pe.value-De.value)/1e3).toFixed(2))+"km | é…é€Ÿï¼š"+v(qe.value.toFixed(1))+"åˆ†é’Ÿ/å…¬é‡Œ",1)])),_:1}),u(y,{class:"data"},{default:s((()=>[n("å¿ƒç‡ï¼š"+v(Ne.value)+"æ¬¡/åˆ† | æ­¥æ•°ï¼š"+v(Se.value),1)])),_:1}),u(y,{class:"pace-status",style:f({color:qe.value<=Je.value?"green":"red"})},{default:s((()=>[n(v(qe.value<=Je.value?"âœ… é…é€Ÿè¾¾æ ‡":"âŒ é…é€Ÿæœªè¾¾æ ‡"),1)])),_:1},8,["style"]),De.value>=Pe.value?(l(),t(y,{key:0,class:"finish-tip"},{default:s((()=>[n("ğŸ‰ å·²å®Œæˆ2000ç±³ç›®æ ‡ï¼")])),_:1})):d("",!0),u(x,{class:"progress-wrap"},{default:s((()=>[u(x,{class:"progress-bar"},{default:s((()=>[u(x,{class:"progress-fill",style:f({width:se.value+"%"})},null,8,["style"])])),_:1}),u(y,{class:"progress-text"},{default:s((()=>[n("ä¸“é¡¹ç›®æ ‡ 2 km Â· å®Œæˆ "+v((De.value/1e3).toFixed(2))+" km",1)])),_:1})])),_:1}),u(F,{onClick:na,class:"stop-btn"},{default:s((()=>[n("ç»“æŸè®­ç»ƒ")])),_:1})])),_:1})):(l(),t(x,{key:0,class:"start-box"},{default:s((()=>[u(y,{class:"tip"},{default:s((()=>[n("æŒ‰è¯¾ç¨‹è¦æ±‚å®Œæˆ2000ç±³è·‘ï¼Œè‡ªåŠ¨æ ¡éªŒé…é€Ÿæ˜¯å¦è¾¾æ ‡")])),_:1}),u(F,{onClick:sa,class:"start-btn"},{default:s((()=>[n("å¼€å§‹ä¸“é¡¹è®­ç»ƒ")])),_:1})])),_:1}))])),_:1})):d("",!0),"campus"===Ce.value?(l(),t(x,{key:6,class:"run-mode-box"},{default:s((()=>[_e.value.name?(l(),t(x,{key:1},{default:s((()=>[Fe.value?(l(),t(x,{key:1,class:"running-box"},{default:s((()=>[u(y,{class:"data"},{default:s((()=>[n("æ—¶é•¿ï¼š"+v(Me.value)+"ç§’ | è·æ‰“å¡ç‚¹ï¼š"+v(Te.value)+"ç±³ | æ­¥æ•°ï¼š"+v(Se.value)+" | å¿ƒç‡ï¼š"+v(Ne.value)+"æ¬¡/åˆ†",1)])),_:1}),u(y,{class:"reach-status",style:f({color:Ie.value?"green":"red"})},{default:s((()=>[n(v(Ie.value?"âœ… å·²åˆ°è¾¾æ‰“å¡ç‚¹":"âŒ æœªåˆ°è¾¾æ‰“å¡ç‚¹"),1)])),_:1},8,["style"]),u(F,{onClick:na,class:"stop-btn"},{default:s((()=>[n("ç»“æŸæ‰“å¡")])),_:1})])),_:1})):(l(),t(x,{key:0,class:"start-box"},{default:s((()=>[u(y,{class:"checkpoint-info"},{default:s((()=>[n("æ‰“å¡ç‚¹ï¼š"+v(_e.value.name)+"ï¼ˆéœ€åˆ°è¾¾10ç±³å†…ï¼‰",1)])),_:1}),u(F,{onClick:ua,class:"start-btn"},{default:s((()=>[n("å¼€å§‹æ‰“å¡")])),_:1})])),_:1}))])),_:1})):(l(),t(x,{key:0,class:"no-checkpoint"},{default:s((()=>[u(y,{class:"tip"},{default:s((()=>[n("è¯·å…ˆæœç´¢æ ¡å›­æ‰“å¡ç‚¹")])),_:1})])),_:1}))])),_:1})):d("",!0),u(U,{current:"/pages/run/run"})])),_:1})}}},[["__scopeId","data-v-a6400e55"]]);export{Q as default};
