import{r as e,G as t,H as s,s as a,g as l,c,w as u,i as n,o as i,a as d,b as o,t as r,m as f,f as _,h as m,F as g,C as p,y as v,J as k,B as x,K as w,L as y,N as C,q as h,k as $,d as D}from"./index-uRXP6RJd.js";import{_ as b}from"./avatar.WOnTDsO9.js";import{a as T,o as F,b as N}from"./uni-app.es.CewT9dt1.js";import{C as M}from"./CustomTabBar.BfyoH42O.js";import{_ as R}from"./_plugin-vue_export-helper.BCo6x5W8.js";const j=R({__name:"mine",setup(R){const j=e("è¿åŠ¨å…ˆé”‹"),I=e("2024çº§ä¾¦æŸ¥ç³»"),S=e(""),B=e(0),P=e(0),L=e(0),H=e(0),Q=e(0),q=e(0),E=e(""),G=e(0),J=e([]),K=e([]);T((()=>{t()})),F((()=>{z(),A(),O(),U()})),N((()=>{z(),A(),O(),setTimeout((()=>{s(),a({title:"æ•°æ®å·²åˆ·æ–°",icon:"success"})}),500)}));const z=()=>{B.value=Number(l("totalRunCount"))||0,P.value=(Number(l("totalRunDistance"))||0).toFixed(1),L.value=Number(l("policeSuccessCount"))||0},A=()=>{const e=new Date,t=new Date(e.setDate(e.getDate()-e.getDay()+1)),s=new Date(e.setDate(e.getDate()+6));E.value=`${t.getMonth()+1}æœˆ${t.getDate()}æ—¥ - ${s.getMonth()+1}æœˆ${s.getDate()}æ—¥`;const a=l("runRecordsList")||[];let c=0,u=0,n=0;a.forEach((e=>{const a=new Date(e.createTime);if(a>=t&&a<=s){(!e.type||"run"===e.type)&&(c++,u+=e.distance,"police"===e.mode&&e.isPaceQualified&&n++)}})),H.value=c,Q.value=u.toFixed(1),q.value=n,G.value=Math.min(c/3*100,100)},O=()=>{const e=l("runRecordsList")||[];J.value=e.map((e=>{const t=new Date(e.createTime),s=`${t.getMonth()+1}æœˆ${t.getDate()}æ—¥ ${t.getHours()}:${t.getMinutes()}`,a=Math.floor(e.duration/60),l=e.duration%60,c=`${a.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`;let u="",n="",i="",d="";const o=e.type||"run";return"run"===o&&"police"===e.mode?(u="è­¦åŠ¡ä¸“é¡¹",n="#fdf2f0",e.isPoliceFinish&&e.isPaceQualified?(i="è¾¾æ ‡å®Œæˆ",d="#20C997"):e.isPoliceFinish?(i="æœªè¾¾æ ‡",d="#d81e06"):(i="æœªå®Œæˆ",d="#ff9500")):"run"===o&&"campus"===e.mode?(u="æ ¡å›­æ‰“å¡",n="#e8f4f8",i=e.isReach?"æ‰“å¡æˆåŠŸ":"æ‰“å¡å¤±è´¥",d=e.isReach?"#20C997":"#d81e06"):"run"===o?(u="æ™®é€šè·‘æ­¥",n="#f5f5f5",i="å·²å®Œæˆ",d="#666"):(u="ä½“èƒ½æµ‹è¯•",n="#f3f7ff",i="åˆæ ¼"===e.result?"åˆæ ¼":"æœªåˆæ ¼",d="åˆæ ¼"===e.result?"#20C997":"#d81e06"),{...e,createTime:s,duration:c,modeText:u,modeBg:n,statusText:i,statusColor:d,type:o}})).reverse(),K.value=J.value.slice(0,5)},U=()=>{S.value=l("bindDeviceId")||""},V=()=>{a({title:"æš‚æœªå¼€æ”¾ï¼Œæ•¬è¯·æœŸå¾…",icon:"none"})},W=()=>{0!==J.value.length?a({title:"å·²å±•ç¤ºå…¨éƒ¨è®°å½•",icon:"success"}):a({title:"æš‚æ— è¿åŠ¨è®°å½•",icon:"none"})},X=()=>{S.value?p({title:"è®¾å¤‡ç»‘å®š",content:"æ˜¯å¦è§£é™¤å½“å‰è®¾å¤‡ç»‘å®šï¼Ÿ",success:e=>{e.confirm&&(v("bindDeviceId"),S.value="",a({title:"å·²è§£é™¤ç»‘å®š",icon:"success"}))}}):k({success:e=>{const t=e.deviceId||`${e.platform}_${e.model}`;x("bindDeviceId",t),S.value=t,a({title:"è®¾å¤‡ç»‘å®šæˆåŠŸ",icon:"success"})},fail:()=>{a({title:"èŽ·å–è®¾å¤‡ä¿¡æ¯å¤±è´¥",icon:"none"})}})},Y=()=>{p({title:"æ¸…é™¤ç¼“å­˜",content:"ç¡®å®šè¦æ¸…é™¤æœ¬åœ°ç¼“å­˜å—ï¼Ÿè¿åŠ¨è®°å½•ä¸ä¼šè¢«åˆ é™¤",success:e=>{e.confirm&&(v("checkpoint"),v("policeFinishTip"),a({title:"ç¼“å­˜å·²æ¸…é™¤",icon:"success"}))}})},Z=()=>{p({title:"å…³äºŽæˆ‘ä»¬",content:"å¤§å­¦ç”Ÿè¿åŠ¨å¥åº·ç®¡ç†ç³»ç»Ÿ v1.0.0\nä¸“ä¸ºå…¬å®‰é™¢æ ¡å®šåˆ¶çš„è·‘æ­¥æ‰“å¡å·¥å…·",showCancel:!1})},ee=()=>{p({title:"é€€å‡ºç™»å½•",content:"ç¡®å®šè¦é€€å‡ºå½“å‰è´¦å·å—ï¼Ÿ",success:e=>{e.confirm&&(w(),y({url:"/pages/login/login"}))}})};return(e,t)=>{const s=C,a=h,l=n,v=$;return i(),c(l,{class:"mine-page"},{default:u((()=>[d(l,{class:"user-header"},{default:u((()=>[d(l,{class:"avatar-box"},{default:u((()=>[d(s,{class:"avatar",src:b,mode:"aspectFill"}),d(a,{class:"edit-avatar",onClick:V},{default:u((()=>[o("ç¼–è¾‘èµ„æ–™")])),_:1})])),_:1}),d(l,{class:"user-info"},{default:u((()=>[d(v,{class:"username"},{default:u((()=>[o(r(j.value),1)])),_:1}),d(v,{class:"user-desc"},{default:u((()=>[o("å…¬å®‰é™¢æ ¡è¿åŠ¨æ‰“å¡ Â· "+r(I.value),1)])),_:1})])),_:1}),d(l,{class:"user-stats"},{default:u((()=>[d(l,{class:"stats-item"},{default:u((()=>[d(v,{class:"stats-num"},{default:u((()=>[o(r(B.value),1)])),_:1}),d(v,{class:"stats-text"},{default:u((()=>[o("æ€»æ¬¡æ•°")])),_:1})])),_:1}),d(l,{class:"stats-item"},{default:u((()=>[d(v,{class:"stats-num"},{default:u((()=>[o(r(P.value)+"km",1)])),_:1}),d(v,{class:"stats-text"},{default:u((()=>[o("æ€»è·ç¦»")])),_:1})])),_:1}),d(l,{class:"stats-item"},{default:u((()=>[d(v,{class:"stats-num"},{default:u((()=>[o(r(L.value),1)])),_:1}),d(v,{class:"stats-text"},{default:u((()=>[o("è­¦åŠ¡è¾¾æ ‡")])),_:1})])),_:1})])),_:1})])),_:1}),d(l,{class:"week-run-card"},{default:u((()=>[d(l,{class:"card-header"},{default:u((()=>[d(v,{class:"card-title"},{default:u((()=>[o("æœ¬å‘¨è·‘æ­¥")])),_:1}),d(v,{class:"date-range"},{default:u((()=>[o(r(E.value),1)])),_:1})])),_:1}),d(l,{class:"week-stats"},{default:u((()=>[d(l,{class:"week-item"},{default:u((()=>[d(v,{class:"week-num"},{default:u((()=>[o(r(H.value),1)])),_:1}),d(v,{class:"week-text"},{default:u((()=>[o("è·‘æ­¥æ¬¡æ•°")])),_:1})])),_:1}),d(l,{class:"week-item"},{default:u((()=>[d(v,{class:"week-num"},{default:u((()=>[o(r(Q.value)+"km",1)])),_:1}),d(v,{class:"week-text"},{default:u((()=>[o("æ€»è·ç¦»")])),_:1})])),_:1}),d(l,{class:"week-item"},{default:u((()=>[d(v,{class:"week-num"},{default:u((()=>[o(r(q.value)+"æ¬¡",1)])),_:1}),d(v,{class:"week-text"},{default:u((()=>[o("è­¦åŠ¡è¾¾æ ‡")])),_:1})])),_:1})])),_:1}),d(l,{class:"progress-box"},{default:u((()=>[d(v,{class:"progress-title"},{default:u((()=>[o("æœ¬å‘¨ç›®æ ‡ï¼šè·‘æ­¥3æ¬¡ï¼ˆå®Œæˆ"+r(H.value)+"/3ï¼‰",1)])),_:1}),d(l,{class:"progress-bar"},{default:u((()=>[d(l,{class:"progress-fill",style:f({width:G.value+"%"})},null,8,["style"])])),_:1})])),_:1})])),_:1}),d(l,{class:"record-card"},{default:u((()=>[d(l,{class:"card-header"},{default:u((()=>[d(v,{class:"card-title"},{default:u((()=>[o("è¿åŠ¨è®°å½•")])),_:1}),d(a,{class:"view-all",onClick:W},{default:u((()=>[o("æŸ¥çœ‹å…¨éƒ¨")])),_:1})])),_:1}),J.value.length>0?(i(),c(l,{key:0,class:"record-list"},{default:u((()=>[(i(!0),_(g,null,m(K.value,((e,t)=>(i(),c(l,{class:"record-item",key:t,onClick:t=>(e=>{p({title:"è®°å½•è¯¦æƒ…",content:"run"===e.type?`æ¨¡å¼ï¼š${e.modeText}\næ—¶é—´ï¼š${e.createTime}\nè·ç¦»ï¼š${e.distance}km\næ—¶é•¿ï¼š${e.duration}\nçŠ¶æ€ï¼š${e.statusText}`:`ç±»åž‹ï¼šä½“èƒ½æµ‹è¯•\né¡¹ç›®ï¼š${e.testName}\næ¬¡æ•°ï¼š${e.testCount}\nåˆ¤å®šï¼š${e.result}\næ—¶é•¿ï¼š${e.duration}`,showCancel:!1})})(e)},{default:u((()=>[d(l,{class:"record-type",style:f({backgroundColor:e.modeBg})},{default:u((()=>[d(v,{class:"type-text"},{default:u((()=>[o(r(e.modeText),1)])),_:2},1024)])),_:2},1032,["style"]),d(l,{class:"record-info"},{default:u((()=>[d(v,{class:"record-date"},{default:u((()=>[o(r(e.createTime),1)])),_:2},1024),"run"===e.type?(i(),c(v,{key:0,class:"record-data"},{default:u((()=>[o(r(e.distance)+"km | "+r(e.duration),1),e.pace?(i(),c(v,{key:0},{default:u((()=>[o(" | é…é€Ÿï¼š"+r(Number(e.pace).toFixed(1))+" åˆ†/å…¬é‡Œ",1)])),_:2},1024)):D("",!0)])),_:2},1024)):(i(),c(v,{key:1,class:"record-data"},{default:u((()=>[o(r(e.testName)+" | æ¬¡æ•°ï¼š"+r(e.testCount)+" | "+r(e.result),1)])),_:2},1024))])),_:2},1024),d(l,{class:"record-status"},{default:u((()=>[d(v,{class:"status-text",style:f({color:e.statusColor})},{default:u((()=>[o(r(e.statusText),1)])),_:2},1032,["style"])])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):(i(),c(l,{key:1,class:"empty-record"},{default:u((()=>[d(v,{class:"empty-icon"},{default:u((()=>[o("ðŸƒ")])),_:1}),d(v,{class:"empty-text"},{default:u((()=>[o("æš‚æ— è¿åŠ¨è®°å½•ï¼Œå¿«åŽ»è·‘æ­¥æ‰“å¡å§ï½ž")])),_:1})])),_:1}))])),_:1}),d(l,{class:"setting-card"},{default:u((()=>[d(l,{class:"setting-item",onClick:X},{default:u((()=>[d(v,{class:"setting-icon"},{default:u((()=>[o("ðŸ“±")])),_:1}),d(v,{class:"setting-text"},{default:u((()=>[o("è®¾å¤‡ç»‘å®šï¼ˆé˜²ä»£è·‘ï¼‰")])),_:1}),d(v,{class:"setting-desc"},{default:u((()=>[o(r(S.value||"æœªç»‘å®š"),1)])),_:1}),d(v,{class:"arrow"},{default:u((()=>[o("ï¼ž")])),_:1})])),_:1}),d(l,{class:"setting-item",onClick:Y},{default:u((()=>[d(v,{class:"setting-icon"},{default:u((()=>[o("ðŸ—‘ï¸")])),_:1}),d(v,{class:"setting-text"},{default:u((()=>[o("æ¸…é™¤ç¼“å­˜")])),_:1}),d(v,{class:"setting-desc"},{default:u((()=>[o("é‡Šæ”¾æœ¬åœ°å­˜å‚¨ç©ºé—´")])),_:1}),d(v,{class:"arrow"},{default:u((()=>[o("ï¼ž")])),_:1})])),_:1}),d(l,{class:"setting-item",onClick:Z},{default:u((()=>[d(v,{class:"setting-icon"},{default:u((()=>[o("â„¹ï¸")])),_:1}),d(v,{class:"setting-text"},{default:u((()=>[o("å…³äºŽæˆ‘ä»¬")])),_:1}),d(v,{class:"setting-desc"},{default:u((()=>[o("ç‰ˆæœ¬ v1.0.0")])),_:1}),d(v,{class:"arrow"},{default:u((()=>[o("ï¼ž")])),_:1})])),_:1}),d(l,{class:"setting-item logout",onClick:ee},{default:u((()=>[d(v,{class:"setting-icon"},{default:u((()=>[o("ðŸšª")])),_:1}),d(v,{class:"setting-text"},{default:u((()=>[o("é€€å‡ºç™»å½•")])),_:1}),d(v,{class:"arrow"},{default:u((()=>[o("ï¼ž")])),_:1})])),_:1})])),_:1}),d(M,{current:"/pages/mine/mine"})])),_:1})}}},[["__scopeId","data-v-1b0fb107"]]);export{j as default};
