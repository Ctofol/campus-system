import{r as e,Y as a,y as l,s as t,c as s,w as o,i as n,o as u,d as r,e as i,t as c,f as d,q as v,J as m,K as f,L as _,m as p,ae as y,a3 as g,p as h,v as k}from"./index-B3FfpJ1t.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=b({__name:"ai-police",setup(b){const x=e(!1),w=e(0),E=e("准备就绪"),I=e("normal"),C=e(0),T=e("Standing");let z=null,D=null;a((()=>{M()})),l((()=>{D&&D.getTracks().forEach((e=>e.stop()))}));const M=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("浏览器不支持摄像头访问");const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}}});D=e,setTimeout((()=>{let a=document.getElementById("h5-video-el");if(console.log("AI Police Video Element:",a),a&&"VIDEO"!==a.tagName){const e=a.querySelector("video");e&&(a=e)}a&&"function"==typeof a.play?(a.srcObject=e,a.play().catch((e=>console.error("Play error:",e)))):(console.error("Video element invalid:",a),t({title:"画面加载失败",icon:"none"}))}),500)}catch(e){q(e)}},S=()=>{x.value=!0,E.value="正在检测...",I.value="normal",w.value=0,A()},j=()=>{x.value=!1,E.value="训练结束",clearInterval(z),m({title:"训练结束",content:`本次训练共完成 ${w.value} 次，是否查看结果？`,confirmText:"查看结果",cancelText:"取消",success:e=>{e.confirm&&(f({title:"正在保存..."}),setTimeout((()=>{_(),p({url:`/pages/result/result?mode=test&project=AI智能训练&count=${w.value}&duration=0`})}),800))}})},A=()=>{z=setInterval((()=>{C.value=(95+5*Math.random()).toFixed(1)}),1e3)},N=()=>{x&&(E.value="动作标准",I.value="success",T.value="Squat Down",setTimeout((()=>{w.value++,T.value="Standing",E.value="正在检测...",I.value="normal"}),800))},$=e=>{x&&(E.value=`警告：${e}`,I.value="warn",C.value=(40*Math.random()).toFixed(1),y(),t({title:`检测到异常：${e}`,icon:"none",duration:2e3}),setTimeout((()=>{E.value="正在检测...",I.value="normal",C.value=98.5}),2e3))},q=e=>{console.error("Camera Error:",e);let a="无法访问摄像头";"NotAllowedError"===e.name||"Permission denied"===e.message?a="权限被拒绝，请在设置中允许摄像头访问":"NotFoundError"===e.name?a="未检测到摄像头设备":"NotSupportedError"===e.name&&(a="浏览器不支持该摄像头配置"),t({title:a,icon:"none",duration:3e3})};return(e,a)=>{const l=g,t=n,m=h,f=k;return u(),s(t,{class:"ai-police"},{default:o((()=>[r(t,{class:"camera-area"},{default:o((()=>[r(t,{class:"h5-camera-wrapper"},{default:o((()=>[r(l,{id:"h5-video-el",class:"real-camera",autoplay:"",playsinline:"",muted:"",controls:!1}),r(t,{class:"camera-overlay"},{default:o((()=>[x.value?(u(),s(t,{key:1,class:"skeleton-overlay"},{default:o((()=>[r(t,{class:"skeleton-box"})])),_:1})):(u(),s(t,{key:0,class:"camera-tip"},{default:o((()=>[i("请将全身置于摄像头区域内")])),_:1})),x.value?(u(),s(t,{key:2,class:"debug-info"},{default:o((()=>[i(" 置信度: "+c(C.value)+"% | 姿态: "+c(T.value),1)])),_:1})):d("",!0)])),_:1})])),_:1})])),_:1}),r(t,{class:"dashboard"},{default:o((()=>[r(t,{class:"counter-box"},{default:o((()=>[r(m,{class:"count-label"},{default:o((()=>[i("有效计数")])),_:1}),r(m,{class:"count-val"},{default:o((()=>[i(c(w.value),1)])),_:1})])),_:1}),r(t,{class:"status-box"},{default:o((()=>[r(m,{class:"status-label"},{default:o((()=>[i("当前状态")])),_:1}),r(m,{class:v(["status-val",I.value])},{default:o((()=>[i(c(E.value),1)])),_:1},8,["class"])])),_:1})])),_:1}),r(t,{class:"controls"},{default:o((()=>[x.value?(u(),s(f,{key:1,class:"btn-stop",onClick:j},{default:o((()=>[i("结束训练")])),_:1})):(u(),s(f,{key:0,class:"btn-start",onClick:S},{default:o((()=>[i("开始AI计数")])),_:1})),r(t,{class:"simulation-tools"},{default:o((()=>[r(m,{class:"tool-title"},{default:o((()=>[i("开发调试：模拟场景")])),_:1}),r(t,{class:"tool-btns"},{default:o((()=>[r(f,{size:"mini",onClick:N},{default:o((()=>[i("模拟有效动作")])),_:1}),r(f,{size:"mini",onClick:a[0]||(a[0]=e=>$("遮挡"))},{default:o((()=>[i("模拟遮挡")])),_:1}),r(f,{size:"mini",onClick:a[1]||(a[1]=e=>$("多人"))},{default:o((()=>[i("模拟多人")])),_:1}),r(f,{size:"mini",onClick:a[2]||(a[2]=e=>$("非活体"))},{default:o((()=>[i("模拟照片攻击")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-ebd25cb4"]]);export{x as default};
