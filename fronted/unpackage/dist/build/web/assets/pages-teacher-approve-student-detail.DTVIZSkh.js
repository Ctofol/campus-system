import{r as e,z as t,c as a,w as s,p as l,i as u,o as n,d as i,e as d,t as c,f as r,h as o,F as v,j as f,l as m,q as _,S as p,_ as h,u as g,v as y,a6 as k}from"./index-DJkcSMuy.js";import{a as b}from"./uni-app.es.BbaSIkqw.js";import{k as C,B as j}from"./request.DDN5gHc8.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const z=x({__name:"student-detail",setup(x){const z=e(null),w=e(""),F=e([]),I=e(!1),M=e([]),$=e(0),q=t((()=>F.value.reduce(((e,t)=>{var a;return e+((null==(a=t.metrics)?void 0:a.distance)||0)}),0).toFixed(2))),B=t((()=>{const e=F.value.reduce(((e,t)=>{var a;return e+((null==(a=t.metrics)?void 0:a.duration)||0)}),0);return Math.floor(e/60)}));b((e=>{e.studentId&&(z.value=e.studentId,w.value=e.studentName||"å­¦ç”Ÿ",(async()=>{if(z.value)try{const e=await C(z.value,{page:1,size:100});e&&e.items&&(F.value=e.items)}catch(e){console.error(e),l({title:"åŠ è½½å¤±è´¥",icon:"none"})}})())}));const D=()=>{I.value=!1},N=()=>{0!==M.value.length&&($.value=($.value-1+M.value.length)%M.value.length)},S=()=>{0!==M.value.length&&($.value=($.value+1)%M.value.length)};return(e,t)=>{const l=_,b=u,C=p,x=h,z=g;return n(),a(b,{class:"container"},{default:s((()=>[i(b,{class:"header"},{default:s((()=>[i(l,{class:"title"},{default:s((()=>[d(c(w.value)+" çš„è¿åŠ¨è®°å½•",1)])),_:1})])),_:1}),i(b,{class:"stats-card"},{default:s((()=>[i(b,{class:"stat-item"},{default:s((()=>[i(l,{class:"stat-num"},{default:s((()=>[d(c(q.value),1)])),_:1}),i(l,{class:"stat-label"},{default:s((()=>[d("æ€»é‡Œç¨‹(km)")])),_:1})])),_:1}),i(b,{class:"stat-divider"}),i(b,{class:"stat-item"},{default:s((()=>[i(l,{class:"stat-num"},{default:s((()=>[d(c(B.value),1)])),_:1}),i(l,{class:"stat-label"},{default:s((()=>[d("æ€»æ—¶é•¿(min)")])),_:1})])),_:1}),i(b,{class:"stat-divider"}),i(b,{class:"stat-item"},{default:s((()=>[i(l,{class:"stat-num"},{default:s((()=>[d(c(F.value.length),1)])),_:1}),i(l,{class:"stat-label"},{default:s((()=>[d("æ€»æ¬¡æ•°")])),_:1})])),_:1})])),_:1}),i(C,{"scroll-y":"",class:"list"},{default:s((()=>[(n(!0),r(v,null,o(F.value,(e=>(n(),a(b,{class:"item",key:e.id},{default:s((()=>[i(b,{class:"info"},{default:s((()=>{var t;return[i(l,{class:"type"},{default:s((()=>[d(c("run"===e.type?"è·‘æ­¥":"ä½“æµ‹"),1)])),_:2},1024),"test"===e.type||void 0!==(null==(t=e.metrics)?void 0:t.count)?(n(),a(l,{key:0,class:"desc"},{default:s((()=>{var t,a;return[d(c((null==(t=e.metrics)?void 0:t.duration)?Math.floor(e.metrics.duration/60):0)+"åˆ†é’Ÿ | "+c((null==(a=e.metrics)?void 0:a.count)?e.metrics.count:0)+"æ¬¡ ",1)]})),_:2},1024)):(n(),a(l,{key:1,class:"desc"},{default:s((()=>{var t,a;return[d(c((null==(t=e.metrics)?void 0:t.distance)?Number(e.metrics.distance).toFixed(2):0)+"km | "+c((null==(a=e.metrics)?void 0:a.duration)?Math.floor(e.metrics.duration/60):0)+"åˆ†é’Ÿ ",1)]})),_:2},1024)),i(l,{class:"time"},{default:s((()=>[d(c(new Date(e.started_at).toLocaleString()),1)])),_:2},1024),e.evidence&&e.evidence.length>0?(n(),a(b,{key:2,class:"evidence-area"},{default:s((()=>[i(b,{class:"evidence-btn",onClick:m((t=>(e=>{if(!e||0===e.length)return;const t=e.map((e=>{const t=e.data_ref.startsWith("http")?e.data_ref:`${j}${e.data_ref}`;return{url:t,type:e.evidence_type?e.evidence_type:/\.(mp4|webm|ogg)$/i.test(t)?"video":"image"}})),a=t.filter((e=>"image"===e.type)).map((e=>e.url)),s=t.filter((e=>"video"===e.type)).map((e=>e.url));a.length>0&&0===s.length?k({urls:a,current:0}):s.length>0&&(M.value=s,$.value=0,I.value=!0)})(e.evidence)),["stop"])},{default:s((()=>[i(l,{class:"btn-icon"},{default:s((()=>[d("ðŸ“·")])),_:1}),d(" æŸ¥çœ‹åª’ä½“ ")])),_:2},1032,["onClick"])])),_:2},1024)):f("",!0)]})),_:2},1024),i(b,{class:y(["status-tag",e.status])},{default:s((()=>{return[d(c((t=e.status,{pending:"å¾…å®¡æ‰¹",approved:"å·²é€šè¿‡",rejected:"å·²é©³å›ž",completed:"å·²å®Œæˆ",finished:"å·²å®Œæˆ"}[t]||t)),1)];var t})),_:2},1032,["class"])])),_:2},1024)))),128)),0===F.value.length?(n(),a(b,{key:0,class:"empty"},{default:s((()=>[d("æš‚æ— è¿åŠ¨è®°å½•")])),_:1})):f("",!0)])),_:1}),I.value?(n(),a(b,{key:0,class:"video-modal",onClick:D},{default:s((()=>[i(b,{class:"video-content",onClick:t[0]||(t[0]=m((()=>{}),["stop"]))},{default:s((()=>[i(x,{class:"video-player",src:M.value[$.value],controls:"",autoplay:""},null,8,["src"]),i(b,{class:"video-actions"},{default:s((()=>[M.value.length>1?(n(),a(z,{key:0,size:"mini",onClick:N},{default:s((()=>[d("ä¸Šä¸€ä¸ª")])),_:1})):f("",!0),M.value.length>1?(n(),a(z,{key:1,size:"mini",onClick:S},{default:s((()=>[d("ä¸‹ä¸€ä¸ª")])),_:1})):f("",!0),i(z,{size:"mini",onClick:D},{default:s((()=>[d("å…³é—­")])),_:1})])),_:1})])),_:1})])),_:1})):f("",!0)])),_:1})}}},[["__scopeId","data-v-3f6dd04f"]]);export{z as default};
