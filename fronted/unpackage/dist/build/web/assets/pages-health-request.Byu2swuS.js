import{r as e,c as a,w as s,i as t,o as l,d as u,e as r,q as c,t as n,j as o,k as i,F as d,f,s as _,p,W as m,v}from"./index-C5iLBQvu.js";import{o as y}from"./uni-app.es.BEWjhZNk.js";import{r as h}from"./request.BfbRFve_.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const j=b({__name:"request",setup(b){const j=e(!1),g=e({type:"leave",reason:""}),k=e([]),w=async()=>{try{const e=await h("/student/health/requests");k.value=e}catch(e){console.error(e)}},q=async()=>{if(!g.value.reason.trim())return _({title:"è¯·å¡«å†™åŽŸå› ",icon:"none"});j.value=!0;try{await h("/student/health/request",{method:"POST",data:{type:g.value.type,reason:g.value.reason}}),_({title:"æäº¤æˆåŠŸ",icon:"success"}),g.value.reason="",await w()}catch(e){_({title:e.detail||"æäº¤å¤±è´¥",icon:"none"})}finally{j.value=!1}};return y((()=>{w()})),(e,_)=>{const y=p,h=t,b=m,w=v;return l(),a(h,{class:"container"},{default:s((()=>[u(h,{class:"form-card"},{default:s((()=>[u(h,{class:"form-header"},{default:s((()=>[u(y,{class:"title"},{default:s((()=>[r("å¥åº·æŠ¥å¤‡ç”³è¯·")])),_:1}),u(y,{class:"subtitle"},{default:s((()=>[r("è¯·å¦‚å®žå¡«å†™ç”³è¯·ä¿¡æ¯ï¼Œæäº¤åŽå°†ç”±è€å¸ˆå®¡æ‰¹")])),_:1})])),_:1}),u(h,{class:"form-item"},{default:s((()=>[u(y,{class:"label"},{default:s((()=>[r("ç”³è¯·ç±»åž‹")])),_:1}),u(h,{class:"type-selector"},{default:s((()=>[u(h,{class:c(["type-btn",{active:"leave"===g.value.type}]),onClick:_[0]||(_[0]=e=>g.value.type="leave")},{default:s((()=>[u(y,{class:"icon"},{default:s((()=>[r("ðŸ“…")])),_:1}),u(y,null,{default:s((()=>[r("è¯·å‡ç”³è¯·")])),_:1})])),_:1},8,["class"]),u(h,{class:c(["type-btn",{active:"injury"===g.value.type}]),onClick:_[1]||(_[1]=e=>g.value.type="injury")},{default:s((()=>[u(y,{class:"icon"},{default:s((()=>[r("ðŸ¥")])),_:1}),u(y,null,{default:s((()=>[r("ä¼¤ç—…æŠ¥å‘Š")])),_:1})])),_:1},8,["class"])])),_:1})])),_:1}),u(h,{class:"form-item"},{default:s((()=>[u(y,{class:"label"},{default:s((()=>[r("ç”³è¯·åŽŸå› ")])),_:1}),u(b,{class:"reason-input",modelValue:g.value.reason,"onUpdate:modelValue":_[2]||(_[2]=e=>g.value.reason=e),placeholder:"è¯·è¯¦ç»†æè¿°åŽŸå› ï¼ˆä¾‹å¦‚ï¼šæ„Ÿå†’å‘çƒ§ã€è„šè¸æ‰­ä¼¤ç­‰ï¼‰",maxlength:"200"},null,8,["modelValue"]),u(y,{class:"word-count"},{default:s((()=>[r(n(g.value.reason.length)+"/200",1)])),_:1})])),_:1}),u(w,{class:"submit-btn",disabled:j.value,onClick:q},{default:s((()=>[r(n(j.value?"æäº¤ä¸­...":"æäº¤ç”³è¯·"),1)])),_:1},8,["disabled"])])),_:1}),u(h,{class:"history-section"},{default:s((()=>[u(h,{class:"section-title"},{default:s((()=>[r("æœ€è¿‘ç”³è¯·è®°å½•")])),_:1}),u(h,{class:"history-list"},{default:s((()=>[(l(!0),o(d,null,i(k.value,(e=>(l(),a(h,{class:"history-item",key:e.id},{default:s((()=>[u(h,{class:"item-header"},{default:s((()=>[u(y,{class:c(["item-type",e.type])},{default:s((()=>[r(n("leave"===e.type?"è¯·å‡":"ä¼¤ç—…"),1)])),_:2},1032,["class"]),u(y,{class:c(["item-status",e.status])},{default:s((()=>{return[r(n((a=e.status,{pending:"å¾…å®¡æ‰¹",approved:"å·²é€šè¿‡",rejected:"å·²é©³å›ž"}[a]||a)),1)];var a})),_:2},1032,["class"])])),_:2},1024),u(y,{class:"item-reason"},{default:s((()=>[r(n(e.reason),1)])),_:2},1024),u(y,{class:"item-time"},{default:s((()=>{return[r(n((a=e.created_at,a?a.replace("T"," ").substring(0,16):"")),1)];var a})),_:2},1024)])),_:2},1024)))),128)),0===k.value.length?(l(),a(h,{key:0,class:"empty-tip"},{default:s((()=>[r(" æš‚æ— ç”³è¯·è®°å½• ")])),_:1})):f("",!0)])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-77f1b309"]]);export{j as default};
