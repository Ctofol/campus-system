import{r as t,z as e,c as a,w as s,s as l,i as u,o as d,d as c,e as n,t as i,q as o,j as r,k as _,F as m,n as f,p,S as v,f as h,l as C,m as k,R as x,v as y}from"./index-B3FfpJ1t.js";import{a as g}from"./uni-app.es.C89-DA02.js";import{f as q}from"./request.CTIzMnE_.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";const w=$({__name:"detail",setup($){const w=t(null),b=t(!0),D=t({id:0,title:"",status:"",statusText:"",dueDate:"",requirements:[],completedCount:0,totalCount:0}),T=t([]),j=t("all"),I=e((()=>0===D.value.totalCount?0:Math.round(D.value.completedCount/D.value.totalCount*100))),V=e((()=>"all"===j.value?T.value:T.value.filter((t=>t.status===j.value))));return g((t=>{t.id&&(w.value=t.id,(async()=>{if(w.value){b.value=!0;try{const t=await q(w.value),e=[];"run"===t.type?(e.push("任务类型: 跑步任务"),t.min_distance&&e.push(`最低距离: ${t.min_distance} km`),t.min_duration&&e.push(`最低时长: ${t.min_duration} 分钟`)):(e.push("任务类型: 体测任务"),t.min_count&&e.push(`最低次数: ${t.min_count} 次`)),t.description&&e.push(`备注: ${t.description}`);const a=new Date,s=t.deadline?new Date(t.deadline):null;let l="ongoing",u="进行中";s&&s<a&&(l="ended",u="已结束"),D.value={id:t.id,title:t.title,status:l,statusText:u,dueDate:t.deadline?t.deadline.replace("T"," "):"无限制",requirements:e,completedCount:t.completed_count,totalCount:t.total_students};const d=t.student_statuses||[];T.value=d.map((t=>({id:t.student_id,name:t.student_name,studentId:`ID:${t.student_id}`,status:"completed"===t.status?"completed":"uncompleted",statusText:"completed"===t.status?"已完成":"未完成",metricValue:t.metric_value,avatar:""})))}catch(t){console.error(t),l({title:"加载失败",icon:"none"})}finally{b.value=!1}}})())})),(t,e)=>{const g=p,q=u,$=x,w=y,b=v;return d(),a(q,{class:"container"},{default:s((()=>[c(q,{class:"header-card"},{default:s((()=>[c(q,{class:"title-row"},{default:s((()=>[c(g,{class:"task-title"},{default:s((()=>[n(i(D.value.title),1)])),_:1}),c(q,{class:o(["status-tag",D.value.status])},{default:s((()=>[n(i(D.value.statusText),1)])),_:1},8,["class"])])),_:1}),c(g,{class:"due-date"},{default:s((()=>[n("截止日期："+i(D.value.dueDate),1)])),_:1})])),_:1}),c(q,{class:"section-card"},{default:s((()=>[c(q,{class:"section-header"},{default:s((()=>[c(g,{class:"section-title"},{default:s((()=>[n("任务要求")])),_:1})])),_:1}),c(q,{class:"requirements-list"},{default:s((()=>[(d(!0),r(m,null,_(D.value.requirements,((t,e)=>(d(),a(q,{class:"req-item",key:e},{default:s((()=>[c(g,{class:"dot"},{default:s((()=>[n("•")])),_:1}),c(g,{class:"req-text"},{default:s((()=>[n(i(t),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),c(q,{class:"section-card"},{default:s((()=>[c(q,{class:"section-header"},{default:s((()=>[c(g,{class:"section-title"},{default:s((()=>[n("完成进度")])),_:1}),c(g,{class:"progress-stats"},{default:s((()=>[n(i(D.value.completedCount)+"/"+i(D.value.totalCount)+" 人",1)])),_:1})])),_:1}),c(q,{class:"progress-box"},{default:s((()=>[c(q,{class:"progress-bar"},{default:s((()=>[c(q,{class:"progress-fill",style:f({width:I.value+"%"})},null,8,["style"])])),_:1}),c(g,{class:"percentage-text"},{default:s((()=>[n(i(I.value)+"%",1)])),_:1})])),_:1})])),_:1}),c(q,{class:"section-card"},{default:s((()=>[c(q,{class:"section-header"},{default:s((()=>[c(g,{class:"section-title"},{default:s((()=>[n("参与情况")])),_:1}),c(q,{class:"filter-tabs"},{default:s((()=>[c(g,{class:o(["tab-item",{active:"all"===j.value}]),onClick:e[0]||(e[0]=t=>j.value="all")},{default:s((()=>[n("全部")])),_:1},8,["class"]),c(g,{class:o(["tab-item",{active:"uncompleted"===j.value}]),onClick:e[1]||(e[1]=t=>j.value="uncompleted")},{default:s((()=>[n("未完成")])),_:1},8,["class"])])),_:1})])),_:1}),c(b,{"scroll-y":"",class:"student-list"},{default:s((()=>[(d(!0),r(m,null,_(V.value,(t=>(d(),a(q,{class:"student-item",key:t.id,onClick:e=>(t=>{k({url:`/pages/teacher/approve/student-detail?studentId=${t.id}&studentName=${t.name}`})})(t)},{default:s((()=>[c(q,{class:"student-info"},{default:s((()=>[c($,{class:"avatar",src:t.avatar||"/static/avatar.png",mode:"aspectFill"},null,8,["src"]),c(q,{class:"info-col"},{default:s((()=>[c(g,{class:"name"},{default:s((()=>[n(i(t.name),1)])),_:2},1024),c(g,{class:"id"},{default:s((()=>[n(i(t.studentId),1)])),_:2},1024),t.metricValue&&"-"!==t.metricValue?(d(),a(g,{key:0,class:"metric-val"},{default:s((()=>[n("成绩: "+i(t.metricValue),1)])),_:2},1024)):h("",!0)])),_:2},1024)])),_:2},1024),c(q,{class:"status-col"},{default:s((()=>[c(g,{class:o(["status-text",t.status])},{default:s((()=>[n(i(t.statusText),1)])),_:2},1032,["class"]),"uncompleted"===t.status?(d(),a(w,{key:0,class:"remind-btn",size:"mini",onClick:C((e=>(t=>{l({title:`已发送提醒给 ${t.name}`,icon:"success"})})(t)),["stop"])},{default:s((()=>[n("提醒")])),_:2},1032,["onClick"])):h("",!0)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-6f755a2e"]]);export{w as default};
