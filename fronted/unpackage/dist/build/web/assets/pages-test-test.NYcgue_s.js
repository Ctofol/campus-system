import{r as e,z as a,a as t,g as l,c as s,w as u,i as c,o as n,d as i,e as o,n as r,t as d,f as v,l as p,j as f,k as _,F as h,K as g,L as m,J as b,s as y,V as P,m as x,p as k,v as w,S as I,h as C,R as S}from"./index-C5iLBQvu.js";import{o as j,a as $,b as O}from"./uni-app.es.BEWjhZNk.js";import{B as D,r as T}from"./request.BfbRFve_.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";const B=z({__name:"test",setup(z){const B=e(20);e(null);const J=e(null),q=e(!1),H=e(0),L=e(0),M=e(null),N=e(null),R=e("");a((()=>Math.min(H.value/20*100,100)));const A=e(!1),F=e("è¯·åšå¥½å‡†å¤‡"),K=e(!1),V=e(!1),E=e("student"),G=e("å¼•ä½“å‘ä¸Š"),Q=e("ä¸‹é¢Œè¿‡æ ï¼ŒåŒè‡‚ä¼¸ç›´"),U=e("pull-up"),W=a((()=>({"pull-up":"ðŸ’ª","sit-up":"ðŸ§˜","push-up":"ðŸ™‡"}[U.value]||"ðŸƒ"))),X=a((()=>"teacher"===E.value?[{pagePath:"/pages/teacher/home/home",text:"ä¸»é¡µ",iconPath:"/static/tab/home.png",selectedIconPath:"/static/tab/home-active.png"},{pagePath:"/pages/teacher/manage/manage",text:"ç®¡ç†",iconPath:"/static/tab/run.png",selectedIconPath:"/static/tab/run-active.png"},{pagePath:"/pages/teacher/mine/mine",text:"æˆ‘çš„",iconPath:"/static/tab/mine.png",selectedIconPath:"/static/tab/mine-active.png"}]:[{pagePath:"/pages/home/home",text:"é¦–é¡µ",iconPath:"/static/tab/home.png",selectedIconPath:"/static/tab/home-active.png"},{pagePath:"/pages/run/run",text:"è·‘æ­¥",iconPath:"/static/tab/run.png",selectedIconPath:"/static/tab/run-active.png"},{pagePath:"/pages/test/test",text:"ä½“æµ‹",iconPath:"/static/tab/test.png",selectedIconPath:"/static/tab/test-active.png"},{pagePath:"/pages/mine/mine",text:"æˆ‘çš„",iconPath:"/static/tab/mine.png",selectedIconPath:"/static/tab/mine-active.png"}]));j((()=>{const e=t("userRole")||"student";E.value=e}));const Y=()=>{K.value=!K.value},Z=(e,a)=>{G.value=e,U.value=a,K.value=!1,"pull-up"===a?Q.value="ä¸‹é¢Œè¿‡æ ï¼ŒåŒè‡‚ä¼¸ç›´":"sit-up"===a?Q.value="åŒæ‰‹æŠ±å¤´ï¼Œè‚˜éƒ¨è§¦è†":"push-up"===a&&(Q.value="èº«ä½“å¹³ç›´ï¼Œå±ˆè‡‚90åº¦"),H.value=0,L.value=0,q.value=!1,F.value="è¯·åšå¥½å‡†å¤‡"},ee=e=>{const a=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},ae=()=>{H.value++,A.value=!0,F.value="åŠ¨ä½œæ ‡å‡†",setTimeout((()=>{A.value=!1,F.value="ä¿æŒåŠ¨ä½œ"}),1e3)},te=()=>{q.value||(q.value=!0,H.value=0,L.value=0,F.value="æ­£åœ¨è¯†åˆ«...",R.value="",M.value=setInterval((()=>{L.value++}),1e3),J.value=setInterval((()=>{ae()}),3e3))},le=async()=>{if(q.value){clearInterval(M.value),clearInterval(J.value),q.value=!1,F.value="æµ‹è¯•ç»“æŸ",N.value={count:H.value,duration:ee(L.value),date:(new Date).toLocaleString()},g({title:"æ­£åœ¨ä¸Šä¼ æ•°æ®..."});try{const e=await se();let a="";if(e){const t=await ue(e);t&&t.url&&(a=t.url)}await ce(a),m(),b({title:"æµ‹è¯•å®Œæˆ",content:`é¡¹ç›®ï¼š${G.value}\næœ¬æ¬¡æˆç»©ï¼š${H.value}æ¬¡\nç”¨æ—¶ï¼š${ee(L.value)}`,showCancel:!1})}catch(e){m(),y({title:"æ•°æ®æäº¤å¤±è´¥",icon:"none"}),console.error(e)}}},se=()=>new Promise(((e,a)=>{e(null)})),ue=e=>new Promise(((a,l)=>{const s=t("token");P({url:`${D}/upload`,filePath:e,name:"file",header:{Authorization:`Bearer ${s}`},success:e=>{try{const t=JSON.parse(e.data);a(t)}catch(t){l(t)}},fail:e=>{l(e)}})})),ce=()=>T({url:"/activity/finish",method:"POST",data:{type:"test",source:"free",started_at:new Date(Date.now()-1e3*L.value).toISOString(),ended_at:(new Date).toISOString(),metrics:{count:H.value,duration:L.value,qualified:H.value>=10,checkpoints:JSON.stringify([])},evidence:[...R.value?[{evidence_type:"video",data_ref:R.value}]:[]]}});$((e=>{const a=l();B.value=a.statusBarHeight||20,e&&(e=>{e.project&&(G.value=e.project),e.type&&(U.value=e.type);const a={"å¼•ä½“å‘ä¸Š":"ä¸‹é¢Œè¿‡æ ï¼ŒåŒè‡‚ä¼¸ç›´","ä»°å§èµ·å":"åŒæ‰‹æŠ±å¤´ï¼Œè‚˜éƒ¨è§¦è†","ä¿¯å§æ’‘":"èº«ä½“å¹³ç›´ï¼Œå±ˆè‡‚90åº¦"};a[G.value]&&(Q.value=a[G.value])})(e)}));const ne=()=>{x({url:"/pages/teacher/students/students"})};return O((()=>{q.value&&(clearInterval(M.value),clearInterval(J.value),q.value=!1)})),(e,a)=>{const t=k,l=c,g=w,m=I,b=S;return n(),s(l,{class:"test-page-root"},{default:u((()=>[i(l,{class:"custom-navbar",style:r({paddingTop:B.value+"px"})},{default:u((()=>[i(l,{class:"navbar-content"},{default:u((()=>[i(t,{class:"navbar-title"},{default:u((()=>[o("ä½“èƒ½æµ‹è¯•")])),_:1})])),_:1})])),_:1},8,["style"]),i(m,{"scroll-y":"true",class:"content-wrapper",style:r({paddingTop:B.value+44+"px"})},{default:u((()=>["teacher"===E.value?(n(),s(l,{key:0,class:"teacher-tools"},{default:u((()=>[i(l,{class:"teacher-card"},{default:u((()=>[i(t,{class:"teacher-title"},{default:u((()=>[o("æ•™å¸ˆå·¥å…·")])),_:1}),i(l,{class:"teacher-actions"},{default:u((()=>[i(g,{class:"teacher-btn",onClick:ne},{default:u((()=>[i(t,{class:"teacher-btn-text"},{default:u((()=>[o("å­¦å‘˜ç®¡ç†")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):(n(),s(l,{key:1,class:"student-container"},{default:u((()=>[i(l,{class:"header-info"},{default:u((()=>[i(t,{class:"project-name"},{default:u((()=>[o(d(G.value),1)])),_:1}),i(l,{class:"standard-badge"},{default:u((()=>[i(t,{class:"badge-text"},{default:u((()=>[o("å›½å®¶å­¦ç”Ÿä½“è´¨å¥åº·æ ‡å‡†")])),_:1})])),_:1}),i(t,{class:"standard-desc"},{default:u((()=>[o("åŠ¨ä½œæ ‡å‡†ï¼š"+d(Q.value),1)])),_:1}),i(l,{class:"test-type-switch"},{default:u((()=>[i(g,{class:"switch-btn",onClick:Y},{default:u((()=>[i(t,{class:"switch-btn-text"},{default:u((()=>[o("åˆ‡æ¢æµ‹è¯•ç±»åž‹")])),_:1})])),_:1}),K.value?(n(),s(l,{key:0,class:"type-selector"},{default:u((()=>[i(l,{class:"type-item",onClick:a[0]||(a[0]=e=>Z("å¼•ä½“å‘ä¸Š","pull-up"))},{default:u((()=>[i(t,{class:"type-item-text"},{default:u((()=>[o("å¼•ä½“å‘ä¸Š")])),_:1})])),_:1}),i(l,{class:"type-item",onClick:a[1]||(a[1]=e=>Z("ä»°å§èµ·å","sit-up"))},{default:u((()=>[i(t,{class:"type-item-text"},{default:u((()=>[o("ä»°å§èµ·å")])),_:1})])),_:1}),i(l,{class:"type-item",onClick:a[2]||(a[2]=e=>Z("ä¿¯å§æ’‘","push-up"))},{default:u((()=>[i(t,{class:"type-item-text"},{default:u((()=>[o("ä¿¯å§æ’‘")])),_:1})])),_:1})])),_:1})):v("",!0)])),_:1})])),_:1}),i(l,{class:"camera-area"},{default:u((()=>[i(l,{class:"h5-camera-wrapper"},{default:u((()=>[i(t,{class:"error-text"},{default:u((()=>[o("H5 not fully supported in nvue mode")])),_:1})])),_:1})])),_:1}),i(l,{class:"action-area"},{default:u((()=>[i(l,{class:"timer-box"},{default:u((()=>[i(t,{class:"timer-label"},{default:u((()=>[o(d(q.value?"æµ‹è¯•ç”¨æ—¶":N.value?"ä¸Šæ¬¡ç”¨æ—¶":"æµ‹è¯•ç”¨æ—¶"),1)])),_:1}),i(t,{class:"timer-text"},{default:u((()=>[o(d(q.value?ee(L.value):N.value?N.value.duration:"00:00"),1)])),_:1})])),_:1}),!q.value&&N.value?(n(),s(l,{key:0,class:"last-result-box"},{default:u((()=>[i(t,{class:"result-title"},{default:u((()=>[o("ä¸Šæ¬¡æˆç»© ("+d(G.value)+")",1)])),_:1}),i(l,{class:"result-row"},{default:u((()=>[i(t,{class:"result-label"},{default:u((()=>[o("æ•°é‡ï¼š")])),_:1}),i(t,{class:"result-value"},{default:u((()=>[o(d(N.value.count)+" æ¬¡",1)])),_:1})])),_:1}),i(l,{class:"result-row"},{default:u((()=>[i(t,{class:"result-label"},{default:u((()=>[o("ç”¨æ—¶ï¼š")])),_:1}),i(t,{class:"result-value"},{default:u((()=>[o(d(N.value.duration),1)])),_:1})])),_:1})])),_:1})):v("",!0),i(l,{class:"btn-group"},{default:u((()=>[q.value?(n(),s(l,{key:1,class:"testing-btns"},{default:u((()=>[i(l,{class:"sub-btn stop-btn",onClick:le},{default:u((()=>[i(t,{class:"btn-text"},{default:u((()=>[o("ç»“æŸæµ‹è¯•")])),_:1})])),_:1}),i(l,{class:"sub-btn mock-btn",onClick:ae},{default:u((()=>[i(t,{class:"btn-text mock-text"},{default:u((()=>[o("+1 æ¨¡æ‹Ÿ")])),_:1})])),_:1})])),_:1})):(n(),s(l,{key:0,class:"main-btn start-btn",onClick:te},{default:u((()=>[i(t,{class:"btn-text"},{default:u((()=>[o(d(N.value?"å†æ¬¡æµ‹è¯•":"å¼€å§‹æµ‹è¯•"),1)])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1})),V.value?(n(),s(l,{key:2,class:"guide-modal",onClick:a[5]||(a[5]=e=>V.value=!1)},{default:u((()=>[i(l,{class:"guide-content",onClick:a[4]||(a[4]=p((()=>{}),["stop"]))},{default:u((()=>[i(t,{class:"guide-title"},{default:u((()=>[o("åŠ¨ä½œæŒ‡å—")])),_:1}),i(l,{class:"guide-visual"},{default:u((()=>[i(t,{class:"guide-emoji"},{default:u((()=>[o(d(W.value),1)])),_:1})])),_:1}),i(t,{class:"guide-desc"},{default:u((()=>[o(d(Q.value),1)])),_:1}),i(g,{class:"guide-btn",onClick:a[3]||(a[3]=e=>V.value=!1)},{default:u((()=>[i(t,{class:"guide-btn-text"},{default:u((()=>[o("æˆ‘çŸ¥é“äº†")])),_:1})])),_:1})])),_:1})])),_:1})):v("",!0)])),_:1},8,["style"]),i(l,{class:"tab-bar"},{default:u((()=>[i(l,{class:"tab-bar-border"}),(n(!0),f(h,null,_(X.value,((e,a)=>(n(),s(l,{key:a,class:"tab-bar-item",onClick:a=>(e=>{"/pages/test/test"!==e.pagePath&&C({url:e.pagePath})})(e)},{default:u((()=>[i(b,{class:"tab-icon",src:"/pages/test/test"===e.pagePath?e.selectedIconPath:e.iconPath},null,8,["src"]),i(t,{class:"tab-text",style:r({color:"/pages/test/test"===e.pagePath?"#20C997":"#666666"})},{default:u((()=>[o(d(e.text),1)])),_:2},1032,["style"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})}}},[["__scopeId","data-v-917b8c68"]]);export{B as default};
