import{r as e,z as a,g as t,c as s,w as l,i as r,o,d as u,e as c,n as d,f as i,h as n,F as p,j as f,W as v,q as m,S as _,t as y}from"./index-DJkcSMuy.js";import{o as g}from"./uni-app.es.BbaSIkqw.js";import{r as h}from"./request.DDN5gHc8.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=k({__name:"history",setup(k){const x=e(20),T=e([]),b=e(1),S=e(20),F=e(!1),$=e(!0),w=a((()=>T.value.filter((e=>!e.isTask))));g((()=>{x.value=t().statusBarHeight||20,b.value=1,T.value=[],$.value=!0,j()}));const C=()=>{v()},j=async()=>{if(!F.value&&$.value){F.value=!0;try{const e=await h({url:"/activity/history",method:"GET",data:{page:b.value,size:S.value}});if(e.items&&e.items.length>0){const a=e.items.map((e=>{var a,t,s,l;const r="run"===e.type,o=new Date(e.started_at),u=`${o.getMonth()+1}-${o.getDate()} ${o.getHours()}:${o.getMinutes().toString().padStart(2,"0")}`;return{type:e.type,modeBg:r?"#20C997":"#FF9F43",modeText:r?"跑步":"体测",createTime:u,distance:(null==(a=e.metrics)?void 0:a.distance)?Number(e.metrics.distance).toFixed(2):0,duration:M((null==(t=e.metrics)?void 0:t.duration)||0),pace:null==(s=e.metrics)?void 0:s.pace,result:(null==(l=e.metrics)?void 0:l.qualified)?"达标":"未达标",statusText:"finished"===e.status?"有效":"待审核",statusColor:"#20C997",isTask:!(!e.task_id&&!e.plan_id)}}));T.value=[...T.value,...a],e.items.length<S.value&&($.value=!1)}else $.value=!1}catch(e){console.error("Fetch history failed",e)}finally{F.value=!1}}},B=()=>{b.value++,j()},M=e=>{const a=Math.floor(e/3600),t=e%60;return`${a>0?a+":":""}${Math.floor(e%3600/60).toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`};return(e,a)=>{const t=m,v=r,g=_;return o(),s(v,{class:"container"},{default:l((()=>[u(v,{class:"custom-navbar",style:d({paddingTop:x.value+"px"})},{default:l((()=>[u(v,{class:"navbar-content"},{default:l((()=>[u(v,{class:"back-btn",onClick:C},{default:l((()=>[u(t,{class:"back-arrow"},{default:l((()=>[c("←")])),_:1})])),_:1}),u(t,{class:"navbar-title"},{default:l((()=>[c("全部运动记录")])),_:1})])),_:1})])),_:1},8,["style"]),u(v,{class:"content-wrapper",style:d({paddingTop:x.value+44+"px"})},{default:l((()=>[u(g,{"scroll-y":"",class:"record-list",onScrolltolower:B},{default:l((()=>[(o(!0),i(p,null,n(w.value,((e,a)=>(o(),s(v,{class:"record-item",key:a},{default:l((()=>[u(v,{class:"record-type",style:d({backgroundColor:e.modeBg})},{default:l((()=>[u(t,{class:"type-text"},{default:l((()=>[c(y(e.modeText),1)])),_:2},1024)])),_:2},1032,["style"]),u(v,{class:"record-info"},{default:l((()=>[u(t,{class:"record-date"},{default:l((()=>[c(y(e.createTime),1)])),_:2},1024),"run"===e.type?(o(),s(t,{key:0,class:"record-data"},{default:l((()=>[c(y(e.distance)+"km | "+y(e.duration),1),e.pace?(o(),s(t,{key:0},{default:l((()=>[c(" | "+y(Number(e.pace).toFixed(1))+"'",1)])),_:2},1024)):f("",!0)])),_:2},1024)):f("",!0)])),_:2},1024),u(v,{class:"record-status"},{default:l((()=>[u(t,{class:"status-text",style:d({color:e.statusColor})},{default:l((()=>[c(y(e.statusText),1)])),_:2},1032,["style"])])),_:2},1024)])),_:2},1024)))),128)),F.value?(o(),s(v,{key:0,class:"loading-more"},{default:l((()=>[c("加载中...")])),_:1})):f("",!0),F.value||0!==w.value.length?f("",!0):(o(),s(v,{key:1,class:"no-more"},{default:l((()=>[c("暂无自主运动记录")])),_:1}))])),_:1})])),_:1},8,["style"])])),_:1})}}},[["__scopeId","data-v-653ca483"]]);export{x as default};
