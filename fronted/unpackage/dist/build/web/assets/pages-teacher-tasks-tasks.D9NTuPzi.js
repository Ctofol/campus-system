import{r as a,x as e,z as t,c as s,w as l,p as c,i as u,o as n,d,e as i,t as r,v as o,j as f,f as _,h as p,F as v,n as m,m as y,q as h,S as g,l as k,L as b,J as x,u as C}from"./index-D4dSIJeF.js";import{o as w}from"./uni-app.es.DJB9Vm6C.js";import{d as j,e as D}from"./request.Da1Pdojv.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=z({__name:"tasks",setup(z){const I=a(0),M=a([]),$=a(1),q=a(20),L=a(0),B=a(!1),E=async()=>{if(!B.value){B.value=!0;try{const a=0===I.value?"active":"ended",e=await j({page:$.value,size:q.value,status:a});if(e.items){const a=new Date,t=e.items.map((e=>{const t=new Date(e.deadline)<a;let s="è®­ç»ƒ";"test"===e.type?s="è€ƒæ ¸":"run"===e.type&&(s="æ—¥å¸¸");const l=e.completed_count||0,c=e.total_students||0,u=c>0?Math.round(l/c*100):0;return{id:e.id,title:e.title,type:s,desc:e.description||(e.min_distance?`ç›®æ ‡è·ç¦»: ${e.min_distance}km`:"æ— å…·ä½“æè¿°"),status:t?"å·²ç»“æŸ":"è¿›è¡Œä¸­",completed:l,total:c,percent:u,deadline:e.deadline?e.deadline.split("T")[0]:"æ— "}}));1===$.value?M.value=t:M.value=[...M.value,...t],L.value=e.total}}catch(a){console.error(a),c({title:"åŠ è½½ä»»åŠ¡å¤±è´¥",icon:"none"})}finally{B.value=!1}}};e(I,(()=>{$.value=1,M.value=[],E()})),w((()=>{$.value=1,E()}));const F=t((()=>0===I.value?L.value:0)),J=t((()=>L.value)),S=t((()=>{if(0===M.value.length)return 0;const a=M.value.reduce(((a,e)=>a+e.percent),0);return Math.round(a/M.value.length)})),T=t((()=>M.value)),A=a=>{if(!a||"æ— "===a)return!1;const e=new Date(a),t=new Date,s=Math.abs(e-t);return Math.ceil(s/864e5)<=3&&e>t},G=a=>{x({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦åˆ é™¤ä»»åŠ¡"${a.title}"å—ï¼Ÿ`,success:async e=>{if(e.confirm)try{await D(a.id),c({title:"åˆ é™¤æˆåŠŸ"}),$.value=1,E()}catch(t){console.error(t),c({title:"åˆ é™¤å¤±è´¥",icon:"none"})}}})},H=()=>{y({url:"/pages/teacher/tasks/create"})};return(a,e)=>{const t=h,x=u,w=C,j=g;return n(),s(x,{class:"tasks-page"},{default:l((()=>[d(x,{class:"dashboard-header"},{default:l((()=>[d(x,{class:"header-top"},{default:l((()=>[d(t,{class:"page-title"},{default:l((()=>[i("ä»»åŠ¡ç®¡ç†")])),_:1}),d(x,{class:"header-actions"},{default:l((()=>[d(x,{class:"icon-btn search"},{default:l((()=>[d(t,{class:"iconfont"},{default:l((()=>[i("ğŸ”")])),_:1})])),_:1})])),_:1})])),_:1}),d(x,{class:"stats-card"},{default:l((()=>[d(x,{class:"stat-item"},{default:l((()=>[d(t,{class:"stat-num"},{default:l((()=>[i(r(F.value),1)])),_:1}),d(t,{class:"stat-label"},{default:l((()=>[i("è¿›è¡Œä¸­")])),_:1})])),_:1}),d(x,{class:"stat-divider"}),d(x,{class:"stat-item"},{default:l((()=>[d(t,{class:"stat-num"},{default:l((()=>[i(r(S.value)+"%",1)])),_:1}),d(t,{class:"stat-label"},{default:l((()=>[i("å¹³å‡å®Œæˆç‡")])),_:1})])),_:1}),d(x,{class:"stat-divider"}),d(x,{class:"stat-item"},{default:l((()=>[d(t,{class:"stat-num"},{default:l((()=>[i(r(J.value),1)])),_:1}),d(t,{class:"stat-label"},{default:l((()=>[i("ç´¯è®¡ä»»åŠ¡")])),_:1})])),_:1})])),_:1})])),_:1}),d(x,{class:"tab-container"},{default:l((()=>[d(x,{class:o(["tab-item",{active:0===I.value}]),onClick:e[0]||(e[0]=a=>I.value=0)},{default:l((()=>[i(" è¿›è¡Œä¸­ "),0===I.value?(n(),s(x,{key:0,class:"tab-line"})):f("",!0)])),_:1},8,["class"]),d(x,{class:o(["tab-item",{active:1===I.value}]),onClick:e[1]||(e[1]=a=>I.value=1)},{default:l((()=>[i(" å†å²è®°å½• "),1===I.value?(n(),s(x,{key:0,class:"tab-line"})):f("",!0)])),_:1},8,["class"])])),_:1}),d(j,{"scroll-y":"",class:"task-list",style:m({height:"calc(100vh - 380rpx)"})},{default:l((()=>[(n(!0),_(v,null,p(T.value,((a,u)=>(n(),s(x,{class:"task-card",key:u,onClick:e=>(a=>{y({url:`/pages/teacher/tasks/detail?id=${a.id}`})})(a)},{default:l((()=>[d(x,{class:"card-header"},{default:l((()=>[d(x,{class:"tag-row"},{default:l((()=>{return[d(x,{class:o(["type-tag",(e=a.type,{"è€ƒæ ¸":"tag-red","æ—¥å¸¸":"tag-green","è®­ç»ƒ":"tag-blue"}[e]||"tag-gray")])},{default:l((()=>[i(r(a.type),1)])),_:2},1032,["class"]),d(x,{class:o(["deadline-tag",{urgent:A(a.deadline)}])},{default:l((()=>[i(" ğŸ“… "+r(a.deadline)+" æˆªæ­¢ ",1)])),_:2},1032,["class"])];var e})),_:2},1024),d(x,{class:"more-btn",onClick:k((e=>(a=>{b({itemList:["ç¼–è¾‘ä»»åŠ¡","åˆ é™¤ä»»åŠ¡"],itemColor:"#000000",success:async e=>{0===e.tapIndex?c({title:"ç¼–è¾‘åŠŸèƒ½å¼€å‘ä¸­",icon:"none"}):1===e.tapIndex&&G(a)}})})(a)),["stop"])},{default:l((()=>[i("...")])),_:2},1032,["onClick"])])),_:2},1024),d(x,{class:"card-content"},{default:l((()=>[d(t,{class:"task-title"},{default:l((()=>[i(r(a.title),1)])),_:2},1024),d(t,{class:"task-desc"},{default:l((()=>[i(r(a.desc),1)])),_:2},1024)])),_:2},1024),d(x,{class:"card-progress"},{default:l((()=>[d(x,{class:"progress-info"},{default:l((()=>[d(t,{class:"info-text"},{default:l((()=>[i("å®Œæˆåº¦ "),d(t,{class:"highlight"},{default:l((()=>[i(r(a.percent)+"%",1)])),_:2},1024)])),_:2},1024),d(t,{class:"info-text sub"},{default:l((()=>[i(r(a.completed)+"/"+r(a.total)+"äºº",1)])),_:2},1024)])),_:2},1024),d(x,{class:"progress-track"},{default:l((()=>[d(x,{class:"progress-bar",style:m({width:a.percent+"%"})},null,8,["style"])])),_:2},1024)])),_:2},1024),d(x,{class:"card-footer",onClick:e[2]||(e[2]=k((()=>{}),["stop"]))},{default:l((()=>[d(x,{class:"avatars"},{default:l((()=>[(n(),_(v,null,p(3,(a=>d(x,{class:"avatar",key:a,style:m({left:20*(a-1)+"rpx",zIndex:4-a})},null,8,["style"]))),64)),d(x,{class:"avatar-more",style:{left:"60rpx"}},{default:l((()=>[i("...")])),_:1})])),_:1}),"è¿›è¡Œä¸­"===a.status?(n(),s(w,{key:0,class:"remind-btn",size:"mini",onClick:a=>{c({title:"æé†’å·²å‘é€",icon:"success"})}},{default:l((()=>[i(" ğŸ”” ä¸€é”®æé†’ ")])),_:2},1032,["onClick"])):f("",!0)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),0===T.value.length?(n(),s(x,{key:0,class:"empty-state"},{default:l((()=>[d(t,{class:"empty-text"},{default:l((()=>[i("æš‚æ— ä»»åŠ¡æ•°æ®")])),_:1})])),_:1})):f("",!0),d(x,{style:{height:"120rpx"}})])),_:1},8,["style"]),d(x,{class:"fab-btn",onClick:H},{default:l((()=>[d(t,{class:"fab-icon"},{default:l((()=>[i("+")])),_:1}),d(t,{class:"fab-text"},{default:l((()=>[i("å‘å¸ƒä»»åŠ¡")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-e4533707"]]);export{I as default};
