import{r as a,a as e,b as t,c as l,w as s,i as c,o as d,d as o,e as u,t as n,j as r,k as i,F as f,f as _,l as p,q as m,m as v,s as h,p as g,R as y,S as k,v as b,I as C,W as q,n as x,X as w}from"./index-C5iLBQvu.js";import{_ as j}from"./avatar.WOnTDsO9.js";import{o as A}from"./uni-app.es.BEWjhZNk.js";import{C as V}from"./CustomTabBar.C3uGOtvP.js";import{r as F}from"./request.BfbRFve_.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";const T=I({__name:"home",setup(I){const T=a({}),z=()=>{v({url:"/pages/teacher/approve/approve"})};A((()=>{uni.hideHomeButton&&uni.hideHomeButton();const a=e("userInfo");if(a)try{T.value="string"==typeof a?JSON.parse(a):a}catch(l){console.error("JSON parse error",l),T.value={}}e("token")?((async()=>{try{const a=await F({url:"/teacher/stats",method:"GET"});S.value={studentCount:a.student_count,todayCheckin:a.today_checkin,abnormalCount:a.abnormal_count,pendingApprovals:a.pending_approvals,avgPace:a.avg_pace,taskCount:a.task_count,complianceRate:a.compliance_rate}}catch(l){if(!e("token"))return;console.error("Failed to fetch teacher stats:",l)}})(),J(),L()):t({url:"/pages/login/login"})}));const S=a({studentCount:0,todayCheckin:0,abnormalCount:0,pendingApprovals:0,avgPace:"--",taskCount:0,complianceRate:0}),B=a([{day:"周一",val:0,color:"linear-gradient(180deg, #e0e0e0 0%, #f5f5f5 100%)"},{day:"周二",val:0,color:"linear-gradient(180deg, #e0e0e0 0%, #f5f5f5 100%)"},{day:"周三",val:0,color:"linear-gradient(180deg, #e0e0e0 0%, #f5f5f5 100%)"},{day:"周四",val:0,color:"linear-gradient(180deg, #20C997 0%, #63e6be 100%)"},{day:"周五",val:0,color:"linear-gradient(180deg, #e0e0e0 0%, #f5f5f5 100%)"},{day:"周六",val:0,color:"linear-gradient(180deg, #e0e0e0 0%, #f5f5f5 100%)"},{day:"周日",val:0,color:"linear-gradient(180deg, #e0e0e0 0%, #f5f5f5 100%)"}]),E=a(!1),G=a(!1),N=a({title:"",type:"日常",desc:""}),R=a([]),H=a([]),J=async()=>{try{const a=await F({url:"/teacher/tasks",method:"GET",data:{page:1,size:5}});a&&a.items&&(R.value=a.items.map((a=>({title:a.title,type:"run"===a.type?"跑步":"其他",typeClass:"run"===a.type?"tag-green":"tag-blue",status:"进行中",percent:a.total_students>0?Math.round(a.completed_count/a.total_students*100):0}))))}catch(a){if(!e("token"))return;console.error("Failed to fetch tasks:",a)}},L=async()=>{try{const a=await F({url:"/teacher/students/abnormal",method:"GET"});Array.isArray(a)&&(H.value=a.map(((a,e)=>({id:a.id||e,student:a.name,type:"injured"===a.health_status?"受伤":"leave"===a.health_status?"请假":"异常",value:a.abnormal_reason||"未说明",time:a.updated_at?new Date(a.updated_at).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):"--:--"}))).slice(0,5))}catch(a){if(!e("token"))return;console.error("Failed to fetch abnormal alerts:",a)}},M=()=>{G.value=!1,N.value={title:"",type:"日常",desc:""},E.value=!0},O=()=>{if(!N.value.title)return h({title:"请输入标题",icon:"none"});h({title:G.value?"修改成功":"发布成功",icon:"success"}),E.value=!1};return(a,e)=>{const t=c,A=g,F=y,I=k,J=b,L=C,P=q;return d(),l(t,{class:"home-container"},{default:s((()=>[o(t,{class:"teacher-dashboard"},{default:s((()=>[o(t,{class:"custom-nav-bar"},{default:s((()=>[o(t,{class:"nav-status-bar"}),o(t,{class:"nav-content"},{default:s((()=>[o(A,{class:"nav-title"},{default:s((()=>[u("教师工作台")])),_:1})])),_:1})])),_:1}),o(t,{class:"teacher-header"},{default:s((()=>[o(t,{class:"teacher-info"},{default:s((()=>[o(A,{class:"teacher-name"},{default:s((()=>[u(n(T.value.name||"老师"),1)])),_:1}),o(A,{class:"teacher-title"},{default:s((()=>[u("体育教研室")])),_:1})])),_:1}),o(t,{class:"teacher-avatar"},{default:s((()=>[o(F,{class:"avatar-img",src:j,mode:"aspectFill"})])),_:1})])),_:1}),o(t,{class:"dashboard-stats"},{default:s((()=>[o(t,{class:"stat-card"},{default:s((()=>[o(A,{class:"stat-num"},{default:s((()=>[u(n(S.value.todayCheckin),1)])),_:1}),o(A,{class:"stat-label"},{default:s((()=>[u("今日打卡")])),_:1})])),_:1}),o(t,{class:"stat-card"},{default:s((()=>[o(A,{class:"stat-num"},{default:s((()=>[u(n(S.value.abnormalCount),1)])),_:1}),o(A,{class:"stat-label"},{default:s((()=>[u("异常待处理")])),_:1})])),_:1}),o(t,{class:"stat-card",onClick:z},{default:s((()=>[o(A,{class:"stat-num"},{default:s((()=>[u(n(S.value.pendingApprovals),1)])),_:1}),o(A,{class:"stat-label"},{default:s((()=>[u("待审批")])),_:1})])),_:1})])),_:1}),o(t,{class:"section-card todo-section"},{default:s((()=>[o(t,{class:"section-header"},{default:s((()=>[o(A,{class:"section-title"},{default:s((()=>[u("今日待办")])),_:1}),o(A,{class:"section-more"},{default:s((()=>[u("全部 >")])),_:1})])),_:1}),o(t,{class:"todo-list"},{default:s((()=>[o(t,{class:"todo-item"},{default:s((()=>[o(t,{class:"todo-check"}),o(t,{class:"todo-content"},{default:s((()=>[o(A,{class:"todo-text"},{default:s((()=>[u("审批 2023级体测成绩")])),_:1}),o(A,{class:"todo-time"},{default:s((()=>[u("截止: 17:00")])),_:1})])),_:1})])),_:1}),o(t,{class:"todo-item"},{default:s((()=>[o(t,{class:"todo-check"}),o(t,{class:"todo-content"},{default:s((()=>[o(A,{class:"todo-text"},{default:s((()=>[u("发布本周训练计划")])),_:1}),o(A,{class:"todo-time"},{default:s((()=>[u("待处理")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),o(t,{class:"section-card chart-section"},{default:s((()=>[o(t,{class:"section-header"},{default:s((()=>[o(A,{class:"section-title"},{default:s((()=>[u("学员体能概览")])),_:1}),o(A,{class:"section-more"},{default:s((()=>[u("更多 >")])),_:1})])),_:1}),o(t,{class:"overview-chart"},{default:s((()=>[o(t,{class:"chart-col"},{default:s((()=>[o(t,{class:"chart-ring ring-green"},{default:s((()=>[o(A,{class:"ring-val"},{default:s((()=>[u("92%")])),_:1}),o(A,{class:"ring-label"},{default:s((()=>[u("达标率")])),_:1})])),_:1}),o(A,{class:"chart-name"},{default:s((()=>[u("体能达标")])),_:1})])),_:1}),o(t,{class:"chart-col"},{default:s((()=>[o(t,{class:"chart-ring ring-blue"},{default:s((()=>[o(A,{class:"ring-val"},{default:s((()=>[u("85%")])),_:1}),o(A,{class:"ring-label"},{default:s((()=>[u("完成率")])),_:1})])),_:1}),o(A,{class:"chart-name"},{default:s((()=>[u("本周任务")])),_:1})])),_:1}),o(t,{class:"chart-col"},{default:s((()=>[o(t,{class:"chart-ring ring-red"},{default:s((()=>[o(A,{class:"ring-val"},{default:s((()=>[u("5'45\"")])),_:1}),o(A,{class:"ring-label"},{default:s((()=>[u("平均配速")])),_:1})])),_:1}),o(A,{class:"chart-name"},{default:s((()=>[u("跑步状态")])),_:1})])),_:1})])),_:1}),o(t,{class:"trend-chart"},{default:s((()=>[o(A,{class:"trend-title"},{default:s((()=>[u("本周运动趋势")])),_:1}),o(t,{class:"trend-bars"},{default:s((()=>[(d(!0),r(f,null,i(B.value,((a,e)=>(d(),l(t,{class:"t-bar-group",key:e},{default:s((()=>[o(t,{class:"t-bar",style:x({height:a.val+"%",background:a.color})},null,8,["style"]),o(A,{class:"t-day"},{default:s((()=>[u(n(a.day),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),o(t,{class:"section-card task-widget"},{default:s((()=>[o(t,{class:"section-header"},{default:s((()=>[o(A,{class:"section-title"},{default:s((()=>[u("快速任务管理")])),_:1}),o(t,{class:"header-actions"},{default:s((()=>[o(A,{class:"section-action",onClick:M},{default:s((()=>[u("+ 发布")])),_:1})])),_:1})])),_:1}),o(I,{"scroll-x":"",class:"quick-task-scroll"},{default:s((()=>[(d(!0),r(f,null,i(R.value,((a,c)=>(d(),l(t,{class:"quick-task-item",key:c,onClick:e=>(a=>{v({url:`/pages/teacher/tasks/detail?id=999&title=${a.title}`})})(a)},{default:s((()=>[o(t,{class:"qt-header"},{default:s((()=>[o(A,{class:m(["qt-type",a.typeClass])},{default:s((()=>[u(n(a.type),1)])),_:2},1032,["class"]),o(A,{class:"qt-status"},{default:s((()=>[u(n(a.status),1)])),_:2},1024)])),_:2},1024),o(A,{class:"qt-title"},{default:s((()=>[u(n(a.title),1)])),_:2},1024),o(t,{class:"qt-progress"},{default:s((()=>[o(t,{class:"qt-bar-bg"},{default:s((()=>[o(t,{class:"qt-bar-fill",style:x({width:a.percent+"%"})},null,8,["style"])])),_:2},1024),o(A,{class:"qt-val"},{default:s((()=>[u(n(a.percent)+"%",1)])),_:2},1024)])),_:2},1024),o(t,{class:"qt-actions",onClick:e[0]||(e[0]=p((()=>{}),["stop"]))},{default:s((()=>[o(A,{class:"qt-btn",onClick:e=>(a=>{G.value=!0,N.value={...a,desc:"任务描述..."},E.value=!0})(a)},{default:s((()=>[u("编辑")])),_:2},1032,["onClick"]),a.percent<100?(d(),l(A,{key:0,class:"qt-btn warn",onClick:e=>(a=>{h({title:`已催办任务: ${a.title}`,icon:"none"})})(a)},{default:s((()=>[u("催办")])),_:2},1032,["onClick"])):_("",!0)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),H.value.length>0?(d(),l(t,{key:0,class:"section-card alert-widget"},{default:s((()=>[o(t,{class:"section-header"},{default:s((()=>[o(A,{class:"section-title red-dot"},{default:s((()=>[u("⚠️ 实时警报")])),_:1})])),_:1}),o(t,{class:"alert-feed"},{default:s((()=>[(d(!0),r(f,null,i(H.value,((a,e)=>(d(),l(t,{class:"feed-item",key:e},{default:s((()=>[o(t,{class:"feed-content"},{default:s((()=>[o(A,{class:"feed-msg"},{default:s((()=>[o(A,{class:"feed-name"},{default:s((()=>[u(n(a.student),1)])),_:2},1024),u(" "+n(a.type)+" ("+n(a.value)+")",1)])),_:2},1024),o(A,{class:"feed-time"},{default:s((()=>[u(n(a.time),1)])),_:2},1024)])),_:2},1024),o(J,{class:"feed-btn",size:"mini",onClick:a=>{return t=e,void w({itemList:["联系学生","标记已处理","查看详情"],success:a=>{1===a.tapIndex?(H.value.splice(t,1),S.value.abnormalCount=Math.max(0,S.value.abnormalCount-1),h({title:"已处理",icon:"success"})):0===a.tapIndex?h({title:"已发送通知",icon:"none"}):v({url:"/pages/teacher/exceptions/exceptions"})}});var t}},{default:s((()=>[u("干预")])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})):_("",!0),E.value?(d(),l(t,{key:1,class:"modal-overlay",onClick:e[8]||(e[8]=a=>E.value=!1)},{default:s((()=>[o(t,{class:"task-modal",onClick:e[7]||(e[7]=p((()=>{}),["stop"]))},{default:s((()=>[o(t,{class:"modal-header"},{default:s((()=>[o(A,{class:"modal-title"},{default:s((()=>[u(n(G.value?"编辑任务":"快速发布任务"),1)])),_:1}),o(A,{class:"close-btn",onClick:e[1]||(e[1]=a=>E.value=!1)},{default:s((()=>[u("×")])),_:1})])),_:1}),o(t,{class:"modal-body"},{default:s((()=>[o(L,{class:"modal-input",placeholder:"任务标题",modelValue:N.value.title,"onUpdate:modelValue":e[2]||(e[2]=a=>N.value.title=a)},null,8,["modelValue"]),o(t,{class:"modal-types"},{default:s((()=>[o(t,{class:m(["type-chip",{active:"考核"===N.value.type}]),onClick:e[3]||(e[3]=a=>N.value.type="考核")},{default:s((()=>[u("考核")])),_:1},8,["class"]),o(t,{class:m(["type-chip",{active:"日常"===N.value.type}]),onClick:e[4]||(e[4]=a=>N.value.type="日常")},{default:s((()=>[u("日常")])),_:1},8,["class"]),o(t,{class:m(["type-chip",{active:"训练"===N.value.type}]),onClick:e[5]||(e[5]=a=>N.value.type="训练")},{default:s((()=>[u("训练")])),_:1},8,["class"])])),_:1}),o(P,{class:"modal-textarea",placeholder:"任务描述",modelValue:N.value.desc,"onUpdate:modelValue":e[6]||(e[6]=a=>N.value.desc=a)},null,8,["modelValue"])])),_:1}),o(J,{class:"modal-submit-btn",onClick:O},{default:s((()=>[u("确认发布")])),_:1})])),_:1})])),_:1})):_("",!0),o(t,{style:{height:"120rpx"}}),o(V,{current:"/pages/teacher/home/home"})])),_:1})])),_:1})}}},[["__scopeId","data-v-4b973fcc"]]);export{T as default};
