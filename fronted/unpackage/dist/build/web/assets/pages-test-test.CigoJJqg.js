import{r as e,a6 as a,v as t,s,x as l,g as o,y as r,a7 as u,c,w as n,i,o as d,a as v,b as p,t as f,m,l as _,f as h,F as g,C as b,U as y,V as j,n as k,k as x,q as T,a8 as w}from"./index-uRXP6RJd.js";import{C}from"./CustomTabBar.BfyoH42O.js";import{a as E,o as $,r as D}from"./uni-app.es.CewT9dt1.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=M({__name:"test",setup(M){const I=e("å¼•ä½“å‘ä¸Š"),S=e("ä¸‹é¢Œè¿‡æ ï¼ŒåŒè‡‚ä¼¸ç›´"),B=e("pull-up"),V=e("student");let F=null;a((()=>{N()})),t((()=>{F&&F.getTracks().forEach((e=>e.stop()))}));const N=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return console.warn("Browser does not support camera access"),void s({title:"å½“å‰çŽ¯å¢ƒä¸æ”¯æŒæ‘„åƒå¤´",icon:"none"});const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}}});F=e,setTimeout((()=>{let a=document.getElementById("h5-video-el-test");if(console.log("H5 Camera Element:",a),a&&"VIDEO"!==a.tagName){const e=a.querySelector("video");e&&(a=e,console.log("Found inner video element:",a))}a&&"function"==typeof a.play?(a.srcObject=e,a.play().catch((e=>{console.error("Video play error:",e)}))):(console.error("Video element not found or invalid:",a),s({title:"æ‘„åƒå¤´åˆå§‹åŒ–å¤±è´¥ï¼šDOMå¼‚å¸¸",icon:"none"}))}),500)}catch(e){Z(e)}},O=e(!1),P=e(0),U=e(0),q=e(null),A=e(!0),H=e("å‡†å¤‡å°±ç»ª");e(!1);const R=e(10),z=l((()=>({"pull-up":"ðŸ’ª","sit-up":"ðŸ§˜","push-up":"ðŸ¤¸","run-1000":"ðŸƒ","run-800":"ðŸƒâ€â™€ï¸"}[B.value]||"ðŸ‹ï¸"))),G=l((()=>Math.min(P.value/R.value*100,100))),J=e=>{e.project&&(I.value=e.project),e.type&&(B.value=e.type);const a={"å¼•ä½“å‘ä¸Š":"ä¸‹é¢Œè¿‡æ ï¼ŒåŒè‡‚ä¼¸ç›´","ä»°å§èµ·å":"åŒæ‰‹æŠ±å¤´ï¼Œè‚˜éƒ¨è§¦è†","ä¿¯å§æ’‘":"èº«ä½“å¹³ç›´ï¼Œå±ˆè‡‚90åº¦"},t={"å¼•ä½“å‘ä¸Š":10,"ä»°å§èµ·å":40,"ä¿¯å§æ’‘":30};a[I.value]&&(S.value=a[I.value]),t[I.value]&&(R.value=t[I.value])};E((e=>{J(e)})),$((()=>{const e=o("userRole")||o("role");e&&(V.value=e);const a=o("testProject"),t=o("testType");a&&(J({project:a,type:t}),r("testProject"),r("testType"),s({title:"å·²æ¸…ç†ä¼ å‚ç¼“å­˜",icon:"none"}))}));const K=e=>{const a=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},L=()=>{O.value=!0,P.value=0,U.value=0,H.value="æ­£åœ¨è¯†åˆ«åŠ¨ä½œ...",q.value=setInterval((()=>{U.value++}),1e3)},Q=()=>{P.value++,H.value="åŠ¨ä½œæ ‡å‡† âœ…",setTimeout((()=>{H.value="æ­£åœ¨è¯†åˆ«åŠ¨ä½œ..."}),800)},W=()=>{clearInterval(q.value),O.value=!1,b({title:"æµ‹è¯•ç»“æŸ",content:`å…±å®Œæˆ ${P.value} æ¬¡ï¼Œç”¨æ—¶ ${K(U.value)}ï¼Œæ˜¯å¦æäº¤æˆç»©ï¼Ÿ`,confirmText:"æäº¤ç»“æžœ",cancelText:"æ”¾å¼ƒ",success:e=>{e.confirm?X():(P.value=0,U.value=0,H.value="å‡†å¤‡å°±ç»ª")}})},X=()=>{y({title:"æ­£åœ¨æäº¤æˆç»©..."}),I.value,P.value,U.value,(new Date).getTime(),setTimeout((()=>{j(),k({url:`/pages/result/result?mode=test&project=${I.value}&count=${P.value}&duration=${U.value}`})}),1e3)},Y=()=>{k({url:"/pages/teacher/students/students"})},Z=e=>{console.error("Camera Error:",e);let a="æ— æ³•è®¿é—®æ‘„åƒå¤´";"NotAllowedError"===e.name||"Permission denied"===e.message?a="æƒé™è¢«æ‹’ç»ï¼Œè¯·å…è®¸æ‘„åƒå¤´è®¿é—®":"NotFoundError"===e.name&&(a="æœªæ£€æµ‹åˆ°æ‘„åƒå¤´"),s({title:a,icon:"none",duration:3e3})};return(e,a)=>{const t=x,s=T,l=i,o=w,r=D(u("CustomTabBar"),C);return d(),c(l,{class:"test-page"},{default:n((()=>["teacher"===V.value?(d(),c(l,{key:0,class:"teacher-tools"},{default:n((()=>[v(l,{class:"teacher-card"},{default:n((()=>[v(t,{class:"teacher-title"},{default:n((()=>[p("æ•™å¸ˆå·¥å…·")])),_:1}),v(l,{class:"teacher-actions"},{default:n((()=>[v(s,{class:"teacher-btn",onClick:Y},{default:n((()=>[p("å­¦å‘˜ç®¡ç†")])),_:1})])),_:1})])),_:1})])),_:1})):(d(),c(l,{key:1,class:"student-container"},{default:n((()=>[v(l,{class:"header-info"},{default:n((()=>[v(t,{class:"project-name"},{default:n((()=>[p(f(I.value),1)])),_:1}),v(l,{class:"standard-badge"},{default:n((()=>[v(t,{class:"badge-text"},{default:n((()=>[p("å…¬å®‰ä½“èƒ½æ ‡å‡†")])),_:1})])),_:1}),v(t,{class:"standard-desc"},{default:n((()=>[p("åŠ¨ä½œæ ‡å‡†ï¼š"+f(S.value),1)])),_:1}),v(l,{class:"project-icon-wrapper"},{default:n((()=>[v(t,{class:"project-emoji"},{default:n((()=>[p(f(z.value),1)])),_:1})])),_:1})])),_:1}),v(l,{class:"camera-area"},{default:n((()=>[v(l,{class:"h5-camera-wrapper"},{default:n((()=>[v(o,{id:"h5-video-el-test",class:"real-camera",autoplay:"",playsinline:"",muted:"",controls:!1}),v(l,{class:"camera-overlay-content"},{default:n((()=>[v(l,{class:"count-overlay"},{default:n((()=>[v(l,{class:"count-val"},{default:n((()=>[p(f(P.value),1)])),_:1}),v(l,{class:"count-label"},{default:n((()=>[p("æ¬¡")])),_:1})])),_:1}),v(l,{class:"progress-bar-container"},{default:n((()=>[v(l,{class:"progress-fill",style:m({width:G.value+"%"})},null,8,["style"])])),_:1}),v(l,{class:"status-tips"},{default:n((()=>[v(l,{class:_(["status-text",{"valid-text":A.value}])},{default:n((()=>[p(f(H.value),1)])),_:1},8,["class"])])),_:1})])),_:1})])),_:1})])),_:1}),v(l,{class:"action-area"},{default:n((()=>[v(l,{class:"timer-box"},{default:n((()=>[v(t,{class:"timer-label"},{default:n((()=>[p("æµ‹è¯•ç”¨æ—¶")])),_:1}),v(t,{class:"timer-text"},{default:n((()=>[p(f(K(U.value)),1)])),_:1})])),_:1}),v(l,{class:"btn-group"},{default:n((()=>[O.value?(d(),h(g,{key:1},[v(s,{class:"sub-btn stop-btn","hover-class":"btn-hover",onClick:W},{default:n((()=>[p("ç»“æŸæµ‹è¯•")])),_:1}),v(s,{class:"sub-btn mock-btn","hover-class":"btn-hover",onClick:Q},{default:n((()=>[p("+1 (æ¨¡æ‹Ÿ)")])),_:1})],64)):(d(),c(s,{key:0,class:"main-btn start-btn","hover-class":"btn-hover",onClick:L},{default:n((()=>[p("å¼€å§‹æµ‹è¯•")])),_:1}))])),_:1})])),_:1})])),_:1})),v(r,{current:"/pages/test/test"})])),_:1})}}},[["__scopeId","data-v-ffc8aa0b"]]);export{I as default};
