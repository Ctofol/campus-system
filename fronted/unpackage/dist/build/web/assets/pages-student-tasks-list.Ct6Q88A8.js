import{r as e,z as a,c as t,w as s,s as l,i,o as n,d as u,q as d,e as c,j as o,k as r,F as p,f as _,S as m,t as f,l as v,m as k,p as g,v as y}from"./index-C5iLBQvu.js";import{o as x}from"./uni-app.es.BEWjhZNk.js";import{g as C}from"./request.BfbRFve_.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const w=b({__name:"list",setup(b){const w=e(0),$=e([]),j=e(1),T=e(20),h=e(!1),z=()=>{};x((()=>{j.value=1,(async()=>{if(!h.value){h.value=!0;try{const e=await C({page:j.value,size:T.value});if(e.items){const a=e.items.map((e=>({...e,statusText:"completed"===e.status?"已完成":"expired"===e.status?"已过期":"进行中",desc:e.description||(e.min_distance?`目标: ${e.min_distance}km`:"无具体描述"),deadline:e.deadline?e.deadline.split("T")[0]:"无限制"})));1===j.value?$.value=a:$.value=[...$.value,...a]}}catch(e){console.error(e),l({title:"加载任务失败",icon:"none"})}finally{h.value=!1}}})()}));const I=a((()=>0===w.value?$.value.filter((e=>"pending"===e.status)):$.value.filter((e=>"pending"!==e.status))));return(e,a)=>{const l=i,x=g,C=y,b=m;return n(),t(l,{class:"container"},{default:s((()=>[u(l,{class:"tabs"},{default:s((()=>[u(l,{class:d(["tab-item",{active:0===w.value}]),onClick:a[0]||(a[0]=e=>w.value=0)},{default:s((()=>[c("进行中")])),_:1},8,["class"]),u(l,{class:d(["tab-item",{active:1===w.value}]),onClick:a[1]||(a[1]=e=>w.value=1)},{default:s((()=>[c("已结束")])),_:1},8,["class"])])),_:1}),u(b,{"scroll-y":"",class:"task-list",onScrolltolower:z},{default:s((()=>[(n(!0),o(p,null,r(I.value,(e=>(n(),t(l,{class:"task-card",key:e.id,onClick:e=>{}},{default:s((()=>[u(l,{class:"card-header"},{default:s((()=>{return[u(l,{class:"title-row"},{default:s((()=>{return[u(x,{class:d(["tag",(a=e.type,"test"===a?"tag-red":"tag-blue")])},{default:s((()=>[c(f("run"===e.type?"跑步":"体测"),1)])),_:2},1032,["class"]),u(x,{class:"title"},{default:s((()=>[c(f(e.title),1)])),_:2},1024)];var a})),_:2},1024),u(x,{class:d(["status",(a=e.status,"completed"===a?"text-green":"expired"===a?"text-gray":"text-orange")])},{default:s((()=>[c(f(e.statusText),1)])),_:2},1032,["class"])];var a})),_:2},1024),u(l,{class:"card-body"},{default:s((()=>[u(x,{class:"desc"},{default:s((()=>[c(f(e.desc),1)])),_:2},1024),u(l,{class:"meta-row"},{default:s((()=>[u(x,{class:"deadline"},{default:s((()=>[c("截止: "+f(e.deadline),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),u(l,{class:"card-footer"},{default:s((()=>["pending"===e.status?(n(),t(C,{key:0,class:"action-btn",onClick:v((a=>(e=>{if("run"===e.type){let a="/pages/run/run?mode=normal";if(e.min_distance&&e.min_distance>0){let t=10;e.min_duration&&e.min_duration>0&&(t=e.min_duration/e.min_distance),a=`/pages/run/run?mode=police&target=${1e3*e.min_distance}&pace=${t.toFixed(2)}&taskId=${e.id}&taskTitle=${encodeURIComponent(e.title)}&taskType=${e.type}`}k({url:a})}else k({url:"/pages/test/test"})})(e)),["stop"])},{default:s((()=>[c("去完成")])),_:2},1032,["onClick"])):"completed"===e.status?(n(),t(x,{key:1,class:"completed-text"},{default:s((()=>[c("✅ 已完成")])),_:1})):(n(),t(x,{key:2,class:"expired-text"},{default:s((()=>[c("已过期")])),_:1}))])),_:2},1024)])),_:2},1032,["onClick"])))),128)),h.value?(n(),t(l,{key:0,class:"loading-more"},{default:s((()=>[c("加载中...")])),_:1})):_("",!0),h.value||0!==I.value.length?_("",!0):(n(),t(l,{key:1,class:"no-more"},{default:s((()=>[c("暂无任务")])),_:1}))])),_:1})])),_:1})}}},[["__scopeId","data-v-4393ae10"]]);export{w as default};
