import{r as e,z as t,g as a,a as s,c as l,w as u,s as c,i as r,o as d,d as i,e as n,n as o,t as f,f as _,h as m,F as p,p as g,m as v,J as y,C as k,b as h,q as x,V as w,u as C,j as b}from"./index-D4dSIJeF.js";import{_ as T}from"./avatar.WOnTDsO9.js";import{o as F}from"./uni-app.es.DJB9Vm6C.js";import{C as N}from"./CustomTabBar.CnmcHvqA.js";import{r as S}from"./request.Da1Pdojv.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";const $=j({__name:"mine",setup(j){const $=e(20),M=e("åŒå­¦"),B=e("å­¦ç”Ÿ"),I=e(""),q=e(0),D=e(0),E=e(0),G=e("æœ¬å‘¨"),J=e(3),z=e(0),H=e(0),O=e(0),R=e(0),V=e([]),A=t((()=>V.value.slice(0,5))),K=e(""),L=e=>{const t=Number(e);return isNaN(t)?"0.00":t.toFixed(2)},P=e=>{const t=Math.floor(e/3600),a=e%60;return`${t>0?t+":":""}${Math.floor(e%3600/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`};F((()=>{$.value=a().statusBarHeight||20;const e=s("userInfo");if(e){let a=e;if("string"==typeof e)try{a=JSON.parse(e)}catch(t){}a&&(a.name&&(M.value=a.name),a.class_name&&(I.value=a.class_name))}(async()=>{try{const e=await S({url:"/activity/history",method:"GET",data:{page:1,size:20}});if(e.items){V.value=e.items.map((e=>{var t,a,s,l,u;const c="run"===e.type,r=new Date(e.started_at),d=`${r.getMonth()+1}-${r.getDate()} ${r.getHours()}:${r.getMinutes().toString().padStart(2,"0")}`;return{type:e.type,modeBg:c?"#20C997":"#FF9F43",modeText:c?"è·‘æ­¥":"ä½“æµ‹",testName:"ä½“èƒ½æµ‹è¯•",createTime:d,distance:(null==(t=e.metrics)?void 0:t.distance)?Number(e.metrics.distance).toFixed(2):0,duration:P((null==(a=e.metrics)?void 0:a.duration)||0),pace:null==(s=e.metrics)?void 0:s.pace,testCount:(null==(l=e.metrics)?void 0:l.count)||0,result:(null==(u=e.metrics)?void 0:u.qualified)?"è¾¾æ ‡":"æœªè¾¾æ ‡",statusText:"finished"===e.status?"æœ‰æ•ˆ":"å¾…å®¡æ ¸",statusColor:"#20C997",isTask:!(!e.task_id&&!e.plan_id)}})).filter((e=>!e.isTask));const t=V.value.filter((e=>"run"===e.type));q.value=t.length,D.value=t.reduce(((e,t)=>e+Number(t.distance||0)),0).toFixed(2),E.value=V.value.filter((e=>"test"===e.type&&"è¾¾æ ‡"===e.result)).length,z.value=t.length,H.value=D.value,O.value=E.value,R.value=Math.min(t.length/J.value*100,100)}}catch(t){console.error("Fetch history failed",t)}})(),(async()=>{try{const e=await S({url:"/users/profile",method:"GET"});if(e){e.name&&(M.value=e.name),e.class_name&&(I.value=e.class_name);let a=s("userInfo");if("string"==typeof a)try{a=JSON.parse(a)}catch(t){a={}}const l={...a,...e};c("userInfo",l)}}catch(t){console.error("Fetch profile failed",t)}})()}));const Q=()=>{g({title:"ç¼–è¾‘èµ„æ–™åŠŸèƒ½å¾…å¼€å‘",icon:"none"})},U=()=>{v({url:"/pages/health/request"})},W=()=>{v({url:"/pages/mine/history-tasks/history-tasks"})},X=()=>{v({url:"/pages/history/history"})},Y=()=>{g({title:"è®¾å¤‡ç»‘å®šåŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},Z=()=>{y({title:"æç¤º",content:"ç¡®å®šè¦æ¸…é™¤ç¼“å­˜å—ï¼Ÿ",success:e=>{e.confirm&&g({title:"æ¸…ç†å®Œæˆ"})}})},ee=()=>{g({title:"å½“å‰ç‰ˆæœ¬ v1.0.0",icon:"none"})},te=()=>{y({title:"æç¤º",content:"ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ",success:e=>{e.confirm&&(k("token"),k("userInfo"),k("userRole"),h({url:"/pages/login/login"}))}})};return(e,t)=>{const a=x,s=r,c=w,g=C;return d(),l(s,{class:"mine-page"},{default:u((()=>[i(s,{class:"custom-navbar",style:o({paddingTop:$.value+"px"})},{default:u((()=>[i(s,{class:"navbar-content"},{default:u((()=>[i(a,{class:"navbar-title"},{default:u((()=>[n("ä¸ªäººä¸­å¿ƒ")])),_:1})])),_:1})])),_:1},8,["style"]),i(s,{class:"content-wrapper",style:o({paddingTop:$.value+44+"px"})},{default:u((()=>[i(s,{class:"user-header"},{default:u((()=>[i(s,{class:"avatar-box"},{default:u((()=>[i(c,{class:"avatar",src:T,mode:"aspectFill"}),i(g,{class:"edit-avatar",onClick:Q},{default:u((()=>[n("ç¼–è¾‘èµ„æ–™")])),_:1})])),_:1}),i(s,{class:"user-info"},{default:u((()=>[i(a,{class:"username"},{default:u((()=>[n(f(M.value),1)])),_:1}),i(a,{class:"user-desc"},{default:u((()=>[n(f(I.value?I.value+" Â· ":"æ ¡å›­è¿åŠ¨æ‰“å¡ Â· ")+f(B.value),1)])),_:1})])),_:1}),i(s,{class:"user-stats"},{default:u((()=>[i(s,{class:"stats-item"},{default:u((()=>[i(a,{class:"stats-num"},{default:u((()=>[n(f(q.value),1)])),_:1}),i(a,{class:"stats-text"},{default:u((()=>[n("æ€»æ¬¡æ•°")])),_:1})])),_:1}),i(s,{class:"stats-item"},{default:u((()=>[i(a,{class:"stats-num"},{default:u((()=>[n(f(D.value)+"km",1)])),_:1}),i(a,{class:"stats-text"},{default:u((()=>[n("æ€»è·ç¦»")])),_:1})])),_:1}),i(s,{class:"stats-item"},{default:u((()=>[i(a,{class:"stats-num"},{default:u((()=>[n(f(E.value),1)])),_:1}),i(a,{class:"stats-text"},{default:u((()=>[n("ä½“æµ‹è¾¾æ ‡")])),_:1})])),_:1})])),_:1})])),_:1}),i(s,{class:"week-run-card"},{default:u((()=>[i(s,{class:"card-header"},{default:u((()=>[i(s,{class:"header-left"},{default:u((()=>[i(a,{class:"card-title"},{default:u((()=>[n("æœ¬å‘¨è·‘æ­¥")])),_:1}),i(a,{class:"target-tag"},{default:u((()=>[n("ç›®æ ‡ "+f(J.value)+" æ¬¡",1)])),_:1})])),_:1}),i(a,{class:"date-range"},{default:u((()=>[n(f(G.value),1)])),_:1})])),_:1}),i(s,{class:"week-stats"},{default:u((()=>[i(s,{class:"week-item"},{default:u((()=>[i(a,{class:"week-num"},{default:u((()=>[n(f(z.value),1)])),_:1}),i(a,{class:"week-text"},{default:u((()=>[n("è·‘æ­¥æ¬¡æ•°")])),_:1})])),_:1}),i(s,{class:"week-item"},{default:u((()=>[i(a,{class:"week-num"},{default:u((()=>[n(f(L(H.value)),1)])),_:1}),i(a,{class:"week-text"},{default:u((()=>[n("æ€»è·ç¦»(km)")])),_:1})])),_:1}),i(s,{class:"week-item"},{default:u((()=>[i(a,{class:"week-num"},{default:u((()=>[n(f(O.value),1)])),_:1}),i(a,{class:"week-text"},{default:u((()=>[n("ä½“æµ‹è¾¾æ ‡")])),_:1})])),_:1})])),_:1}),i(s,{class:"progress-box"},{default:u((()=>[i(s,{class:"progress-header"},{default:u((()=>[i(a,{class:"progress-info"},{default:u((()=>[n("å·²å®Œæˆ "+f(z.value)+"/"+f(J.value),1)])),_:1}),i(a,{class:"progress-percent"},{default:u((()=>[n(f(Math.round(R.value))+"%",1)])),_:1})])),_:1}),i(s,{class:"progress-bar"},{default:u((()=>[i(s,{class:"progress-fill",style:o({width:R.value+"%"})},null,8,["style"])])),_:1})])),_:1})])),_:1}),i(s,{class:"record-card"},{default:u((()=>[i(s,{class:"card-header"},{default:u((()=>[i(a,{class:"card-title"},{default:u((()=>[n("è¿åŠ¨è®°å½•")])),_:1}),i(s,{class:"header-actions"},{default:u((()=>[i(a,{class:"history-task-link",onClick:W},{default:u((()=>[n("åŽ†å²ä»»åŠ¡")])),_:1}),i(g,{class:"view-all",onClick:X},{default:u((()=>[n("æŸ¥çœ‹å…¨éƒ¨")])),_:1})])),_:1})])),_:1}),V.value.length>0?(d(),l(s,{key:0,class:"record-list"},{default:u((()=>[(d(!0),_(p,null,m(A.value,((e,t)=>(d(),l(s,{class:"record-item",key:t,onClick:e=>{}},{default:u((()=>[i(s,{class:"record-type",style:o({backgroundColor:e.modeBg})},{default:u((()=>[i(a,{class:"type-text"},{default:u((()=>[n(f(e.modeText),1)])),_:2},1024)])),_:2},1032,["style"]),i(s,{class:"record-info"},{default:u((()=>[i(a,{class:"record-date"},{default:u((()=>[n(f(e.createTime),1)])),_:2},1024),"run"===e.type?(d(),l(a,{key:0,class:"record-data"},{default:u((()=>[n(f(e.distance)+"km | "+f(e.duration),1),e.pace?(d(),l(a,{key:0},{default:u((()=>[n(" | é…é€Ÿï¼š"+f(Number(e.pace).toFixed(1))+" åˆ†/å…¬é‡Œ",1)])),_:2},1024)):b("",!0)])),_:2},1024)):(d(),l(a,{key:1,class:"record-data"},{default:u((()=>[n(f(e.testName)+" | æ¬¡æ•°ï¼š"+f(e.testCount)+" | "+f(e.result),1)])),_:2},1024))])),_:2},1024),i(s,{class:"record-status"},{default:u((()=>[i(a,{class:"status-text",style:o({color:e.statusColor})},{default:u((()=>[n(f(e.statusText),1)])),_:2},1032,["style"])])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):(d(),l(s,{key:1,class:"empty-record"},{default:u((()=>[i(a,{class:"empty-icon"},{default:u((()=>[n("ðŸƒ")])),_:1}),i(a,{class:"empty-text"},{default:u((()=>[n("æš‚æ— è¿åŠ¨è®°å½•ï¼Œå¿«åŽ»è·‘æ­¥æ‰“å¡å§ï½ž")])),_:1})])),_:1}))])),_:1}),i(s,{class:"setting-card"},{default:u((()=>[i(s,{class:"setting-item",onClick:U},{default:u((()=>[i(a,{class:"setting-icon"},{default:u((()=>[n("ðŸ©º")])),_:1}),i(a,{class:"setting-text"},{default:u((()=>[n("å¥åº·æŠ¥å¤‡")])),_:1}),i(a,{class:"setting-desc"},{default:u((()=>[n("è¯·å‡/ä¼¤ç—…ç”³è¯·")])),_:1}),i(a,{class:"arrow"},{default:u((()=>[n("ï¼ž")])),_:1})])),_:1}),i(s,{class:"setting-item",onClick:Y},{default:u((()=>[i(a,{class:"setting-icon"},{default:u((()=>[n("ðŸ“±")])),_:1}),i(a,{class:"setting-text"},{default:u((()=>[n("è®¾å¤‡ç»‘å®šï¼ˆé˜²ä»£è·‘ï¼‰")])),_:1}),i(a,{class:"setting-desc"},{default:u((()=>[n(f(K.value||"æœªç»‘å®š"),1)])),_:1}),i(a,{class:"arrow"},{default:u((()=>[n("ï¼ž")])),_:1})])),_:1}),i(s,{class:"setting-item",onClick:Z},{default:u((()=>[i(a,{class:"setting-icon"},{default:u((()=>[n("ðŸ—‘ï¸")])),_:1}),i(a,{class:"setting-text"},{default:u((()=>[n("æ¸…é™¤ç¼“å­˜")])),_:1}),i(a,{class:"setting-desc"},{default:u((()=>[n("é‡Šæ”¾æœ¬åœ°å­˜å‚¨ç©ºé—´")])),_:1}),i(a,{class:"arrow"},{default:u((()=>[n("ï¼ž")])),_:1})])),_:1}),i(s,{class:"setting-item",onClick:ee},{default:u((()=>[i(a,{class:"setting-icon"},{default:u((()=>[n("â„¹ï¸")])),_:1}),i(a,{class:"setting-text"},{default:u((()=>[n("å…³äºŽæˆ‘ä»¬")])),_:1}),i(a,{class:"setting-desc"},{default:u((()=>[n("ç‰ˆæœ¬ v1.0.0")])),_:1}),i(a,{class:"arrow"},{default:u((()=>[n("ï¼ž")])),_:1})])),_:1}),i(s,{class:"setting-item logout",onClick:te},{default:u((()=>[i(a,{class:"setting-icon"},{default:u((()=>[n("ðŸšª")])),_:1}),i(a,{class:"setting-text"},{default:u((()=>[n("é€€å‡ºç™»å½•")])),_:1}),i(a,{class:"arrow"},{default:u((()=>[n("ï¼ž")])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),i(N,{current:"/pages/mine/mine"})])),_:1})}}},[["__scopeId","data-v-e7f3a9bc"]]);export{$ as default};
