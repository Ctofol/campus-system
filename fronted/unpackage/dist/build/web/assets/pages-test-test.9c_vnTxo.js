import{r as e,z as a,a as t,g as l,c as s,w as u,i as c,o as n,d as o,e as i,n as r,t as d,j as v,l as p,f,h as _,F as h,G as g,H as m,p as b,J as y,Y as P,m as x,q as k,u as w,S as I,k as C,V as S}from"./index-DJkcSMuy.js";import{o as j,a as $,b as D}from"./uni-app.es.BbaSIkqw.js";import{B as O,r as B}from"./request.DDN5gHc8.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";const q=T({__name:"test",setup(T){const q=e(20);e(null);const H=e(null),J=e(!1),z=e(0),M=e(0),N=e(null),A=e(null),E=e("");a((()=>Math.min(z.value/20*100,100)));const F=e(!1),G=e("è¯·åšå¥½å‡†å¤‡"),L=e(!1),R=e(!1),V=e("student");e(!0),e("back");const Y=e("å¼•ä½“å‘ä¸Š"),K=e("ä¸‹é¢Œè¿‡æ ï¼ŒåŒè‡‚ä¼¸ç›´"),Q=e("pull-up"),U=a((()=>({"pull-up":"ðŸ’ª","sit-up":"ðŸ§˜","push-up":"ðŸ™‡"}[Q.value]||"ðŸƒ"))),W=a((()=>"teacher"===V.value?[{pagePath:"/pages/teacher/home/home",text:"ä¸»é¡µ",iconPath:"/static/tab/home.png",selectedIconPath:"/static/tab/home-active.png"},{pagePath:"/pages/teacher/manage/manage",text:"ç®¡ç†",iconPath:"/static/tab/run.png",selectedIconPath:"/static/tab/run-active.png"},{pagePath:"/pages/teacher/mine/mine",text:"æˆ‘çš„",iconPath:"/static/tab/mine.png",selectedIconPath:"/static/tab/mine-active.png"}]:[{pagePath:"/pages/home/home",text:"é¦–é¡µ",iconPath:"/static/tab/home.png",selectedIconPath:"/static/tab/home-active.png"},{pagePath:"/pages/run/run",text:"è·‘æ­¥",iconPath:"/static/tab/run.png",selectedIconPath:"/static/tab/run-active.png"},{pagePath:"/pages/test/test",text:"ä½“æµ‹",iconPath:"/static/tab/test.png",selectedIconPath:"/static/tab/test-active.png"},{pagePath:"/pages/mine/mine",text:"æˆ‘çš„",iconPath:"/static/tab/mine.png",selectedIconPath:"/static/tab/mine-active.png"}]));j((()=>{const e=t("userRole")||"student";V.value=e}));const X=()=>{L.value=!L.value},Z=(e,a)=>{Y.value=e,Q.value=a,L.value=!1,"pull-up"===a?K.value="ä¸‹é¢Œè¿‡æ ï¼ŒåŒè‡‚ä¼¸ç›´":"sit-up"===a?K.value="åŒæ‰‹æŠ±å¤´ï¼Œè‚˜éƒ¨è§¦è†":"push-up"===a&&(K.value="èº«ä½“å¹³ç›´ï¼Œå±ˆè‡‚90åº¦"),z.value=0,M.value=0,J.value=!1,G.value="è¯·åšå¥½å‡†å¤‡"},ee=e=>{const a=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},ae=()=>{z.value++,F.value=!0,G.value="åŠ¨ä½œæ ‡å‡†",setTimeout((()=>{F.value=!1,G.value="ä¿æŒåŠ¨ä½œ"}),1e3)},te=()=>{J.value||(J.value=!0,z.value=0,M.value=0,G.value="æ­£åœ¨è¯†åˆ«...",E.value="",N.value=setInterval((()=>{M.value++}),1e3),H.value=setInterval((()=>{ae()}),3e3))},le=async()=>{J.value&&(clearInterval(N.value),clearInterval(H.value),J.value=!1,G.value="æµ‹è¯•ç»“æŸ",A.value={count:z.value,duration:ee(M.value),date:(new Date).toLocaleString()},g({title:"æ­£åœ¨å¤„ç†è§†é¢‘..."}),se())},se=async()=>{try{const e=await ce();let a="";if(e){const t=await ne(e);t&&t.url&&(a=t.url)}await oe(a),m(),ue()}catch(e){m(),b({title:"æ•°æ®æäº¤å¤±è´¥",icon:"none"}),console.error(e)}},ue=()=>{y({title:"æµ‹è¯•å®Œæˆ",content:`é¡¹ç›®ï¼š${Y.value}\næœ¬æ¬¡æˆç»©ï¼š${z.value}æ¬¡\nç”¨æ—¶ï¼š${ee(M.value)}`,showCancel:!1})},ce=()=>new Promise(((e,a)=>{e(null)})),ne=e=>new Promise(((a,l)=>{const s=t("token");P({url:`${O}/upload`,filePath:e,name:"file",header:{Authorization:`Bearer ${s}`},success:e=>{try{const t=JSON.parse(e.data);a(t)}catch(t){l(t)}},fail:e=>{l(e)}})})),oe=e=>B({url:"/activity/finish",method:"POST",data:{type:"test",source:"free",started_at:new Date(Date.now()-1e3*M.value).toISOString(),ended_at:(new Date).toISOString(),metrics:{count:z.value,duration:M.value,qualified:z.value>=10,checkpoints:JSON.stringify([])},evidence:[...e?[{evidence_type:"video",data_ref:e}]:[]]}});$((e=>{const a=l();q.value=a.statusBarHeight||20,e&&(e=>{e.project&&(Y.value=e.project),e.type&&(Q.value=e.type);const a={"å¼•ä½“å‘ä¸Š":"ä¸‹é¢Œè¿‡æ ï¼ŒåŒè‡‚ä¼¸ç›´","ä»°å§èµ·å":"åŒæ‰‹æŠ±å¤´ï¼Œè‚˜éƒ¨è§¦è†","ä¿¯å§æ’‘":"èº«ä½“å¹³ç›´ï¼Œå±ˆè‡‚90åº¦"};a[Y.value]&&(K.value=a[Y.value])})(e)}));const ie=()=>{x({url:"/pages/teacher/students/students"})};return D((()=>{J.value&&(clearInterval(N.value),clearInterval(H.value),J.value=!1)})),(e,a)=>{const t=k,l=c,g=w,m=I,b=S;return n(),s(l,{class:"test-page-root"},{default:u((()=>[o(l,{class:"custom-navbar",style:r({paddingTop:q.value+"px"})},{default:u((()=>[o(l,{class:"navbar-content"},{default:u((()=>[o(t,{class:"navbar-title"},{default:u((()=>[i("ä½“èƒ½æµ‹è¯•")])),_:1})])),_:1})])),_:1},8,["style"]),o(m,{"scroll-y":"true",class:"content-wrapper",style:r({paddingTop:q.value+44+"px"})},{default:u((()=>["teacher"===V.value?(n(),s(l,{key:0,class:"teacher-tools"},{default:u((()=>[o(l,{class:"teacher-card"},{default:u((()=>[o(t,{class:"teacher-title"},{default:u((()=>[i("æ•™å¸ˆå·¥å…·")])),_:1}),o(l,{class:"teacher-actions"},{default:u((()=>[o(g,{class:"teacher-btn",onClick:ie},{default:u((()=>[o(t,{class:"teacher-btn-text"},{default:u((()=>[i("å­¦å‘˜ç®¡ç†")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):(n(),s(l,{key:1,class:"student-container"},{default:u((()=>[o(l,{class:"header-info"},{default:u((()=>[o(t,{class:"project-name"},{default:u((()=>[i(d(Y.value),1)])),_:1}),o(l,{class:"standard-badge"},{default:u((()=>[o(t,{class:"badge-text"},{default:u((()=>[i("å›½å®¶å­¦ç”Ÿä½“è´¨å¥åº·æ ‡å‡†")])),_:1})])),_:1}),o(t,{class:"standard-desc"},{default:u((()=>[i("åŠ¨ä½œæ ‡å‡†ï¼š"+d(K.value),1)])),_:1}),o(l,{class:"test-type-switch"},{default:u((()=>[o(g,{class:"switch-btn",onClick:X},{default:u((()=>[o(t,{class:"switch-btn-text"},{default:u((()=>[i("åˆ‡æ¢æµ‹è¯•ç±»åž‹")])),_:1})])),_:1}),L.value?(n(),s(l,{key:0,class:"type-selector"},{default:u((()=>[o(l,{class:"type-item",onClick:a[0]||(a[0]=e=>Z("å¼•ä½“å‘ä¸Š","pull-up"))},{default:u((()=>[o(t,{class:"type-item-text"},{default:u((()=>[i("å¼•ä½“å‘ä¸Š")])),_:1})])),_:1}),o(l,{class:"type-item",onClick:a[1]||(a[1]=e=>Z("ä»°å§èµ·å","sit-up"))},{default:u((()=>[o(t,{class:"type-item-text"},{default:u((()=>[i("ä»°å§èµ·å")])),_:1})])),_:1}),o(l,{class:"type-item",onClick:a[2]||(a[2]=e=>Z("ä¿¯å§æ’‘","push-up"))},{default:u((()=>[o(t,{class:"type-item-text"},{default:u((()=>[i("ä¿¯å§æ’‘")])),_:1})])),_:1})])),_:1})):v("",!0)])),_:1})])),_:1}),o(l,{class:"camera-area"},{default:u((()=>[o(l,{class:"h5-camera-wrapper"},{default:u((()=>[o(t,{class:"error-text"},{default:u((()=>[i("H5 not fully supported in nvue mode")])),_:1})])),_:1})])),_:1}),o(l,{class:"action-area"},{default:u((()=>[o(l,{class:"timer-box"},{default:u((()=>[o(t,{class:"timer-label"},{default:u((()=>[i(d(J.value?"æµ‹è¯•ç”¨æ—¶":A.value?"ä¸Šæ¬¡ç”¨æ—¶":"æµ‹è¯•ç”¨æ—¶"),1)])),_:1}),o(t,{class:"timer-text"},{default:u((()=>[i(d(J.value?ee(M.value):A.value?A.value.duration:"00:00"),1)])),_:1})])),_:1}),!J.value&&A.value?(n(),s(l,{key:0,class:"last-result-box"},{default:u((()=>[o(t,{class:"result-title"},{default:u((()=>[i("ä¸Šæ¬¡æˆç»© ("+d(Y.value)+")",1)])),_:1}),o(l,{class:"result-row"},{default:u((()=>[o(t,{class:"result-label"},{default:u((()=>[i("æ•°é‡ï¼š")])),_:1}),o(t,{class:"result-value"},{default:u((()=>[i(d(A.value.count)+" æ¬¡",1)])),_:1})])),_:1}),o(l,{class:"result-row"},{default:u((()=>[o(t,{class:"result-label"},{default:u((()=>[i("ç”¨æ—¶ï¼š")])),_:1}),o(t,{class:"result-value"},{default:u((()=>[i(d(A.value.duration),1)])),_:1})])),_:1})])),_:1})):v("",!0),o(l,{class:"btn-group"},{default:u((()=>[J.value?(n(),s(l,{key:1,class:"testing-btns"},{default:u((()=>[o(l,{class:"sub-btn stop-btn",onClick:le},{default:u((()=>[o(t,{class:"btn-text"},{default:u((()=>[i("ç»“æŸæµ‹è¯•")])),_:1})])),_:1}),o(l,{class:"sub-btn mock-btn",onClick:ae},{default:u((()=>[o(t,{class:"btn-text mock-text"},{default:u((()=>[i("+1 æ¨¡æ‹Ÿ")])),_:1})])),_:1})])),_:1})):(n(),s(l,{key:0,class:"main-btn start-btn",onClick:te},{default:u((()=>[o(t,{class:"btn-text"},{default:u((()=>[i(d(A.value?"å†æ¬¡æµ‹è¯•":"å¼€å§‹æµ‹è¯•"),1)])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1})),R.value?(n(),s(l,{key:2,class:"guide-modal",onClick:a[5]||(a[5]=e=>R.value=!1)},{default:u((()=>[o(l,{class:"guide-content",onClick:a[4]||(a[4]=p((()=>{}),["stop"]))},{default:u((()=>[o(t,{class:"guide-title"},{default:u((()=>[i("åŠ¨ä½œæŒ‡å—")])),_:1}),o(l,{class:"guide-visual"},{default:u((()=>[o(t,{class:"guide-emoji"},{default:u((()=>[i(d(U.value),1)])),_:1})])),_:1}),o(t,{class:"guide-desc"},{default:u((()=>[i(d(K.value),1)])),_:1}),o(g,{class:"guide-btn",onClick:a[3]||(a[3]=e=>R.value=!1)},{default:u((()=>[o(t,{class:"guide-btn-text"},{default:u((()=>[i("æˆ‘çŸ¥é“äº†")])),_:1})])),_:1})])),_:1})])),_:1})):v("",!0)])),_:1},8,["style"]),o(l,{class:"tab-bar"},{default:u((()=>[o(l,{class:"tab-bar-border"}),(n(!0),f(h,null,_(W.value,((e,a)=>(n(),s(l,{key:a,class:"tab-bar-item",onClick:a=>(e=>{"/pages/test/test"!==e.pagePath&&C({url:e.pagePath})})(e)},{default:u((()=>[o(b,{class:"tab-icon",src:"/pages/test/test"===e.pagePath?e.selectedIconPath:e.iconPath},null,8,["src"]),o(t,{class:"tab-text",style:r({color:"/pages/test/test"===e.pagePath?"#20C997":"#666666"})},{default:u((()=>[i(d(e.text),1)])),_:2},1032,["style"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})}}},[["__scopeId","data-v-46dac95d"]]);export{q as default};
