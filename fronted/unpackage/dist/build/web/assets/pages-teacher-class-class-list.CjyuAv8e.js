import{r as a,Y as e,c as s,w as l,s as t,i as c,o as n,d as i,e as u,j as d,k as o,F as r,f as _,p as f,v as m,a5 as v,t as h,l as p,J as y,m as k,a1 as b,a6 as g}from"./index-C5iLBQvu.js";import{r as C}from"./request.BfbRFve_.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const w=x({__name:"class-list",setup(x){const w=a([]),j=a(!1),z=a([]),E=a([]),S=async()=>{try{const a=await C({url:"/teacher/classes"});w.value=a}catch(a){t({title:"加载失败",icon:"none"})}},$=async()=>{try{const a=await C({url:"/teacher/available_classes"});z.value=a,E.value=[],j.value=!0}catch(a){t({title:"无法获取可选班级",icon:"none"})}},I=a=>{E.value=a.detail.value},T=async()=>{if(0!==E.value.length)try{const a=E.value.map((a=>parseInt(a)));await C({url:"/teacher/classes/bind",method:"POST",data:{class_ids:a}}),j.value=!1,S(),t({title:"关联成功",icon:"success"})}catch(a){t({title:"关联失败: "+(a.message||"未知错误"),icon:"none"})}};return e((()=>{S()})),(a,e)=>{const x=f,q=m,D=c,F=b,J=g,L=v;return n(),s(D,{class:"container"},{default:l((()=>[i(D,{class:"header"},{default:l((()=>[i(x,{class:"title"},{default:l((()=>[u("班级管理")])),_:1}),i(q,{class:"add-btn",size:"mini",type:"primary",onClick:$},{default:l((()=>[u("+ 关联班级")])),_:1})])),_:1}),i(D,{class:"class-list"},{default:l((()=>[(n(!0),d(r,null,o(w.value,(a=>(n(),s(D,{class:"class-item",key:a.id,onClick:e=>{return s=a.id,void k({url:`/pages/teacher/class/class-detail?id=${s}`});var s}},{default:l((()=>[i(D,{class:"info"},{default:l((()=>[i(x,{class:"name"},{default:l((()=>[u(h(a.name),1)])),_:2},1024),i(x,{class:"count"},{default:l((()=>[u(h(a.student_count)+" 人",1)])),_:2},1024)])),_:2},1024),i(D,{class:"actions"},{default:l((()=>[i(x,{class:"delete-btn",onClick:p((e=>(async a=>{y({title:"确认解绑",content:`确定要不再管理班级 ${a.name} 吗？\n（班级和学生数据将保留）`,success:async e=>{if(e.confirm)try{await C({url:`/teacher/classes/${a.id}`,method:"DELETE"}),S(),t({title:"解绑成功",icon:"success"})}catch(s){t({title:"解绑失败",icon:"none"})}}})})(a)),["stop"])},{default:l((()=>[u("解绑")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["onClick"])))),128)),0===w.value.length?(n(),s(D,{key:0,class:"empty-tip"},{default:l((()=>[u("暂无关联班级，请关联")])),_:1})):_("",!0)])),_:1}),j.value?(n(),s(D,{key:0,class:"modal-mask"},{default:l((()=>[i(D,{class:"modal"},{default:l((()=>[i(D,{class:"modal-title"},{default:l((()=>[u("关联已有班级")])),_:1}),z.value.length>0?(n(),s(D,{key:0,class:"checkbox-list"},{default:l((()=>[i(L,{onChange:I},{default:l((()=>[(n(!0),d(r,null,o(z.value,(a=>(n(),s(J,{class:"checkbox-item",key:a.id},{default:l((()=>[i(F,{value:String(a.id),checked:E.value.includes(String(a.id))},null,8,["value","checked"]),i(x,{class:"checkbox-label"},{default:l((()=>[u(h(a.name)+" ("+h(a.student_count)+"人)",1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):(n(),s(D,{key:1,class:"empty-tip"},{default:l((()=>[u(" 没有可关联的班级（所有班级均已有老师） ")])),_:1})),i(D,{class:"modal-btns"},{default:l((()=>[i(q,{size:"mini",onClick:e[0]||(e[0]=a=>j.value=!1)},{default:l((()=>[u("取消")])),_:1}),i(q,{size:"mini",type:"primary",onClick:T,disabled:0===E.value.length},{default:l((()=>[u("确定")])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})):_("",!0)])),_:1})}}},[["__scopeId","data-v-3522d35b"]]);export{w as default};
