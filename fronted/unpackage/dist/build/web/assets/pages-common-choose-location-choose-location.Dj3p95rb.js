import{r as e,a1 as a,g as t,al as l,p as s,c as o,w as n,i as c,o as i,d as u,n as d,e as r,t as g,W as f,am as p,an as _,O as m,N as v,q as h,P as x,u as y}from"./index-DJkcSMuy.js";import{g as b,_ as F}from"./location.CVYbPWui.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const k=C({__name:"choose-location",setup(C){const k=e(39.909),j=e(116.397),w=e({lat:39.909,lng:116.397}),B=e("40px");let E=null;a((()=>{try{const e=t();e.statusBarHeight&&(B.value=e.statusBarHeight+10+"px")}catch(e){console.error("Get system info failed",e)}E=l("choose-map"),b().then((e=>{e.success&&(k.value=e.latitude,j.value=e.longitude,w.value={lat:e.latitude,lng:e.longitude})})).catch((e=>{console.error("Init location failed",e),s({title:"定位失败，请手动移动地图",icon:"none"})}))}));const G=e=>{("end"===e.type||e.detail&&("end"===e.detail.type||"regionchange"===e.detail.type))&&E.getCenterLocation({success:e=>{w.value={lat:e.latitude,lng:e.longitude}},fail:e=>{console.error("Get center failed",e)}})},H=()=>{f()},I=()=>{!uni.getFileSystemManager&&p()[p().length-1].getOpenerEventChannel(),_("onLocationChosen",{latitude:w.value.lat,longitude:w.value.lng,name:"自选打卡点",address:`经纬度: ${w.value.lng.toFixed(4)}, ${w.value.lat.toFixed(4)}`}),f()};return(e,a)=>{const t=m,l=v,s=h,f=x,p=c,_=y;return i(),o(p,{class:"choose-location-container"},{default:n((()=>[u(f,{id:"choose-map",class:"map",latitude:k.value,longitude:j.value,"show-location":!0,"enable-zoom":!0,"enable-scroll":!0,onRegionchange:G},{default:n((()=>[u(l,{class:"center-pin"},{default:n((()=>[u(t,{src:F,class:"pin-icon"})])),_:1}),u(l,{class:"back-btn",onClick:H,style:d({top:B.value})},{default:n((()=>[u(s,{class:"back-text"},{default:n((()=>[r("返回")])),_:1})])),_:1},8,["style"])])),_:1},8,["latitude","longitude"]),u(p,{class:"bottom-panel"},{default:n((()=>[u(p,{class:"location-info"},{default:n((()=>[u(s,{class:"info-title"},{default:n((()=>[r("已选位置")])),_:1}),u(s,{class:"info-coords"},{default:n((()=>[r("经度: "+g(w.value.lng.toFixed(6)),1)])),_:1}),u(s,{class:"info-coords"},{default:n((()=>[r("纬度: "+g(w.value.lat.toFixed(6)),1)])),_:1})])),_:1}),u(_,{class:"confirm-btn",onClick:I},{default:n((()=>[r("确认选择")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-97c442cc"]]);export{k as default};
