import{r as e,x as a,o as l,c as t,w as s,d as u,e as n,f as o,F as c,h as i,v as r,j as d,t as v,n as f,p,i as h,q as m,u as g,S as _,I as k,y as b,g as y,z as x,A as w,B as C,a as F,k as D,C as T,$ as M,D as I,E as S,G as R,H as N,s as $,J as L,K as O,L as P,M as j,b as B,N as J,O as q,P as A,Q as V,R as z,T as H,U}from"./index-DJkcSMuy.js";import{g as E,_ as Y}from"./location.CVYbPWui.js";import{a as G,o as K,b as Q}from"./uni-app.es.BbaSIkqw.js";import{_ as W}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{C as X}from"./CustomTabBar.wh3o2TYd.js";import{a as Z,s as ee,c as ae}from"./request.DDN5gHc8.js";const le=W({__name:"ai-chat-robot",props:{visible:Boolean,runData:{type:Object,default:()=>({distance:0,pace:0,heartRate:0})}},emits:["update:visible","share"],setup(y,{emit:x}){const w=y,C=x,F=e([{type:"robot",text:"ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ä¸“å±è¿åŠ¨å°åŠ©æ‰‹ã€‚æˆ‘æ­£åœ¨å®æ—¶åˆ†æä½ çš„è·‘æ­¥æ•°æ®ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"}]),D=e(""),T=e(0),M=()=>{C("update:visible",!1)},I=()=>{b((()=>{T.value=99999}))},S=()=>{D.value.trim()&&(R(D.value),D.value="")},R=e=>{F.value.push({type:"user",text:e}),I(),setTimeout((()=>{N(e)}),800)},N=e=>{let a={type:"robot",text:"",card:null};const{distance:l,pace:t,heartRate:s}=w.runData;if(e.includes("é…é€Ÿ")){a.text=`å½“å‰é…é€Ÿ ${t.toFixed(2)} åˆ†é’Ÿ/å…¬é‡Œã€‚`;let e="",l="#20C997";t<4?(e="é€Ÿåº¦å¾ˆå¿«ï¼Œè¯·æ³¨æ„ä¿æŒå¿ƒç‡ç¨³å®šï¼",l="#FF6B6B"):t>8?(e="é€Ÿåº¦ç¨æ…¢ï¼Œå»ºè®®åŠ å¿«æ‘†è‡‚é¢‘ç‡æ¥æå‡é€Ÿåº¦ã€‚",l="#FF9F43"):e="é…é€Ÿä¿æŒå¾—å¾ˆå¥½ï¼Œç»§ç»­åŠ æ²¹ï¼",a.card={title:"ğŸƒ é…é€Ÿåˆ†æ",chartData:[{label:"å½“å‰",value:Math.min(100,10/t*50),valText:`${t.toFixed(1)}`,color:l},{label:"ç›®æ ‡",value:70,valText:"6.0",color:"#3A7BD5"}],suggestion:e,shareable:!0}}else if(e.includes("è¿åŠ¨é‡")||e.includes("å¤Ÿå—")){const e=(l/1e3).toFixed(2);a.text=`ä½ ä»Šå¤©å·²ç»è·‘äº† ${e} å…¬é‡Œã€‚`;let t="";t=e<2?"å»ºè®®ä»Šå¤©è‡³å°‘å®Œæˆ 3 å…¬é‡Œï¼ŒåŠ æ²¹ï¼":e>10?"è¿åŠ¨é‡éå¸¸å……è¶³ï¼Œæ³¨æ„è·‘åæ‹‰ä¼¸ã€‚":"è¿åŠ¨é‡é€‚ä¸­ï¼Œä¿æŒè¿™ä¸ªèŠ‚å¥ã€‚",a.card={title:"ğŸ“Š è¿åŠ¨é‡è¯„ä¼°",chartData:[{label:"ä»Šæ—¥",value:Math.min(100,e/5*100),valText:`${e}km`,color:"#20C997"},{label:"ç›®æ ‡",value:100,valText:"5.0km",color:"#eee"}],suggestion:t,shareable:!0}}else e.includes("å»ºè®®")||e.includes("åˆ†æ")?(a.text="åŸºäºä½ çš„å®æ—¶æ•°æ®ï¼Œæˆ‘ç”Ÿæˆäº†ä¸€ä»½ç®€æŠ¥ï¼š",a.card={title:"ğŸ’¡ ç»¼åˆæ”¹è¿›å»ºè®®",suggestion:s>160?"å¿ƒç‡åé«˜ï¼Œå»ºè®®é€‚å½“æ”¾æ…¢é€Ÿåº¦ï¼Œè°ƒæ•´å‘¼å¸ã€‚":"å¿ƒç‡æ§åˆ¶è‰¯å¥½ï¼Œå¯ä»¥å°è¯•è¿›è¡Œé—´æ­‡è·‘è®­ç»ƒæå‡è€åŠ›ã€‚",chartData:[{label:"å¿ƒç‡",value:Math.min(100,s/200*100),valText:`${s}bpm`,color:s>160?"#FF4757":"#20C997"},{label:"é…é€Ÿ",value:Math.min(100,10/t*50),valText:`${t.toFixed(1)}`,color:"#3A7BD5"}],shareable:!0}):a.text="æŠ±æ­‰ï¼Œæˆ‘è¿˜åœ¨å­¦ä¹ ä¸­ï¼Œæš‚æ—¶åªèƒ½å›ç­”å…³äºé…é€Ÿã€è¿åŠ¨é‡å’Œæ”¹è¿›å»ºè®®çš„é—®é¢˜ã€‚";F.value.push(a),I()};return a((()=>w.visible),(e=>{e&&0===F.value.length&&F.value.push({type:"robot",text:"ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ä¸“å±è¿åŠ¨å°åŠ©æ‰‹ã€‚"})})),(e,a)=>{const b=h,x=m,w=g,I=_,N=k;return y.visible?(l(),t(b,{key:0,class:"ai-robot-container"},{default:s((()=>[u(b,{class:"robot-mask",onClick:M}),u(b,{class:"robot-window"},{default:s((()=>[u(b,{class:"robot-header"},{default:s((()=>[u(b,{class:"header-left"},{default:s((()=>[u(b,{class:"robot-avatar"},{default:s((()=>[n("ğŸ¤–")])),_:1}),u(b,{class:"robot-info"},{default:s((()=>[u(x,{class:"robot-name"},{default:s((()=>[n("è¿åŠ¨å°åŠ©æ‰‹")])),_:1}),u(x,{class:"robot-status"},{default:s((()=>[n("åœ¨çº¿åˆ†æä¸­...")])),_:1})])),_:1})])),_:1}),u(b,{class:"header-right"},{default:s((()=>[u(x,{class:"close-btn",onClick:M},{default:s((()=>[n("Ã—")])),_:1})])),_:1})])),_:1}),u(I,{"scroll-y":"",class:"chat-area","scroll-top":T.value},{default:s((()=>[u(b,{class:"message-list"},{default:s((()=>[(l(!0),o(c,null,i(F.value,((e,a)=>(l(),t(b,{key:a,class:r(["message-item",e.type])},{default:s((()=>["robot"===e.type?(l(),t(b,{key:0,class:"msg-avatar"},{default:s((()=>[n("ğŸ¤–")])),_:1})):d("",!0),u(b,{class:"msg-content-box"},{default:s((()=>[u(b,{class:"msg-content"},{default:s((()=>[u(x,null,{default:s((()=>[n(v(e.text),1)])),_:2},1024)])),_:2},1024),e.card?(l(),t(b,{key:0,class:"msg-card"},{default:s((()=>[u(b,{class:"card-title"},{default:s((()=>[n(v(e.card.title),1)])),_:2},1024),e.card.chartData?(l(),t(b,{key:0,class:"card-chart"},{default:s((()=>[(l(!0),o(c,null,i(e.card.chartData,((e,a)=>(l(),t(b,{class:"chart-bar-item",key:a},{default:s((()=>[u(x,{class:"bar-label"},{default:s((()=>[n(v(e.label),1)])),_:2},1024),u(b,{class:"bar-track"},{default:s((()=>[u(b,{class:"bar-fill",style:f({width:e.value+"%",background:e.color})},null,8,["style"])])),_:2},1024),u(x,{class:"bar-val"},{default:s((()=>[n(v(e.valText),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)):d("",!0),e.card.suggestion?(l(),t(b,{key:1,class:"card-suggestion"},{default:s((()=>[u(x,{class:"suggestion-icon"},{default:s((()=>[n("ğŸ’¡")])),_:1}),u(x,null,{default:s((()=>[n(v(e.card.suggestion),1)])),_:2},1024)])),_:2},1024)):d("",!0),e.card.shareable?(l(),t(w,{key:2,class:"share-btn",size:"mini",onClick:a=>{return l=e.card,p({title:"å·²å‘é€ç»™æ•™å®˜",icon:"success"}),void C("share",l);var l}},{default:s((()=>[n("åˆ†äº«ç»™æ•™å®˜")])),_:2},1032,["onClick"])):d("",!0)])),_:2},1024)):d("",!0)])),_:2},1024),"user"===e.type?(l(),t(b,{key:1,class:"msg-avatar"},{default:s((()=>[n("ğŸ‘¤")])),_:1})):d("",!0)])),_:2},1032,["class"])))),128))])),_:1})])),_:1},8,["scroll-top"]),u(b,{class:"input-area"},{default:s((()=>[u(I,{"scroll-x":"",class:"quick-replies","show-scrollbar":!1},{default:s((()=>[u(b,{class:"chip",onClick:a[0]||(a[0]=e=>R("æˆ‘çš„é…é€Ÿæ€ä¹ˆæ ·ï¼Ÿ"))},{default:s((()=>[n("é…é€Ÿåˆ†æ")])),_:1}),u(b,{class:"chip",onClick:a[1]||(a[1]=e=>R("ä»Šå¤©è¿åŠ¨é‡å¤Ÿå—ï¼Ÿ"))},{default:s((()=>[n("è¿åŠ¨é‡è¯„ä¼°")])),_:1}),u(b,{class:"chip",onClick:a[2]||(a[2]=e=>R("ç»™ç‚¹å»ºè®®"))},{default:s((()=>[n("æ”¹è¿›å»ºè®®")])),_:1})])),_:1}),u(b,{class:"input-box"},{default:s((()=>[u(N,{class:"text-input",modelValue:D.value,"onUpdate:modelValue":a[3]||(a[3]=e=>D.value=e),placeholder:"è¾“å…¥é—®é¢˜...","confirm-type":"send",onConfirm:S},null,8,["modelValue"]),u(b,{class:"send-btn",onClick:S},{default:s((()=>[n("å‘é€")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):d("",!0)}}},[["__scopeId","data-v-79d7ba8d"]]),te=W({__name:"run",setup(a){const b=e(20);G((()=>{const e=y();b.value=e.statusBarHeight||20}));const W=e(!1),te=x((()=>({distance:Oe.value,pace:Ke.value||(Oe.value>0?Le.value/60/(Oe.value/1e3):0),heartRate:Je.value,stepCount:Be.value}))),se=()=>{W.value=!0};K((()=>{He=!0,console.log("run.vue onShow triggered"),w({title:"è·‘æ­¥"}),C({frontColor:"#ffffff",backgroundColor:"#20C997"});if("teacher"===(F("userRole")||F("role")))return p({title:"è¯¥åŠŸèƒ½ä»…å¯¹å­¦ç”Ÿå¼€æ”¾",icon:"none"}),void setTimeout((()=>{D({url:"/pages/teacher/home/home"})}),800);const e=F("runMode");e&&(da(e),T("runMode")),Xe(),Z().then((e=>{ge.value=e})).catch((e=>{console.error("Failed to load checkpoints",e)})),De.value=F("checkpoint")||{},De.value.name&&ra(De.value.lat,De.value.lng,De.value.name);const a=F("runRecordsList")||[],l=new Date,t=new Date(l.getFullYear(),l.getMonth(),l.getDate()).getTime(),s=t+864e5;let u=0,n=0;if(a.forEach((e=>{const a=new Date(e.createTime).getTime();(!e.type||"run"===e.type)&&a>=t&&a<s&&(u+=1,n+=Number(e.distance)||0)})),ne.value=u,oe.value=Number(n.toFixed(2)),ve.value=xa(a),!Ye.value){const e=F("teacherTask");if(e)try{const a="string"==typeof e?JSON.parse(e):e;ce.value=a.title||""}catch(o){ce.value=""}}}));const ue=e=>{var a;const l={studentName:(null==(a=F("userInfo"))?void 0:a.name)||"å­¦å‘˜",time:(new Date).toLocaleString(),card:e};let t=F("mockSharedReports")||[];t.unshift(l),$("mockSharedReports",t)},ne=e(0),oe=e(0),ce=e(""),ie=e(5),re=e(0),de=e(0),ve=e([]),fe=e([{name:"åˆæ¬¡å¼€è·‘",icon:"ğŸ…"},{name:"äº”å…¬é‡Œè¾¾äºº",icon:"ğŸƒâ€â™‚ï¸"},{name:"å…¨å‹¤å‘¨",icon:"ğŸ”¥"},{name:"æ—©èµ·é¸Ÿ",icon:"ğŸ¦"}]),pe=e(!1),he=e([{name:"ç¯æ ¡å¤–åœˆè·‘",distance:5.2,difficulty:"ä¸­ç­‰"},{name:"æ¹–ç•”æ—è«é“",distance:3,difficulty:"ç®€å•"},{name:"ä½“è‚²åœºå†²åˆº",distance:1.5,difficulty:"å›°éš¾"}]),me=()=>pe.value=!pe.value,ge=e([]),_e=e("idle"),ke=e(""),be=e(39.909),ye=e(116.397),xe=e([]),we=e({points:[],color:"#007AFF",width:4,arrowLine:!0}),Ce=e(null),Fe=e([]),De=e({}),Te=e([]),Me=e([]),Ie=()=>{const e=[];we.value.points.length>0?e.push(JSON.parse(JSON.stringify(we.value))):e.push({...we.value,points:[]}),Ce.value&&e.push(JSON.parse(JSON.stringify(Ce.value))),Fe.value=e},Se=(e,a,l,t)=>{const s=(l-e)*Math.PI/180,u=(t-a)*Math.PI/180,n=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e*Math.PI/180)*Math.cos(l*Math.PI/180)*Math.sin(u/2)*Math.sin(u/2);return 6371e3*(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)))},Re=()=>{ze&&clearInterval(ze);let e=Date.now();ze=setInterval((()=>{E({type:"gcj02"}).then((a=>{const l=a.latitude,t=a.longitude;let s=0;if($e.value&&Te.value.length>0){const a=Te.value[Te.value.length-1],u=Se(a.latitude,a.longitude,l,t),n=(Date.now()-e)/1e3;n>0&&(s=u/n)}qe.value=s,((e,a,l)=>{if(be.value=e,ye.value=a,xe.value[0]={id:0,latitude:e,longitude:a,title:"æˆ‘çš„ä½ç½®",iconPath:"/static/location.png",width:30,height:30},$e.value){if(0===Te.value.length){const t={latitude:e,longitude:a,timestamp:Date.now(),speed:l||qe.value};return Te.value.push(t),we.value.points.push({latitude:e,longitude:a}),void Ie()}const t=Te.value[Te.value.length-1],s=Se(t.latitude,t.longitude,e,a),u=(Date.now()-t.timestamp)/1e3;if(u<.5)return;const n=s/u;if(s>=2&&n<20){Oe.value+=s;const t={latitude:e,longitude:a,timestamp:Date.now(),speed:l||n};Te.value.push(t),we.value.points.push({latitude:e,longitude:a}),Ie(),"campus"===Ne.value&&De.value.lat&&(Pe.value=Math.floor(Se(e,a,De.value.lat,De.value.lng)),Pe.value<=(De.value.radius||100)?(je.value=!0,F("checkpointReached")||(De.value.id?ae({lat:e,lng:a,checkpoint_id:De.value.id}).then((l=>{l.success&&(p({title:"æ‰“å¡æˆåŠŸï¼",icon:"success"}),Me.value.push({checkpoint_id:De.value.id,time:(new Date).toISOString(),lat:e,lng:a}))})).catch((()=>{})):p({title:"å·²åˆ°è¾¾æ‰“å¡ç‚¹èŒƒå›´ï¼",icon:"success"}),$("checkpointReached","1"))):je.value=!1),"normal"===Ne.value?re.value=Math.min(100,Oe.value/1e3/ie.value*100):"police"===Ne.value&&(de.value=Math.min(100,Oe.value/Ue.value*100))}}})(l,t,s),e=Date.now()})).catch((e=>{console.warn("H5 Polling failed",e)}))}),1e3)},Ne=e("normal"),$e=e(!1),Le=e(0),Oe=e(0),Pe=e(0),je=e(!1),Be=e(0),Je=e(80),qe=e(0);e(0);let Ae=null,Ve=null,ze=null,He=!0;const Ue=e(2e3),Ee=e(6.5),Ye=e(null),Ge=e(null),Ke=x((()=>{const e=Oe.value/1e3,a=Le.value/60;if(0===e)return 0;const l=a/e;return l>999?999:l})),Qe=x((()=>(3.6*qe.value).toFixed(1))),We=x((()=>0===Le.value?0:(Oe.value/1e3/(Le.value/3600)).toFixed(1)));G((e=>{e.mode&&(Ne.value=e.mode),e.target&&(Ue.value=parseInt(e.target)),e.pace&&(Ee.value=parseFloat(e.pace)),e.taskId&&(Ye.value=e.taskId,e.taskType&&(Ge.value=e.taskType)),e.taskTitle&&(ce.value=decodeURIComponent(e.taskTitle)),e.course&&p({title:`å¼€å§‹è¯¾ç¨‹ï¼š${e.course}`,icon:"none"})})),M("onLocationChosen",(e=>{ca(e)})),I((()=>{S("onLocationChosen"),Ze(),Ae&&clearInterval(Ae)}));const Xe=()=>{ea()},Ze=()=>{};Q((()=>{He=!1})),I((()=>{Ae&&clearInterval(Ae),ha()}));const ea=()=>{ta()},aa=e=>{be.value=e.latitude,ye.value=e.longitude,$("lastLocation",{lat:e.latitude,lng:e.longitude}),xe.value=[{id:0,latitude:e.latitude,longitude:e.longitude,title:"æˆ‘çš„ä½ç½®",iconPath:"/static/location.png",width:30,height:30}];e.latitude>=39.9&&e.latitude<=39.92&&e.longitude>=116.39&&e.longitude<=116.41||"campus"!==Ne.value||p({title:"ä»…æ ¡å›­å†…å¯è¿›è¡Œæ‰“å¡",icon:"none"})},la=e=>{console.error("Location failed:",e);let a="å®šä½å¤±è´¥",l=!1;const t=e.errMsg||"";t.includes("auth")||t.includes("denied")||t.includes("permission")?(a="å®šä½æƒé™è¢«æ‹’ç»ï¼Œè¯·å»è®¾ç½®å¼€å¯",l=!0):(t.includes("service")||t.includes("unavailable"))&&(a="å®šä½æœåŠ¡ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥GPS"),"https:"!==location.protocol&&"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname&&(a="H5å®šä½éœ€HTTPS"),l?L({title:"æƒé™æç¤º",content:a,confirmText:"å»è®¾ç½®",success:e=>{e.confirm&&uni.openSetting()}}):p({title:a,icon:"none",duration:3e3}),_e.value="fail"},ta=async()=>{const e=F("lastLocation");e?(be.value=e.lat,ye.value=e.lng,xe.value=[{id:0,latitude:e.lat,longitude:e.lng,title:"æˆ‘çš„ä½ç½®",iconPath:"/static/location.png",width:30,height:30}]):R({title:"å®šä½ä¸­..."}),_e.value="locating";try{const e=await E();if(!He)return;N(),e.success&&(aa(e),p({title:"å®šä½æˆåŠŸ",icon:"none"}),_e.value="success")}catch(a){if(!He)return;N(),e?(p({title:"åˆ·æ–°å®šä½å¤±è´¥ï¼Œä½¿ç”¨å†å²ä½ç½®",icon:"none"}),_e.value="fail"):la(a)}},sa=()=>{R({title:"é‡æ–°å®šä½..."}),_e.value="locating",setTimeout((()=>N()),5e3),E().then((e=>{He&&(N(),aa(e),p({title:"å·²æ›´æ–°ä½ç½®",icon:"none"}),_e.value="success")})).catch((e=>{He&&(N(),la(e))}))},ua=x((()=>{switch(_e.value){case"locating":return"æ­£åœ¨å®šä½...";case"success":return"å®šä½æˆåŠŸ";case"fail":return"å®šä½å¤±è´¥ï¼Œè¯·ç§»è‡³å®¤å¤–å¼€é˜”åœ°";default:return"ç­‰å¾…å®šä½"}})),na=()=>{if(!ke.value){if(0===ge.value.length)return p({title:"æœªåŠ è½½åˆ°æ‰“å¡ç‚¹æ•°æ®",icon:"none"}),void Z().then((e=>{ge.value=e,p({title:"æ•°æ®å·²é‡æ–°åŠ è½½ï¼Œè¯·é‡è¯•",icon:"none"})}));const e=ge.value.map((e=>e.name));return void P({itemList:e,success:e=>{const a=ge.value[e.tapIndex];oa(a)},fail:e=>{console.log(e.errMsg)}})}const e=ge.value.find((e=>e.name.includes(ke.value)));e?oa(e):p({title:"æœªæ‰¾åˆ°è¯¥æ‰“å¡ç‚¹",icon:"none"})},oa=e=>{const a={name:e.name,lat:e.latitude,lng:e.longitude,radius:e.radius,id:e.id};$("checkpoint",a),De.value=a,ra(a.lat,a.lng,a.name),Ce.value={points:[{latitude:be.value,longitude:ye.value},{latitude:a.lat,longitude:a.lng}],color:"#FF0000",width:2,dottedLine:!0},Ie(),p({title:`å·²é”å®šï¼š${a.name}`,icon:"success"})},ca=e=>{console.log("Selected location:",e);const a=e.latitude,l=e.longitude;let t=null,s=1/0;if(ge.value.forEach((e=>{const u=Se(a,l,e.latitude,e.longitude);u<s&&(s=u,t=e)})),t&&s<=200){ke.value=t.name;const e={name:t.name,lat:t.latitude,lng:t.longitude,radius:t.radius,id:t.id};$("checkpoint",e),De.value=e,ra(e.lat,e.lng,e.name),Ce.value={points:[{latitude:be.value,longitude:ye.value},{latitude:e.lat,longitude:e.lng}],color:"#FF0000",width:2,dottedLine:!0},Ie(),p({title:`å·²å®šä½åˆ°ï¼š${t.name}`,icon:"success"})}else L({title:"æç¤º",content:"æ‚¨é€‰æ‹©çš„åœ°ç‚¹ä¸åœ¨æ ¡å›­æ‰“å¡ç‚¹èŒƒå›´å†…ï¼Œæ˜¯å¦ä»è¦è®¾ä¸ºç›®æ ‡ï¼Ÿ(æ— æ³•è¿›è¡Œæœ‰æ•ˆæ‰“å¡)",success:t=>{if(t.confirm){ke.value=e.name||"è‡ªå®šä¹‰ä½ç½®";const t={name:e.name||"è‡ªå®šä¹‰ä½ç½®",lat:a,lng:l,radius:50,id:null};$("checkpoint",t),De.value=t,ra(a,l,t.name),Ce.value={points:[{latitude:be.value,longitude:ye.value},{latitude:a,longitude:l}],color:"#FF0000",width:2,dottedLine:!0},Ie()}}})},ia=()=>{j({success:e=>{ca(e)},fail:e=>{console.error("Choose location failed",e)}})},ra=(e,a,l)=>{xe.value.push({id:1,latitude:e,longitude:a,title:l,iconPath:"/static/checkpoint.png",width:40,height:40})},da=e=>{$e.value=!1,clearInterval(Ae),ha(),Le.value=0,Oe.value=0,Be.value=0,Je.value=80,Ne.value=e};let va=!1,fa=0;const pa=()=>{V(),z({interval:"game",success:()=>{console.log("Accelerometer started"),va=!1,fa=Date.now()},fail:e=>{console.error("Start Accelerometer failed:",e)}}),Ve=e=>{let a=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);a>5&&(a/=9.8);const l=Date.now();va&&l-fa>1500&&(va=!1),!va&&a>1.25?l-fa>300&&(Be.value+=1,fa=l,va=!0):va&&a<1.05&&(va=!1)},H(Ve)},ha=()=>{Ve&&(V(),U(Ve),Ve=null)},ma=()=>{Je.value=80+Math.floor(Le.value/10),Je.value>180&&L({title:"å¥åº·é¢„è­¦",content:`å½“å‰å¿ƒç‡è¿‡é«˜ï¼ˆ${Je.value}æ¬¡/åˆ†ï¼‰ï¼Œå»ºè®®é™é€Ÿä¼‘æ¯`,showCancel:!1})},ga=()=>{if("success"!==_e.value)return p({title:"å®šä½æœªæˆåŠŸï¼Œæ— æ³•å¼€å§‹",icon:"none"}),ta(),!1;if($e.value=!0,Le.value=0,Oe.value=0,Be.value=0,Je.value=80,we.value.points=[],Te.value=[],be.value&&ye.value){const e={latitude:be.value,longitude:ye.value,timestamp:Date.now(),speed:0};Te.value.push(e),we.value.points.push({latitude:be.value,longitude:ye.value}),Ie()}return!0},_a=()=>{Ce.value=null,ga()&&(T("checkpointReached"),Re(),pa(),Ae=setInterval((()=>{Le.value+=1,ma()}),1e3))},ka=()=>{ga()&&(T("policeFinishTip"),Re(),pa(),Ae=setInterval((()=>{Le.value+=1,ma(),Oe.value>=Ue.value&&!F("policeFinishTip")&&(p({title:"å·²å®Œæˆ2000ç±³ç›®æ ‡ï¼",icon:"success"}),$("policeFinishTip","1"))}),1e3))},ba=()=>{ga()&&(je.value=!1,T("checkpointReached"),Re(),pa(),Ae=setInterval((()=>{Le.value+=1,ma()}),1e3))},ya=async()=>{if(!$e.value)return;$e.value=!1,clearInterval(Ae),ha(),ze&&(clearInterval(ze),ze=null);if(!F("token"))return p({title:"è¯·å…ˆç™»å½•",icon:"none"}),void setTimeout((()=>{B({url:"/pages/login/login"})}),800);const e={type:Ge.value?Ge.value:"police"===Ne.value?"test":"run",source:Ye.value?"task":"free",started_at:new Date(Date.now()-1e3*Le.value).toISOString(),ended_at:(new Date).toISOString(),metrics:{distance:Oe.value/1e3,duration:Le.value,pace:Ke.value.toFixed(1),count:"police"===Ne.value?1:null,qualified:"police"===Ne.value&&Ke.value<=Ee.value,trajectory:JSON.stringify(Te.value),checkpoints:JSON.stringify(Me.value)},evidence:[]};try{R({title:"æäº¤ä¸­..."});const a=await ee(e);N(),console.log("Submit success:",a),$("tempRunResult",e),D({url:"/pages/result/result?useStorage=true",fail:e=>{console.error("Navigate failed:",e),p({title:"é¡µé¢è·³è½¬å¤±è´¥",icon:"none"})}})}catch(a){N(),console.error("Submit failed:",a),L({title:"æäº¤å¤±è´¥",content:a&&a.detail?a.detail:"ç½‘ç»œæˆ–æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·é‡è¯•",confirmText:"é‡è¯•",cancelText:"å¼ºåˆ¶ç»“æŸ",success:e=>{e.confirm||e.cancel&&(p({title:"å·²å¼ºåˆ¶ç»“æŸ",icon:"none"}),setTimeout((()=>{B({url:"/pages/home/home"})}),800))}})}},xa=e=>{const a=new Date,l=[];for(let t=0;t<7;t++){const s=new Date(a.getFullYear(),a.getMonth(),a.getDate()-t),u=new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime(),n=u+864e5,o=e.filter((e=>{const a=new Date(e.createTime).getTime();return(!e.type||"run"===e.type)&&a>=u&&a<n})),c=o.length,i=o.reduce(((e,a)=>e+Number(a.distance||0)),0);l.push({date:`${s.getMonth()+1}/${s.getDate()}`,count:c,distance:Number(i.toFixed(2))})}return l.reverse()};return(e,a)=>{const y=m,x=h,w=_,C=k,F=g,D=J,T=q,M=A;return l(),t(x,{class:"run"},{default:s((()=>[u(x,{class:"custom-navbar",style:f({paddingTop:b.value+"px"})},{default:s((()=>[u(x,{class:"navbar-content"},{default:s((()=>[u(y,{class:"navbar-title"},{default:s((()=>[n("è·‘æ­¥")])),_:1})])),_:1})])),_:1},8,["style"]),u(x,{class:"content-spacer",style:f({height:b.value+44+"px"})},null,8,["style"]),u(le,{visible:W.value,"onUpdate:visible":a[0]||(a[0]=e=>W.value=e),"run-data":te.value,onShare:ue},null,8,["visible","run-data"]),$e.value||Oe.value>0?(l(),t(x,{key:0,class:"ai-float-btn",onClick:se},{default:s((()=>[u(y,{class:"ai-btn-icon"},{default:s((()=>[n("ğŸ¤–")])),_:1}),u(y,{class:"ai-btn-text"},{default:s((()=>[n("AIåŠ©æ‰‹")])),_:1})])),_:1})):d("",!0),u(x,{class:"top-widgets"},{default:s((()=>[u(x,{class:"weather-widget"},{default:s((()=>[u(x,{class:"weather-left"},{default:s((()=>[u(y,{class:"weather-temp"},{default:s((()=>[n("24Â°C")])),_:1}),u(y,{class:"weather-status"},{default:s((()=>[n("â˜€ï¸ æ™´æœ—")])),_:1})])),_:1}),u(x,{class:"weather-right"},{default:s((()=>[u(y,{class:"weather-tips"},{default:s((()=>[n("ç©ºæ°”ä¼˜ Â· é€‚å®œè·‘æ­¥")])),_:1})])),_:1})])),_:1}),u(w,{"scroll-x":"",class:"achievements-scroll","show-scrollbar":!1},{default:s((()=>[(l(!0),o(c,null,i(fe.value,((e,a)=>(l(),t(x,{class:"badge-item",key:a},{default:s((()=>[u(y,{class:"badge-icon"},{default:s((()=>[n(v(e.icon),1)])),_:2},1024),u(y,{class:"badge-name"},{default:s((()=>[n(v(e.name),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),"campus"===Ne.value?(l(),t(x,{key:1,class:"search-bar"},{default:s((()=>[u(C,{modelValue:ke.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ke.value=e),placeholder:"è¾“å…¥æ ¡å›­æ‰“å¡ç‚¹ï¼ˆå¦‚ï¼šæ“åœº/è·‘é“ï¼‰",class:"search-input"},null,8,["modelValue"]),u(x,{class:"map-select-btn",onClick:ia},{default:s((()=>[u(y,{class:"map-icon"},{default:s((()=>[n("ğŸ—ºï¸")])),_:1})])),_:1}),u(F,{onClick:na,class:"search-btn"},{default:s((()=>[n("æœç´¢")])),_:1})])),_:1})):d("",!0),u(x,{class:"overview-card"},{default:s((()=>[u(y,{class:"overview-title"},{default:s((()=>[n("ä»Šæ—¥è·‘æ­¥æ¦‚è§ˆ")])),_:1}),u(x,{class:"overview-meta"},{default:s((()=>[u(y,null,{default:s((()=>[n("æ¬¡æ•°ï¼š"+v(ne.value),1)])),_:1}),u(y,null,{default:s((()=>[n("é‡Œç¨‹ï¼š"+v(oe.value)+" km",1)])),_:1})])),_:1}),ce.value?(l(),t(y,{key:0,class:"task-tip"},{default:s((()=>[n("æ•™å¸ˆä»»åŠ¡ï¼š"+v(ce.value),1)])),_:1})):d("",!0)])),_:1}),u(M,{class:"map",latitude:be.value,longitude:ye.value,markers:xe.value,polyline:Fe.value,"enable-zoom":!0,"min-scale":3,"max-scale":20,scale:"16","show-location":!0},{default:s((()=>[u(D,{class:"location-status-bar",style:f({display:"success"===_e.value?"none":"flex"})},{default:s((()=>[u(y,{class:"status-text"},{default:s((()=>[n(v(ua.value),1)])),_:1})])),_:1},8,["style"]),u(D,{class:"map-controls"},{default:s((()=>[u(D,{class:"control-btn",onClick:sa},{default:s((()=>[u(T,{src:Y,class:"control-icon"})])),_:1})])),_:1})])),_:1},8,["latitude","longitude","markers","polyline"]),"normal"===Ne.value?(l(),t(x,{key:2,class:"routes-card"},{default:s((()=>[u(x,{class:"card-header",onClick:me},{default:s((()=>[u(y,{class:"card-title"},{default:s((()=>[n("ğŸƒ æ¨èè·¯çº¿")])),_:1}),u(y,{class:"card-toggle"},{default:s((()=>[n(v(pe.value?"æ”¶èµ·":"å±•å¼€"),1)])),_:1})])),_:1}),pe.value?(l(),t(x,{key:0,class:"routes-list"},{default:s((()=>[(l(!0),o(c,null,i(he.value,((e,a)=>(l(),t(x,{class:"route-item",key:a,onClick:a=>(e=>{p({title:`å·²åŠ è½½è·¯çº¿ï¼š${e.name}`,icon:"none"}),ie.value=e.distance})(e)},{default:s((()=>[u(x,{class:"route-info"},{default:s((()=>[u(y,{class:"route-name"},{default:s((()=>[n(v(e.name),1)])),_:2},1024),u(y,{class:"route-meta"},{default:s((()=>[n(v(e.distance)+"km Â· "+v(e.difficulty),1)])),_:2},1024)])),_:2},1024),u(y,{class:"route-action"},{default:s((()=>[n("å»è·‘æ­¥ >")])),_:1})])),_:2},1032,["onClick"])))),128))])),_:1})):d("",!0)])),_:1})):d("",!0),u(x,{class:"mode-switch"},{default:s((()=>[u(y,{class:r(["mode-item",{active:"normal"===Ne.value}]),onClick:a[2]||(a[2]=e=>da("normal"))},{default:s((()=>[n("æ™®é€šè·‘æ­¥")])),_:1},8,["class"]),u(y,{class:r(["mode-item",{active:"police"===Ne.value}]),onClick:a[3]||(a[3]=e=>da("police"))},{default:s((()=>[n("ä¸“é¡¹æµ‹è¯•")])),_:1},8,["class"]),u(y,{class:r(["mode-item",{active:"campus"===Ne.value}]),onClick:a[4]||(a[4]=e=>da("campus"))},{default:s((()=>[n("æ ¡å›­æ‰“å¡")])),_:1},8,["class"])])),_:1}),"police"===Ne.value?(l(),t(x,{key:3,class:"police-plan"},{default:s((()=>[u(y,{class:"plan-title"},{default:s((()=>[n("ğŸ¯ 2000ç±³ä½“èƒ½ä¸“é¡¹è®­ç»ƒ")])),_:1}),u(x,{class:"plan-info"},{default:s((()=>[u(y,{class:"info-item"},{default:s((()=>[n("ç›®æ ‡è·ç¦»ï¼š"),O("span",{class:"highlight"},v(Ue.value/1e3)+"å…¬é‡Œ",1)])),_:1}),u(y,{class:"info-item"},{default:s((()=>[n("è¾¾æ ‡é…é€Ÿï¼š"),O("span",{class:"highlight"},v(Ee.value)+"åˆ†é’Ÿ/å…¬é‡Œ",1)])),_:1}),u(y,{class:"info-item"},{default:s((()=>[n("å»ºè®®æ ‡å‡†ï¼š"),O("span",{class:"highlight"},"å¯æŒ‰å­¦æ ¡æˆ–è¯¾ç¨‹è¦æ±‚é…ç½®")])),_:1})])),_:1})])),_:1})):d("",!0),"normal"===Ne.value?(l(),t(x,{key:4,class:"run-mode-box"},{default:s((()=>[$e.value?(l(),t(x,{key:1,class:"running-box"},{default:s((()=>[u(y,{class:"data"},{default:s((()=>[n("æ—¶é•¿ï¼š"+v(Le.value)+"ç§’ | å·²è·‘ï¼š"+v(((Oe.value||0)/1e3).toFixed(2))+"km | é€Ÿåº¦ï¼š"+v(Qe.value)+"km/h",1)])),_:1}),u(y,{class:"data"},{default:s((()=>[n("æ­¥æ•°ï¼š"+v(Be.value)+" | å¿ƒç‡ï¼š"+v(Je.value)+"æ¬¡/åˆ† | å¹³å‡é€Ÿåº¦ï¼š"+v(We.value)+"km/h",1)])),_:1}),u(x,{class:"progress-wrap"},{default:s((()=>[u(x,{class:"progress-bar"},{default:s((()=>[u(x,{class:"progress-fill",style:f({width:re.value+"%"})},null,8,["style"])])),_:1}),u(y,{class:"progress-text"},{default:s((()=>[n("ä»Šæ—¥ç›®æ ‡ "+v(ie.value)+" km Â· å®Œæˆ "+v(((Oe.value||0)/1e3).toFixed(2))+" km",1)])),_:1})])),_:1}),u(F,{onClick:ya,class:"stop-btn"},{default:s((()=>[n("ç»“æŸè·‘æ­¥")])),_:1})])),_:1})):(l(),t(x,{key:0,class:"start-box"},{default:s((()=>[u(y,{class:"tip"},{default:s((()=>[n("æ— åœ°ç‚¹/è·ç¦»é™åˆ¶ï¼Œè‡ªç”±è®°å½•è·‘æ­¥è½¨è¿¹")])),_:1}),u(F,{onClick:_a,class:"start-btn"},{default:s((()=>[n("å¼€å§‹è·‘æ­¥")])),_:1})])),_:1}))])),_:1})):d("",!0),"police"===Ne.value?(l(),t(x,{key:5,class:"run-mode-box"},{default:s((()=>[$e.value?(l(),t(x,{key:1,class:"running-box"},{default:s((()=>[u(y,{class:"data"},{default:s((()=>[n("æ—¶é•¿ï¼š"+v(Le.value)+"ç§’ | å·²è·‘ï¼š"+v((Oe.value/1e3).toFixed(2))+"km / ç›®æ ‡ï¼š2km",1)])),_:1}),u(y,{class:"data"},{default:s((()=>[n("å‰©ä½™ï¼š"+v(((Ue.value-Oe.value)/1e3).toFixed(2))+"km | é…é€Ÿï¼š"+v(Ke.value.toFixed(1))+"åˆ†é’Ÿ/å…¬é‡Œ",1)])),_:1}),u(y,{class:"data"},{default:s((()=>[n("å¿ƒç‡ï¼š"+v(Je.value)+"æ¬¡/åˆ† | æ­¥æ•°ï¼š"+v(Be.value),1)])),_:1}),u(y,{class:"pace-status",style:f({color:Ke.value<=Ee.value?"green":"red"})},{default:s((()=>[n(v(Ke.value<=Ee.value?"âœ… é…é€Ÿè¾¾æ ‡":"âŒ é…é€Ÿæœªè¾¾æ ‡"),1)])),_:1},8,["style"]),Oe.value>=Ue.value?(l(),t(y,{key:0,class:"finish-tip"},{default:s((()=>[n("ğŸ‰ å·²å®Œæˆ2000ç±³ç›®æ ‡ï¼")])),_:1})):d("",!0),u(x,{class:"progress-wrap"},{default:s((()=>[u(x,{class:"progress-bar"},{default:s((()=>[u(x,{class:"progress-fill",style:f({width:de.value+"%"})},null,8,["style"])])),_:1}),u(y,{class:"progress-text"},{default:s((()=>[n("ä¸“é¡¹ç›®æ ‡ 2 km Â· å®Œæˆ "+v((Oe.value/1e3).toFixed(2))+" km",1)])),_:1})])),_:1}),u(F,{onClick:ya,class:"stop-btn"},{default:s((()=>[n("ç»“æŸè®­ç»ƒ")])),_:1})])),_:1})):(l(),t(x,{key:0,class:"start-box"},{default:s((()=>[u(y,{class:"tip"},{default:s((()=>[n("æŒ‰è¯¾ç¨‹è¦æ±‚å®Œæˆ2000ç±³è·‘ï¼Œè‡ªåŠ¨æ ¡éªŒé…é€Ÿæ˜¯å¦è¾¾æ ‡")])),_:1}),u(F,{onClick:ka,class:"start-btn"},{default:s((()=>[n("å¼€å§‹ä¸“é¡¹è®­ç»ƒ")])),_:1})])),_:1}))])),_:1})):d("",!0),"campus"===Ne.value?(l(),t(x,{key:6,class:"run-mode-box"},{default:s((()=>[De.value.name?(l(),t(x,{key:1},{default:s((()=>[$e.value?(l(),t(x,{key:1,class:"running-box"},{default:s((()=>[u(y,{class:"data"},{default:s((()=>[n("æ—¶é•¿ï¼š"+v(Le.value)+"ç§’ | è·æ‰“å¡ç‚¹ï¼š"+v(Pe.value)+"ç±³ | æ­¥æ•°ï¼š"+v(Be.value)+" | å¿ƒç‡ï¼š"+v(Je.value)+"æ¬¡/åˆ†",1)])),_:1}),u(y,{class:"reach-status",style:f({color:je.value?"green":"red"})},{default:s((()=>[n(v(je.value?"âœ… å·²åˆ°è¾¾æ‰“å¡ç‚¹":"âŒ æœªåˆ°è¾¾æ‰“å¡ç‚¹"),1)])),_:1},8,["style"]),u(F,{onClick:ya,class:"stop-btn"},{default:s((()=>[n("ç»“æŸæ‰“å¡")])),_:1})])),_:1})):(l(),t(x,{key:0,class:"start-box"},{default:s((()=>[u(y,{class:"checkpoint-info"},{default:s((()=>[n("æ‰“å¡ç‚¹ï¼š"+v(De.value.name)+"ï¼ˆéœ€åˆ°è¾¾10ç±³å†…ï¼‰",1)])),_:1}),u(F,{onClick:ba,class:"start-btn"},{default:s((()=>[n("å¼€å§‹æ‰“å¡")])),_:1})])),_:1}))])),_:1})):(l(),t(x,{key:0,class:"no-checkpoint"},{default:s((()=>[u(y,{class:"tip"},{default:s((()=>[n("è¯·å…ˆæœç´¢æ ¡å›­æ‰“å¡ç‚¹")])),_:1})])),_:1}))])),_:1})):d("",!0),u(X,{current:"/pages/run/run"})])),_:1})}}},[["__scopeId","data-v-860e9a77"]]);export{te as default};
