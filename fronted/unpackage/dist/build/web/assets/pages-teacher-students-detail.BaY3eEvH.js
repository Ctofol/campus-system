import{r as a,z as t,s as e,c as s,w as l,i as u,o as c,d,e as r,t as n,q as i,j as o,k as f,F as _,f as v,X as m,a2 as p,p as g,S as h,v as y}from"./index-C5iLBQvu.js";import{a as b,o as k}from"./uni-app.es.BEWjhZNk.js";import{r as S}from"./request.BfbRFve_.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const w=x({__name:"detail",setup(x){const w=a(""),$=a(""),j=a(""),C=a(""),F=a("体能A组"),q=a("良好"),z=a("run"),A=a([]),D=a([]),M=t((()=>A.value.reduce(((a,t)=>a+parseFloat(t.distance)),0).toFixed(1))),N=t((()=>"良好"===q.value?"good":"bad"));b((a=>{w.value=a.id||"",w.value&&H()}));const T=a=>{if(!a)return"";const t=new Date(a);return`${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},I=a=>{if(!a)return"00:00";return`${Math.floor(a/60).toString().padStart(2,"0")}:${(a%60).toString().padStart(2,"0")}`},H=async()=>{try{const a=await S({url:"/teacher/classes"}),t=await S({url:`/teacher/students/${w.value}`});if($.value=t.name,j.value=t.student_id||t.phone,t.class_id){const e=a.find((a=>a.id===t.class_id));C.value=e?e.name:"未知班级"}else C.value="未分配班级";F.value=t.group_name||"未分组";const e={normal:"正常",leave:"请假",injured:"受伤"};q.value=e[t.health_status]||"正常";const s=await S({url:`/teacher/student/${w.value}/activities`,data:{size:100}}),l=s.items||s;Array.isArray(l)&&(A.value=l.filter((a=>"run"===a.type)).map((a=>{var t,e,s;return{date:T(a.started_at),distance:((null==(t=a.metrics)?void 0:t.distance)||0).toFixed(2),duration:I((null==(e=a.metrics)?void 0:e.duration)||0),modeText:"task"===a.source?"任务跑步":"自由跑",pace:(null==(s=a.metrics)?void 0:s.pace)||"-"}})),D.value=l.filter((a=>"test"===a.type)).map((a=>{var t,e;return{date:T(a.started_at),testName:"体能测试",testCount:(null==(t=a.metrics)?void 0:t.count)||0,result:(null==(e=a.metrics)?void 0:e.qualified)?"合格":"未合格"}})))}catch(a){e({title:"加载数据失败",icon:"none"}),console.error(a)}};k((()=>{}));const L=()=>{m({itemList:["拨打电话","发送消息"],success:a=>{0===a.tapIndex?p({phoneNumber:j.value}):e({title:"功能开发中",icon:"none"})}})},P=()=>{e({title:"正在生成PDF档案...",icon:"loading"}),setTimeout((()=>{e({title:"导出成功",icon:"success"})}),1500)};return(a,t)=>{const e=u,m=g,p=h,b=y;return c(),s(e,{class:"detail-page"},{default:l((()=>[d(e,{class:"header-card"},{default:l((()=>[d(e,{class:"user-info"},{default:l((()=>[d(e,{class:"avatar"},{default:l((()=>[r(n($.value.slice(0,1)),1)])),_:1}),d(e,{class:"info-content"},{default:l((()=>[d(e,{class:"name-row"},{default:l((()=>[d(m,{class:"name"},{default:l((()=>[r(n($.value),1)])),_:1}),d(m,{class:i(["status-badge",N.value])},{default:l((()=>[r(n(q.value),1)])),_:1},8,["class"])])),_:1}),d(m,{class:"sub-text"},{default:l((()=>[r("学号："+n(j.value)+" | "+n(C.value),1)])),_:1}),d(m,{class:"sub-text"},{default:l((()=>[r("分组："+n(F.value||"未分组"),1)])),_:1})])),_:1})])),_:1}),d(e,{class:"stats-grid"},{default:l((()=>[d(e,{class:"stat-item"},{default:l((()=>[d(m,{class:"stat-val"},{default:l((()=>[r(n(A.value.length),1)])),_:1}),d(m,{class:"stat-label"},{default:l((()=>[r("总跑次")])),_:1})])),_:1}),d(e,{class:"stat-item"},{default:l((()=>[d(m,{class:"stat-val"},{default:l((()=>[r(n(M.value),1)])),_:1}),d(m,{class:"stat-label"},{default:l((()=>[r("总里程(km)")])),_:1})])),_:1}),d(e,{class:"stat-item"},{default:l((()=>[d(m,{class:"stat-val"},{default:l((()=>[r(n(D.value.length),1)])),_:1}),d(m,{class:"stat-label"},{default:l((()=>[r("测试次数")])),_:1})])),_:1})])),_:1})])),_:1}),d(e,{class:"tabs-container"},{default:l((()=>[d(e,{class:"tabs"},{default:l((()=>[d(e,{class:i(["tab-item",{active:"run"===z.value}]),onClick:t[0]||(t[0]=a=>z.value="run")},{default:l((()=>[r("跑步记录")])),_:1},8,["class"]),d(e,{class:i(["tab-item",{active:"test"===z.value}]),onClick:t[1]||(t[1]=a=>z.value="test")},{default:l((()=>[r("体能测试")])),_:1},8,["class"])])),_:1})])),_:1}),d(p,{"scroll-y":"",class:"content-area"},{default:l((()=>["run"===z.value?(c(),s(e,{key:0,class:"list-container"},{default:l((()=>[(c(!0),o(_,null,f(A.value,((a,t)=>(c(),s(e,{class:"record-card",key:"r"+t},{default:l((()=>[d(e,{class:"card-left"},{default:l((()=>[d(m,{class:"card-date"},{default:l((()=>[r(n(a.date),1)])),_:2},1024),d(m,{class:"card-tag"},{default:l((()=>[r(n(a.modeText),1)])),_:2},1024)])),_:2},1024),d(e,{class:"card-right"},{default:l((()=>[d(e,{class:"data-row"},{default:l((()=>[d(m,{class:"data-val"},{default:l((()=>[r(n(a.distance),1),d(m,{class:"unit"},{default:l((()=>[r("km")])),_:1})])),_:2},1024),d(m,{class:"data-val"},{default:l((()=>[r(n(a.duration),1)])),_:2},1024)])),_:2},1024),d(m,{class:"pace"},{default:l((()=>[r("配速 "+n(a.pace||"5'30\""),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),0===A.value.length?(c(),s(e,{key:0,class:"empty-tip"},{default:l((()=>[r("暂无跑步记录")])),_:1})):v("",!0)])),_:1})):(c(),s(e,{key:1,class:"list-container"},{default:l((()=>[(c(!0),o(_,null,f(D.value,((a,t)=>(c(),s(e,{class:"record-card",key:"t"+t},{default:l((()=>[d(e,{class:"card-left"},{default:l((()=>[d(m,{class:"card-date"},{default:l((()=>[r(n(a.date),1)])),_:2},1024),d(m,{class:"card-title"},{default:l((()=>[r(n(a.testName),1)])),_:2},1024)])),_:2},1024),d(e,{class:"card-right"},{default:l((()=>[d(m,{class:i(["test-result","合格"===a.result?"pass":"fail"])},{default:l((()=>[r(n(a.result),1)])),_:2},1032,["class"]),d(m,{class:"test-val"},{default:l((()=>[r("成绩："+n(a.testCount),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),0===D.value.length?(c(),s(e,{key:0,class:"empty-tip"},{default:l((()=>[r("暂无测试记录")])),_:1})):v("",!0)])),_:1}))])),_:1}),d(e,{class:"footer-actions"},{default:l((()=>[d(b,{class:"action-btn outline",onClick:L},{default:l((()=>[r("联系学生")])),_:1}),d(b,{class:"action-btn primary",onClick:P},{default:l((()=>[r("导出档案")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-407986a3"]]);export{w as default};
