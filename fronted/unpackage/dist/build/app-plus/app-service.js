if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}const a=(t,a=0)=>(a,l=e.getCurrentInstance())=>{!e.isInSSRComponentSetup&&e.injectHook(t,a,l)},l=a("onShow",3),s=a("onLoad",2),n=a("onReachBottom",2),c=(e,t)=>{const a=e.__vccOpts||e;for(const[l,s]of t)a[l]=s;return a},o=c({__name:"CustomTabBar",props:{current:{type:String,default:""}},setup(t){const a=t,l=e.ref("student"),s=[{pagePath:"/pages/home/home",text:"é¦–é¡µ",iconPath:"/static/tab/home.png",selectedIconPath:"/static/tab/home-active.png"},{pagePath:"/pages/run/run",text:"è·‘æ­¥",iconPath:"/static/tab/run.png",selectedIconPath:"/static/tab/run-active.png"},{pagePath:"/pages/test/test",text:"ä½“æµ‹",iconPath:"/static/tab/test.png",selectedIconPath:"/static/tab/test-active.png"},{pagePath:"/pages/mine/mine",text:"æˆ‘çš„",iconPath:"/static/tab/mine.png",selectedIconPath:"/static/tab/mine-active.png"}],n=[{pagePath:"/pages/teacher/home/home",text:"ä¸»é¡µ",iconPath:"/static/tab/home.png",selectedIconPath:"/static/tab/home-active.png"},{pagePath:"/pages/teacher/manage/manage",text:"ç®¡ç†",iconPath:"/static/tab/run.png",selectedIconPath:"/static/tab/run-active.png"},{pagePath:"/pages/teacher/mine/mine",text:"æˆ‘çš„",iconPath:"/static/tab/mine.png",selectedIconPath:"/static/tab/mine-active.png"}];e.onMounted((()=>{const e=uni.getStorageSync("userRole")||"student";l.value=e}));const c=e.computed((()=>"teacher"===l.value?n:s)),o=e.computed((()=>c.value.findIndex((e=>e.pagePath===a.current||a.current.startsWith(e.pagePath)))));return(t,l)=>(e.openBlock(),e.createElementBlock("cover-view",{class:"tab-bar"},[e.createElementVNode("cover-view",{class:"tab-bar-border"}),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,((t,l)=>(e.openBlock(),e.createElementBlock("cover-view",{key:l,class:"tab-bar-item",onClick:e=>(e=>{const t=e.pagePath;t!==a.current&&uni.redirectTo({url:t})})(t)},[e.createElementVNode("cover-image",{class:"tab-icon",src:o.value===l?t.selectedIconPath:t.iconPath},null,8,["src"]),e.createElementVNode("cover-view",{class:"tab-text",style:e.normalizeStyle({color:o.value===l?"#20C997":"#666666"})},e.toDisplayString(t.text),5)],8,["onClick"])))),128))]))}},[["__scopeId","data-v-93aa6fa5"]]);let i="http://127.0.0.1:8000";i="http://192.168.0.210:8000";const r="http://192.168.0.210:8000",d=(...e)=>{let t={};return t="string"==typeof e[0]?{url:e[0],...e[1]}:e[0]||{},new Promise(((e,a)=>{const l=uni.getStorageSync("token"),s={"Content-Type":"application/json",...t.header||{}};l&&(s.Authorization=`Bearer ${l}`),uni.request({url:`${r}${t.url}`,method:t.method||"GET",data:t.data||{},header:s,success:t=>{t.statusCode>=200&&t.statusCode<300?e(t.data):401===t.statusCode?(uni.removeStorageSync("token"),uni.removeStorageSync("userInfo"),uni.showToast({title:"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•",icon:"none"}),setTimeout((()=>{uni.reLaunch({url:"/pages/login/login"})}),1500),a(t.data)):(uni.showToast({title:t.data.detail||"è¯·æ±‚å¤±è´¥",icon:"none"}),a(t.data))},fail:e=>{uni.showToast({title:"ç½‘ç»œè¯·æ±‚å¤±è´¥",icon:"none"}),a(e)}})}))},m=e=>{let t="";return e&&(t=`?page=${e.page}&size=${e.size}`),d({url:`/student/tasks${t}`,method:"GET"})},u=c({__name:"home",setup(a){const s=e.ref(20),n=e.ref("student"),c=e.ref({}),i=e.ref(null);l((()=>{s.value=uni.getSystemInfoSync().statusBarHeight||20;if(!uni.getStorageSync("token"))return void uni.reLaunch({url:"/pages/login/login"});const e=uni.getStorageSync("userRole")||uni.getStorageSync("role");e&&(n.value=e);const a=uni.getStorageSync("userInfo");if(a)try{c.value="string"==typeof a?JSON.parse(a):a}catch(l){t("error","at pages/home/home.vue:187","JSON parse error",l),c.value={}}(async()=>{try{const e=await m({page:1,size:1});if(e.items&&e.items.length>0){const t=e.items[0];i.value={id:t.id,title:t.title,desc:t.description||(t.min_distance?`ç›®æ ‡: ${t.min_distance}km`:"è¯·æŸ¥çœ‹è¯¦æƒ…")}}else i.value=null}catch(l){if(!uni.getStorageSync("token"))return;t("error","at pages/home/home.vue:165","Fetch task failed",l)}})()}));const r=e.ref(!0),d=e.ref(!1),u=e.ref([{name:"å¼•ä½“å‘ä¸Š",tag:"ä½“æµ‹é¡¹ç›®",tagClass:"tag-police",status:"æœªå®Œæˆ",type:"pull-up"},{name:"ä»°å§èµ·å",tag:"æ—¥å¸¸æµ‹è¯„",tagClass:"tag-daily",status:"è¿›è¡Œä¸­",type:"sit-up"},{name:"ä¿¯å§æ’‘",tag:"åŸºç¡€è®­ç»ƒ",tagClass:"tag-base",status:"æœªå¼€å§‹",type:"push-up"}]),v=e.ref([{id:1,name:"ç»¼åˆä½“èƒ½æµ‹è¯•",type:"è€ƒæ ¸",typeClass:"tag-red",duration:45,difficulty:"é«˜å¼ºåº¦",isCompleted:!1},{id:2,name:"1000ç±³çˆ†å‘åŠ›è®­ç»ƒ",type:"ä¸“é¡¹",typeClass:"tag-blue",duration:20,difficulty:"ä¸­å¼ºåº¦",isCompleted:!0},{id:3,name:"æ ¸å¿ƒåŠ›é‡å¼ºåŒ–è¯¾ç¨‹",type:"æ—¥å¸¸",typeClass:"tag-green",duration:30,difficulty:"ä½å¼ºåº¦",isCompleted:!1}]),p=e.ref({name:"åˆ‘ä¾¦å…ˆé”‹è·‘å›¢",rank:3,members:42,totalDistance:1205.8,activityCount:5}),E=e.ref([{name:"äº”å››é’å¹´èŠ‚ç¯æ ¡è·‘",time:"5æœˆ4æ—¥ 07:00",status:"æŠ¥åä¸­",statusClass:"status-active",joined:128},{name:"å‘¨æœ«å¤œè·‘æ‰“å¡èµ›",time:"æœ¬å‘¨å…­ 19:00",status:"è¿›è¡Œä¸­",statusClass:"status-ing",joined:56},{name:"è¿åŠ¨æŠ€èƒ½äº¤æµä¼š",time:"ä¸‹å‘¨ä¸‰ 14:00",status:"é¢„å‘Š",statusClass:"status-future",joined:30}]);e.ref([{user:"å¼ ä¼Ÿ",time:"10åˆ†é’Ÿå‰",action:"å®Œæˆäº†",result:"5å…¬é‡Œæ™¨è·‘",likes:12,avatarColor:"#FF6B6B"},{user:"æå¨œ",time:"35åˆ†é’Ÿå‰",action:"æ‰“å¡äº†",result:"æ ¸å¿ƒåŠ›é‡è®­ç»ƒ",likes:8,avatarColor:"#4ECDC4"},{user:"ç‹å¼º",time:"1å°æ—¶å‰",action:"åˆ·æ–°äº†",result:"3000ç±³ä¸ªäººè®°å½•",likes:25,avatarColor:"#45B7D1"}]);const N=e.ref([{name:"æ™¨è·‘å…ˆé”‹é˜Ÿ",members:56,distance:2300,heat:9800},{name:"é•¿è·‘èè‹±å›¢",members:48,distance:1800,heat:8500},{name:"æ ¡å›­é©¬æ‹‰æ¾ç¤¾",members:42,distance:1205,heat:7200},{name:"é˜³å…‰è¿åŠ¨é˜Ÿ",members:35,distance:980,heat:6e3}]),g=()=>{const e=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEEAD"];return e[Math.floor(Math.random()*e.length)]},V=()=>{uni.navigateTo({url:"/pages/student/tasks/list"})},w=()=>{uni.navigateTo({url:"/pages/ai-police/ai-police"})},h=()=>{uni.navigateTo({url:"/pages/activity/list"})},k=()=>{uni.showToast({title:"åˆ›å»ºåŠŸèƒ½å³å°†ä¸Šçº¿",icon:"none"})},y=()=>{uni.showToast({title:"åŠ å…¥åŠŸèƒ½å³å°†ä¸Šçº¿",icon:"none"})},x=()=>{uni.showToast({title:"è·‘å›¢è¯¦æƒ…",icon:"none"})},f=()=>{d.value=!0},b=()=>{d.value=!1};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"home-container"},[e.createElementVNode("view",{class:"custom-navbar",style:e.normalizeStyle({paddingTop:s.value+"px"})},[e.createElementVNode("view",{class:"navbar-content"},[e.createElementVNode("text",{class:"navbar-title"},"é¦–é¡µ")])],4),e.createElementVNode("view",{class:"content-wrapper",style:e.normalizeStyle({paddingTop:s.value+44+"px"})},[e.createElementVNode("view",{class:"student-dashboard"},[e.createElementVNode("view",{class:"header-section"},[i.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"teacher-task-box",onClick:V},[e.createElementVNode("view",{class:"task-icon-box"},[e.createElementVNode("text",{class:"task-icon"},"ğŸ“¢")]),e.createElementVNode("view",{class:"task-content"},[e.createElementVNode("text",{class:"task-title"},"è€å¸ˆå‘å¸ƒäº†æ–°ä»»åŠ¡"),e.createElementVNode("text",{class:"task-desc"},e.toDisplayString(i.value.title),1)]),e.createElementVNode("view",{class:"task-action"},[e.createElementVNode("text",{class:"btn-text"},"å»å®Œæˆ")])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"student-func-grid"},[e.createElementVNode("view",{class:"stu-func-item",onClick:w},[e.createElementVNode("view",{class:"stu-func-icon"},"ğŸ¤–"),e.createElementVNode("text",{class:"stu-func-name"},"AIè®¡æ•°")]),e.createElementVNode("view",{class:"stu-func-item",onClick:h},[e.createElementVNode("view",{class:"stu-func-icon"},"ğŸš©"),e.createElementVNode("text",{class:"stu-func-name"},"è·‘å›¢æ´»åŠ¨")]),e.createElementVNode("view",{class:"stu-func-item",onClick:a[0]||(a[0]=e=>uni.redirectTo({url:"/pages/test/test"}))},[e.createElementVNode("view",{class:"stu-func-icon"},"ğŸ“Š"),e.createElementVNode("text",{class:"stu-func-name"},"ä½“æµ‹æˆç»©")]),e.createElementVNode("view",{class:"stu-func-item",onClick:a[1]||(a[1]=e=>uni.redirectTo({url:"/pages/mine/mine"}))},[e.createElementVNode("view",{class:"stu-func-icon"},"ğŸ‘¤"),e.createElementVNode("text",{class:"stu-func-name"},"ä¸ªäººä¸­å¿ƒ")])])]),e.createElementVNode("view",{class:"section-container module-card"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"ä½“èƒ½è€ƒæ ¸é¡¹ç›®")]),e.createElementVNode("view",{class:"test-project-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"test-card",key:a,onClick:e=>(e=>{uni.redirectTo({url:"/pages/test/test?project="+e.name+"&type="+e.type})})(t)},[e.createElementVNode("view",{class:"test-icon"},e.toDisplayString("pull-up"===t.type?"ğŸ’ª":"sit-up"===t.type?"ğŸ§˜":"ğŸ‹ï¸"),1),e.createElementVNode("view",{class:"test-info"},[e.createElementVNode("text",{class:"test-name"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:"test-tags"},[e.createElementVNode("text",{class:e.normalizeClass(["tag-small",t.tagClass])},e.toDisplayString(t.tag),3)])]),e.createElementVNode("text",{class:"test-status"},e.toDisplayString(t.status),1)],8,["onClick"])))),128))])]),e.createElementVNode("view",{class:"section-container module-card"},[e.createElementVNode("view",{class:"section-header",onClick:a[2]||(a[2]=e=>r.value=!r.value)},[e.createElementVNode("text",{class:"section-title"},"ä¸“é¡¹è®­ç»ƒè®¡åˆ’"),e.createElementVNode("text",{class:"section-more"},e.toDisplayString(r.value?"æ”¶èµ·":"å±•å¼€"),1)]),r.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"training-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"training-card",key:a,onClick:e=>(e=>{uni.navigateTo({url:`/pages/run/run?mode=training&planId=${e.id}&name=${e.name}`})})(t)},[e.createElementVNode("view",{class:"card-left"},[e.createElementVNode("view",{class:e.normalizeClass(["tag-box",t.typeClass])},[e.createElementVNode("text",{class:"tag-text"},e.toDisplayString(t.type),1)],2),e.createElementVNode("view",{class:"training-info"},[e.createElementVNode("text",{class:"training-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"training-meta"},e.toDisplayString(t.duration)+"åˆ†é’Ÿ Â· "+e.toDisplayString(t.difficulty),1)])]),e.createElementVNode("view",{class:"card-right"},[t.isCompleted?(e.openBlock(),e.createElementBlock("view",{key:0,class:"status-icon"},[e.createElementVNode("text",null,"âœ…")])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"start-btn-small"},[e.createElementVNode("text",null,"å¼€å§‹")]))])],8,["onClick"])))),128))])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"section-container module-card"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"è·‘å›¢è”ç›Ÿ"),e.createElementVNode("view",{class:"header-actions"},[e.createElementVNode("text",{class:"action-link",onClick:k},"åˆ›å»º"),e.createElementVNode("text",{class:"divider"},"|"),e.createElementVNode("text",{class:"action-link",onClick:y},"åŠ å…¥"),e.createElementVNode("text",{class:"divider"},"|"),e.createElementVNode("text",{class:"action-link",onClick:h},"æ´»åŠ¨æµè§ˆ")])]),e.createElementVNode("view",{class:"my-club-card",onClick:x},[e.createElementVNode("view",{class:"club-bg-overlay"}),e.createElementVNode("view",{class:"club-info"},[e.createElementVNode("view",{class:"club-header"},[e.createElementVNode("text",{class:"club-name"},e.toDisplayString(p.value.name),1),e.createElementVNode("text",{class:"club-rank"},"No."+e.toDisplayString(p.value.rank),1)]),e.createElementVNode("view",{class:"club-stats"},[e.createElementVNode("view",{class:"stat-box"},[e.createElementVNode("text",{class:"val"},e.toDisplayString(p.value.members),1),e.createElementVNode("text",{class:"label"},"æˆå‘˜")]),e.createElementVNode("view",{class:"stat-box"},[e.createElementVNode("text",{class:"val"},e.toDisplayString(p.value.totalDistance),1),e.createElementVNode("text",{class:"label"},"æ€»é‡Œç¨‹(km)")]),e.createElementVNode("view",{class:"stat-box"},[e.createElementVNode("text",{class:"val"},e.toDisplayString(p.value.activityCount),1),e.createElementVNode("text",{class:"label"},"æœ¬æœˆæ´»åŠ¨")])])]),e.createElementVNode("view",{class:"rank-entry",onClick:e.withModifiers(f,["stop"])},[e.createElementVNode("text",{class:"rank-icon"},"ğŸ†"),e.createElementVNode("text",{class:"rank-text"},"æ’è¡Œæ¦œ")])]),e.createElementVNode("view",{class:"community-feed"},[e.createElementVNode("text",{class:"feed-title"},"æœ€æ–°åŠ¨æ€"),e.createElementVNode("scroll-view",{"scroll-x":"",class:"activity-scroll"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(E.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"activity-card",key:a,onClick:e=>(e=>{uni.navigateTo({url:`/pages/activity/detail?name=${e.name}`})})(t)},[e.createElementVNode("view",{class:e.normalizeClass(["act-tag",t.statusClass])},e.toDisplayString(t.status),3),e.createElementVNode("text",{class:"act-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"act-time"},"ğŸ•’ "+e.toDisplayString(t.time),1),e.createElementVNode("view",{class:"act-users"},[e.createElementVNode("view",{class:"avatar-group"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(3,(t=>e.createElementVNode("view",{class:"avatar-circle",key:t,style:e.normalizeStyle({backgroundColor:g()})},null,4))),64))]),e.createElementVNode("text",{class:"act-count"},e.toDisplayString(t.joined)+"äººå·²æŠ¥å",1)])],8,["onClick"])))),128))])])])]),e.createElementVNode("view",{style:{height:"120rpx"}}),e.createVNode(o,{current:"/pages/home/home"}),d.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal-overlay",onClick:b},[e.createElementVNode("view",{class:"rank-modal",onClick:a[3]||(a[3]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"ğŸ† è·‘å›¢æ’è¡Œæ¦œ"),e.createElementVNode("text",{class:"close-btn",onClick:b},"Ã—")]),e.createElementVNode("view",{class:"rank-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(N.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"rank-item",key:a},[e.createElementVNode("view",{class:e.normalizeClass(["rank-num","rank-"+(a+1)])},e.toDisplayString(a+1),3),e.createElementVNode("view",{class:"rank-info"},[e.createElementVNode("text",{class:"rank-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"rank-detail"},e.toDisplayString(t.members)+"äºº / "+e.toDisplayString(t.distance)+"km",1)]),e.createElementVNode("view",{class:"rank-trend"},[e.createElementVNode("text",null,"ğŸ”¥ "+e.toDisplayString(t.heat),1)])])))),128))])])])):e.createCommentVNode("",!0)],4)]))}},[["__scopeId","data-v-524124dd"]]),v=c({__name:"ai-chat-robot",props:{visible:Boolean,runData:{type:Object,default:()=>({distance:0,pace:0,heartRate:0})}},emits:["update:visible","share"],setup(t,{emit:a}){const l=t,s=a,n=e.ref([{type:"robot",text:"ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ä¸“å±è¿åŠ¨å°åŠ©æ‰‹ã€‚æˆ‘æ­£åœ¨å®æ—¶åˆ†æä½ çš„è·‘æ­¥æ•°æ®ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"}]),c=e.ref(""),o=e.ref(0),i=()=>{s("update:visible",!1)},r=()=>{e.nextTick((()=>{o.value=99999}))},d=()=>{c.value.trim()&&(m(c.value),c.value="")},m=e=>{n.value.push({type:"user",text:e}),r(),setTimeout((()=>{u(e)}),800)},u=e=>{let t={type:"robot",text:"",card:null};const{distance:a,pace:s,heartRate:c}=l.runData;if(e.includes("é…é€Ÿ")){t.text=`å½“å‰é…é€Ÿ ${s.toFixed(2)} åˆ†é’Ÿ/å…¬é‡Œã€‚`;let e="",a="#20C997";s<4?(e="é€Ÿåº¦å¾ˆå¿«ï¼Œè¯·æ³¨æ„ä¿æŒå¿ƒç‡ç¨³å®šï¼",a="#FF6B6B"):s>8?(e="é€Ÿåº¦ç¨æ…¢ï¼Œå»ºè®®åŠ å¿«æ‘†è‡‚é¢‘ç‡æ¥æå‡é€Ÿåº¦ã€‚",a="#FF9F43"):e="é…é€Ÿä¿æŒå¾—å¾ˆå¥½ï¼Œç»§ç»­åŠ æ²¹ï¼",t.card={title:"ğŸƒ é…é€Ÿåˆ†æ",chartData:[{label:"å½“å‰",value:Math.min(100,10/s*50),valText:`${s.toFixed(1)}`,color:a},{label:"ç›®æ ‡",value:70,valText:"6.0",color:"#3A7BD5"}],suggestion:e,shareable:!0}}else if(e.includes("è¿åŠ¨é‡")||e.includes("å¤Ÿå—")){const e=(a/1e3).toFixed(2);t.text=`ä½ ä»Šå¤©å·²ç»è·‘äº† ${e} å…¬é‡Œã€‚`;let l="";l=e<2?"å»ºè®®ä»Šå¤©è‡³å°‘å®Œæˆ 3 å…¬é‡Œï¼ŒåŠ æ²¹ï¼":e>10?"è¿åŠ¨é‡éå¸¸å……è¶³ï¼Œæ³¨æ„è·‘åæ‹‰ä¼¸ã€‚":"è¿åŠ¨é‡é€‚ä¸­ï¼Œä¿æŒè¿™ä¸ªèŠ‚å¥ã€‚",t.card={title:"ğŸ“Š è¿åŠ¨é‡è¯„ä¼°",chartData:[{label:"ä»Šæ—¥",value:Math.min(100,e/5*100),valText:`${e}km`,color:"#20C997"},{label:"ç›®æ ‡",value:100,valText:"5.0km",color:"#eee"}],suggestion:l,shareable:!0}}else e.includes("å»ºè®®")||e.includes("åˆ†æ")?(t.text="åŸºäºä½ çš„å®æ—¶æ•°æ®ï¼Œæˆ‘ç”Ÿæˆäº†ä¸€ä»½ç®€æŠ¥ï¼š",t.card={title:"ğŸ’¡ ç»¼åˆæ”¹è¿›å»ºè®®",suggestion:c>160?"å¿ƒç‡åé«˜ï¼Œå»ºè®®é€‚å½“æ”¾æ…¢é€Ÿåº¦ï¼Œè°ƒæ•´å‘¼å¸ã€‚":"å¿ƒç‡æ§åˆ¶è‰¯å¥½ï¼Œå¯ä»¥å°è¯•è¿›è¡Œé—´æ­‡è·‘è®­ç»ƒæå‡è€åŠ›ã€‚",chartData:[{label:"å¿ƒç‡",value:Math.min(100,c/200*100),valText:`${c}bpm`,color:c>160?"#FF4757":"#20C997"},{label:"é…é€Ÿ",value:Math.min(100,10/s*50),valText:`${s.toFixed(1)}`,color:"#3A7BD5"}],shareable:!0}):t.text="æŠ±æ­‰ï¼Œæˆ‘è¿˜åœ¨å­¦ä¹ ä¸­ï¼Œæš‚æ—¶åªèƒ½å›ç­”å…³äºé…é€Ÿã€è¿åŠ¨é‡å’Œæ”¹è¿›å»ºè®®çš„é—®é¢˜ã€‚";n.value.push(t),r()};return e.watch((()=>l.visible),(e=>{e&&0===n.value.length&&n.value.push({type:"robot",text:"ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ä¸“å±è¿åŠ¨å°åŠ©æ‰‹ã€‚"})})),(a,l)=>t.visible?(e.openBlock(),e.createElementBlock("view",{key:0,class:"ai-robot-container"},[e.createElementVNode("view",{class:"robot-mask",onClick:i}),e.createElementVNode("view",{class:"robot-window"},[e.createElementVNode("view",{class:"robot-header"},[e.createElementVNode("view",{class:"header-left"},[e.createElementVNode("view",{class:"robot-avatar"},"ğŸ¤–"),e.createElementVNode("view",{class:"robot-info"},[e.createElementVNode("text",{class:"robot-name"},"è¿åŠ¨å°åŠ©æ‰‹"),e.createElementVNode("text",{class:"robot-status"},"åœ¨çº¿åˆ†æä¸­...")])]),e.createElementVNode("view",{class:"header-right"},[e.createElementVNode("text",{class:"close-btn",onClick:i},"Ã—")])]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"chat-area","scroll-top":o.value},[e.createElementVNode("view",{class:"message-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{key:a,class:e.normalizeClass(["message-item",t.type])},["robot"===t.type?(e.openBlock(),e.createElementBlock("view",{key:0,class:"msg-avatar"},"ğŸ¤–")):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"msg-content-box"},[e.createElementVNode("view",{class:"msg-content"},[e.createElementVNode("text",null,e.toDisplayString(t.text),1)]),t.card?(e.openBlock(),e.createElementBlock("view",{key:0,class:"msg-card"},[e.createElementVNode("view",{class:"card-title"},e.toDisplayString(t.card.title),1),t.card.chartData?(e.openBlock(),e.createElementBlock("view",{key:0,class:"card-chart"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.card.chartData,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"chart-bar-item",key:a},[e.createElementVNode("text",{class:"bar-label"},e.toDisplayString(t.label),1),e.createElementVNode("view",{class:"bar-track"},[e.createElementVNode("view",{class:"bar-fill",style:e.normalizeStyle({width:t.value+"%",background:t.color})},null,4)]),e.createElementVNode("text",{class:"bar-val"},e.toDisplayString(t.valText),1)])))),128))])):e.createCommentVNode("",!0),t.card.suggestion?(e.openBlock(),e.createElementBlock("view",{key:1,class:"card-suggestion"},[e.createElementVNode("text",{class:"suggestion-icon"},"ğŸ’¡"),e.createElementVNode("text",null,e.toDisplayString(t.card.suggestion),1)])):e.createCommentVNode("",!0),t.card.shareable?(e.openBlock(),e.createElementBlock("button",{key:2,class:"share-btn",size:"mini",onClick:e=>{return a=t.card,uni.showToast({title:"å·²å‘é€ç»™æ•™å®˜",icon:"success"}),void s("share",a);var a}},"åˆ†äº«ç»™æ•™å®˜",8,["onClick"])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)]),"user"===t.type?(e.openBlock(),e.createElementBlock("view",{key:1,class:"msg-avatar"},"ğŸ‘¤")):e.createCommentVNode("",!0)],2)))),128))])],8,["scroll-top"]),e.createElementVNode("view",{class:"input-area"},[e.createElementVNode("scroll-view",{"scroll-x":"",class:"quick-replies","show-scrollbar":!1},[e.createElementVNode("view",{class:"chip",onClick:l[0]||(l[0]=e=>m("æˆ‘çš„é…é€Ÿæ€ä¹ˆæ ·ï¼Ÿ"))},"é…é€Ÿåˆ†æ"),e.createElementVNode("view",{class:"chip",onClick:l[1]||(l[1]=e=>m("ä»Šå¤©è¿åŠ¨é‡å¤Ÿå—ï¼Ÿ"))},"è¿åŠ¨é‡è¯„ä¼°"),e.createElementVNode("view",{class:"chip",onClick:l[2]||(l[2]=e=>m("ç»™ç‚¹å»ºè®®"))},"æ”¹è¿›å»ºè®®")]),e.createElementVNode("view",{class:"input-box"},[e.withDirectives(e.createElementVNode("input",{class:"text-input","onUpdate:modelValue":l[3]||(l[3]=e=>c.value=e),placeholder:"è¾“å…¥é—®é¢˜...","confirm-type":"send",onConfirm:d},null,544),[[e.vModelText,c.value]]),e.createElementVNode("view",{class:"send-btn",onClick:d},"å‘é€")])])])])):e.createCommentVNode("",!0)}},[["__scopeId","data-v-79d7ba8d"]]),p=c({__name:"run",setup(a){const n=e.ref(20);s((()=>{const e=uni.getSystemInfoSync();n.value=e.statusBarHeight||20})),e.onUnmounted((()=>{W&&clearInterval(W),ve()}));const c=e.ref(!1),i=e.computed((()=>({distance:j.value,pace:te.value||(j.value>0?q.value/60/(j.value/1e3):0),heartRate:J.value,stepCount:G.value}))),r=()=>{c.value=!0};l((()=>{t("log","at pages/run/run.vue:209","run.vue onShow triggered"),uni.setNavigationBarTitle({title:"è·‘æ­¥"}),uni.setNavigationBarColor({frontColor:"#ffffff",backgroundColor:"#20C997"});if("teacher"===(uni.getStorageSync("userRole")||uni.getStorageSync("role")))return uni.showToast({title:"è¯¥åŠŸèƒ½ä»…å¯¹å­¦ç”Ÿå¼€æ”¾",icon:"none"}),void setTimeout((()=>{uni.redirectTo({url:"/pages/teacher/home/home"})}),800);const e=uni.getStorageSync("runMode");e&&(re(e),uni.removeStorageSync("runMode")),se(),d({url:"/checkpoints",method:"GET"}).then((e=>{f.value=e})).catch((e=>{t("error","at pages/run/run.vue:241","Failed to load checkpoints",e)})),z.value=uni.getStorageSync("checkpoint")||{},z.value.name&&ie(z.value.lat,z.value.lng,z.value.name);const a=uni.getStorageSync("runRecordsList")||[],l=new Date,s=new Date(l.getFullYear(),l.getMonth(),l.getDate()).getTime(),n=s+864e5;let c=0,o=0;if(a.forEach((e=>{const t=new Date(e.createTime).getTime();(!e.type||"run"===e.type)&&t>=s&&t<n&&(c+=1,o+=Number(e.distance)||0)})),u.value=c,p.value=Number(o.toFixed(2)),w.value=he(a),!Z.value){const e=uni.getStorageSync("teacherTask");if(e)try{const t="string"==typeof e?JSON.parse(e):e;E.value=t.title||""}catch(i){E.value=""}}}));const m=e=>{var t;const a={studentName:(null==(t=uni.getStorageSync("userInfo"))?void 0:t.name)||"å­¦å‘˜",time:(new Date).toLocaleString(),card:e};let l=uni.getStorageSync("mockSharedReports")||[];l.unshift(a),uni.setStorageSync("mockSharedReports",l)},u=e.ref(0),p=e.ref(0),E=e.ref(""),N=e.ref(5),g=e.ref(0),V=e.ref(0),w=e.ref([]),h=e.ref([{name:"åˆæ¬¡å¼€è·‘",icon:"ğŸ…"},{name:"äº”å…¬é‡Œè¾¾äºº",icon:"ğŸƒâ€â™‚ï¸"},{name:"å…¨å‹¤å‘¨",icon:"ğŸ”¥"},{name:"æ—©èµ·é¸Ÿ",icon:"ğŸ¦"}]),k=e.ref(!1),y=e.ref([{name:"ç¯æ ¡å¤–åœˆè·‘",distance:5.2,difficulty:"ä¸­ç­‰"},{name:"æ¹–ç•”æ—è«é“",distance:3,difficulty:"ç®€å•"},{name:"ä½“è‚²åœºå†²åˆº",distance:1.5,difficulty:"å›°éš¾"}]),x=()=>k.value=!k.value,f=e.ref([]),b=e.ref(""),S=e.ref(39.909),B=e.ref(116.397),C=e.ref([]),D=e.ref({points:[],color:"#007AFF",width:4,arrowLine:!0}),T=e.ref(null),_=e.ref([]),z=e.ref({}),F=e.ref([]),I=e.ref([]),M=()=>{const e=[];D.value.points.length>0?e.push(JSON.parse(JSON.stringify(D.value))):e.push({...D.value,points:[]}),T.value&&e.push(JSON.parse(JSON.stringify(T.value))),_.value=e},$=(e,t,a,l)=>{const s=(a-e)*Math.PI/180,n=(l-t)*Math.PI/180,c=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 6371e3*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))},L=(e,t,a)=>{if(S.value=e,B.value=t,C.value[0]={id:0,latitude:e,longitude:t,title:"æˆ‘çš„ä½ç½®",iconPath:"/static/location.png",width:30,height:30},U.value){if(F.value.length>0){const a=F.value[F.value.length-1],l=$(a.latitude,a.longitude,e,t);l>2&&l<100&&(j.value+=l)}const s={latitude:e,longitude:t,timestamp:Date.now(),speed:a||H.value};F.value.push(s),D.value.points.push({latitude:e,longitude:t}),M(),"campus"===A.value&&z.value.lat&&(O.value=Math.floor($(e,t,z.value.lat,z.value.lng)),O.value<=(z.value.radius||50)?(R.value=!0,uni.getStorageSync("checkpointReached")||(z.value.id?(l={lat:e,lng:t,checkpoint_id:z.value.id},d({url:"/activity/checkin",method:"POST",data:l})).then((a=>{a.success&&(uni.showToast({title:"æ‰“å¡æˆåŠŸï¼",icon:"success"}),I.value.push({checkpoint_id:z.value.id,time:(new Date).toISOString(),lat:e,lng:t}))})).catch((()=>{})):uni.showToast({title:"å·²åˆ°è¾¾æ‰“å¡ç‚¹èŒƒå›´ï¼",icon:"success"}),uni.setStorageSync("checkpointReached","1"))):R.value=!1),"normal"===A.value?g.value=Math.min(100,j.value/1e3/N.value*100):"police"===A.value&&(V.value=Math.min(100,j.value/Q.value*100))}var l},P=()=>{uni.startLocationUpdate({success:()=>{K=e=>{e.speed&&e.speed>=0&&(H.value=e.speed),L(e.latitude,e.longitude,H.value)},uni.onLocationChange(K)},fail:()=>{uni.showToast({title:"æ— æ³•è·å–å®æ—¶ä½ç½®ï¼Œè¯·æ£€æŸ¥æƒé™",icon:"none"})}})},A=e.ref("normal"),U=e.ref(!1),q=e.ref(0),j=e.ref(0),O=e.ref(0),R=e.ref(!1),G=e.ref(0),J=e.ref(80),H=e.ref(0);e.ref(0);let W=null,Y=null,K=null;const Q=e.ref(2e3),X=e.ref(6.5),Z=e.ref(null),ee=e.ref(null),te=e.computed((()=>{const e=j.value/1e3,t=q.value/60;if(0===e)return 0;const a=t/e;return a>999?999:a})),ae=e.computed((()=>(3.6*H.value).toFixed(1))),le=e.computed((()=>0===q.value?0:(j.value/1e3/(q.value/3600)).toFixed(1)));s((e=>{e.mode&&(A.value=e.mode),e.target&&(Q.value=parseInt(e.target)),e.pace&&(X.value=parseFloat(e.pace)),e.taskId&&(Z.value=e.taskId,e.taskType&&(ee.value=e.taskType)),e.taskTitle&&(E.value=decodeURIComponent(e.taskTitle)),e.course&&uni.showToast({title:`å¼€å§‹è¯¾ç¨‹ï¼š${e.course}`,icon:"none"})}));const se=()=>{ne()},ne=()=>{const e=uni.getStorageSync("lastLocation");e&&(S.value=e.lat,B.value=e.lng,C.value=[{id:0,latitude:e.lat,longitude:e.lng,title:"æˆ‘çš„ä½ç½®",iconPath:"/static/location.png",width:30,height:30}]),uni.getLocation({type:"gcj02",accuracy:"high",success:e=>{S.value=e.latitude,B.value=e.longitude,C.value=[{id:0,latitude:e.latitude,longitude:e.longitude,title:"æˆ‘çš„ä½ç½®",iconPath:"/static/location.png",width:30,height:30}];e.latitude>=39.9&&e.latitude<=39.92&&e.longitude>=116.39&&e.longitude<=116.41||"campus"!==A.value||uni.showToast({title:"ä»…æ ¡å›­å†…å¯è¿›è¡Œæ‰“å¡",icon:"none"})},fail:e=>{t("error","at pages/run/run.vue:644","Location failed:",e);uni.showToast({title:"å®šä½å¤±è´¥ï¼Œå·²ä½¿ç”¨æ¨¡æ‹Ÿä½ç½®",icon:"none",duration:3e3}),S.value=39.908823,B.value=116.39747,C.value=[{id:0,latitude:39.908823,longitude:116.39747,title:"æˆ‘çš„ä½ç½® (æ¨¡æ‹Ÿ)",iconPath:"/static/location.png",width:30,height:30}]}})},ce=()=>{if(!b.value)return void uni.showToast({title:"è¯·è¾“å…¥æ‰“å¡ç‚¹åç§°",icon:"none"});const e=f.value.find((e=>e.name.includes(b.value)));if(!e)return void uni.showToast({title:"æœªæ‰¾åˆ°è¯¥æ‰“å¡ç‚¹",icon:"none"});const t={name:e.name,lat:e.latitude,lng:e.longitude,radius:e.radius};uni.setStorageSync("checkpoint",t),z.value=t,ie(t.lat,t.lng,t.name),T.value={points:[{latitude:S.value,longitude:B.value},{latitude:t.lat,longitude:t.lng}],color:"#FF0000",width:2,dottedLine:!0},M(),uni.showToast({title:`æ‰¾åˆ°${t.name}`,icon:"success"})},oe=()=>{uni.chooseLocation({success:e=>{t("log","at pages/run/run.vue:720","Selected location:",e);const a=e.latitude,l=e.longitude;let s=null,n=1/0;if(f.value.forEach((e=>{const t=$(a,l,e.latitude,e.longitude);t<n&&(n=t,s=e)})),s&&n<=200){b.value=s.name;const e={name:s.name,lat:s.latitude,lng:s.longitude,radius:s.radius,id:s.id};uni.setStorageSync("checkpoint",e),z.value=e,ie(e.lat,e.lng,e.name),T.value={points:[{latitude:S.value,longitude:B.value},{latitude:e.lat,longitude:e.lng}],color:"#FF0000",width:2,dottedLine:!0},M(),uni.showToast({title:`å·²å®šä½åˆ°ï¼š${s.name}`,icon:"success"})}else uni.showModal({title:"æç¤º",content:"æ‚¨é€‰æ‹©çš„åœ°ç‚¹ä¸åœ¨æ ¡å›­æ‰“å¡ç‚¹èŒƒå›´å†…ï¼Œæ˜¯å¦ä»è¦è®¾ä¸ºç›®æ ‡ï¼Ÿ(æ— æ³•è¿›è¡Œæœ‰æ•ˆæ‰“å¡)",success:t=>{if(t.confirm){b.value=e.name||"è‡ªå®šä¹‰ä½ç½®";const t={name:e.name||"è‡ªå®šä¹‰ä½ç½®",lat:a,lng:l,radius:50,id:null};uni.setStorageSync("checkpoint",t),z.value=t,ie(a,l,t.name),T.value={points:[{latitude:S.value,longitude:B.value},{latitude:a,longitude:l}],color:"#FF0000",width:2,dottedLine:!0},M()}}})},fail:e=>{t("error","at pages/run/run.vue:797","Choose location failed",e)}})},ie=(e,t,a)=>{C.value.push({id:1,latitude:e,longitude:t,title:a,iconPath:"/static/checkpoint.png",width:40,height:40})},re=e=>{U.value=!1,clearInterval(W),ve(),q.value=0,j.value=0,G.value=0,J.value=80,A.value=e};let de=!1,me=0;const ue=()=>{uni.stopAccelerometer(),uni.startAccelerometer({interval:"game",success:()=>{t("log","at pages/run/run.vue:844","Accelerometer started"),de=!1,me=Date.now()},fail:e=>{t("error","at pages/run/run.vue:849","Start Accelerometer failed:",e)}}),Y=e=>{let t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);t>5&&(t/=9.8);const a=Date.now();de&&a-me>1500&&(de=!1),!de&&t>1.25?a-me>300&&(G.value+=1,me=a,de=!0):de&&t<1.05&&(de=!1)},uni.onAccelerometerChange(Y)},ve=()=>{Y&&(uni.stopAccelerometer(),uni.offAccelerometerChange(Y),Y=null)},pe=()=>{J.value=80+Math.floor(q.value/10),J.value>180&&uni.showModal({title:"å¥åº·é¢„è­¦",content:`å½“å‰å¿ƒç‡è¿‡é«˜ï¼ˆ${J.value}æ¬¡/åˆ†ï¼‰ï¼Œå»ºè®®é™é€Ÿä¼‘æ¯`,showCancel:!1})},Ee=()=>{if(U.value=!0,q.value=0,j.value=0,G.value=0,J.value=80,D.value.points=[],F.value=[],S.value&&B.value){const e={latitude:S.value,longitude:B.value,timestamp:Date.now(),speed:0};F.value.push(e),D.value.points.push({latitude:S.value,longitude:B.value}),M()}},Ne=()=>{T.value=null,Ee(),uni.removeStorageSync("checkpointReached"),P(),ue(),W=setInterval((()=>{q.value+=1,pe()}),1e3)},ge=()=>{Ee(),uni.removeStorageSync("policeFinishTip"),P(),ue(),W=setInterval((()=>{q.value+=1,pe(),j.value>=Q.value&&!uni.getStorageSync("policeFinishTip")&&(uni.showToast({title:"å·²å®Œæˆ2000ç±³ç›®æ ‡ï¼",icon:"success"}),uni.setStorageSync("policeFinishTip","1"))}),1e3)},Ve=()=>{Ee(),R.value=!1,uni.removeStorageSync("checkpointReached"),P(),ue(),W=setInterval((()=>{q.value+=1,pe()}),1e3)},we=async()=>{if(!U.value)return;U.value=!1,clearInterval(W),ve(),uni.stopLocationUpdate(),K&&(uni.offLocationChange(K),K=null);if(!uni.getStorageSync("token"))return uni.showToast({title:"è¯·å…ˆç™»å½•",icon:"none"}),void setTimeout((()=>{uni.reLaunch({url:"/pages/login/login"})}),800);const e={type:ee.value?ee.value:"police"===A.value?"test":"run",source:Z.value?"task":"free",started_at:new Date(Date.now()-1e3*q.value).toISOString(),ended_at:(new Date).toISOString(),metrics:{distance:j.value/1e3,duration:q.value,pace:te.value.toFixed(1),count:"police"===A.value?1:null,qualified:"police"===A.value&&te.value<=X.value,trajectory:JSON.stringify(F.value),checkpoints:JSON.stringify(I.value)},evidence:[]};try{uni.showLoading({title:"æäº¤ä¸­..."});const l=await(a=e,d({url:"/activity/finish",method:"POST",data:a}));uni.hideLoading(),t("log","at pages/run/run.vue:1006","Submit success:",l),uni.setStorageSync("tempRunResult",e),uni.redirectTo({url:"/pages/result/result?useStorage=true",fail:e=>{t("error","at pages/run/run.vue:1016","Navigate failed:",e),uni.showToast({title:"é¡µé¢è·³è½¬å¤±è´¥",icon:"none"})}})}catch(l){uni.hideLoading(),t("error","at pages/run/run.vue:1022","Submit failed:",l),uni.showModal({title:"æäº¤å¤±è´¥",content:l&&l.detail?l.detail:"ç½‘ç»œæˆ–æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·é‡è¯•",confirmText:"é‡è¯•",cancelText:"å¼ºåˆ¶ç»“æŸ",success:e=>{e.confirm||e.cancel&&(uni.showToast({title:"å·²å¼ºåˆ¶ç»“æŸ",icon:"none"}),setTimeout((()=>{uni.reLaunch({url:"/pages/home/home"})}),800))}})}var a},he=e=>{const t=new Date,a=[];for(let l=0;l<7;l++){const s=new Date(t.getFullYear(),t.getMonth(),t.getDate()-l),n=new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime(),c=n+864e5,o=e.filter((e=>{const t=new Date(e.createTime).getTime();return(!e.type||"run"===e.type)&&t>=n&&t<c})),i=o.length,r=o.reduce(((e,t)=>e+Number(t.distance||0)),0);a.push({date:`${s.getMonth()+1}/${s.getDate()}`,count:i,distance:Number(r.toFixed(2))})}return a.reverse()};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"run"},[e.createElementVNode("view",{class:"custom-navbar",style:e.normalizeStyle({paddingTop:n.value+"px"})},[e.createElementVNode("view",{class:"navbar-content"},[e.createElementVNode("text",{class:"navbar-title"},"è·‘æ­¥")])],4),e.createElementVNode("view",{class:"content-spacer",style:e.normalizeStyle({height:n.value+44+"px"})},null,4),e.createVNode(v,{visible:c.value,"onUpdate:visible":a[0]||(a[0]=e=>c.value=e),"run-data":i.value,onShare:m},null,8,["visible","run-data"]),U.value||j.value>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"ai-float-btn",onClick:r},[e.createElementVNode("text",{class:"ai-btn-icon"},"ğŸ¤–"),e.createElementVNode("text",{class:"ai-btn-text"},"AIåŠ©æ‰‹")])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"top-widgets"},[e.createElementVNode("view",{class:"weather-widget"},[e.createElementVNode("view",{class:"weather-left"},[e.createElementVNode("text",{class:"weather-temp"},"24Â°C"),e.createElementVNode("text",{class:"weather-status"},"â˜€ï¸ æ™´æœ—")]),e.createElementVNode("view",{class:"weather-right"},[e.createElementVNode("text",{class:"weather-tips"},"ç©ºæ°”ä¼˜ Â· é€‚å®œè·‘æ­¥")])]),e.createElementVNode("scroll-view",{"scroll-x":"",class:"achievements-scroll","show-scrollbar":!1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"badge-item",key:a},[e.createElementVNode("text",{class:"badge-icon"},e.toDisplayString(t.icon),1),e.createElementVNode("text",{class:"badge-name"},e.toDisplayString(t.name),1)])))),128))])]),"campus"===A.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"search-bar"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>b.value=e),placeholder:"è¾“å…¥æ ¡å›­æ‰“å¡ç‚¹ï¼ˆå¦‚ï¼šæ“åœº/è·‘é“ï¼‰",class:"search-input"},null,512),[[e.vModelText,b.value]]),e.createElementVNode("view",{class:"map-select-btn",onClick:oe},[e.createElementVNode("text",{class:"map-icon"},"ğŸ—ºï¸")]),e.createElementVNode("button",{onClick:ce,class:"search-btn"},"æœç´¢")])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"overview-card"},[e.createElementVNode("text",{class:"overview-title"},"ä»Šæ—¥è·‘æ­¥æ¦‚è§ˆ"),e.createElementVNode("view",{class:"overview-meta"},[e.createElementVNode("text",null,"æ¬¡æ•°ï¼š"+e.toDisplayString(u.value),1),e.createElementVNode("text",null,"é‡Œç¨‹ï¼š"+e.toDisplayString(p.value)+" km",1)]),E.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"task-tip"},"æ•™å¸ˆä»»åŠ¡ï¼š"+e.toDisplayString(E.value),1)):e.createCommentVNode("",!0)]),e.createElementVNode("map",{class:"map",latitude:S.value,longitude:B.value,markers:C.value,polyline:_.value},null,8,["latitude","longitude","markers","polyline"]),"normal"===A.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"routes-card"},[e.createElementVNode("view",{class:"card-header",onClick:x},[e.createElementVNode("text",{class:"card-title"},"ğŸƒ æ¨èè·¯çº¿"),e.createElementVNode("text",{class:"card-toggle"},e.toDisplayString(k.value?"æ”¶èµ·":"å±•å¼€"),1)]),k.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"routes-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"route-item",key:a,onClick:e=>(e=>{uni.showToast({title:`å·²åŠ è½½è·¯çº¿ï¼š${e.name}`,icon:"none"}),N.value=e.distance})(t)},[e.createElementVNode("view",{class:"route-info"},[e.createElementVNode("text",{class:"route-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"route-meta"},e.toDisplayString(t.distance)+"km Â· "+e.toDisplayString(t.difficulty),1)]),e.createElementVNode("text",{class:"route-action"},"å»è·‘æ­¥ >")],8,["onClick"])))),128))])):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"mode-switch"},[e.createElementVNode("text",{class:e.normalizeClass(["mode-item",{active:"normal"===A.value}]),onClick:a[2]||(a[2]=e=>re("normal"))},"æ™®é€šè·‘æ­¥",2),e.createElementVNode("text",{class:e.normalizeClass(["mode-item",{active:"police"===A.value}]),onClick:a[3]||(a[3]=e=>re("police"))},"ä¸“é¡¹æµ‹è¯•",2),e.createElementVNode("text",{class:e.normalizeClass(["mode-item",{active:"campus"===A.value}]),onClick:a[4]||(a[4]=e=>re("campus"))},"æ ¡å›­æ‰“å¡",2)]),"police"===A.value?(e.openBlock(),e.createElementBlock("view",{key:3,class:"police-plan"},[e.createElementVNode("text",{class:"plan-title"},"ğŸ¯ 2000ç±³ä½“èƒ½ä¸“é¡¹è®­ç»ƒ"),e.createElementVNode("view",{class:"plan-info"},[e.createElementVNode("text",{class:"info-item"},[e.createTextVNode("ç›®æ ‡è·ç¦»ï¼š"),e.createElementVNode("span",{class:"highlight"},e.toDisplayString(Q.value/1e3)+"å…¬é‡Œ",1)]),e.createElementVNode("text",{class:"info-item"},[e.createTextVNode("è¾¾æ ‡é…é€Ÿï¼š"),e.createElementVNode("span",{class:"highlight"},e.toDisplayString(X.value)+"åˆ†é’Ÿ/å…¬é‡Œ",1)]),e.createElementVNode("text",{class:"info-item"},[e.createTextVNode("å»ºè®®æ ‡å‡†ï¼š"),e.createElementVNode("span",{class:"highlight"},"å¯æŒ‰å­¦æ ¡æˆ–è¯¾ç¨‹è¦æ±‚é…ç½®")])])])):e.createCommentVNode("",!0),"normal"===A.value?(e.openBlock(),e.createElementBlock("view",{key:4,class:"run-mode-box"},[U.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"running-box"},[e.createElementVNode("text",{class:"data"},"æ—¶é•¿ï¼š"+e.toDisplayString(q.value)+"ç§’ | å·²è·‘ï¼š"+e.toDisplayString(((j.value||0)/1e3).toFixed(2))+"km | é€Ÿåº¦ï¼š"+e.toDisplayString(ae.value)+"km/h",1),e.createElementVNode("text",{class:"data"},"æ­¥æ•°ï¼š"+e.toDisplayString(G.value)+" | å¿ƒç‡ï¼š"+e.toDisplayString(J.value)+"æ¬¡/åˆ† | å¹³å‡é€Ÿåº¦ï¼š"+e.toDisplayString(le.value)+"km/h",1),e.createElementVNode("view",{class:"progress-wrap"},[e.createElementVNode("view",{class:"progress-bar"},[e.createElementVNode("view",{class:"progress-fill",style:e.normalizeStyle({width:g.value+"%"})},null,4)]),e.createElementVNode("text",{class:"progress-text"},"ä»Šæ—¥ç›®æ ‡ "+e.toDisplayString(N.value)+" km Â· å®Œæˆ "+e.toDisplayString(((j.value||0)/1e3).toFixed(2))+" km",1)]),e.createElementVNode("button",{onClick:we,class:"stop-btn"},"ç»“æŸè·‘æ­¥")])):(e.openBlock(),e.createElementBlock("view",{key:0,class:"start-box"},[e.createElementVNode("text",{class:"tip"},"æ— åœ°ç‚¹/è·ç¦»é™åˆ¶ï¼Œè‡ªç”±è®°å½•è·‘æ­¥è½¨è¿¹"),e.createElementVNode("button",{onClick:Ne,class:"start-btn"},"å¼€å§‹è·‘æ­¥")]))])):e.createCommentVNode("",!0),"police"===A.value?(e.openBlock(),e.createElementBlock("view",{key:5,class:"run-mode-box"},[U.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"running-box"},[e.createElementVNode("text",{class:"data"},"æ—¶é•¿ï¼š"+e.toDisplayString(q.value)+"ç§’ | å·²è·‘ï¼š"+e.toDisplayString((j.value/1e3).toFixed(2))+"km / ç›®æ ‡ï¼š2km",1),e.createElementVNode("text",{class:"data"},"å‰©ä½™ï¼š"+e.toDisplayString(((Q.value-j.value)/1e3).toFixed(2))+"km | é…é€Ÿï¼š"+e.toDisplayString(te.value.toFixed(1))+"åˆ†é’Ÿ/å…¬é‡Œ",1),e.createElementVNode("text",{class:"data"},"å¿ƒç‡ï¼š"+e.toDisplayString(J.value)+"æ¬¡/åˆ† | æ­¥æ•°ï¼š"+e.toDisplayString(G.value),1),e.createElementVNode("text",{class:"pace-status",style:e.normalizeStyle({color:te.value<=X.value?"green":"red"})},e.toDisplayString(te.value<=X.value?"âœ… é…é€Ÿè¾¾æ ‡":"âŒ é…é€Ÿæœªè¾¾æ ‡"),5),j.value>=Q.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"finish-tip"},"ğŸ‰ å·²å®Œæˆ2000ç±³ç›®æ ‡ï¼")):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"progress-wrap"},[e.createElementVNode("view",{class:"progress-bar"},[e.createElementVNode("view",{class:"progress-fill",style:e.normalizeStyle({width:V.value+"%"})},null,4)]),e.createElementVNode("text",{class:"progress-text"},"ä¸“é¡¹ç›®æ ‡ 2 km Â· å®Œæˆ "+e.toDisplayString((j.value/1e3).toFixed(2))+" km",1)]),e.createElementVNode("button",{onClick:we,class:"stop-btn"},"ç»“æŸè®­ç»ƒ")])):(e.openBlock(),e.createElementBlock("view",{key:0,class:"start-box"},[e.createElementVNode("text",{class:"tip"},"æŒ‰è¯¾ç¨‹è¦æ±‚å®Œæˆ2000ç±³è·‘ï¼Œè‡ªåŠ¨æ ¡éªŒé…é€Ÿæ˜¯å¦è¾¾æ ‡"),e.createElementVNode("button",{onClick:ge,class:"start-btn"},"å¼€å§‹ä¸“é¡¹è®­ç»ƒ")]))])):e.createCommentVNode("",!0),"campus"===A.value?(e.openBlock(),e.createElementBlock("view",{key:6,class:"run-mode-box"},[z.value.name?(e.openBlock(),e.createElementBlock("view",{key:1},[U.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"running-box"},[e.createElementVNode("text",{class:"data"},"æ—¶é•¿ï¼š"+e.toDisplayString(q.value)+"ç§’ | è·æ‰“å¡ç‚¹ï¼š"+e.toDisplayString(O.value)+"ç±³ | æ­¥æ•°ï¼š"+e.toDisplayString(G.value)+" | å¿ƒç‡ï¼š"+e.toDisplayString(J.value)+"æ¬¡/åˆ†",1),e.createElementVNode("text",{class:"reach-status",style:e.normalizeStyle({color:R.value?"green":"red"})},e.toDisplayString(R.value?"âœ… å·²åˆ°è¾¾æ‰“å¡ç‚¹":"âŒ æœªåˆ°è¾¾æ‰“å¡ç‚¹"),5),e.createElementVNode("button",{onClick:we,class:"stop-btn"},"ç»“æŸæ‰“å¡")])):(e.openBlock(),e.createElementBlock("view",{key:0,class:"start-box"},[e.createElementVNode("text",{class:"checkpoint-info"},"æ‰“å¡ç‚¹ï¼š"+e.toDisplayString(z.value.name)+"ï¼ˆéœ€åˆ°è¾¾10ç±³å†…ï¼‰",1),e.createElementVNode("button",{onClick:Ve,class:"start-btn"},"å¼€å§‹æ‰“å¡")]))])):(e.openBlock(),e.createElementBlock("view",{key:0,class:"no-checkpoint"},[e.createElementVNode("text",{class:"tip"},"è¯·å…ˆæœç´¢æ ¡å›­æ‰“å¡ç‚¹")]))])):e.createCommentVNode("",!0),e.createVNode(o,{current:"/pages/run/run"})]))}},[["__scopeId","data-v-cc536244"]]),E="/static/avatar.png",N=c({__name:"mine",setup(a){const s=e.ref(20),n=e.ref("åŒå­¦"),c=e.ref("å­¦ç”Ÿ"),i=e.ref(""),r=e.ref(0),m=e.ref(0),u=e.ref(0),v=e.ref("æœ¬å‘¨"),p=e.ref(3),N=e.ref(0),g=e.ref(0),V=e.ref(0),w=e.ref(0),h=e.ref([]),k=e.computed((()=>h.value.slice(0,5))),y=e.ref(""),x=e=>{const t=Number(e);return isNaN(t)?"0.00":t.toFixed(2)},f=e=>{const t=Math.floor(e/3600),a=e%60;return`${t>0?t+":":""}${Math.floor(e%3600/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`};l((()=>{s.value=uni.getSystemInfoSync().statusBarHeight||20;const e=uni.getStorageSync("userInfo");if(e){let t=e;if("string"==typeof e)try{t=JSON.parse(e)}catch(a){}t&&(t.name&&(n.value=t.name),t.class_name&&(i.value=t.class_name))}(async()=>{try{const e=await d({url:"/activity/history",method:"GET",data:{page:1,size:20}});if(e.items){h.value=e.items.map((e=>{var t,a,l,s,n;const c="run"===e.type,o=new Date(e.started_at),i=`${o.getMonth()+1}-${o.getDate()} ${o.getHours()}:${o.getMinutes().toString().padStart(2,"0")}`;return{type:e.type,modeBg:c?"#20C997":"#FF9F43",modeText:c?"è·‘æ­¥":"ä½“æµ‹",testName:"ä½“èƒ½æµ‹è¯•",createTime:i,distance:(null==(t=e.metrics)?void 0:t.distance)?Number(e.metrics.distance).toFixed(2):0,duration:f((null==(a=e.metrics)?void 0:a.duration)||0),pace:null==(l=e.metrics)?void 0:l.pace,testCount:(null==(s=e.metrics)?void 0:s.count)||0,result:(null==(n=e.metrics)?void 0:n.qualified)?"è¾¾æ ‡":"æœªè¾¾æ ‡",statusText:"finished"===e.status?"æœ‰æ•ˆ":"å¾…å®¡æ ¸",statusColor:"#20C997"}}));const t=h.value.filter((e=>"run"===e.type));r.value=t.length,m.value=t.reduce(((e,t)=>e+Number(t.distance||0)),0).toFixed(2),u.value=h.value.filter((e=>"test"===e.type&&"è¾¾æ ‡"===e.result)).length,N.value=t.length,g.value=m.value,V.value=u.value,w.value=Math.min(t.length/p.value*100,100)}}catch(a){t("error","at pages/mine/mine.vue:227","Fetch history failed",a)}})(),(async()=>{try{const e=await d({url:"/users/profile",method:"GET"});if(e){e.name&&(n.value=e.name),e.class_name&&(i.value=e.class_name);let t=uni.getStorageSync("userInfo");if("string"==typeof t)try{t=JSON.parse(t)}catch(a){t={}}const l={...t,...e};uni.setStorageSync("userInfo",l)}}catch(a){t("error","at pages/mine/mine.vue:251","Fetch profile failed",a)}})()}));const b=()=>{uni.showToast({title:"ç¼–è¾‘èµ„æ–™åŠŸèƒ½å¾…å¼€å‘",icon:"none"})},S=()=>{uni.navigateTo({url:"/pages/health/request"})},B=()=>{uni.showToast({title:"åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},C=()=>{uni.showToast({title:"è®¾å¤‡ç»‘å®šåŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},D=()=>{uni.showModal({title:"æç¤º",content:"ç¡®å®šè¦æ¸…é™¤ç¼“å­˜å—ï¼Ÿ",success:e=>{e.confirm&&uni.showToast({title:"æ¸…ç†å®Œæˆ"})}})},T=()=>{uni.showToast({title:"å½“å‰ç‰ˆæœ¬ v1.0.0",icon:"none"})},_=()=>{uni.showModal({title:"æç¤º",content:"ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ",success:e=>{e.confirm&&(uni.removeStorageSync("token"),uni.removeStorageSync("userInfo"),uni.removeStorageSync("userRole"),uni.reLaunch({url:"/pages/login/login"}))}})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"mine-page"},[e.createElementVNode("view",{class:"custom-navbar",style:e.normalizeStyle({paddingTop:s.value+"px"})},[e.createElementVNode("view",{class:"navbar-content"},[e.createElementVNode("text",{class:"navbar-title"},"ä¸ªäººä¸­å¿ƒ")])],4),e.createElementVNode("view",{class:"content-wrapper",style:e.normalizeStyle({paddingTop:s.value+44+"px"})},[e.createElementVNode("view",{class:"user-header"},[e.createElementVNode("view",{class:"avatar-box"},[e.createElementVNode("image",{class:"avatar",src:E,mode:"aspectFill"}),e.createElementVNode("button",{class:"edit-avatar",onClick:b},"ç¼–è¾‘èµ„æ–™")]),e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("text",{class:"username"},e.toDisplayString(n.value),1),e.createElementVNode("text",{class:"user-desc"},e.toDisplayString(i.value?i.value+" Â· ":"æ ¡å›­è¿åŠ¨æ‰“å¡ Â· ")+e.toDisplayString(c.value),1)]),e.createElementVNode("view",{class:"user-stats"},[e.createElementVNode("view",{class:"stats-item"},[e.createElementVNode("text",{class:"stats-num"},e.toDisplayString(r.value),1),e.createElementVNode("text",{class:"stats-text"},"æ€»æ¬¡æ•°")]),e.createElementVNode("view",{class:"stats-item"},[e.createElementVNode("text",{class:"stats-num"},e.toDisplayString(m.value)+"km",1),e.createElementVNode("text",{class:"stats-text"},"æ€»è·ç¦»")]),e.createElementVNode("view",{class:"stats-item"},[e.createElementVNode("text",{class:"stats-num"},e.toDisplayString(u.value),1),e.createElementVNode("text",{class:"stats-text"},"ä½“æµ‹è¾¾æ ‡")])])]),e.createElementVNode("view",{class:"week-run-card"},[e.createElementVNode("view",{class:"card-header"},[e.createElementVNode("view",{class:"header-left"},[e.createElementVNode("text",{class:"card-title"},"æœ¬å‘¨è·‘æ­¥"),e.createElementVNode("text",{class:"target-tag"},"ç›®æ ‡ "+e.toDisplayString(p.value)+" æ¬¡",1)]),e.createElementVNode("text",{class:"date-range"},e.toDisplayString(v.value),1)]),e.createElementVNode("view",{class:"week-stats"},[e.createElementVNode("view",{class:"week-item"},[e.createElementVNode("text",{class:"week-num"},e.toDisplayString(N.value),1),e.createElementVNode("text",{class:"week-text"},"è·‘æ­¥æ¬¡æ•°")]),e.createElementVNode("view",{class:"week-item"},[e.createElementVNode("text",{class:"week-num"},e.toDisplayString(x(g.value)),1),e.createElementVNode("text",{class:"week-text"},"æ€»è·ç¦»(km)")]),e.createElementVNode("view",{class:"week-item"},[e.createElementVNode("text",{class:"week-num"},e.toDisplayString(V.value),1),e.createElementVNode("text",{class:"week-text"},"ä½“æµ‹è¾¾æ ‡")])]),e.createElementVNode("view",{class:"progress-box"},[e.createElementVNode("view",{class:"progress-header"},[e.createElementVNode("text",{class:"progress-info"},"å·²å®Œæˆ "+e.toDisplayString(N.value)+"/"+e.toDisplayString(p.value),1),e.createElementVNode("text",{class:"progress-percent"},e.toDisplayString(Math.round(w.value))+"%",1)]),e.createElementVNode("view",{class:"progress-bar"},[e.createElementVNode("view",{class:"progress-fill",style:e.normalizeStyle({width:w.value+"%"})},null,4)])])]),e.createElementVNode("view",{class:"record-card"},[e.createElementVNode("view",{class:"card-header"},[e.createElementVNode("text",{class:"card-title"},"è¿åŠ¨è®°å½•"),e.createElementVNode("button",{class:"view-all",onClick:B},"æŸ¥çœ‹å…¨éƒ¨")]),h.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"record-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"record-item",key:a,onClick:e=>{}},[e.createElementVNode("view",{class:"record-type",style:e.normalizeStyle({backgroundColor:t.modeBg})},[e.createElementVNode("text",{class:"type-text"},e.toDisplayString(t.modeText),1)],4),e.createElementVNode("view",{class:"record-info"},[e.createElementVNode("text",{class:"record-date"},e.toDisplayString(t.createTime),1),"run"===t.type?(e.openBlock(),e.createElementBlock("text",{key:0,class:"record-data"},[e.createTextVNode(e.toDisplayString(t.distance)+"km | "+e.toDisplayString(t.duration),1),t.pace?(e.openBlock(),e.createElementBlock("text",{key:0}," | é…é€Ÿï¼š"+e.toDisplayString(Number(t.pace).toFixed(1))+" åˆ†/å…¬é‡Œ",1)):e.createCommentVNode("",!0)])):(e.openBlock(),e.createElementBlock("text",{key:1,class:"record-data"},e.toDisplayString(t.testName)+" | æ¬¡æ•°ï¼š"+e.toDisplayString(t.testCount)+" | "+e.toDisplayString(t.result),1))]),e.createElementVNode("view",{class:"record-status"},[e.createElementVNode("text",{class:"status-text",style:e.normalizeStyle({color:t.statusColor})},e.toDisplayString(t.statusText),5)])],8,["onClick"])))),128))])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-record"},[e.createElementVNode("text",{class:"empty-icon"},"ğŸƒ"),e.createElementVNode("text",{class:"empty-text"},"æš‚æ— è¿åŠ¨è®°å½•ï¼Œå¿«å»è·‘æ­¥æ‰“å¡å§ï½")]))]),e.createElementVNode("view",{class:"setting-card"},[e.createElementVNode("view",{class:"setting-item",onClick:S},[e.createElementVNode("text",{class:"setting-icon"},"ğŸ©º"),e.createElementVNode("text",{class:"setting-text"},"å¥åº·æŠ¥å¤‡"),e.createElementVNode("text",{class:"setting-desc"},"è¯·å‡/ä¼¤ç—…ç”³è¯·"),e.createElementVNode("text",{class:"arrow"},"ï¼")]),e.createElementVNode("view",{class:"setting-item",onClick:C},[e.createElementVNode("text",{class:"setting-icon"},"ğŸ“±"),e.createElementVNode("text",{class:"setting-text"},"è®¾å¤‡ç»‘å®šï¼ˆé˜²ä»£è·‘ï¼‰"),e.createElementVNode("text",{class:"setting-desc"},e.toDisplayString(y.value||"æœªç»‘å®š"),1),e.createElementVNode("text",{class:"arrow"},"ï¼")]),e.createElementVNode("view",{class:"setting-item",onClick:D},[e.createElementVNode("text",{class:"setting-icon"},"ğŸ—‘ï¸"),e.createElementVNode("text",{class:"setting-text"},"æ¸…é™¤ç¼“å­˜"),e.createElementVNode("text",{class:"setting-desc"},"é‡Šæ”¾æœ¬åœ°å­˜å‚¨ç©ºé—´"),e.createElementVNode("text",{class:"arrow"},"ï¼")]),e.createElementVNode("view",{class:"setting-item",onClick:T},[e.createElementVNode("text",{class:"setting-icon"},"â„¹ï¸"),e.createElementVNode("text",{class:"setting-text"},"å…³äºæˆ‘ä»¬"),e.createElementVNode("text",{class:"setting-desc"},"ç‰ˆæœ¬ v1.0.0"),e.createElementVNode("text",{class:"arrow"},"ï¼")]),e.createElementVNode("view",{class:"setting-item logout",onClick:_},[e.createElementVNode("text",{class:"setting-icon"},"ğŸšª"),e.createElementVNode("text",{class:"setting-text"},"é€€å‡ºç™»å½•"),e.createElementVNode("text",{class:"arrow"},"ï¼")])])],4),e.createVNode(o,{current:"/pages/mine/mine"})]))}},[["__scopeId","data-v-4ef0a796"]]),g=c({__name:"result",setup(a){const l=e.ref("normal"),n=e.ref(0),c=e.ref(0),o=e.ref(!1),i=e.ref(!1),r=e.ref(0),d=e.ref("");e.ref("");const m=e.ref(0),u=e.ref(!1),v=e.ref(0),p=e.ref(0),E=e.ref(0),N=e.ref(""),g=e.computed((()=>{switch(l.value){case"police":return"ğŸ¯ 2000ç±³ä¸“é¡¹ä½“èƒ½ç»“ç®—";case"campus":return"ğŸ« æ ¡å›­æ‰“å¡è·‘æ­¥ç»“ç®—";case"test":return"ğŸ’ª ä½“èƒ½æµ‹è¯•ç»“ç®—";default:return"ğŸƒ æ™®é€šè·‘æ­¥ç»“ç®—"}})),V=e.computed((()=>{switch(l.value){case"police":return"#fdf2f0";case"campus":return"#e8f4f8";case"test":return"#f3f7ff";default:return"#f5f5f5"}})),w=e.computed((()=>r.value<=6.5));s((e=>{let a=null;if("true"===e.useStorage)a=uni.getStorageSync("tempRunResult");else if(e.data)try{a=JSON.parse(decodeURIComponent(e.data))}catch(s){t("error","at pages/result/result.vue:177","Failed to parse result data",s)}a?(l.value="test"===a.type?"test":"normal",a.metrics&&(n.value=a.metrics.duration||0,c.value=1e3*(a.metrics.distance||0),m.value=a.metrics.count||0,u.value=a.metrics.qualified,r.value=Number(a.metrics.pace)||0),"test"===l.value&&(d.value="ä½“æµ‹é¡¹ç›®",u.value=a.metrics.qualified,u.value?N.value="æ­å–œè¾¾æ ‡ï¼":N.value="ç»§ç»­åŠ æ²¹ï¼")):(l.value=e.mode||"normal",n.value=Number(e.duration)||0,c.value=Number(e.distance)||0,o.value="true"===e.isReach,i.value="true"===e.isPoliceFinish,r.value=Number(e.policePace)||0)}));const h=e=>{const t=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},k=()=>{uni.reLaunch({url:"/pages/home/home"})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"result-page"},[e.createElementVNode("view",{class:"mode-header",style:e.normalizeStyle({backgroundColor:V.value})},[e.createElementVNode("text",{class:"mode-title"},e.toDisplayString(g.value),1)],4),e.createElementVNode("view",{class:"result-card"},["test"===l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"base-data"},[e.createElementVNode("text",{class:"base-title"},"æµ‹è¯•é¡¹ç›®ï¼š"+e.toDisplayString(d.value),1),e.createElementVNode("view",{class:"data-item"},[e.createElementVNode("text",{class:"item-label"},"å®Œæˆæ•°é‡"),e.createElementVNode("text",{class:"item-value count-text"},e.toDisplayString(m.value)+" æ¬¡",1)]),e.createElementVNode("view",{class:"data-item"},[e.createElementVNode("text",{class:"item-label"},"æµ‹è¯•ç”¨æ—¶"),e.createElementVNode("text",{class:"item-value"},e.toDisplayString(h(n.value)),1)]),e.createElementVNode("view",{class:"data-item"},[e.createElementVNode("text",{class:"item-label"},"åŠ¨ä½œåˆ¤å®š"),e.createElementVNode("text",{class:e.normalizeClass(["item-value",u.value?"success":"fail"])},e.toDisplayString(u.value?"âœ… åˆæ ¼":"âŒ æœªåˆæ ¼"),3)])])):e.createCommentVNode("",!0),"test"===l.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"mode-data"},[e.createElementVNode("text",{class:"mode-data-title"},"æˆç»©åˆ†æ"),e.createElementVNode("view",{class:"bar-chart"},[e.createElementVNode("view",{class:"bar-row"},[e.createElementVNode("text",{class:"bar-label"},"æˆ‘çš„"),e.createElementVNode("view",{class:"bar-track"},[e.createElementVNode("view",{class:"bar-fill user-fill",style:e.normalizeStyle({width:p.value+"%"})},null,4),p.value>15?(e.openBlock(),e.createElementBlock("text",{key:0,class:"bar-val-in"},e.toDisplayString(m.value),1)):e.createCommentVNode("",!0)]),p.value<=15?(e.openBlock(),e.createElementBlock("text",{key:0,class:"bar-val-out"},e.toDisplayString(m.value),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"bar-row"},[e.createElementVNode("text",{class:"bar-label"},"åˆæ ¼"),e.createElementVNode("view",{class:"bar-track"},[e.createElementVNode("view",{class:"bar-fill standard-fill",style:e.normalizeStyle({width:E.value+"%"})},null,4),E.value>15?(e.openBlock(),e.createElementBlock("text",{key:0,class:"bar-val-in"},e.toDisplayString(v.value),1)):e.createCommentVNode("",!0)]),E.value<=15?(e.openBlock(),e.createElementBlock("text",{key:0,class:"bar-val-out"},e.toDisplayString(v.value),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"suggestion-box"},[e.createElementVNode("text",{class:"sugg-title"},"ğŸ’¡ æ™ºèƒ½åé¦ˆ"),e.createElementVNode("text",{class:"sugg-text"},e.toDisplayString(N.value),1)])])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"base-data"},[e.createElementVNode("text",{class:"base-title"},"è¿åŠ¨åŸºç¡€æ•°æ®"),e.createElementVNode("view",{class:"data-item"},[e.createElementVNode("text",{class:"item-label"},"è¿åŠ¨æ—¶é•¿"),e.createElementVNode("text",{class:"item-value"},e.toDisplayString(h(n.value)),1)]),e.createElementVNode("view",{class:"data-item"},[e.createElementVNode("text",{class:"item-label"},"è¿åŠ¨è·ç¦»"),e.createElementVNode("text",{class:"item-value"},e.toDisplayString((c.value/1e3).toFixed(2))+" å…¬é‡Œ",1)])])),"police"===l.value?(e.openBlock(),e.createElementBlock("view",{key:3,class:"mode-data"},[e.createElementVNode("text",{class:"mode-data-title"},"ä¸“é¡¹ä½“èƒ½æµ‹è¯•æ•°æ®"),e.createElementVNode("view",{class:"data-item"},[e.createElementVNode("text",{class:"item-label"},"2000ç±³ç›®æ ‡å®Œæˆ"),e.createElementVNode("text",{class:e.normalizeClass(["item-value",i.value?"success":"fail"])},e.toDisplayString(i.value?"âœ… å·²å®Œæˆ":"âŒ æœªå®Œæˆ"),3)]),e.createElementVNode("view",{class:"data-item"},[e.createElementVNode("text",{class:"item-label"},"é…é€Ÿæ˜¯å¦è¾¾æ ‡"),e.createElementVNode("text",{class:e.normalizeClass(["item-value",w.value?"success":"fail"])},e.toDisplayString(w.value?`âœ… è¾¾æ ‡ï¼ˆ${r.value.toFixed(1)} åˆ†/å…¬é‡Œï¼‰`:`âŒ æœªè¾¾æ ‡ï¼ˆ${r.value.toFixed(1)} åˆ†/å…¬é‡Œï¼‰`),3)]),e.createElementVNode("view",{class:"data-item tips"},[e.createElementVNode("text",{class:"item-label"},"å‚è€ƒæ ‡å‡†"),e.createElementVNode("text",{class:"item-value"},"å¯æ ¹æ®å­¦æ ¡æˆ–è¯¾ç¨‹ä½“æµ‹æ ‡å‡†é…ç½®")])])):e.createCommentVNode("",!0),"campus"===l.value?(e.openBlock(),e.createElementBlock("view",{key:4,class:"mode-data"},[e.createElementVNode("text",{class:"mode-data-title"},"æ ¡å›­æ‰“å¡æ•°æ®"),e.createElementVNode("view",{class:"data-item"},[e.createElementVNode("text",{class:"item-label"},"æ‰“å¡ç‚¹åˆ°è¾¾çŠ¶æ€"),e.createElementVNode("text",{class:e.normalizeClass(["item-value",o.value?"success":"fail"])},e.toDisplayString(o.value?"âœ… å·²åˆ°è¾¾":"âŒ æœªåˆ°è¾¾"),3)])])):e.createCommentVNode("",!0),"normal"===l.value?(e.openBlock(),e.createElementBlock("view",{key:5,class:"mode-data"},[e.createElementVNode("text",{class:"mode-data-title"},"æ™®é€šè·‘æ­¥æ•°æ®"),e.createElementVNode("view",{class:"data-item tips"},[e.createElementVNode("text",{class:"item-label"},"æ¸©é¦¨æç¤º"),e.createElementVNode("text",{class:"item-value"},"æ•°æ®å·²è‡ªåŠ¨è®°å½•ï¼Œå¯åœ¨ã€Œæˆ‘çš„ã€é¡µé¢æŸ¥çœ‹æ±‡æ€»")])])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"btn-group"},[e.createElementVNode("button",{class:"save-btn",disabled:""}," âœ… æ•°æ®å·²ä¿å­˜ "),e.createElementVNode("button",{onClick:k,class:"back-btn"},"è¿”å›é¦–é¡µ")])]))}},[["__scopeId","data-v-b293ec21"]]),V=c({__name:"login",setup(a){const l=e.ref("student"),s=e.ref(!1),n=e.ref({account:"",password:""}),c=e.computed((()=>n.value.account.length>0&&n.value.password.length>0)),o=async()=>{if(c.value&&(()=>{const{account:e,password:t}=n.value;return!(t.length<6&&(uni.showToast({title:"å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½",icon:"none"}),1))})()){s.value=!0;try{const t=await(e={phone:n.value.account,password:n.value.password},d({url:"/auth/login",method:"POST",data:e}));if("admin"!==t.role&&t.role!==l.value)return uni.showToast({title:"è§’è‰²ä¸åŒ¹é…ï¼Œè¯·åˆ‡æ¢è§’è‰²ç™»å½•",icon:"none"}),void(s.value=!1);const a={userId:t.user_id,role:t.role,name:t.name,phone:n.value.account,schoolId:"10001",isPoliceSchool:!1};uni.setStorageSync("token",t.access_token),uni.setStorageSync("userInfo",a),uni.setStorageSync("userRole",t.role),uni.showToast({title:"ç™»å½•æˆåŠŸ",icon:"success"}),setTimeout((()=>{"admin"===t.role?uni.reLaunch({url:"/pages/admin/dashboard/index"}):"student"===l.value?uni.reLaunch({url:"/pages/home/home"}):uni.reLaunch({url:"/pages/teacher/home/home"})}),1e3)}catch(a){t("error","at pages/login/login.vue:164","Login failed:",a)}finally{s.value=!1}var e}},i=()=>{uni.navigateTo({url:"/pages/register/register"})},r=()=>{uni.showToast({title:"è¯·è”ç³»ç®¡ç†å‘˜é‡ç½®å¯†ç ",icon:"none"})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"login-container"},[e.createElementVNode("view",{class:"header-section"},[e.createElementVNode("view",{class:"logo-circle"},[e.createElementVNode("text",{class:"logo-text"},"æ ¡")]),e.createElementVNode("text",{class:"app-name"},"å¤§å­¦ç”Ÿè¿åŠ¨å¥åº·ç®¡ç†å¹³å°"),e.createElementVNode("text",{class:"app-sub-name"},"Professional Sports Management System")]),e.createElementVNode("view",{class:"login-card"},[e.createElementVNode("view",{class:"role-tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["role-tab",{active:"student"===l.value}]),onClick:a[0]||(a[0]=e=>l.value="student")},[e.createElementVNode("text",null,"å­¦ç”Ÿç«¯")],2),e.createElementVNode("view",{class:e.normalizeClass(["role-tab",{active:"teacher"===l.value}]),onClick:a[1]||(a[1]=e=>l.value="teacher")},[e.createElementVNode("text",null,"æ•™å¸ˆç«¯")],2)]),e.createElementVNode("view",{class:"form-area"},[e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("text",{class:"input-label"},e.toDisplayString("student"===l.value?"å­¦å· / æ‰‹æœºå·":"å·¥å· / æ‰‹æœºå·"),1),e.withDirectives(e.createElementVNode("input",{class:"input-field","onUpdate:modelValue":a[2]||(a[2]=e=>n.value.account=e),placeholder:"student"===l.value?"è¯·è¾“å…¥å­¦å·/æ‰‹æœºå·":"è¯·è¾“å…¥å·¥å·/æ‰‹æœºå·","placeholder-class":"placeholder-style"},null,8,["placeholder"]),[[e.vModelText,n.value.account]])]),e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("text",{class:"input-label"},"å¯†ç "),e.withDirectives(e.createElementVNode("input",{class:"input-field","onUpdate:modelValue":a[3]||(a[3]=e=>n.value.password=e),type:"password",placeholder:"è¯·è¾“å…¥å¯†ç ","placeholder-class":"placeholder-style"},null,512),[[e.vModelText,n.value.password]])]),e.createElementVNode("button",{class:e.normalizeClass(["submit-btn",{disabled:!c.value}]),onClick:o,loading:s.value}," ç™»å½• ",10,["loading"]),e.createElementVNode("view",{class:"footer-links"},[e.createElementVNode("text",{class:"link-text",onClick:i},"æ³¨å†Œæ–°è´¦å·"),e.createElementVNode("text",{class:"divider"},"|"),e.createElementVNode("text",{class:"link-text",onClick:r},"å¿˜è®°å¯†ç ï¼Ÿ")])])]),e.createElementVNode("view",{class:"copyright"},[e.createElementVNode("text",null,"Copyright Â© 2026 Campus Sports System")])]))}},[["__scopeId","data-v-c1fdb01d"]]),w=c({__name:"register",setup(a){const l=e.ref(1),s=e.ref(!1),n=e.ref({role:"student",name:"",phone:"",code:"",password:"",confirmPwd:"",school:"",college:"",major:"",class:"",empId:"",department:"",isPoliceSchool:!1}),c=e=>{n.value.role=e},o=()=>{l.value=2},i=e=>{n.value.isPoliceSchool=e.detail.value},r=()=>{uni.navigateBack()},m=()=>{if(!n.value.phone)return void uni.showToast({title:"è¯·å…ˆè¾“å…¥æ‰‹æœºå·",icon:"none"});/^1[3-9]\d{9}$/.test(n.value.phone)?uni.showToast({title:"éªŒè¯ç å·²å‘é€",icon:"success"}):uni.showToast({title:"æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®",icon:"none"})},u=async()=>{const e=n.value;if(!e.name||!e.phone||!e.password)return void uni.showToast({title:"è¯·å®Œå–„åŸºç¡€ä¿¡æ¯",icon:"none"});if(/^1[3-9]\d{9}$/.test(e.phone))if(e.password.length<6)uni.showToast({title:"å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½",icon:"none"});else if(e.password===e.confirmPwd)if("student"!==e.role||e.school&&e.class)if("teacher"!==e.role||e.empId&&e.department){s.value=!0;try{await(a={phone:e.phone,name:e.name,role:e.role,password:e.password},d({url:"/auth/register",method:"POST",data:a})),uni.showToast({title:"æ³¨å†ŒæˆåŠŸ",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),1500)}catch(l){t("error","at pages/register/register.vue:228","Register failed:",l)}finally{s.value=!1}var a}else uni.showToast({title:"è¯·å®Œå–„æ•™å¸ˆä¿¡æ¯",icon:"none"});else uni.showToast({title:"è¯·å®Œå–„å­¦ç”Ÿä¿¡æ¯",icon:"none"});else uni.showToast({title:"ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´",icon:"none"});else uni.showToast({title:"è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·",icon:"none"})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"register-container"},[e.createElementVNode("view",{class:"header-section"},[e.createElementVNode("text",{class:"title"},"æ³¨å†Œæ–°è´¦å·"),e.createElementVNode("text",{class:"sub-title"},"åŠ å…¥æ ¡å›­è¿åŠ¨å¥åº·å¹³å°")]),e.createElementVNode("view",{class:"register-card"},[1===l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"role-select-box"},[e.createElementVNode("text",{class:"step-title"},"è¯·é€‰æ‹©æ‚¨çš„èº«ä»½"),e.createElementVNode("view",{class:"role-options"},[e.createElementVNode("view",{class:e.normalizeClass(["role-option",{active:"student"===n.value.role}]),onClick:a[0]||(a[0]=e=>c("student"))},[e.createElementVNode("text",{class:"role-icon"},"ğŸ‘¨â€ğŸ“"),e.createElementVNode("text",{class:"role-name"},"æˆ‘æ˜¯å­¦ç”Ÿ")],2),e.createElementVNode("view",{class:e.normalizeClass(["role-option",{active:"teacher"===n.value.role}]),onClick:a[1]||(a[1]=e=>c("teacher"))},[e.createElementVNode("text",{class:"role-icon"},"ğŸ‘¨â€ğŸ«"),e.createElementVNode("text",{class:"role-name"},"æˆ‘æ˜¯æ•™å¸ˆ")],2)]),e.createElementVNode("button",{class:"next-btn",onClick:o},"ä¸‹ä¸€æ­¥")])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"form-box"},[e.createElementVNode("view",{class:"form-header"},[e.createElementVNode("text",{class:"back-text",onClick:a[2]||(a[2]=e=>l.value=1)},"è¿”å›ä¿®æ”¹èº«ä»½"),e.createElementVNode("text",{class:"current-role"},"å½“å‰èº«ä»½ï¼š"+e.toDisplayString("student"===n.value.role?"å­¦ç”Ÿ":"æ•™å¸ˆ"),1)]),e.createElementVNode("view",{class:"section-title"},"åŸºç¡€ä¿¡æ¯"),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[3]||(a[3]=e=>n.value.name=e),placeholder:"çœŸå®å§“å"},null,512),[[e.vModelText,n.value.name]])]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[4]||(a[4]=e=>n.value.phone=e),type:"number",placeholder:"æ‰‹æœºå·ç "},null,512),[[e.vModelText,n.value.phone]])]),e.createElementVNode("view",{class:"input-item code-box"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[5]||(a[5]=e=>n.value.code=e),type:"number",placeholder:"éªŒè¯ç "},null,512),[[e.vModelText,n.value.code]]),e.createElementVNode("text",{class:"get-code",onClick:m},"è·å–éªŒè¯ç ")]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[6]||(a[6]=e=>n.value.password=e),type:"password",placeholder:"è®¾ç½®å¯†ç  (6-16ä½)"},null,512),[[e.vModelText,n.value.password]])]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[7]||(a[7]=e=>n.value.confirmPwd=e),type:"password",placeholder:"ç¡®è®¤å¯†ç "},null,512),[[e.vModelText,n.value.confirmPwd]])]),e.createElementVNode("view",{class:"section-title"},"èº«ä»½ä¿¡æ¯"),"student"===n.value.role?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[8]||(a[8]=e=>n.value.school=e),placeholder:"å­¦æ ¡åç§°"},null,512),[[e.vModelText,n.value.school]])]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[9]||(a[9]=e=>n.value.college=e),placeholder:"æ‰€å±å­¦é™¢"},null,512),[[e.vModelText,n.value.college]])]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[10]||(a[10]=e=>n.value.major=e),placeholder:"ä¸“ä¸š"},null,512),[[e.vModelText,n.value.major]])]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[11]||(a[11]=e=>n.value.class=e),placeholder:"ç­çº§ (å¦‚: 22çº§3ç­)"},null,512),[[e.vModelText,n.value.class]])])],64)):e.createCommentVNode("",!0),"teacher"===n.value.role?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[12]||(a[12]=e=>n.value.school=e),placeholder:"å­¦æ ¡åç§°"},null,512),[[e.vModelText,n.value.school]])]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[13]||(a[13]=e=>n.value.empId=e),placeholder:"æ•™å¸ˆå·¥å·"},null,512),[[e.vModelText,n.value.empId]])]),e.createElementVNode("view",{class:"input-item"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[14]||(a[14]=e=>n.value.department=e),placeholder:"æ‰€å±éƒ¨é—¨ (å¦‚: è­¦ä½“æ•™ç ”å®¤)"},null,512),[[e.vModelText,n.value.department]])])],64)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"police-switch-box"},[e.createElementVNode("view",{class:"switch-header"},[e.createElementVNode("text",{class:"switch-label"},"è­¦æ ¡/å†›æ ¡ç”¨æˆ·"),e.createElementVNode("switch",{checked:n.value.isPoliceSchool,onChange:i,color:"#20C997",style:{transform:"scale(0.8)"}},null,40,["checked"])]),n.value.isPoliceSchool?(e.openBlock(),e.createElementBlock("text",{key:0,class:"switch-tip"}," * å‹¾é€‰åï¼Œç³»ç»Ÿå°†å¼€å¯é€‚é…è­¦æ ¡/å†›æ ¡ä½“æµ‹æ ‡å‡†çš„ä¸“é¡¹è®­ç»ƒæ¨¡å— ")):e.createCommentVNode("",!0)]),e.createElementVNode("button",{class:"submit-btn",onClick:u,loading:s.value},"ç«‹å³æ³¨å†Œ",8,["loading"])])),e.createElementVNode("view",{class:"footer-link"},[e.createElementVNode("text",{class:"link-text",onClick:r},"å·²æœ‰è´¦å·ï¼Ÿè¿”å›ç™»å½•")])])]))}},[["__scopeId","data-v-94eb3276"]]),h={__name:"list",setup(a){const s=e.ref(0),n=e.ref([]),c=e.ref(1),o=e.ref(20),i=e.ref(!1),r=()=>{};l((()=>{c.value=1,(async()=>{if(!i.value){i.value=!0;try{const e=await m({page:c.value,size:o.value});if(e.items){const t=e.items.map((e=>({...e,statusText:"completed"===e.status?"å·²å®Œæˆ":"expired"===e.status?"å·²è¿‡æœŸ":"è¿›è¡Œä¸­",desc:e.description||(e.min_distance?`ç›®æ ‡: ${e.min_distance}km`:"æ— å…·ä½“æè¿°"),deadline:e.deadline?e.deadline.split("T")[0]:"æ— é™åˆ¶"})));1===c.value?n.value=t:n.value=[...n.value,...t]}}catch(e){t("error","at pages/student/tasks/list.vue:66",e),uni.showToast({title:"åŠ è½½ä»»åŠ¡å¤±è´¥",icon:"none"})}finally{i.value=!1}}})()}));const d=e.computed((()=>0===s.value?n.value.filter((e=>"pending"===e.status)):n.value.filter((e=>"pending"!==e.status))));return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:0===s.value}]),onClick:a[0]||(a[0]=e=>s.value=0)},"è¿›è¡Œä¸­",2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:1===s.value}]),onClick:a[1]||(a[1]=e=>s.value=1)},"å·²ç»“æŸ",2)]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"task-list",onScrolltolower:r},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,(t=>{return e.openBlock(),e.createElementBlock("view",{class:"task-card",key:t.id,onClick:e=>{}},[e.createElementVNode("view",{class:"card-header"},[e.createElementVNode("view",{class:"title-row"},[e.createElementVNode("text",{class:e.normalizeClass(["tag",(l=t.type,"test"===l?"tag-red":"tag-blue")])},e.toDisplayString("run"===t.type?"è·‘æ­¥":"ä½“æµ‹"),3),e.createElementVNode("text",{class:"title"},e.toDisplayString(t.title),1)]),e.createElementVNode("text",{class:e.normalizeClass(["status",(a=t.status,"completed"===a?"text-green":"expired"===a?"text-gray":"text-orange")])},e.toDisplayString(t.statusText),3)]),e.createElementVNode("view",{class:"card-body"},[e.createElementVNode("text",{class:"desc"},e.toDisplayString(t.desc),1),e.createElementVNode("view",{class:"meta-row"},[e.createElementVNode("text",{class:"deadline"},"æˆªæ­¢: "+e.toDisplayString(t.deadline),1)])]),e.createElementVNode("view",{class:"card-footer"},["pending"===t.status?(e.openBlock(),e.createElementBlock("button",{key:0,class:"action-btn",onClick:e.withModifiers((e=>(e=>{if("run"===e.type){let t="/pages/run/run?mode=normal";if(e.min_distance&&e.min_distance>0){let a=10;e.min_duration&&e.min_duration>0&&(a=e.min_duration/e.min_distance),t=`/pages/run/run?mode=police&target=${1e3*e.min_distance}&pace=${a.toFixed(2)}&taskId=${e.id}&taskTitle=${encodeURIComponent(e.title)}&taskType=${e.type}`}uni.navigateTo({url:t})}else uni.navigateTo({url:"/pages/test/test"})})(t)),["stop"])},"å»å®Œæˆ",8,["onClick"])):"completed"===t.status?(e.openBlock(),e.createElementBlock("text",{key:1,class:"completed-text"},"âœ… å·²å®Œæˆ")):(e.openBlock(),e.createElementBlock("text",{key:2,class:"expired-text"},"å·²è¿‡æœŸ"))])],8,["onClick"]);var a,l})),128)),i.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-more"},"åŠ è½½ä¸­...")):e.createCommentVNode("",!0),i.value||0!==d.value.length?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-more"},"æš‚æ— ä»»åŠ¡"))],32)]))}},k=c({__name:"request",setup(a){const s=e.ref(!1),n=e.ref({type:"leave",reason:""}),c=e.ref([]),o=async()=>{try{const e=await d("/student/health/requests");c.value=e}catch(e){t("error","at pages/health/request.vue:92",e)}},i=async()=>{if(!n.value.reason.trim())return uni.showToast({title:"è¯·å¡«å†™åŸå› ",icon:"none"});s.value=!0;try{await d("/student/health/request",{method:"POST",data:{type:n.value.type,reason:n.value.reason}}),uni.showToast({title:"æäº¤æˆåŠŸ",icon:"success"}),n.value.reason="",await o()}catch(e){uni.showToast({title:e.detail||"æäº¤å¤±è´¥",icon:"none"})}finally{s.value=!1}};return l((()=>{o()})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"form-card"},[e.createElementVNode("view",{class:"form-header"},[e.createElementVNode("text",{class:"title"},"å¥åº·æŠ¥å¤‡ç”³è¯·"),e.createElementVNode("text",{class:"subtitle"},"è¯·å¦‚å®å¡«å†™ç”³è¯·ä¿¡æ¯ï¼Œæäº¤åå°†ç”±è€å¸ˆå®¡æ‰¹")]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"ç”³è¯·ç±»å‹"),e.createElementVNode("view",{class:"type-selector"},[e.createElementVNode("view",{class:e.normalizeClass(["type-btn",{active:"leave"===n.value.type}]),onClick:a[0]||(a[0]=e=>n.value.type="leave")},[e.createElementVNode("text",{class:"icon"},"ğŸ“…"),e.createElementVNode("text",null,"è¯·å‡ç”³è¯·")],2),e.createElementVNode("view",{class:e.normalizeClass(["type-btn",{active:"injury"===n.value.type}]),onClick:a[1]||(a[1]=e=>n.value.type="injury")},[e.createElementVNode("text",{class:"icon"},"ğŸ¥"),e.createElementVNode("text",null,"ä¼¤ç—…æŠ¥å‘Š")],2)])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"ç”³è¯·åŸå› "),e.withDirectives(e.createElementVNode("textarea",{class:"reason-input","onUpdate:modelValue":a[2]||(a[2]=e=>n.value.reason=e),placeholder:"è¯·è¯¦ç»†æè¿°åŸå› ï¼ˆä¾‹å¦‚ï¼šæ„Ÿå†’å‘çƒ§ã€è„šè¸æ‰­ä¼¤ç­‰ï¼‰",maxlength:"200"},null,512),[[e.vModelText,n.value.reason]]),e.createElementVNode("text",{class:"word-count"},e.toDisplayString(n.value.reason.length)+"/200",1)]),e.createElementVNode("button",{class:"submit-btn",disabled:s.value,onClick:i},e.toDisplayString(s.value?"æäº¤ä¸­...":"æäº¤ç”³è¯·"),9,["disabled"])]),e.createElementVNode("view",{class:"history-section"},[e.createElementVNode("view",{class:"section-title"},"æœ€è¿‘ç”³è¯·è®°å½•"),e.createElementVNode("view",{class:"history-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,(t=>{return e.openBlock(),e.createElementBlock("view",{class:"history-item",key:t.id},[e.createElementVNode("view",{class:"item-header"},[e.createElementVNode("text",{class:e.normalizeClass(["item-type",t.type])},e.toDisplayString("leave"===t.type?"è¯·å‡":"ä¼¤ç—…"),3),e.createElementVNode("text",{class:e.normalizeClass(["item-status",t.status])},e.toDisplayString((l=t.status,{pending:"å¾…å®¡æ‰¹",approved:"å·²é€šè¿‡",rejected:"å·²é©³å›"}[l]||l)),3)]),e.createElementVNode("text",{class:"item-reason"},e.toDisplayString(t.reason),1),e.createElementVNode("text",{class:"item-time"},e.toDisplayString((a=t.created_at,a?a.replace("T"," ").substring(0,16):"")),1)]);var a,l})),128)),0===c.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-tip"}," æš‚æ— ç”³è¯·è®°å½• ")):e.createCommentVNode("",!0)])])]))}},[["__scopeId","data-v-ba928d83"]]),y=c({__name:"home",setup(a){const s=e.ref({}),n=()=>{uni.navigateTo({url:"/pages/teacher/approve/approve"})};l((()=>{uni.hideHomeButton&&uni.hideHomeButton();const e=uni.getStorageSync("userInfo");if(e)try{s.value="string"==typeof e?JSON.parse(e):e}catch(a){t("error","at pages/teacher/home/home.vue:221","JSON parse error",a),s.value={}}uni.getStorageSync("token")?((async()=>{try{const e=await d({url:"/teacher/stats",method:"GET"});c.value={studentCount:e.student_count,todayCheckin:e.today_checkin,abnormalCount:e.abnormal_count,pendingApprovals:e.pending_approvals,avgPace:e.avg_pace,taskCount:e.task_count,complianceRate:e.compliance_rate}}catch(a){if(!uni.getStorageSync("token"))return;t("error","at pages/teacher/home/home.vue:208","Failed to fetch teacher stats:",a)}})(),N(),g()):uni.reLaunch({url:"/pages/login/login"})}));const c=e.ref({studentCount:0,todayCheckin:0,abnormalCount:0,pendingApprovals:0,avgPace:"--",taskCount:0,complianceRate:0}),i=e.ref([{day:"å‘¨ä¸€",val:0,color:"linear-gradient(180deg, #e0e0e0 0%, #f5f5f5 100%)"},{day:"å‘¨äºŒ",val:0,color:"linear-gradient(180deg, #e0e0e0 0%, #f5f5f5 100%)"},{day:"å‘¨ä¸‰",val:0,color:"linear-gradient(180deg, #e0e0e0 0%, #f5f5f5 100%)"},{day:"å‘¨å››",val:0,color:"linear-gradient(180deg, #20C997 0%, #63e6be 100%)"},{day:"å‘¨äº”",val:0,color:"linear-gradient(180deg, #e0e0e0 0%, #f5f5f5 100%)"},{day:"å‘¨å…­",val:0,color:"linear-gradient(180deg, #e0e0e0 0%, #f5f5f5 100%)"},{day:"å‘¨æ—¥",val:0,color:"linear-gradient(180deg, #e0e0e0 0%, #f5f5f5 100%)"}]),r=e.ref(!1),m=e.ref(!1),u=e.ref({title:"",type:"æ—¥å¸¸",desc:""}),v=e.ref([]),p=e.ref([]),N=async()=>{try{const e=await d({url:"/teacher/tasks",method:"GET",data:{page:1,size:5}});e&&e.items&&(v.value=e.items.map((e=>({title:e.title,type:"run"===e.type?"è·‘æ­¥":"å…¶ä»–",typeClass:"run"===e.type?"tag-green":"tag-blue",status:"è¿›è¡Œä¸­",percent:e.total_students>0?Math.round(e.completed_count/e.total_students*100):0}))))}catch(e){if(!uni.getStorageSync("token"))return;t("error","at pages/teacher/home/home.vue:285","Failed to fetch tasks:",e)}},g=async()=>{try{const e=await d({url:"/teacher/students/abnormal",method:"GET"});Array.isArray(e)&&(p.value=e.map(((e,t)=>({id:e.id||t,student:e.name,type:"injured"===e.health_status?"å—ä¼¤":"leave"===e.health_status?"è¯·å‡":"å¼‚å¸¸",value:e.abnormal_reason||"æœªè¯´æ˜",time:e.updated_at?new Date(e.updated_at).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):"--:--"}))).slice(0,5))}catch(e){if(!uni.getStorageSync("token"))return;t("error","at pages/teacher/home/home.vue:306","Failed to fetch abnormal alerts:",e)}},V=()=>{m.value=!1,u.value={title:"",type:"æ—¥å¸¸",desc:""},r.value=!0},w=()=>{if(!u.value.title)return uni.showToast({title:"è¯·è¾“å…¥æ ‡é¢˜",icon:"none"});uni.showToast({title:m.value?"ä¿®æ”¹æˆåŠŸ":"å‘å¸ƒæˆåŠŸ",icon:"success"}),r.value=!1};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"home-container"},[e.createElementVNode("view",{class:"teacher-dashboard"},[e.createElementVNode("view",{class:"custom-nav-bar"},[e.createElementVNode("view",{class:"nav-status-bar"}),e.createElementVNode("view",{class:"nav-content"},[e.createElementVNode("text",{class:"nav-title"},"æ•™å¸ˆå·¥ä½œå°")])]),e.createElementVNode("view",{class:"teacher-header"},[e.createElementVNode("view",{class:"teacher-info"},[e.createElementVNode("text",{class:"teacher-name"},e.toDisplayString(s.value.name||"è€å¸ˆ"),1),e.createElementVNode("text",{class:"teacher-title"},"ä½“è‚²æ•™ç ”å®¤")]),e.createElementVNode("view",{class:"teacher-avatar"},[e.createElementVNode("image",{class:"avatar-img",src:E,mode:"aspectFill"})])]),e.createElementVNode("view",{class:"dashboard-stats"},[e.createElementVNode("view",{class:"stat-card"},[e.createElementVNode("text",{class:"stat-num"},e.toDisplayString(c.value.todayCheckin),1),e.createElementVNode("text",{class:"stat-label"},"ä»Šæ—¥æ‰“å¡")]),e.createElementVNode("view",{class:"stat-card"},[e.createElementVNode("text",{class:"stat-num"},e.toDisplayString(c.value.abnormalCount),1),e.createElementVNode("text",{class:"stat-label"},"å¼‚å¸¸å¾…å¤„ç†")]),e.createElementVNode("view",{class:"stat-card",onClick:n},[e.createElementVNode("text",{class:"stat-num"},e.toDisplayString(c.value.pendingApprovals),1),e.createElementVNode("text",{class:"stat-label"},"å¾…å®¡æ‰¹")])]),e.createElementVNode("view",{class:"section-card todo-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"ä»Šæ—¥å¾…åŠ"),e.createElementVNode("text",{class:"section-more"},"å…¨éƒ¨ >")]),e.createElementVNode("view",{class:"todo-list"},[e.createElementVNode("view",{class:"todo-item"},[e.createElementVNode("view",{class:"todo-check"}),e.createElementVNode("view",{class:"todo-content"},[e.createElementVNode("text",{class:"todo-text"},"å®¡æ‰¹ 2023çº§ä½“æµ‹æˆç»©"),e.createElementVNode("text",{class:"todo-time"},"æˆªæ­¢: 17:00")])]),e.createElementVNode("view",{class:"todo-item"},[e.createElementVNode("view",{class:"todo-check"}),e.createElementVNode("view",{class:"todo-content"},[e.createElementVNode("text",{class:"todo-text"},"å‘å¸ƒæœ¬å‘¨è®­ç»ƒè®¡åˆ’"),e.createElementVNode("text",{class:"todo-time"},"å¾…å¤„ç†")])])])]),e.createElementVNode("view",{class:"section-card chart-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"å­¦å‘˜ä½“èƒ½æ¦‚è§ˆ"),e.createElementVNode("text",{class:"section-more"},"æ›´å¤š >")]),e.createElementVNode("view",{class:"overview-chart"},[e.createElementVNode("view",{class:"chart-col"},[e.createElementVNode("view",{class:"chart-ring ring-green"},[e.createElementVNode("text",{class:"ring-val"},"92%"),e.createElementVNode("text",{class:"ring-label"},"è¾¾æ ‡ç‡")]),e.createElementVNode("text",{class:"chart-name"},"ä½“èƒ½è¾¾æ ‡")]),e.createElementVNode("view",{class:"chart-col"},[e.createElementVNode("view",{class:"chart-ring ring-blue"},[e.createElementVNode("text",{class:"ring-val"},"85%"),e.createElementVNode("text",{class:"ring-label"},"å®Œæˆç‡")]),e.createElementVNode("text",{class:"chart-name"},"æœ¬å‘¨ä»»åŠ¡")]),e.createElementVNode("view",{class:"chart-col"},[e.createElementVNode("view",{class:"chart-ring ring-red"},[e.createElementVNode("text",{class:"ring-val"},"5'45\""),e.createElementVNode("text",{class:"ring-label"},"å¹³å‡é…é€Ÿ")]),e.createElementVNode("text",{class:"chart-name"},"è·‘æ­¥çŠ¶æ€")])]),e.createElementVNode("view",{class:"trend-chart"},[e.createElementVNode("text",{class:"trend-title"},"æœ¬å‘¨è¿åŠ¨è¶‹åŠ¿"),e.createElementVNode("view",{class:"trend-bars"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"t-bar-group",key:a},[e.createElementVNode("view",{class:"t-bar",style:e.normalizeStyle({height:t.val+"%",background:t.color})},null,4),e.createElementVNode("text",{class:"t-day"},e.toDisplayString(t.day),1)])))),128))])])]),e.createElementVNode("view",{class:"section-card task-widget"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"å¿«é€Ÿä»»åŠ¡ç®¡ç†"),e.createElementVNode("view",{class:"header-actions"},[e.createElementVNode("text",{class:"section-action",onClick:V},"+ å‘å¸ƒ")])]),e.createElementVNode("scroll-view",{"scroll-x":"",class:"quick-task-scroll"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.value,((t,l)=>(e.openBlock(),e.createElementBlock("view",{class:"quick-task-item",key:l,onClick:e=>(e=>{uni.navigateTo({url:`/pages/teacher/tasks/detail?id=999&title=${e.title}`})})(t)},[e.createElementVNode("view",{class:"qt-header"},[e.createElementVNode("text",{class:e.normalizeClass(["qt-type",t.typeClass])},e.toDisplayString(t.type),3),e.createElementVNode("text",{class:"qt-status"},e.toDisplayString(t.status),1)]),e.createElementVNode("text",{class:"qt-title"},e.toDisplayString(t.title),1),e.createElementVNode("view",{class:"qt-progress"},[e.createElementVNode("view",{class:"qt-bar-bg"},[e.createElementVNode("view",{class:"qt-bar-fill",style:e.normalizeStyle({width:t.percent+"%"})},null,4)]),e.createElementVNode("text",{class:"qt-val"},e.toDisplayString(t.percent)+"%",1)]),e.createElementVNode("view",{class:"qt-actions",onClick:a[0]||(a[0]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("text",{class:"qt-btn",onClick:e=>(e=>{m.value=!0,u.value={...e,desc:"ä»»åŠ¡æè¿°..."},r.value=!0})(t)},"ç¼–è¾‘",8,["onClick"]),t.percent<100?(e.openBlock(),e.createElementBlock("text",{key:0,class:"qt-btn warn",onClick:e=>(e=>{uni.showToast({title:`å·²å‚¬åŠä»»åŠ¡: ${e.title}`,icon:"none"})})(t)},"å‚¬åŠ",8,["onClick"])):e.createCommentVNode("",!0)])],8,["onClick"])))),128))])]),p.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"section-card alert-widget"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title red-dot"},"âš ï¸ å®æ—¶è­¦æŠ¥")]),e.createElementVNode("view",{class:"alert-feed"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"feed-item",key:a},[e.createElementVNode("view",{class:"feed-content"},[e.createElementVNode("text",{class:"feed-msg"},[e.createElementVNode("text",{class:"feed-name"},e.toDisplayString(t.student),1),e.createTextVNode(" "+e.toDisplayString(t.type)+" ("+e.toDisplayString(t.value)+")",1)]),e.createElementVNode("text",{class:"feed-time"},e.toDisplayString(t.time),1)]),e.createElementVNode("button",{class:"feed-btn",size:"mini",onClick:e=>{return t=a,void uni.showActionSheet({itemList:["è”ç³»å­¦ç”Ÿ","æ ‡è®°å·²å¤„ç†","æŸ¥çœ‹è¯¦æƒ…"],success:e=>{1===e.tapIndex?(p.value.splice(t,1),c.value.abnormalCount=Math.max(0,c.value.abnormalCount-1),uni.showToast({title:"å·²å¤„ç†",icon:"success"})):0===e.tapIndex?uni.showToast({title:"å·²å‘é€é€šçŸ¥",icon:"none"}):uni.navigateTo({url:"/pages/teacher/exceptions/exceptions"})}});var t}},"å¹²é¢„",8,["onClick"])])))),128))])])):e.createCommentVNode("",!0),r.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"modal-overlay",onClick:a[8]||(a[8]=e=>r.value=!1)},[e.createElementVNode("view",{class:"task-modal",onClick:a[7]||(a[7]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},e.toDisplayString(m.value?"ç¼–è¾‘ä»»åŠ¡":"å¿«é€Ÿå‘å¸ƒä»»åŠ¡"),1),e.createElementVNode("text",{class:"close-btn",onClick:a[1]||(a[1]=e=>r.value=!1)},"Ã—")]),e.createElementVNode("view",{class:"modal-body"},[e.withDirectives(e.createElementVNode("input",{class:"modal-input",placeholder:"ä»»åŠ¡æ ‡é¢˜","onUpdate:modelValue":a[2]||(a[2]=e=>u.value.title=e)},null,512),[[e.vModelText,u.value.title]]),e.createElementVNode("view",{class:"modal-types"},[e.createElementVNode("view",{class:e.normalizeClass(["type-chip",{active:"è€ƒæ ¸"===u.value.type}]),onClick:a[3]||(a[3]=e=>u.value.type="è€ƒæ ¸")},"è€ƒæ ¸",2),e.createElementVNode("view",{class:e.normalizeClass(["type-chip",{active:"æ—¥å¸¸"===u.value.type}]),onClick:a[4]||(a[4]=e=>u.value.type="æ—¥å¸¸")},"æ—¥å¸¸",2),e.createElementVNode("view",{class:e.normalizeClass(["type-chip",{active:"è®­ç»ƒ"===u.value.type}]),onClick:a[5]||(a[5]=e=>u.value.type="è®­ç»ƒ")},"è®­ç»ƒ",2)]),e.withDirectives(e.createElementVNode("textarea",{class:"modal-textarea",placeholder:"ä»»åŠ¡æè¿°","onUpdate:modelValue":a[6]||(a[6]=e=>u.value.desc=e)},null,512),[[e.vModelText,u.value.desc]])]),e.createElementVNode("button",{class:"modal-submit-btn",onClick:w},"ç¡®è®¤å‘å¸ƒ")])])):e.createCommentVNode("",!0),e.createElementVNode("view",{style:{height:"120rpx"}}),e.createVNode(o,{current:"/pages/teacher/home/home"})])]))}},[["__scopeId","data-v-8e9d15cb"]]),x=c({__name:"manage",setup(t){l((()=>{uni.hideHomeButton&&uni.hideHomeButton()}));const a=e=>{uni.navigateTo({url:e})},s=e=>{uni.showToast({title:`${e}åŠŸèƒ½å¼€å‘ä¸­`,icon:"none"})};return(t,l)=>(e.openBlock(),e.createElementBlock("view",{class:"manage-container"},[e.createElementVNode("view",{class:"custom-nav-bar"},[e.createElementVNode("view",{class:"nav-status-bar"}),e.createElementVNode("view",{class:"nav-content"},[e.createElementVNode("text",{class:"nav-title"},"ç»¼åˆç®¡ç†")])]),e.createElementVNode("view",{class:"content-wrapper"},[e.createElementVNode("view",{class:"grid-container"},[e.createElementVNode("view",{class:"grid-item",onClick:l[0]||(l[0]=e=>a("/pages/teacher/students/students"))},[e.createElementVNode("view",{class:"icon-box purple"},"ğŸ‘¥"),e.createElementVNode("text",{class:"grid-label"},"å­¦å‘˜ç®¡ç†"),e.createElementVNode("text",{class:"grid-desc"},"åˆ†ç»„ã€æ¡£æ¡ˆ")]),e.createElementVNode("view",{class:"grid-item",onClick:l[1]||(l[1]=e=>a("/pages/teacher/class/class-list"))},[e.createElementVNode("view",{class:"icon-box cyan"},"ğŸ«"),e.createElementVNode("text",{class:"grid-label"},"ç­çº§ç®¡ç†"),e.createElementVNode("text",{class:"grid-desc"},"æ’è¯¾ã€è€ƒå‹¤")]),e.createElementVNode("view",{class:"grid-item",onClick:l[2]||(l[2]=e=>a("/pages/teacher/tasks/tasks"))},[e.createElementVNode("view",{class:"icon-box green"},"ğŸ“¢"),e.createElementVNode("text",{class:"grid-label"},"ä»»åŠ¡ç®¡ç†"),e.createElementVNode("text",{class:"grid-desc"},"å‘å¸ƒã€å®¡æ‰¹")]),e.createElementVNode("view",{class:"grid-item",onClick:l[3]||(l[3]=e=>s("æ•™å­¦èµ„æº"))},[e.createElementVNode("view",{class:"icon-box pink"},"ğŸ“š"),e.createElementVNode("text",{class:"grid-label"},"æ•™å­¦èµ„æº"),e.createElementVNode("text",{class:"grid-desc"},"è¯¾ä»¶ã€è§†é¢‘")]),e.createElementVNode("view",{class:"grid-item",onClick:l[4]||(l[4]=e=>a("/pages/teacher/tests/tests"))},[e.createElementVNode("view",{class:"icon-box blue"},"ğŸ“Š"),e.createElementVNode("text",{class:"grid-label"},"æµ‹è¯•ç›‘æ§"),e.createElementVNode("text",{class:"grid-desc"},"å®æ—¶æ•°æ®")]),e.createElementVNode("view",{class:"grid-item",onClick:l[5]||(l[5]=e=>s("æ•°æ®å¯¼å‡º"))},[e.createElementVNode("view",{class:"icon-box indigo"},"ğŸ“¥"),e.createElementVNode("text",{class:"grid-label"},"æ•°æ®å¯¼å‡º"),e.createElementVNode("text",{class:"grid-desc"},"æŠ¥è¡¨ä¸‹è½½")]),e.createElementVNode("view",{class:"grid-item",onClick:l[6]||(l[6]=e=>a("/pages/teacher/exceptions/exceptions"))},[e.createElementVNode("view",{class:"icon-box orange"},"âš ï¸"),e.createElementVNode("text",{class:"grid-label"},"å¼‚å¸¸å¤„ç†"),e.createElementVNode("text",{class:"grid-desc"},"é¢„è­¦å¹²é¢„")]),e.createElementVNode("view",{class:"grid-item",onClick:l[7]||(l[7]=e=>s("é€šçŸ¥å…¬å‘Š"))},[e.createElementVNode("view",{class:"icon-box teal"},"ğŸ””"),e.createElementVNode("text",{class:"grid-label"},"é€šçŸ¥å…¬å‘Š"),e.createElementVNode("text",{class:"grid-desc"},"æ¶ˆæ¯æ¨é€")])]),e.createElementVNode("view",{class:"stats-card"},[e.createElementVNode("view",{class:"card-header"},[e.createElementVNode("text",{class:"card-title"},"æ•°æ®æ¦‚è§ˆ")]),e.createElementVNode("view",{class:"stats-row"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-val"},"128"),e.createElementVNode("text",{class:"stat-label"},"æ€»å­¦å‘˜")]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-val"},"92%"),e.createElementVNode("text",{class:"stat-label"},"è¾¾æ ‡ç‡")]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-val"},"5"),e.createElementVNode("text",{class:"stat-label"},"è¿›è¡Œä¸­ä»»åŠ¡")])])]),e.createElementVNode("view",{style:{height:"120rpx"}}),e.createVNode(o,{current:"/pages/teacher/manage/manage"})])]))}},[["__scopeId","data-v-ed3bf69d"]]),f=c({__name:"mine",setup(t){const a=e.ref({});l((()=>{uni.hideHomeButton&&uni.hideHomeButton();const e=uni.getStorageSync("userInfo");if(e)try{a.value="string"==typeof e?JSON.parse(e):e}catch(t){a.value={}}}));const s=()=>{uni.removeStorageSync("userInfo"),uni.removeStorageSync("userRole"),uni.reLaunch({url:"/pages/login/login"})};return(t,l)=>(e.openBlock(),e.createElementBlock("view",{class:"mine-container"},[e.createElementVNode("view",{class:"custom-nav-bar"},[e.createElementVNode("view",{class:"nav-status-bar"}),e.createElementVNode("view",{class:"nav-content"},[e.createElementVNode("text",{class:"nav-title"},"ä¸ªäººä¸­å¿ƒ")])]),e.createElementVNode("view",{class:"content-wrapper"},[e.createElementVNode("view",{class:"user-card"},[e.createElementVNode("view",{class:"avatar"},"ğŸ‘®â€â™‚ï¸"),e.createElementVNode("view",{class:"info"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(a.value.name||"æ•™å®˜"),1),e.createElementVNode("text",{class:"role"},"ä½“èƒ½æ•™ç ”å®¤")])]),e.createElementVNode("view",{class:"menu-list"},[e.createElementVNode("view",{class:"menu-item",onClick:l[0]||(l[0]=e=>uni.showToast({title:"è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­",icon:"none"}))},[e.createElementVNode("text",null,"ä¸ªäººä¿¡æ¯è®¾ç½®"),e.createElementVNode("text",{class:"arrow"},">")]),e.createElementVNode("view",{class:"menu-item",onClick:l[1]||(l[1]=e=>uni.showToast({title:"å®‰å…¨ä¸­å¿ƒå¼€å‘ä¸­",icon:"none"}))},[e.createElementVNode("text",null,"è´¦å·å®‰å…¨"),e.createElementVNode("text",{class:"arrow"},">")]),e.createElementVNode("view",{class:"menu-item",onClick:l[2]||(l[2]=e=>uni.showToast({title:"æš‚æ— æ–°é€šçŸ¥",icon:"none"}))},[e.createElementVNode("text",null,"ç³»ç»Ÿé€šçŸ¥"),e.createElementVNode("text",{class:"arrow"},">")]),e.createElementVNode("view",{class:"menu-item",onClick:l[3]||(l[3]=e=>uni.showToast({title:"è¯·è”ç³»ç®¡ç†å‘˜",icon:"none"}))},[e.createElementVNode("text",null,"å¸®åŠ©ä¸åé¦ˆ"),e.createElementVNode("text",{class:"arrow"},">")])]),e.createElementVNode("button",{class:"logout-btn",onClick:s},"é€€å‡ºç™»å½•"),e.createElementVNode("view",{style:{height:"120rpx"}}),e.createVNode(o,{current:"/pages/teacher/mine/mine"})])]))}},[["__scopeId","data-v-0cf1a906"]]),b=c({__name:"students",setup(a){const s=e.ref(!1),c=e.ref([]),o=e.ref([]),i=e.ref(!1),m=e.ref(!1),u=e.ref([]),v=e.ref([]),p=e.ref(""),E=e.ref(1),N=e.ref(!0),g=e.ref(!1),V=e.ref([]),w=e.computed((()=>["å…¨éƒ¨ç­çº§",...V.value.map((e=>e.name))])),h=e.ref(""),k=e.ref(null),y=["å…¨éƒ¨çŠ¶æ€","æ­£å¸¸","è¯·å‡","å—ä¼¤"],x=e.ref(""),f=e.ref(null),b=["ä½“èƒ½Aç»„","ä½“èƒ½Bç»„","åº·å¤ç»„"],S=["å…¨éƒ¨å°ç»„",...b],B=e.ref(""),C=e.computed((()=>u.value)),D=e.computed((()=>u.value.length)),T=e.computed((()=>u.value.filter((e=>"normal"!==e.health_status)).length)),_=e.computed((()=>u.value.filter((e=>"normal"===e.health_status)).length)),z=e.computed((()=>C.value.length>0&&c.value.length===C.value.length)),F=async(e=!1)=>{if(e&&(E.value=1,N.value=!0,u.value=[]),N.value&&!g.value){g.value=!0;try{const e={page:E.value,size:20};k.value&&(e.class_id=k.value),p.value&&(e.name=p.value),f.value&&(e.status=f.value),B.value&&(e.group_name=B.value);const t=(await d("/teacher/students",{method:"GET",data:e})).map((e=>{let t="æœªåˆ†é…";if(e.class_id){const a=V.value.find((t=>t.id===e.class_id));a&&(t=a.name)}let a="æ­£å¸¸",l="ok";return"leave"===e.health_status&&(a="è¯·å‡",l="warn"),"injured"===e.health_status&&(a="å—ä¼¤",l="warn"),{...e,className:t,statusLabel:a,statusClass:l,expanded:!1}}));t.length<20&&(N.value=!1),u.value=[...u.value,...t],E.value++}catch(a){t("error","at pages/teacher/students/students.vue:315",a),uni.showToast({title:"åŠ è½½å¤±è´¥",icon:"none"})}finally{g.value=!1}}};n((()=>{F(!1)}));const I=async()=>{try{const e=await d("/teacher/health/requests",{method:"GET"});v.value=e}catch(e){t("error","at pages/teacher/students/students.vue:331",e)}};l((()=>{if("teacher"!==(uni.getStorageSync("userRole")||uni.getStorageSync("role")))return uni.showToast({title:"è¯·ä½¿ç”¨æ•™å¸ˆè´¦å·ç™»å½•",icon:"none"}),void uni.redirectTo({url:"/pages/login/login"});(async()=>{try{const e=await d("/teacher/classes",{method:"GET"});V.value=e}catch(e){t("error","at pages/teacher/students/students.vue:257",e)}})().then((()=>{F(!0)})),I(),o.value=uni.getStorageSync("mockSharedReports")||[]}));const M=e=>{const t=e.detail.value;0==t?(h.value="",k.value=null):(h.value=w.value[t],k.value=V.value[t-1].id),F(!0)},$=e=>{const t=e.detail.value;B.value=0==t?"":S[t],F(!0)},L=e=>{const t=e.detail.value;x.value=y[t],0==t?f.value=null:1==t?f.value="normal":2==t?f.value="leave":3==t&&(f.value="injured"),F(!0)},P=()=>{s.value=!s.value,c.value=[],s.value&&u.value.forEach((e=>e.expanded=!1))},A=e=>{const t=c.value.indexOf(e.id);t>-1?c.value.splice(t,1):c.value.push(e.id)},U=()=>{z.value?c.value=[]:c.value=C.value.map((e=>e.id))},q=()=>{if(0===c.value.length)return uni.showToast({title:"è¯·å…ˆé€‰æ‹©å­¦å‘˜",icon:"none"});uni.showActionSheet({itemList:b,success:async e=>{const t=b[e.tapIndex];try{await d("/teacher/students/bulk-update",{method:"POST",data:{student_ids:c.value,group_name:t}}),uni.showToast({title:"æ‰¹é‡åˆ†ç»„æˆåŠŸ",icon:"success"}),F(!0),P()}catch(a){uni.showToast({title:"æ“ä½œå¤±è´¥",icon:"none"})}}})},j=()=>{if(0===c.value.length)return uni.showToast({title:"è¯·å…ˆé€‰æ‹©å­¦å‘˜",icon:"none"});const e=["normal","leave","injured"];uni.showActionSheet({itemList:["æ¢å¤æ­£å¸¸","æ ‡è®°è¯·å‡","æ ‡è®°å—ä¼¤"],success:async t=>{const a=e[t.tapIndex];try{await d("/teacher/students/bulk-update",{method:"POST",data:{student_ids:c.value,health_status:a}}),uni.showToast({title:"çŠ¶æ€æ›´æ–°æˆåŠŸ",icon:"success"}),F(!0),P()}catch(l){uni.showToast({title:"æ“ä½œå¤±è´¥",icon:"none"})}}})},O=()=>{c.value.length>0?R({student_ids:c.value}):uni.showModal({title:"å¯¼å‡ºç¡®è®¤",content:"æœªé€‰æ‹©å­¦å‘˜ï¼Œæ˜¯å¦å¯¼å‡ºå½“å‰ç­›é€‰æ¡ä»¶ä¸‹çš„æ‰€æœ‰å­¦å‘˜ï¼Ÿ",success:e=>{if(e.confirm){const e={};k.value&&(e.class_id=k.value),f.value&&(e.health_status=f.value),B.value&&(e.group_name=B.value),R(e)}}})},R=e=>{uni.showLoading({title:"ç”ŸæˆæŠ¥è¡¨ä¸­..."});const t=uni.getStorageSync("token");uni.request({url:`${r}/teacher/students/export`,method:"POST",header:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},data:e,responseType:"arraybuffer",success:e=>{uni.hideLoading(),200===e.statusCode?(uni.showToast({title:"å¯¼å‡ºæˆåŠŸ",icon:"success"}),s.value&&P()):uni.showToast({title:"å¯¼å‡ºå¤±è´¥",icon:"none"})},fail:()=>{uni.hideLoading(),uni.showToast({title:"è¯·æ±‚å¤±è´¥",icon:"none"})}})},G=async(e,a,l)=>{try{await d(`/teacher/students/${e}`,{method:"PUT",data:{health_status:a,abnormal_reason:l}}),uni.showToast({title:"å·²æ›´æ–°",icon:"success"}),F(!0)}catch(s){t("error","at pages/teacher/students/students.vue:574",s)}},J=e=>{const t=u.value.find((t=>t.id===e));return t?t.name:`æœªçŸ¥å­¦å‘˜(${e})`},H=async(e,t)=>{try{await d(`/teacher/health/requests/${e.id}/review`,{method:"PUT",data:{status:t}}),uni.showToast({title:"å·²å¤„ç†",icon:"success"}),I(),F()}catch(a){uni.showToast({title:"å¤„ç†å¤±è´¥",icon:"none"})}};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"students-page"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"nav-row"},[e.createElementVNode("text",{class:"page-title"},"å­¦å‘˜ç®¡ç†"),e.createElementVNode("view",{class:e.normalizeClass(["batch-btn",{active:s.value}]),onClick:P},[e.createElementVNode("text",null,e.toDisplayString(s.value?"å®Œæˆ":"æ‰¹é‡ç®¡ç†"),1)],2)]),e.createElementVNode("view",{class:"stats-row"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-num"},e.toDisplayString(D.value),1),e.createElementVNode("text",{class:"stat-label"},"æ€»äººæ•°")]),e.createElementVNode("view",{class:"stat-item warn"},[e.createElementVNode("text",{class:"stat-num"},e.toDisplayString(T.value),1),e.createElementVNode("text",{class:"stat-label"},"å¼‚å¸¸")]),e.createElementVNode("view",{class:"stat-item success"},[e.createElementVNode("text",{class:"stat-num"},e.toDisplayString(_.value),1),e.createElementVNode("text",{class:"stat-label"},"æ­£å¸¸")])]),e.createElementVNode("view",{class:"tools-section"},[e.createElementVNode("view",{class:"search-bar"},[e.createElementVNode("text",{class:"search-icon"},"ğŸ”"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),class:"search-input",placeholder:"æœç´¢å§“å/å­¦å·...","confirm-type":"search",onConfirm:F},null,544),[[e.vModelText,p.value]])]),e.createElementVNode("view",{class:"filters-bar"},[e.createElementVNode("picker",{mode:"selector",range:w.value,onChange:M,class:"filter-item"},[e.createElementVNode("view",{class:"picker-box"},[e.createElementVNode("text",{class:"picker-text"},e.toDisplayString(h.value||"å…¨éƒ¨ç­çº§"),1),e.createElementVNode("text",{class:"picker-icon"},"â–¼")])],40,["range"]),e.createElementVNode("picker",{mode:"selector",range:S,onChange:$,class:"filter-item"},[e.createElementVNode("view",{class:"picker-box"},[e.createElementVNode("text",{class:"picker-text"},e.toDisplayString(B.value||"å…¨éƒ¨å°ç»„"),1),e.createElementVNode("text",{class:"picker-icon"},"â–¼")])],32),e.createElementVNode("picker",{mode:"selector",range:y,onChange:L,class:"filter-item"},[e.createElementVNode("view",{class:"picker-box"},[e.createElementVNode("text",{class:"picker-text"},e.toDisplayString(x.value||"å…¨éƒ¨çŠ¶æ€"),1),e.createElementVNode("text",{class:"picker-icon"},"â–¼")])],32)])]),v.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"notice-bar",onClick:a[1]||(a[1]=e=>m.value=!0)},[e.createElementVNode("view",{class:"notice-content"},[e.createElementVNode("text",{class:"notice-icon"},"ğŸ””"),e.createElementVNode("text",null,"æœ‰ "+e.toDisplayString(v.value.length)+" æ¡å¾…å®¡æ‰¹ç”³è¯·",1)]),e.createElementVNode("text",{class:"arrow"},"å»å¤„ç† >")])):e.createCommentVNode("",!0)]),o.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"report-notice",onClick:a[2]||(a[2]=e=>i.value=!0)},[e.createElementVNode("view",{class:"notice-left"},[e.createElementVNode("text",{class:"notice-icon"},"ğŸ¤–"),e.createElementVNode("text",{class:"notice-text"},"æ”¶åˆ° "+e.toDisplayString(o.value.length)+" ä»½æ–°çš„è¿åŠ¨åˆ†ææŠ¥å‘Š",1)]),e.createElementVNode("text",{class:"notice-arrow"},"æŸ¥çœ‹ >")])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:e.normalizeClass(["card-list",{"has-bottom-bar":s.value}])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(C.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"student-card",key:t.id,onClick:e=>(e=>{s.value?A(e):e.expanded=!e.expanded})(t)},[e.createElementVNode("view",{class:"card-main"},[e.createElementVNode("view",{class:"card-left"},[s.value?(e.openBlock(),e.createElementBlock("checkbox",{key:0,checked:c.value.includes(t.id),onClick:e.withModifiers((e=>A(t)),["stop"]),color:"#20C997",style:{transform:"scale(0.8)"}},null,8,["checked","onClick"])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"avatar"},e.toDisplayString(t.name.slice(0,1)),1),e.createElementVNode("view",{class:"info"},[e.createElementVNode("text",{class:"name"},[e.createTextVNode(e.toDisplayString(t.name)+" ",1),t.groupName?(e.openBlock(),e.createElementBlock("text",{key:0,class:"group-tag"},"("+e.toDisplayString(t.groupName)+")",1)):e.createCommentVNode("",!0)]),e.createElementVNode("text",{class:"meta"},"å­¦å·ï¼š"+e.toDisplayString(t.student_id||"æœªå½•å…¥"),1),e.createElementVNode("text",{class:"meta"},"ç­çº§ï¼š"+e.toDisplayString(t.className),1),e.createElementVNode("text",{class:"meta"},e.toDisplayString("normal"===t.health_status?"å¥åº·ï¼šè‰¯å¥½":"åŸå› ï¼š"+(t.abnormal_reason||"æœªè¯´æ˜")),1)])]),e.createElementVNode("view",{class:"card-right"},[e.createElementVNode("text",{class:e.normalizeClass(["status",t.statusClass])},e.toDisplayString(t.statusLabel),3),s.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:0,class:"expand-icon"},e.toDisplayString(t.expanded?"â–²":"â–¼"),1))])]),t.expanded&&!s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"card-expanded"},[e.createElementVNode("view",{class:"exp-grid"},[e.createElementVNode("view",{class:"exp-item"},[e.createElementVNode("text",{class:"exp-label"},"çŠ¶æ€"),e.createElementVNode("text",{class:"exp-val"},e.toDisplayString(t.statusLabel),1)]),e.createElementVNode("view",{class:"exp-item"},[e.createElementVNode("text",{class:"exp-label"},"åŸå› "),e.createElementVNode("text",{class:"exp-val"},e.toDisplayString(t.abnormal_reason||"-"),1)])]),e.createElementVNode("view",{class:"exp-actions"},[e.createElementVNode("button",{size:"mini",class:"exp-btn",onClick:e.withModifiers((e=>(e=>{uni.navigateTo({url:`/pages/teacher/students/detail?id=${e.id}`})})(t)),["stop"])},"å®Œæ•´æ¡£æ¡ˆ",8,["onClick"]),e.createElementVNode("button",{size:"mini",class:"exp-btn outline",onClick:e.withModifiers((e=>(e=>{uni.showActionSheet({itemList:["ä¿®æ”¹çŠ¶æ€: æ­£å¸¸","ä¿®æ”¹çŠ¶æ€: è¯·å‡","ä¿®æ”¹çŠ¶æ€: å—ä¼¤","ä¿®æ”¹åˆ†ç»„"],success:async t=>{if(t.tapIndex<3){const a=["normal","leave","injured"][t.tapIndex];"normal"!==a?uni.showModal({title:"å¼‚å¸¸åŸå› ",editable:!0,placeholder:"è¯·è¾“å…¥åŸå› ï¼ˆå¦‚ï¼šæ„Ÿå†’ã€æ‰­ä¼¤ï¼‰",success:async t=>{t.confirm&&await G(e.id,a,t.content)}}):await G(e.id,a,"")}else uni.showActionSheet({itemList:b,success:async t=>{await d(`/teacher/students/${e.id}`,{method:"PUT",data:{group_name:b[t.tapIndex]}}),uni.showToast({title:"å·²æ›´æ–°",icon:"success"}),F(!0)}})}})})(t)),["stop"])},"ç¼–è¾‘ä¿¡æ¯",8,["onClick"])])])):e.createCommentVNode("",!0)],8,["onClick"])))),128)),0===C.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty"},[e.createElementVNode("text",null,"æš‚æ— ç¬¦åˆæ¡ä»¶çš„å­¦å‘˜")])):e.createCommentVNode("",!0)],2),s.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"batch-bar"},[e.createElementVNode("view",{class:"batch-info"},[e.createElementVNode("checkbox",{checked:z.value,onClick:U,color:"#20C997",style:{transform:"scale(0.8)"}},null,8,["checked"]),e.createElementVNode("text",null,"å·²é€‰ "+e.toDisplayString(c.value.length)+" äºº",1)]),e.createElementVNode("view",{class:"batch-actions"},[e.createElementVNode("button",{size:"mini",class:"action-btn outline",onClick:q},"æ‰¹é‡åˆ†ç»„"),e.createElementVNode("button",{size:"mini",class:"action-btn warn",onClick:j},"æ›´æ–°çŠ¶æ€"),e.createElementVNode("button",{size:"mini",class:"action-btn",onClick:O},"å¯¼å‡ºæ•°æ®")])])):e.createCommentVNode("",!0),m.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"modal-overlay",onClick:a[5]||(a[5]=e=>m.value=!1)},[e.createElementVNode("view",{class:"report-modal",onClick:a[4]||(a[4]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"ğŸ”” è¯·å‡/ä¼¤ç—…å®¡æ‰¹"),e.createElementVNode("text",{class:"close-btn",onClick:a[3]||(a[3]=e=>m.value=!1)},"Ã—")]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"report-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.value,((t,a)=>{return e.openBlock(),e.createElementBlock("view",{class:"report-item",key:t.id},[e.createElementVNode("view",{class:"report-meta"},[e.createElementVNode("text",{class:"report-stu"},e.toDisplayString(J(t.student_id)),1),e.createElementVNode("text",{class:"report-time"},e.toDisplayString((l=t.created_at,l?new Date(l).toLocaleDateString():"")),1)]),e.createElementVNode("view",{class:e.normalizeClass(["report-card",t.type])},[e.createElementVNode("view",{class:"card-header"},[e.createElementVNode("text",{class:e.normalizeClass(["report-type-tag",t.type])},e.toDisplayString("leave"===t.type?"ğŸ“… è¯·å‡ç”³è¯·":"ğŸ¥ ä¼¤ç—…æŠ¥å‘Š"),3)]),e.createElementVNode("text",{class:"report-content"},e.toDisplayString(t.reason),1)],2),e.createElementVNode("view",{class:"report-actions"},[e.createElementVNode("button",{size:"mini",class:"action-btn reject",onClick:e=>H(t,"rejected")},"é©³å›",8,["onClick"]),e.createElementVNode("button",{size:"mini",class:"action-btn approve",onClick:e=>H(t,"approved")},"æ‰¹å‡†",8,["onClick"])])]);var l})),128)),0===v.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty"},[e.createElementVNode("text",null,"æš‚æ— å¾…å®¡æ‰¹è¯·æ±‚")])):e.createCommentVNode("",!0)])])])):e.createCommentVNode("",!0),i.value?(e.openBlock(),e.createElementBlock("view",{key:3,class:"modal-overlay",onClick:a[8]||(a[8]=e=>i.value=!1)},[e.createElementVNode("view",{class:"report-modal",onClick:a[7]||(a[7]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"ğŸ“„ å­¦å‘˜è¿åŠ¨åˆ†ææŠ¥å‘Š"),e.createElementVNode("text",{class:"close-btn",onClick:a[6]||(a[6]=e=>i.value=!1)},"Ã—")]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"report-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"report-item",key:a},[e.createElementVNode("view",{class:"report-meta"},[e.createElementVNode("text",{class:"report-stu"},e.toDisplayString(t.studentName),1),e.createElementVNode("text",{class:"report-time"},e.toDisplayString(t.time),1)]),e.createElementVNode("view",{class:"report-card"},[e.createElementVNode("text",{class:"report-title"},e.toDisplayString(t.card.title),1),t.card.suggestion?(e.openBlock(),e.createElementBlock("text",{key:0,class:"report-suggestion"},"ğŸ’¡ "+e.toDisplayString(t.card.suggestion),1)):e.createCommentVNode("",!0),t.card.chartData?(e.openBlock(),e.createElementBlock("view",{key:1,class:"report-chart"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.card.chartData,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"mini-bar",key:a},[e.createElementVNode("text",{class:"mini-label"},e.toDisplayString(t.label),1),e.createElementVNode("view",{class:"mini-track"},[e.createElementVNode("view",{class:"mini-fill",style:e.normalizeStyle({width:t.value+"%",background:t.color})},null,4)]),e.createElementVNode("text",{class:"mini-val"},e.toDisplayString(t.valText),1)])))),128))])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"report-actions"},[e.createElementVNode("button",{size:"mini",class:"reply-btn",onClick:e=>{}},"å›å¤æŒ‡å¯¼",8,["onClick"])])])))),128))])])])):e.createCommentVNode("",!0)]))}},[["__scopeId","data-v-07c538d9"]]),S=c({__name:"detail",setup(a){const n=e.ref(""),c=e.ref(""),o=e.ref(""),i=e.ref(""),r=e.ref("ä½“èƒ½Aç»„"),m=e.ref("è‰¯å¥½"),u=e.ref("run"),v=e.ref([]),p=e.ref([]),E=e.computed((()=>v.value.reduce(((e,t)=>e+parseFloat(t.distance)),0).toFixed(1))),N=e.computed((()=>"è‰¯å¥½"===m.value?"good":"bad"));s((e=>{n.value=e.id||"",n.value&&w()}));const g=e=>{if(!e)return"";const t=new Date(e);return`${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},V=e=>{if(!e)return"00:00";return`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`},w=async()=>{try{const e=await d({url:"/teacher/classes"}),t=await d({url:`/teacher/students/${n.value}`});if(c.value=t.name,o.value=t.student_id||t.phone,t.class_id){const a=e.find((e=>e.id===t.class_id));i.value=a?a.name:"æœªçŸ¥ç­çº§"}else i.value="æœªåˆ†é…ç­çº§";r.value=t.group_name||"æœªåˆ†ç»„";const a={normal:"æ­£å¸¸",leave:"è¯·å‡",injured:"å—ä¼¤"};m.value=a[t.health_status]||"æ­£å¸¸";const l=await d({url:`/teacher/student/${n.value}/activities`,data:{size:100}}),s=l.items||l;Array.isArray(s)&&(v.value=s.filter((e=>"run"===e.type)).map((e=>{var t,a,l;return{date:g(e.started_at),distance:((null==(t=e.metrics)?void 0:t.distance)||0).toFixed(2),duration:V((null==(a=e.metrics)?void 0:a.duration)||0),modeText:"task"===e.source?"ä»»åŠ¡è·‘æ­¥":"è‡ªç”±è·‘",pace:(null==(l=e.metrics)?void 0:l.pace)||"-"}})),p.value=s.filter((e=>"test"===e.type)).map((e=>{var t,a;return{date:g(e.started_at),testName:"ä½“èƒ½æµ‹è¯•",testCount:(null==(t=e.metrics)?void 0:t.count)||0,result:(null==(a=e.metrics)?void 0:a.qualified)?"åˆæ ¼":"æœªåˆæ ¼"}})))}catch(e){uni.showToast({title:"åŠ è½½æ•°æ®å¤±è´¥",icon:"none"}),t("error","at pages/teacher/students/detail.vue:195",e)}};l((()=>{}));const h=()=>{uni.showActionSheet({itemList:["æ‹¨æ‰“ç”µè¯","å‘é€æ¶ˆæ¯"],success:e=>{0===e.tapIndex?uni.makePhoneCall({phoneNumber:o.value}):uni.showToast({title:"åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})}})},k=()=>{uni.showToast({title:"æ­£åœ¨ç”ŸæˆPDFæ¡£æ¡ˆ...",icon:"loading"}),setTimeout((()=>{uni.showToast({title:"å¯¼å‡ºæˆåŠŸ",icon:"success"})}),1500)};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"detail-page"},[e.createElementVNode("view",{class:"header-card"},[e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("view",{class:"avatar"},e.toDisplayString(c.value.slice(0,1)),1),e.createElementVNode("view",{class:"info-content"},[e.createElementVNode("view",{class:"name-row"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(c.value),1),e.createElementVNode("text",{class:e.normalizeClass(["status-badge",N.value])},e.toDisplayString(m.value),3)]),e.createElementVNode("text",{class:"sub-text"},"å­¦å·ï¼š"+e.toDisplayString(o.value)+" | "+e.toDisplayString(i.value),1),e.createElementVNode("text",{class:"sub-text"},"åˆ†ç»„ï¼š"+e.toDisplayString(r.value||"æœªåˆ†ç»„"),1)])]),e.createElementVNode("view",{class:"stats-grid"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-val"},e.toDisplayString(v.value.length),1),e.createElementVNode("text",{class:"stat-label"},"æ€»è·‘æ¬¡")]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-val"},e.toDisplayString(E.value),1),e.createElementVNode("text",{class:"stat-label"},"æ€»é‡Œç¨‹(km)")]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-val"},e.toDisplayString(p.value.length),1),e.createElementVNode("text",{class:"stat-label"},"æµ‹è¯•æ¬¡æ•°")])])]),e.createElementVNode("view",{class:"tabs-container"},[e.createElementVNode("view",{class:"tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"run"===u.value}]),onClick:a[0]||(a[0]=e=>u.value="run")},"è·‘æ­¥è®°å½•",2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"test"===u.value}]),onClick:a[1]||(a[1]=e=>u.value="test")},"ä½“èƒ½æµ‹è¯•",2)])]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"content-area"},["run"===u.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"list-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"record-card",key:"r"+a},[e.createElementVNode("view",{class:"card-left"},[e.createElementVNode("text",{class:"card-date"},e.toDisplayString(t.date),1),e.createElementVNode("text",{class:"card-tag"},e.toDisplayString(t.modeText),1)]),e.createElementVNode("view",{class:"card-right"},[e.createElementVNode("view",{class:"data-row"},[e.createElementVNode("text",{class:"data-val"},[e.createTextVNode(e.toDisplayString(t.distance),1),e.createElementVNode("text",{class:"unit"},"km")]),e.createElementVNode("text",{class:"data-val"},e.toDisplayString(t.duration),1)]),e.createElementVNode("text",{class:"pace"},"é…é€Ÿ "+e.toDisplayString(t.pace||"5'30\""),1)])])))),128)),0===v.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-tip"},"æš‚æ— è·‘æ­¥è®°å½•")):e.createCommentVNode("",!0)])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"list-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"record-card",key:"t"+a},[e.createElementVNode("view",{class:"card-left"},[e.createElementVNode("text",{class:"card-date"},e.toDisplayString(t.date),1),e.createElementVNode("text",{class:"card-title"},e.toDisplayString(t.testName),1)]),e.createElementVNode("view",{class:"card-right"},[e.createElementVNode("text",{class:e.normalizeClass(["test-result","åˆæ ¼"===t.result?"pass":"fail"])},e.toDisplayString(t.result),3),e.createElementVNode("text",{class:"test-val"},"æˆç»©ï¼š"+e.toDisplayString(t.testCount),1)])])))),128)),0===p.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-tip"},"æš‚æ— æµ‹è¯•è®°å½•")):e.createCommentVNode("",!0)]))]),e.createElementVNode("view",{class:"footer-actions"},[e.createElementVNode("button",{class:"action-btn outline",onClick:h},"è”ç³»å­¦ç”Ÿ"),e.createElementVNode("button",{class:"action-btn primary",onClick:k},"å¯¼å‡ºæ¡£æ¡ˆ")])]))}},[["__scopeId","data-v-ecd2be69"]]),B=c({__name:"tasks",setup(a){const s=e.ref(0),n=e.ref([]),c=e.ref(1),o=e.ref(20),i=e.ref(0),r=e.ref(!1),m=async()=>{if(!r.value){r.value=!0;try{const e=0===s.value?"active":"ended",t=await(e=>{let t="";if(e){const a=[];e.page&&a.push(`page=${e.page}`),e.size&&a.push(`size=${e.size}`),e.status&&a.push(`status=${e.status}`),a.length>0&&(t=`?${a.join("&")}`)}return d({url:`/teacher/tasks${t}`,method:"GET"})})({page:c.value,size:o.value,status:e});if(t.items){const e=new Date,a=t.items.map((t=>{const a=new Date(t.deadline)<e;let l="è®­ç»ƒ";"test"===t.type?l="è€ƒæ ¸":"run"===t.type&&(l="æ—¥å¸¸");const s=t.completed_count||0,n=t.total_students||0,c=n>0?Math.round(s/n*100):0;return{id:t.id,title:t.title,type:l,desc:t.description||(t.min_distance?`ç›®æ ‡è·ç¦»: ${t.min_distance}km`:"æ— å…·ä½“æè¿°"),status:a?"å·²ç»“æŸ":"è¿›è¡Œä¸­",completed:s,total:n,percent:c,deadline:t.deadline?t.deadline.split("T")[0]:"æ— "}}));1===c.value?n.value=a:n.value=[...n.value,...a],i.value=t.total}}catch(e){t("error","at pages/teacher/tasks/tasks.vue:163",e),uni.showToast({title:"åŠ è½½ä»»åŠ¡å¤±è´¥",icon:"none"})}finally{r.value=!1}}};e.watch(s,(()=>{c.value=1,n.value=[],m()})),l((()=>{c.value=1,m()}));const u=e.computed((()=>0===s.value?i.value:0)),v=e.computed((()=>i.value)),p=e.computed((()=>{if(0===n.value.length)return 0;const e=n.value.reduce(((e,t)=>e+t.percent),0);return Math.round(e/n.value.length)})),E=e.computed((()=>n.value)),N=e=>{if(!e||"æ— "===e)return!1;const t=new Date(e),a=new Date,l=Math.abs(t-a);return Math.ceil(l/864e5)<=3&&t>a},g=e=>{uni.showModal({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦åˆ é™¤ä»»åŠ¡"${e.title}"å—ï¼Ÿ`,success:async a=>{if(a.confirm)try{await(l=e.id,d({url:`/teacher/tasks/${l}`,method:"DELETE"})),uni.showToast({title:"åˆ é™¤æˆåŠŸ"}),c.value=1,m()}catch(s){t("error","at pages/teacher/tasks/tasks.vue:255",s),uni.showToast({title:"åˆ é™¤å¤±è´¥",icon:"none"})}var l}})},V=()=>{uni.navigateTo({url:"/pages/teacher/tasks/create"})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"tasks-page"},[e.createElementVNode("view",{class:"dashboard-header"},[e.createElementVNode("view",{class:"header-top"},[e.createElementVNode("text",{class:"page-title"},"ä»»åŠ¡ç®¡ç†"),e.createElementVNode("view",{class:"header-actions"},[e.createElementVNode("view",{class:"icon-btn search"},[e.createElementVNode("text",{class:"iconfont"},"ğŸ”")])])]),e.createElementVNode("view",{class:"stats-card"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-num"},e.toDisplayString(u.value),1),e.createElementVNode("text",{class:"stat-label"},"è¿›è¡Œä¸­")]),e.createElementVNode("view",{class:"stat-divider"}),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-num"},e.toDisplayString(p.value)+"%",1),e.createElementVNode("text",{class:"stat-label"},"å¹³å‡å®Œæˆç‡")]),e.createElementVNode("view",{class:"stat-divider"}),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-num"},e.toDisplayString(v.value),1),e.createElementVNode("text",{class:"stat-label"},"ç´¯è®¡ä»»åŠ¡")])])]),e.createElementVNode("view",{class:"tab-container"},[e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:0===s.value}]),onClick:a[0]||(a[0]=e=>s.value=0)},[e.createTextVNode(" è¿›è¡Œä¸­ "),0===s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"tab-line"})):e.createCommentVNode("",!0)],2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:1===s.value}]),onClick:a[1]||(a[1]=e=>s.value=1)},[e.createTextVNode(" å†å²è®°å½• "),1===s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"tab-line"})):e.createCommentVNode("",!0)],2)]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"task-list",style:e.normalizeStyle({height:"calc(100vh - 380rpx)"})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(E.value,((t,l)=>{return e.openBlock(),e.createElementBlock("view",{class:"task-card",key:l,onClick:e=>(e=>{uni.navigateTo({url:`/pages/teacher/tasks/detail?id=${e.id}`})})(t)},[e.createElementVNode("view",{class:"card-header"},[e.createElementVNode("view",{class:"tag-row"},[e.createElementVNode("view",{class:e.normalizeClass(["type-tag",(s=t.type,{"è€ƒæ ¸":"tag-red","æ—¥å¸¸":"tag-green","è®­ç»ƒ":"tag-blue"}[s]||"tag-gray")])},e.toDisplayString(t.type),3),e.createElementVNode("view",{class:e.normalizeClass(["deadline-tag",{urgent:N(t.deadline)}])}," ğŸ“… "+e.toDisplayString(t.deadline)+" æˆªæ­¢ ",3)]),e.createElementVNode("view",{class:"more-btn",onClick:e.withModifiers((e=>(e=>{uni.showActionSheet({itemList:["ç¼–è¾‘ä»»åŠ¡","åˆ é™¤ä»»åŠ¡"],itemColor:"#000000",success:async t=>{0===t.tapIndex?uni.showToast({title:"ç¼–è¾‘åŠŸèƒ½å¼€å‘ä¸­",icon:"none"}):1===t.tapIndex&&g(e)}})})(t)),["stop"])},"...",8,["onClick"])]),e.createElementVNode("view",{class:"card-content"},[e.createElementVNode("text",{class:"task-title"},e.toDisplayString(t.title),1),e.createElementVNode("text",{class:"task-desc"},e.toDisplayString(t.desc),1)]),e.createElementVNode("view",{class:"card-progress"},[e.createElementVNode("view",{class:"progress-info"},[e.createElementVNode("text",{class:"info-text"},[e.createTextVNode("å®Œæˆåº¦ "),e.createElementVNode("text",{class:"highlight"},e.toDisplayString(t.percent)+"%",1)]),e.createElementVNode("text",{class:"info-text sub"},e.toDisplayString(t.completed)+"/"+e.toDisplayString(t.total)+"äºº",1)]),e.createElementVNode("view",{class:"progress-track"},[e.createElementVNode("view",{class:"progress-bar",style:e.normalizeStyle({width:t.percent+"%"})},null,4)])]),e.createElementVNode("view",{class:"card-footer",onClick:a[2]||(a[2]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"avatars"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(3,(t=>e.createElementVNode("view",{class:"avatar",key:t,style:e.normalizeStyle({left:20*(t-1)+"rpx",zIndex:4-t})},null,4))),64)),e.createElementVNode("view",{class:"avatar-more",style:{left:"60rpx"}},"...")]),"è¿›è¡Œä¸­"===t.status?(e.openBlock(),e.createElementBlock("button",{key:0,class:"remind-btn",size:"mini",onClick:e=>{uni.showToast({title:"æé†’å·²å‘é€",icon:"success"})}}," ğŸ”” ä¸€é”®æé†’ ",8,["onClick"])):e.createCommentVNode("",!0)])],8,["onClick"]);var s})),128)),0===E.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("text",{class:"empty-text"},"æš‚æ— ä»»åŠ¡æ•°æ®")])):e.createCommentVNode("",!0),e.createElementVNode("view",{style:{height:"120rpx"}})],4),e.createElementVNode("view",{class:"fab-btn",onClick:V},[e.createElementVNode("text",{class:"fab-icon"},"+"),e.createElementVNode("text",{class:"fab-text"},"å‘å¸ƒä»»åŠ¡")])]))}},[["__scopeId","data-v-98a8d695"]]),C={__name:"detail",setup(a){const l=e.ref(null),n=e.ref(!0),c=e.ref({id:0,title:"",status:"",statusText:"",dueDate:"",requirements:[],completedCount:0,totalCount:0}),o=e.ref([]),i=e.ref("all"),r=e.computed((()=>0===c.value.totalCount?0:Math.round(c.value.completedCount/c.value.totalCount*100))),m=e.computed((()=>"all"===i.value?o.value:o.value.filter((e=>e.status===i.value)))),u=async()=>{if(l.value){n.value=!0;try{const e=await(e=>d({url:`/teacher/tasks/${e}`,method:"GET"}))(l.value),t=[];"run"===e.type?(t.push("ä»»åŠ¡ç±»å‹: è·‘æ­¥ä»»åŠ¡"),e.min_distance&&t.push(`æœ€ä½è·ç¦»: ${e.min_distance} km`),e.min_duration&&t.push(`æœ€ä½æ—¶é•¿: ${e.min_duration} åˆ†é’Ÿ`)):(t.push("ä»»åŠ¡ç±»å‹: ä½“æµ‹ä»»åŠ¡"),e.min_count&&t.push(`æœ€ä½æ¬¡æ•°: ${e.min_count} æ¬¡`)),e.description&&t.push(`å¤‡æ³¨: ${e.description}`);const a=new Date,s=e.deadline?new Date(e.deadline):null;let i="ongoing",r="è¿›è¡Œä¸­";s&&s<a&&(i="ended",r="å·²ç»“æŸ"),c.value={id:e.id,title:e.title,status:i,statusText:r,dueDate:e.deadline?e.deadline.replace("T"," "):"æ— é™åˆ¶",requirements:t,completedCount:e.completed_count,totalCount:e.total_students};const m=e.student_statuses||[];o.value=m.map((e=>({id:e.student_id,name:e.student_name,studentId:`ID:${e.student_id}`,status:"completed"===e.status?"completed":"uncompleted",statusText:"completed"===e.status?"å·²å®Œæˆ":"æœªå®Œæˆ",metricValue:e.metric_value,avatar:""})))}catch(e){t("error","at pages/teacher/tasks/detail.vue:179",e),uni.showToast({title:"åŠ è½½å¤±è´¥",icon:"none"})}finally{n.value=!1}}};return s((e=>{e.id&&(l.value=e.id,u())})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header-card"},[e.createElementVNode("view",{class:"title-row"},[e.createElementVNode("text",{class:"task-title"},e.toDisplayString(c.value.title),1),e.createElementVNode("view",{class:e.normalizeClass(["status-tag",c.value.status])},e.toDisplayString(c.value.statusText),3)]),e.createElementVNode("text",{class:"due-date"},"æˆªæ­¢æ—¥æœŸï¼š"+e.toDisplayString(c.value.dueDate),1)]),e.createElementVNode("view",{class:"section-card"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"ä»»åŠ¡è¦æ±‚")]),e.createElementVNode("view",{class:"requirements-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value.requirements,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"req-item",key:a},[e.createElementVNode("text",{class:"dot"},"â€¢"),e.createElementVNode("text",{class:"req-text"},e.toDisplayString(t),1)])))),128))])]),e.createElementVNode("view",{class:"section-card"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"å®Œæˆè¿›åº¦"),e.createElementVNode("text",{class:"progress-stats"},e.toDisplayString(c.value.completedCount)+"/"+e.toDisplayString(c.value.totalCount)+" äºº",1)]),e.createElementVNode("view",{class:"progress-box"},[e.createElementVNode("view",{class:"progress-bar"},[e.createElementVNode("view",{class:"progress-fill",style:e.normalizeStyle({width:r.value+"%"})},null,4)]),e.createElementVNode("text",{class:"percentage-text"},e.toDisplayString(r.value)+"%",1)])]),e.createElementVNode("view",{class:"section-card"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"å‚ä¸æƒ…å†µ"),e.createElementVNode("view",{class:"filter-tabs"},[e.createElementVNode("text",{class:e.normalizeClass(["tab-item",{active:"all"===i.value}]),onClick:a[0]||(a[0]=e=>i.value="all")},"å…¨éƒ¨",2),e.createElementVNode("text",{class:e.normalizeClass(["tab-item",{active:"uncompleted"===i.value}]),onClick:a[1]||(a[1]=e=>i.value="uncompleted")},"æœªå®Œæˆ",2)])]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"student-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value,(t=>(e.openBlock(),e.createElementBlock("view",{class:"student-item",key:t.id,onClick:e=>(e=>{uni.navigateTo({url:`/pages/teacher/approve/student-detail?studentId=${e.id}&studentName=${e.name}`})})(t)},[e.createElementVNode("view",{class:"student-info"},[e.createElementVNode("image",{class:"avatar",src:t.avatar||"/static/avatar.png",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"info-col"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"id"},e.toDisplayString(t.studentId),1),t.metricValue&&"-"!==t.metricValue?(e.openBlock(),e.createElementBlock("text",{key:0,class:"metric-val"},"æˆç»©: "+e.toDisplayString(t.metricValue),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"status-col"},[e.createElementVNode("text",{class:e.normalizeClass(["status-text",t.status])},e.toDisplayString(t.statusText),3),"uncompleted"===t.status?(e.openBlock(),e.createElementBlock("button",{key:0,class:"remind-btn",size:"mini",onClick:e.withModifiers((e=>(e=>{uni.showToast({title:`å·²å‘é€æé†’ç»™ ${e.name}`,icon:"success"})})(t)),["stop"])},"æé†’",8,["onClick"])):e.createCommentVNode("",!0)])],8,["onClick"])))),128))])])]))}},D=c({__name:"create",setup(a){const l=["run","test"],s=["è·‘æ­¥ä»»åŠ¡","ä½“èƒ½æµ‹è¯•"],n=e.ref(["all"]),c=e.ref(["å…¨å‘˜"]),o=e.ref([]),i=e.ref({title:"",type:"",typeLabel:"",distance:"",deadline:"",target:"all",targetLabel:"å…¨å‘˜",description:""});e.onMounted((()=>{r()}));const r=async()=>{try{const e=await d({url:"/teacher/classes"});o.value=e,c.value=["å…¨å‘˜",...e.map((e=>`ç­çº§: ${e.name}`))],n.value=["all",...e.map((e=>e.id))]}catch(e){t("error","at pages/teacher/tasks/create.vue:89","Fetch classes failed",e)}},m=e=>{const t=e.detail.value;i.value.type=l[t],i.value.typeLabel=s[t]},u=e=>{i.value.deadline=e.detail.value},v=e=>{const t=e.detail.value;i.value.target=n.value[t],i.value.targetLabel=c.value[t]},p=async()=>{if(!i.value.title||!i.value.type||!i.value.deadline)return uni.showToast({title:"è¯·å®Œå–„ä»»åŠ¡ä¿¡æ¯",icon:"none"});uni.showLoading({title:"å‘å¸ƒä¸­..."});try{const t={title:i.value.title,type:i.value.type,min_distance:"run"===i.value.type?Number(i.value.distance):0,min_duration:0,min_count:0,deadline:new Date(i.value.deadline).toISOString(),description:i.value.description,target_group:"all"===i.value.target?"all":null,class_id:"number"==typeof i.value.target?i.value.target:null};await(e=t,d({url:"/teacher/tasks",method:"POST",data:e})),uni.hideLoading(),uni.showToast({title:"ä»»åŠ¡å‘å¸ƒæˆåŠŸ",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),1500)}catch(a){uni.hideLoading(),t("error","at pages/teacher/tasks/create.vue:139",a)}var e};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"create-task-page"},[e.createElementVNode("view",{class:"form-card"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"ä»»åŠ¡æ ‡é¢˜"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[0]||(a[0]=e=>i.value.title=e),placeholder:"ä¾‹å¦‚ï¼šæœ¬å‘¨5å…¬é‡Œè€åŠ›è·‘"},null,512),[[e.vModelText,i.value.title]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"ä»»åŠ¡ç±»å‹"),e.createElementVNode("picker",{mode:"selector",range:s,onChange:m},[e.createElementVNode("view",{class:"picker-box"},[e.createElementVNode("text",null,e.toDisplayString(i.value.typeLabel||"è¯·é€‰æ‹©ä»»åŠ¡ç±»å‹"),1),e.createElementVNode("text",{class:"arrow"},">")])],32)]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"ç›®æ ‡è·ç¦» (km)"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"digit","onUpdate:modelValue":a[1]||(a[1]=e=>i.value.distance=e),placeholder:"0.0"},null,512),[[e.vModelText,i.value.distance]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"æˆªæ­¢æ—¥æœŸ"),e.createElementVNode("picker",{mode:"date",onChange:u},[e.createElementVNode("view",{class:"picker-box"},[e.createElementVNode("text",null,e.toDisplayString(i.value.deadline||"è¯·é€‰æ‹©æˆªæ­¢æ—¥æœŸ"),1),e.createElementVNode("text",{class:"arrow"},">")])],32)]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"æŒ‡æ´¾å¯¹è±¡"),e.createElementVNode("picker",{mode:"selector",range:c.value,onChange:v},[e.createElementVNode("view",{class:"picker-box"},[e.createElementVNode("text",null,e.toDisplayString(i.value.targetLabel||"å…¨å‘˜"),1),e.createElementVNode("text",{class:"arrow"},">")])],40,["range"])]),e.createElementVNode("view",{class:"form-item vertical"},[e.createElementVNode("text",{class:"label"},"ä»»åŠ¡è¯´æ˜"),e.withDirectives(e.createElementVNode("textarea",{class:"textarea","onUpdate:modelValue":a[2]||(a[2]=e=>i.value.description=e),placeholder:"è¯·è¾“å…¥ä»»åŠ¡çš„å…·ä½“è¦æ±‚å’Œæ³¨æ„äº‹é¡¹..."},null,512),[[e.vModelText,i.value.description]])])]),e.createElementVNode("view",{class:"footer-btn"},[e.createElementVNode("button",{class:"submit-btn",onClick:p},"å‘å¸ƒä»»åŠ¡")])]))}},[["__scopeId","data-v-f83d9947"]]),T={__name:"exceptions",setup(t){const a=e.ref("all"),l=e.ref([{id:1,type:"heart_rate",typeText:"å¿ƒç‡è¿‡é«˜",typeClass:"tag-red",studentName:"å¼ ä¸‰",studentId:"2023001",time:"10:30",value:"195 bpm",standard:"60-180 bpm",description:"è·‘æ­¥è¿‡ç¨‹ä¸­æŒç»­3åˆ†é’Ÿå¿ƒç‡è¶…è¿‡å®‰å…¨é˜ˆå€¼ï¼Œå»ºè®®æš‚åœè®­ç»ƒå¹¶æ£€æŸ¥èº«ä½“çŠ¶å†µã€‚",level:"urgent"},{id:2,type:"pace",typeText:"é…é€Ÿå¼‚å¸¸",typeClass:"tag-orange",studentName:"æå››",studentId:"2023002",time:"10:45",value:"2'30\"/km",standard:"4'00\"-8'00\"/km",description:"çŸ­æ—¶é—´å†…é…é€Ÿæå¿«ï¼Œç–‘ä¼¼éª‘è½¦æˆ–æ•°æ®æ¼‚ç§»ã€‚",level:"normal"},{id:3,type:"location",typeText:"è½¨è¿¹å¼‚å¸¸",typeClass:"tag-blue",studentName:"ç‹äº”",studentId:"2023003",time:"09:15",value:"ç›´çº¿ç©¿è¶Š",standard:"è¿ç»­è½¨è¿¹",description:"è½¨è¿¹ç‚¹ä¹‹é—´è·ç¦»è¿‡å¤§ï¼Œä¸”æ— ä¸­é—´è·¯å¾„ï¼Œç–‘ä¼¼GPSä¿¡å·ä¸¢å¤±æˆ–ä½œå¼Šã€‚",level:"normal"}]),s=e.computed((()=>l.value.length)),n=e.ref(5),c=e.computed((()=>"all"===a.value?l.value:l.value.filter((e=>e.level===a.value))));return(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"page-title"},"å¼‚å¸¸å¤„ç†"),e.createElementVNode("view",{class:"stats-row"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-num"},e.toDisplayString(s.value),1),e.createElementVNode("text",{class:"stat-desc"},"å¾…å¤„ç†")]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-num"},e.toDisplayString(n.value),1),e.createElementVNode("text",{class:"stat-desc"},"ä»Šæ—¥æ–°å¢")])])]),e.createElementVNode("view",{class:"filter-bar"},[e.createElementVNode("text",{class:e.normalizeClass(["filter-item",{active:"all"===a.value}]),onClick:o[0]||(o[0]=e=>a.value="all")},"å…¨éƒ¨",2),e.createElementVNode("text",{class:e.normalizeClass(["filter-item",{active:"urgent"===a.value}]),onClick:o[1]||(o[1]=e=>a.value="urgent")},"ç´§æ€¥",2),e.createElementVNode("text",{class:e.normalizeClass(["filter-item",{active:"normal"===a.value}]),onClick:o[2]||(o[2]=e=>a.value="normal")},"ä¸€èˆ¬",2)]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"alert-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"alert-card",key:t.id},[e.createElementVNode("view",{class:"card-header"},[e.createElementVNode("view",{class:"header-left"},[e.createElementVNode("view",{class:e.normalizeClass(["type-tag",t.typeClass])},e.toDisplayString(t.typeText),3),e.createElementVNode("text",{class:"student-name"},e.toDisplayString(t.studentName),1),e.createElementVNode("text",{class:"student-id"},e.toDisplayString(t.studentId),1)]),e.createElementVNode("text",{class:"time"},e.toDisplayString(t.time),1)]),e.createElementVNode("view",{class:"card-body"},[e.createElementVNode("view",{class:"data-row"},[e.createElementVNode("text",{class:"label"},"å¼‚å¸¸æ•°æ®ï¼š"),e.createElementVNode("text",{class:"value highlight"},e.toDisplayString(t.value),1),e.createElementVNode("text",{class:"standard"},"ï¼ˆæ ‡å‡†èŒƒå›´ï¼š"+e.toDisplayString(t.standard)+"ï¼‰",1)]),e.createElementVNode("view",{class:"desc-box"},[e.createElementVNode("text",{class:"desc-title"},"å¼‚å¸¸è¯´æ˜ï¼š"),e.createElementVNode("text",{class:"desc-content"},e.toDisplayString(t.description),1)])]),e.createElementVNode("view",{class:"card-footer"},[e.createElementVNode("button",{class:"action-btn ignore",size:"mini",onClick:e=>{return a=t.id,void uni.showModal({title:"ç¡®è®¤å¿½ç•¥",content:"å¿½ç•¥åè¯¥å¼‚å¸¸å°†ä¸å†æé†’ï¼Œç¡®è®¤æ“ä½œï¼Ÿ",success:e=>{e.confirm&&(l.value=l.value.filter((e=>e.id!==a)),uni.showToast({title:"å·²å¿½ç•¥",icon:"none"}))}});var a}},"å¿½ç•¥",8,["onClick"]),e.createElementVNode("button",{class:"action-btn notify",size:"mini",onClick:e=>(e=>{uni.showToast({title:`å·²å‘é€é€šçŸ¥ç»™ ${e.studentName}`,icon:"success"})})(t)},"é€šçŸ¥å­¦ç”Ÿ",8,["onClick"]),e.createElementVNode("button",{class:"action-btn handle",size:"mini",onClick:e=>(e=>{uni.showActionSheet({itemList:["æ ‡è®°ä¸ºæ— æ•ˆæˆç»©","æ ‡è®°ä¸ºè®¾å¤‡æ•…éšœ","è¦æ±‚é‡æµ‹"],success:t=>{uni.showToast({title:`å·²æ ‡è®°ä¸ºï¼š${["æ— æ•ˆæˆç»©","è®¾å¤‡æ•…éšœ","é‡æµ‹"][t.tapIndex]}`,icon:"success"}),l.value=l.value.filter((t=>t.id!==e.id))}})})(t)},"å¤„ç†",8,["onClick"])])])))),128)),0===c.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("text",{class:"empty-text"},"æš‚æ— å¼‚å¸¸æ•°æ®")])):e.createCommentVNode("",!0)])]))}},_=c({__name:"tests",setup(t){const a=e.ref("live"),l=e.ref([{name:"å¼ ä¼Ÿ",action:"å¼•ä½“å‘ä¸Š",currentScore:8,isAbnormal:!1,confidence:98},{name:"æå¼º",action:"ä»°å§èµ·å",currentScore:24,isAbnormal:!0,confidence:85},{name:"ç‹èŠ³",action:"æ·±è¹²",currentScore:15,isAbnormal:!1,confidence:96},{name:"èµµæ°",action:"ä¿¯å§æ’‘",currentScore:12,isAbnormal:!1,confidence:99}]),s=e.ref([{name:"çˆ†å‘åŠ›",val:85,color:"#ff6b6b"},{name:"è€åŠ›",val:72,color:"#4dabf7"},{name:"æŸ”éŸ§æ€§",val:68,color:"#ffd43b"},{name:"åè°ƒæ€§",val:90,color:"#20C997"},{name:"æ ¸å¿ƒåŠ›é‡",val:78,color:"#a55eea"}]),n=e.ref([{label:"ä¼˜ç§€",value:15,percent:30,color:"#20C997"},{label:"è‰¯å¥½",value:45,percent:60,color:"#4dabf7"},{label:"åŠæ ¼",value:30,percent:45,color:"#ffd43b"},{label:"ä¸åŠæ ¼",value:10,percent:20,color:"#ff6b6b"}]),c=e.ref([{name:"1000ç±³è·‘",rate:85},{name:"å¼•ä½“å‘ä¸Š",rate:62},{name:"ç«‹å®šè·³è¿œ",rate:94},{name:"åä½ä½“å‰å±ˆ",rate:78}]),o=e.ref([{date:"2026-05-18",testName:"å…¨å‘˜ä½“èƒ½æ‘¸åº•æµ‹è¯•",count:128,passRate:92},{date:"2026-05-10",testName:"åŠ›é‡ä¸“é¡¹è€ƒæ ¸",count:45,passRate:88},{date:"2026-04-28",testName:"è€åŠ›è·‘æµ‹è¯•",count:128,passRate:76}]);return(t,i)=>(e.openBlock(),e.createElementBlock("view",{class:"teacher-test-page"},[e.createElementVNode("view",{class:"header-tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"live"===a.value}]),onClick:i[0]||(i[0]=e=>a.value="live")},[e.createElementVNode("text",{class:"tab-title"},"å®æ—¶ç›‘æ§"),"live"===a.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"tab-indicator"})):e.createCommentVNode("",!0)],2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"analysis"===a.value}]),onClick:i[1]||(i[1]=e=>a.value="analysis")},[e.createElementVNode("text",{class:"tab-title"},"æ•°æ®åˆ†æ"),"analysis"===a.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"tab-indicator"})):e.createCommentVNode("",!0)],2),e.createElementVNode("view",{class:e.normalizeClass(["tab-item",{active:"history"===a.value}]),onClick:i[2]||(i[2]=e=>a.value="history")},[e.createElementVNode("text",{class:"tab-title"},"å†å²å›é¡¾"),"history"===a.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"tab-indicator"})):e.createCommentVNode("",!0)],2)]),"live"===a.value?(e.openBlock(),e.createElementBlock("scroll-view",{key:0,"scroll-y":"",class:"content-area"},[e.createElementVNode("view",{class:"live-card"},[e.createElementVNode("view",{class:"live-header"},[e.createElementVNode("text",{class:"live-title"},"å½“å‰æ­£åœ¨è¿›è¡Œçš„æµ‹è¯•"),e.createElementVNode("view",{class:"live-badge"},"AI è¯„åˆ†æ¥å…¥ä¸­")]),e.createElementVNode("view",{class:"student-live-grid"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"student-monitor-card",key:a},[e.createElementVNode("view",{class:"monitor-video-placeholder"},[e.createElementVNode("text",{class:"ai-overlay"},"AI Analyzing..."),e.createElementVNode("view",{class:"ai-bbox",style:e.normalizeStyle({borderColor:t.isAbnormal?"#ff6b6b":"#0f0"})},[e.createElementVNode("text",{class:"bbox-label"},e.toDisplayString(t.confidence)+"%",1)],4),e.createElementVNode("view",{class:"pose-skeleton"},[e.createElementVNode("view",{class:"bone head"}),e.createElementVNode("view",{class:"bone body"}),e.createElementVNode("view",{class:"bone arm-l"}),e.createElementVNode("view",{class:"bone arm-r"}),e.createElementVNode("view",{class:"bone leg-l"}),e.createElementVNode("view",{class:"bone leg-r"})]),e.createElementVNode("text",{class:"live-score"},e.toDisplayString(t.currentScore),1)]),e.createElementVNode("view",{class:"monitor-info"},[e.createElementVNode("text",{class:"s-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"s-action"},e.toDisplayString(t.action),1),t.isAbnormal?(e.openBlock(),e.createElementBlock("text",{key:0,class:"s-status warning"},"åŠ¨ä½œä¸æ ‡å‡†")):(e.openBlock(),e.createElementBlock("text",{key:1,class:"s-status good"},"åŠ¨ä½œæ ‡å‡†"))])])))),128))])])])):e.createCommentVNode("",!0),"analysis"===a.value?(e.openBlock(),e.createElementBlock("scroll-view",{key:1,"scroll-y":"",class:"content-area"},[e.createElementVNode("view",{class:"chart-card"},[e.createElementVNode("view",{class:"card-title"},"ç­çº§ä½“èƒ½ç»¼åˆæ¨¡å‹"),e.createElementVNode("view",{class:"skills-matrix"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"skill-row",key:a},[e.createElementVNode("text",{class:"skill-name"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:"skill-track"},[e.createElementVNode("view",{class:"skill-bar",style:e.normalizeStyle({width:t.val+"%",background:t.color})},null,4)]),e.createElementVNode("text",{class:"skill-val"},e.toDisplayString(t.val),1)])))),128))]),e.createElementVNode("view",{class:"analysis-summary"},[e.createElementVNode("text",{class:"summary-text"},[e.createTextVNode("ğŸ’¡ å»ºè®®åŠ å¼º "),e.createElementVNode("text",{class:"highlight"},"ä¸Šè‚¢åŠ›é‡"),e.createTextVNode(" ä¸“é¡¹è®­ç»ƒ")])])]),e.createElementVNode("view",{class:"chart-card"},[e.createElementVNode("view",{class:"card-title"},"ç­çº§æˆç»©åˆ†å¸ƒå¯¹æ¯”"),e.createElementVNode("view",{class:"bar-chart"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"bar-group",key:a},[e.createElementVNode("view",{class:"bar-col"},[e.createElementVNode("view",{class:"bar-fill",style:e.normalizeStyle({height:t.percent+"%",background:t.color})},null,4),e.createElementVNode("text",{class:"bar-val"},e.toDisplayString(t.value),1)]),e.createElementVNode("text",{class:"bar-label"},e.toDisplayString(t.label),1)])))),128))])]),e.createElementVNode("view",{class:"chart-card"},[e.createElementVNode("view",{class:"card-title"},"å„é¡¹ä½“èƒ½åˆæ ¼ç‡"),e.createElementVNode("view",{class:"progress-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"prog-item",key:a},[e.createElementVNode("view",{class:"prog-header"},[e.createElementVNode("text",{class:"prog-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"prog-val"},e.toDisplayString(t.rate)+"%",1)]),e.createElementVNode("view",{class:"prog-track"},[e.createElementVNode("view",{class:"prog-bar",style:e.normalizeStyle({width:t.rate+"%"})},null,4)])])))),128))])])])):e.createCommentVNode("",!0),"history"===a.value?(e.openBlock(),e.createElementBlock("scroll-view",{key:2,"scroll-y":"",class:"content-area"},[e.createElementVNode("view",{class:"history-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"history-item",key:a},[e.createElementVNode("view",{class:"h-left"},[e.createElementVNode("text",{class:"h-date"},e.toDisplayString(t.date),1),e.createElementVNode("text",{class:"h-name"},e.toDisplayString(t.testName),1)]),e.createElementVNode("view",{class:"h-right"},[e.createElementVNode("text",{class:"h-stat"},"å‚ä¸: "+e.toDisplayString(t.count)+"äºº",1),e.createElementVNode("text",{class:"h-stat"},"åˆæ ¼: "+e.toDisplayString(t.passRate)+"%",1),e.createElementVNode("text",{class:"arrow"},">")])])))),128))])])):e.createCommentVNode("",!0)]))}},[["__scopeId","data-v-02da4c10"]]),z={__name:"approve",setup(a){const s=e.ref([]),n=async()=>{try{const e=await(e=>{let t="";return e&&(t=`?page=${e.page}&size=${e.size}`),d({url:`/teacher/activities${t}`,method:"GET"})})({page:1,size:20});e&&e.items&&(s.value=e.items)}catch(e){t("error","at pages/teacher/approve/approve.vue:39",e),uni.showToast({title:"åŠ è½½å¾…å®¡æ‰¹æ´»åŠ¨å¤±è´¥",icon:"none"})}},c=async e=>{try{await(a=e,d({url:`/teacher/activity/${a}/approve`,method:"POST"})),uni.showToast({title:"å®¡æ‰¹æˆåŠŸ"}),n()}catch(l){t("error","at pages/teacher/approve/approve.vue:50",l),uni.showToast({title:"å®¡æ‰¹å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•",icon:"none"})}var a};return l((()=>{n()})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"å¾…å®¡æ‰¹æ´»åŠ¨")]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,(t=>{var a,l;return e.openBlock(),e.createElementBlock("view",{class:"item",key:t.id,onClick:e=>(e=>{uni.navigateTo({url:`/pages/teacher/approve/student-detail?studentId=${e.user_id}&studentName=${e.student_name}`})})(t)},[e.createElementVNode("view",{class:"info"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(t.student_name),1),e.createElementVNode("view",{class:"desc-row"},["run"===t.type?(e.openBlock(),e.createElementBlock("text",{key:0,class:"desc"},"è·‘æ­¥ - "+e.toDisplayString((null==(a=t.metrics)?void 0:a.distance)?Number(t.metrics.distance).toFixed(2):0)+"km",1)):(e.openBlock(),e.createElementBlock("text",{key:1,class:"desc"},"ä½“æµ‹ - "+e.toDisplayString((null==(l=t.metrics)?void 0:l.count)?t.metrics.count:0)+"æ¬¡",1))]),e.createElementVNode("text",{class:"time"},e.toDisplayString(new Date(t.started_at).toLocaleString()),1)]),e.createElementVNode("button",{class:"btn",onClick:e.withModifiers((e=>c(t.id)),["stop"]),disabled:"approved"===t.status||"completed"===t.status,style:e.normalizeStyle({backgroundColor:"approved"===t.status||"completed"===t.status?"#ccc":"#20C997"})},e.toDisplayString("approved"===t.status||"completed"===t.status?"å·²é€šè¿‡":"é€šè¿‡"),13,["onClick","disabled"])],8,["onClick"])})),128)),0===s.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty"},"æš‚æ— å¾…å®¡æ‰¹æ´»åŠ¨")):e.createCommentVNode("",!0)])]))}},F={__name:"student-detail",setup(a){const l=e.ref(null),n=e.ref(""),c=e.ref([]),o=e.ref(!1),i=e.ref([]),m=e.ref(0),u=e.computed((()=>c.value.reduce(((e,t)=>{var a;return e+((null==(a=t.metrics)?void 0:a.distance)||0)}),0).toFixed(2))),v=e.computed((()=>{const e=c.value.reduce(((e,t)=>{var a;return e+((null==(a=t.metrics)?void 0:a.duration)||0)}),0);return Math.floor(e/60)})),p=async()=>{if(l.value)try{const e=await((e,t)=>d({url:`/teacher/student/${e}/activities`,method:"GET",data:t}))(l.value,{page:1,size:100});e&&e.items&&(c.value=e.items)}catch(e){t("error","at pages/teacher/approve/student-detail.vue:135",e),uni.showToast({title:"åŠ è½½å¤±è´¥",icon:"none"})}};s((e=>{e.studentId&&(l.value=e.studentId,n.value=e.studentName||"å­¦ç”Ÿ",p())}));const E=()=>{o.value=!1},N=()=>{0!==i.value.length&&(m.value=(m.value-1+i.value.length)%i.value.length)},g=()=>{0!==i.value.length&&(m.value=(m.value+1)%i.value.length)};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},e.toDisplayString(n.value)+" çš„è¿åŠ¨è®°å½•",1)]),e.createElementVNode("view",{class:"stats-card"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-num"},e.toDisplayString(u.value),1),e.createElementVNode("text",{class:"stat-label"},"æ€»é‡Œç¨‹(km)")]),e.createElementVNode("view",{class:"stat-divider"}),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-num"},e.toDisplayString(v.value),1),e.createElementVNode("text",{class:"stat-label"},"æ€»æ—¶é•¿(min)")]),e.createElementVNode("view",{class:"stat-divider"}),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"stat-num"},e.toDisplayString(c.value.length),1),e.createElementVNode("text",{class:"stat-label"},"æ€»æ¬¡æ•°")])]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value,(t=>{var a,l,s,n,c,d;return e.openBlock(),e.createElementBlock("view",{class:"item",key:t.id},[e.createElementVNode("view",{class:"info"},[e.createElementVNode("text",{class:"type"},e.toDisplayString("run"===t.type?"è·‘æ­¥":"ä½“æµ‹"),1),"test"===t.type||void 0!==(null==(a=t.metrics)?void 0:a.count)?(e.openBlock(),e.createElementBlock("text",{key:0,class:"desc"},e.toDisplayString((null==(l=t.metrics)?void 0:l.duration)?Math.floor(t.metrics.duration/60):0)+"åˆ†é’Ÿ | "+e.toDisplayString((null==(s=t.metrics)?void 0:s.count)?t.metrics.count:0)+"æ¬¡ ",1)):(e.openBlock(),e.createElementBlock("text",{key:1,class:"desc"},e.toDisplayString((null==(n=t.metrics)?void 0:n.distance)?Number(t.metrics.distance).toFixed(2):0)+"km | "+e.toDisplayString((null==(c=t.metrics)?void 0:c.duration)?Math.floor(t.metrics.duration/60):0)+"åˆ†é’Ÿ ",1)),e.createElementVNode("text",{class:"time"},e.toDisplayString(new Date(t.started_at).toLocaleString()),1),t.evidence&&t.evidence.length>0?(e.openBlock(),e.createElementBlock("view",{key:2,class:"evidence-area"},[e.createElementVNode("view",{class:"evidence-btn",onClick:e.withModifiers((e=>(e=>{if(!e||0===e.length)return;const t=e.map((e=>{const t=e.data_ref.startsWith("http")?e.data_ref:`${r}${e.data_ref}`;return{url:t,type:e.evidence_type?e.evidence_type:/\.(mp4|webm|ogg)$/i.test(t)?"video":"image"}})),a=t.filter((e=>"image"===e.type)).map((e=>e.url)),l=t.filter((e=>"video"===e.type)).map((e=>e.url));a.length>0&&0===l.length?uni.previewImage({urls:a,current:0}):l.length>0&&(i.value=l,m.value=0,o.value=!0)})(t.evidence)),["stop"])},[e.createElementVNode("text",{class:"btn-icon"},"ğŸ“·"),e.createTextVNode(" æŸ¥çœ‹åª’ä½“ ")],8,["onClick"])])):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:e.normalizeClass(["status-tag",t.status])},e.toDisplayString((d=t.status,{pending:"å¾…å®¡æ‰¹",approved:"å·²é€šè¿‡",rejected:"å·²é©³å›",completed:"å·²å®Œæˆ",finished:"å·²å®Œæˆ"}[d]||d)),3)])})),128)),0===c.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty"},"æš‚æ— è¿åŠ¨è®°å½•")):e.createCommentVNode("",!0)]),o.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"video-modal",onClick:E},[e.createElementVNode("view",{class:"video-content",onClick:a[0]||(a[0]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("video",{class:"video-player",src:i.value[m.value],controls:"",autoplay:""},null,8,["src"]),e.createElementVNode("view",{class:"video-actions"},[i.value.length>1?(e.openBlock(),e.createElementBlock("button",{key:0,size:"mini",onClick:N},"ä¸Šä¸€ä¸ª")):e.createCommentVNode("",!0),i.value.length>1?(e.openBlock(),e.createElementBlock("button",{key:1,size:"mini",onClick:g},"ä¸‹ä¸€ä¸ª")):e.createCommentVNode("",!0),e.createElementVNode("button",{size:"mini",onClick:E},"å…³é—­")])])])):e.createCommentVNode("",!0)]))}},I={__name:"class-list",setup(t){const a=e.ref([]),l=e.ref(!1),s=e.ref([]),n=e.ref([]),c=async()=>{try{const e=await d({url:"/teacher/classes"});a.value=e}catch(e){uni.showToast({title:"åŠ è½½å¤±è´¥",icon:"none"})}},o=async()=>{try{const e=await d({url:"/teacher/available_classes"});s.value=e,n.value=[],l.value=!0}catch(e){uni.showToast({title:"æ— æ³•è·å–å¯é€‰ç­çº§",icon:"none"})}},i=e=>{n.value=e.detail.value},r=async()=>{if(0!==n.value.length)try{const e=n.value.map((e=>parseInt(e)));await d({url:"/teacher/classes/bind",method:"POST",data:{class_ids:e}}),l.value=!1,c(),uni.showToast({title:"å…³è”æˆåŠŸ",icon:"success"})}catch(e){uni.showToast({title:"å…³è”å¤±è´¥: "+(e.message||"æœªçŸ¥é”™è¯¯"),icon:"none"})}};return e.onMounted((()=>{c()})),(t,m)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"ç­çº§ç®¡ç†"),e.createElementVNode("button",{class:"add-btn",size:"mini",type:"primary",onClick:o},"+ å…³è”ç­çº§")]),e.createElementVNode("view",{class:"class-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,(t=>(e.openBlock(),e.createElementBlock("view",{class:"class-item",key:t.id,onClick:e=>{return a=t.id,void uni.navigateTo({url:`/pages/teacher/class/class-detail?id=${a}`});var a}},[e.createElementVNode("view",{class:"info"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"count"},e.toDisplayString(t.student_count)+" äºº",1)]),e.createElementVNode("view",{class:"actions"},[e.createElementVNode("text",{class:"delete-btn",onClick:e.withModifiers((e=>(async e=>{uni.showModal({title:"ç¡®è®¤è§£ç»‘",content:`ç¡®å®šè¦ä¸å†ç®¡ç†ç­çº§ ${e.name} å—ï¼Ÿ\nï¼ˆç­çº§å’Œå­¦ç”Ÿæ•°æ®å°†ä¿ç•™ï¼‰`,success:async t=>{if(t.confirm)try{await d({url:`/teacher/classes/${e.id}`,method:"DELETE"}),c(),uni.showToast({title:"è§£ç»‘æˆåŠŸ",icon:"success"})}catch(a){uni.showToast({title:"è§£ç»‘å¤±è´¥",icon:"none"})}}})})(t)),["stop"])},"è§£ç»‘",8,["onClick"])])],8,["onClick"])))),128)),0===a.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-tip"},"æš‚æ— å…³è”ç­çº§ï¼Œè¯·å…³è”")):e.createCommentVNode("",!0)]),l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal-mask"},[e.createElementVNode("view",{class:"modal"},[e.createElementVNode("view",{class:"modal-title"},"å…³è”å·²æœ‰ç­çº§"),s.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"checkbox-list"},[e.createElementVNode("checkbox-group",{onChange:i},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,(t=>(e.openBlock(),e.createElementBlock("label",{class:"checkbox-item",key:t.id},[e.createElementVNode("checkbox",{value:String(t.id),checked:n.value.includes(String(t.id))},null,8,["value","checked"]),e.createElementVNode("text",{class:"checkbox-label"},e.toDisplayString(t.name)+" ("+e.toDisplayString(t.student_count)+"äºº)",1)])))),128))],32)])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-tip"}," æ²¡æœ‰å¯å…³è”çš„ç­çº§ï¼ˆæ‰€æœ‰ç­çº§å‡å·²æœ‰è€å¸ˆï¼‰ ")),e.createElementVNode("view",{class:"modal-btns"},[e.createElementVNode("button",{size:"mini",onClick:m[0]||(m[0]=e=>l.value=!1)},"å–æ¶ˆ"),e.createElementVNode("button",{size:"mini",type:"primary",onClick:r,disabled:0===n.value.length},"ç¡®å®š",8,["disabled"])])])])):e.createCommentVNode("",!0)]))}},M={__name:"class-detail",setup(a){const l=e.ref(null),n=e.ref(null),c=e.ref(null),o=e.ref([]),i=e.ref(!1),r=e.ref(""),m=e.ref([]),u=e.ref([]),v=e.ref(-1),p=e.ref(""),E=e.ref("");s((e=>{e.id&&(l.value=e.id,g(),N())}));const N=async()=>{try{const e=await d({url:"/teacher/tasks",data:{size:100}});m.value=e.items,u.value=[{title:"å…¨éƒ¨ä»»åŠ¡",id:null},...e.items]}catch(e){t("error","at pages/teacher/class/class-detail.vue:107","Fetch tasks failed",e)}},g=async()=>{if(l.value)try{const e=await d({url:`/teacher/classes/${l.value}`});n.value=e,await V()}catch(e){uni.showToast({title:"åŠ è½½å¤±è´¥",icon:"none"})}},V=async()=>{if(l.value)try{const e={};if(v.value>-1){const t=u.value[v.value].id;t&&(e.task_id=t)}p.value&&(e.start_date=new Date(p.value).toISOString()),E.value&&(e.end_date=new Date(E.value).toISOString());const t=await d({url:`/teacher/classes/${l.value}/stats`,data:e});c.value=t,o.value=t.student_stats}catch(e){uni.showToast({title:"ç»Ÿè®¡åŠ è½½å¤±è´¥",icon:"none"})}},w=e=>{v.value=e.detail.value},h=e=>{p.value=e.detail.value},k=e=>{E.value=e.detail.value},y=async()=>{if(r.value)try{await d({url:`/teacher/classes/${l.value}/students`,method:"POST",data:{phone:r.value}}),i.value=!1,r.value="",g(),uni.showToast({title:"æ·»åŠ æˆåŠŸ",icon:"success"})}catch(e){uni.showToast({title:"æ·»åŠ å¤±è´¥: "+(e.message||"æ‰¾ä¸åˆ°å­¦ç”Ÿ"),icon:"none"})}};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"header"},[e.createElementVNode("view",null,[e.createElementVNode("text",{class:"title"},e.toDisplayString(n.value.name),1),e.createElementVNode("text",{class:"sub-title"},e.toDisplayString(n.value.student_count)+" åå­¦ç”Ÿ",1)]),e.createElementVNode("button",{size:"mini",type:"primary",onClick:a[0]||(a[0]=e=>i.value=!0)},"+ æ·»åŠ å­¦ç”Ÿ")])):e.createCommentVNode("",!0),c.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"stats-card"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"val"},e.toDisplayString(c.value.total_distance?c.value.total_distance.toFixed(1):"0.0"),1),e.createElementVNode("text",{class:"label"},"æ€»é‡Œç¨‹ (km)")]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"val"},e.toDisplayString(c.value.total_activities),1),e.createElementVNode("text",{class:"label"},"æ€»è¿åŠ¨æ¬¡æ•°")])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"filter-card"},[e.createElementVNode("view",{class:"filter-row"},[e.createElementVNode("picker",{class:"filter-picker",range:u.value,"range-key":"title",onChange:w},[e.createElementVNode("view",{class:"picker-view"},[e.createElementVNode("text",null,"ä»»åŠ¡ç­›é€‰:"),e.createElementVNode("text",{class:"picker-val"},e.toDisplayString(v.value>-1?u.value[v.value].title:"å…¨éƒ¨ä»»åŠ¡"),1)])],40,["range"])]),e.createElementVNode("view",{class:"filter-row date-row"},[e.createElementVNode("picker",{mode:"date",onChange:h},[e.createElementVNode("view",{class:"date-picker"},e.toDisplayString(p.value||"å¼€å§‹æ—¥æœŸ"),1)],32),e.createElementVNode("text",{class:"sep"},"è‡³"),e.createElementVNode("picker",{mode:"date",onChange:k},[e.createElementVNode("view",{class:"date-picker"},e.toDisplayString(E.value||"ç»“æŸæ—¥æœŸ"),1)],32)]),e.createElementVNode("button",{class:"filter-btn",type:"default",size:"mini",onClick:V},"åº”ç”¨ç­›é€‰")]),e.createElementVNode("view",{class:"list-title"},"å­¦ç”Ÿåˆ—è¡¨"),e.createElementVNode("view",{class:"student-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,(t=>(e.openBlock(),e.createElementBlock("view",{class:"student-item",key:t.id,onClick:e=>{return a=t.id,void uni.navigateTo({url:`/pages/teacher/students/detail?id=${a}`});var a}},[e.createElementVNode("view",{class:"info"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"detail"},"é‡Œç¨‹: "+e.toDisplayString(t.distance?t.distance.toFixed(1):"0.0")+"km | æ¬¡æ•°: "+e.toDisplayString(t.count),1)]),e.createElementVNode("text",{class:"remove-btn",onClick:e.withModifiers((e=>(async e=>{e.id&&uni.showModal({title:"ç¡®è®¤ç§»é™¤",content:`ç¡®å®šå°† ${e.name} ç§»å‡ºç­çº§å—ï¼Ÿ`,success:async t=>{if(t.confirm)try{await d({url:`/teacher/classes/${l.value}/students/${e.id}`,method:"DELETE"}),g()}catch(a){uni.showToast({title:"ç§»é™¤å¤±è´¥",icon:"none"})}}})})(t)),["stop"])},"ç§»é™¤",8,["onClick"])],8,["onClick"])))),128)),0===o.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-tip"},"æš‚æ— å­¦ç”Ÿ")):e.createCommentVNode("",!0)]),i.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"modal-mask"},[e.createElementVNode("view",{class:"modal"},[e.createElementVNode("view",{class:"modal-title"},"æ·»åŠ å­¦ç”Ÿ"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[1]||(a[1]=e=>r.value=e),placeholder:"è¯·è¾“å…¥å­¦ç”Ÿæ‰‹æœºå·",type:"number"},null,512),[[e.vModelText,r.value]]),e.createElementVNode("view",{class:"modal-btns"},[e.createElementVNode("button",{size:"mini",onClick:a[2]||(a[2]=e=>i.value=!1)},"å–æ¶ˆ"),e.createElementVNode("button",{size:"mini",type:"primary",onClick:y},"ç¡®å®š")])])])):e.createCommentVNode("",!0)]))}},$=c({__name:"list",setup(t){const a=e.ref([{id:1,name:"äº”å››é’å¹´èŠ‚ç¯æ ¡è·‘",time:"5æœˆ4æ—¥ 07:00",location:"å—æ“åœº",status:"æŠ¥åä¸­",statusClass:"status-active",joined:128,image:""},{id:2,name:"å‘¨æœ«å¤œè·‘æ‰“å¡èµ›",time:"æœ¬å‘¨å…­ 19:00",location:"åŒ—ç”°å¾„åœº",status:"è¿›è¡Œä¸­",statusClass:"status-ing",joined:56,image:""},{id:3,name:"è­¦åŠ¡æŠ€èƒ½äº¤æµä¼š",time:"ä¸‹å‘¨ä¸‰ 14:00",location:"ä½“è‚²é¦†",status:"é¢„å‘Š",statusClass:"status-future",joined:30,image:""}]);return(t,l)=>(e.openBlock(),e.createElementBlock("view",{class:"activity-list-page"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"è·‘å›¢æ´»åŠ¨")]),e.createElementVNode("view",{class:"activity-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"activity-card",key:a,onClick:e=>(e=>{uni.navigateTo({url:`/pages/activity/detail?id=${e.id}&name=${e.name}`})})(t)},[e.createElementVNode("image",{class:"act-img",src:t.image||"/static/activity-placeholder.png",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"act-info"},[e.createElementVNode("text",{class:"act-name"},e.toDisplayString(t.name),1),e.createElementVNode("view",{class:"act-meta"},[e.createElementVNode("text",{class:"act-time"},"ğŸ“… "+e.toDisplayString(t.time),1),e.createElementVNode("text",{class:"act-location"},"ğŸ“ "+e.toDisplayString(t.location),1)]),e.createElementVNode("view",{class:e.normalizeClass(["act-status",t.statusClass])},[e.createElementVNode("text",null,e.toDisplayString(t.status),1),e.createElementVNode("text",{class:"join-count"},e.toDisplayString(t.joined)+"äººå·²æŠ¥å",1)],2)])],8,["onClick"])))),128))])]))}},[["__scopeId","data-v-43af4363"]]),L=c({__name:"detail",setup(t){const a=e.ref({name:"åŠ è½½ä¸­...",time:"å¾…å®š",location:"å¾…å®š",status:"æŠ¥åä¸­",joined:0,limit:100});s((e=>{e.name&&(a.value.name=e.name,a.value.time="2026å¹´5æœˆ4æ—¥ 07:00",a.value.location="å—æ“åœºä¸»å¸­å°å‰",a.value.joined=128,a.value.limit=200)}));const l=()=>{uni.showToast({title:"æŠ¥åæˆåŠŸï¼",icon:"success"})};return(t,s)=>(e.openBlock(),e.createElementBlock("view",{class:"activity-detail-page"},[e.createElementVNode("view",{class:"banner"},[e.createElementVNode("image",{class:"banner-img",src:"/static/activity-placeholder.png",mode:"aspectFill"}),e.createElementVNode("view",{class:"banner-overlay"},[e.createElementVNode("text",{class:"act-title"},e.toDisplayString(a.value.name),1),e.createElementVNode("text",{class:"act-status"},e.toDisplayString(a.value.status),1)])]),e.createElementVNode("view",{class:"content-card"},[e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"ğŸ“… æ—¶é—´"),e.createElementVNode("text",{class:"value"},e.toDisplayString(a.value.time),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"ğŸ“ åœ°ç‚¹"),e.createElementVNode("text",{class:"value"},e.toDisplayString(a.value.location),1)]),e.createElementVNode("view",{class:"info-row"},[e.createElementVNode("text",{class:"label"},"ğŸ‘¥ äººæ•°"),e.createElementVNode("text",{class:"value"},e.toDisplayString(a.value.joined)+" / "+e.toDisplayString(a.value.limit),1)]),e.createElementVNode("view",{class:"divider"}),e.createElementVNode("view",{class:"desc-section"},[e.createElementVNode("text",{class:"section-title"},"æ´»åŠ¨è¯¦æƒ…"),e.createElementVNode("text",{class:"desc-text"},"è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„æ´»åŠ¨è¯¦æƒ…é¡µé¢ã€‚åœ¨è¿™é‡Œï¼ŒåŒå­¦ä»¬å¯ä»¥æŸ¥çœ‹æ´»åŠ¨çš„å…·ä½“å®‰æ’ã€æ³¨æ„äº‹é¡¹ä»¥åŠå¥–åŠ±è§„åˆ™ã€‚å‚åŠ æ´»åŠ¨ä¸ä»…èƒ½é”»ç‚¼èº«ä½“ï¼Œè¿˜èƒ½ç»“è¯†æ›´å¤šå¿—åŒé“åˆçš„æœ‹å‹ã€‚")])]),e.createElementVNode("view",{class:"bottom-bar"},[e.createElementVNode("button",{class:"join-btn",onClick:l},"ç«‹å³æŠ¥å")])]))}},[["__scopeId","data-v-be5e94f4"]]),P=c({__name:"ai-police",setup(a){const l=e.ref(!1),s=e.ref(0),n=e.ref("å‡†å¤‡å°±ç»ª"),c=e.ref("normal"),o=e.ref(0),i=e.ref("Standing");let r=null;const d=()=>{l.value=!0,n.value="æ­£åœ¨æ£€æµ‹...",c.value="normal",s.value=0,u()},m=()=>{l.value=!1,n.value="è®­ç»ƒç»“æŸ",clearInterval(r),uni.showModal({title:"è®­ç»ƒç»“æŸ",content:`æœ¬æ¬¡è®­ç»ƒå…±å®Œæˆ ${s.value} æ¬¡ï¼Œæ˜¯å¦æŸ¥çœ‹ç»“æœï¼Ÿ`,confirmText:"æŸ¥çœ‹ç»“æœ",cancelText:"å–æ¶ˆ",success:e=>{e.confirm&&(uni.showLoading({title:"æ­£åœ¨ä¿å­˜..."}),setTimeout((()=>{uni.hideLoading(),uni.navigateTo({url:`/pages/result/result?mode=test&project=AIæ™ºèƒ½è®­ç»ƒ&count=${s.value}&duration=0`})}),800))}})},u=()=>{r=setInterval((()=>{o.value=(95+5*Math.random()).toFixed(1)}),1e3)},v=()=>{l&&(n.value="åŠ¨ä½œæ ‡å‡†",c.value="success",i.value="Squat Down",setTimeout((()=>{s.value++,i.value="Standing",n.value="æ­£åœ¨æ£€æµ‹...",c.value="normal"}),800))},p=e=>{l&&(n.value=`è­¦å‘Šï¼š${e}`,c.value="warn",o.value=(40*Math.random()).toFixed(1),uni.vibrateLong(),uni.showToast({title:`æ£€æµ‹åˆ°å¼‚å¸¸ï¼š${e}`,icon:"none",duration:2e3}),setTimeout((()=>{n.value="æ­£åœ¨æ£€æµ‹...",c.value="normal",o.value=98.5}),2e3))},E=e=>{t("error","at pages/ai-police/ai-police.vue:209","Camera Error:",e);let a="æ— æ³•è®¿é—®æ‘„åƒå¤´";"NotAllowedError"===e.name||"Permission denied"===e.message?a="æƒé™è¢«æ‹’ç»ï¼Œè¯·åœ¨è®¾ç½®ä¸­å…è®¸æ‘„åƒå¤´è®¿é—®":"NotFoundError"===e.name?a="æœªæ£€æµ‹åˆ°æ‘„åƒå¤´è®¾å¤‡":"NotSupportedError"===e.name&&(a="æµè§ˆå™¨ä¸æ”¯æŒè¯¥æ‘„åƒå¤´é…ç½®"),uni.showToast({title:a,icon:"none",duration:3e3})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"ai-police"},[e.createElementVNode("view",{class:"camera-area"},[e.createElementVNode("camera",{class:"real-camera","device-position":"front",flash:"off",onError:E},[e.createElementVNode("cover-view",{class:"camera-overlay"},[l.value?(e.openBlock(),e.createElementBlock("cover-view",{key:1,class:"skeleton-overlay"},[e.createElementVNode("cover-view",{class:"skeleton-box"})])):(e.openBlock(),e.createElementBlock("cover-view",{key:0,class:"camera-tip"},"è¯·å°†å…¨èº«ç½®äºæ‘„åƒå¤´åŒºåŸŸå†…")),l.value?(e.openBlock(),e.createElementBlock("cover-view",{key:2,class:"debug-info"}," ç½®ä¿¡åº¦: "+e.toDisplayString(o.value)+"% | å§¿æ€: "+e.toDisplayString(i.value),1)):e.createCommentVNode("",!0)])],32)]),e.createElementVNode("view",{class:"dashboard"},[e.createElementVNode("view",{class:"counter-box"},[e.createElementVNode("text",{class:"count-label"},"æœ‰æ•ˆè®¡æ•°"),e.createElementVNode("text",{class:"count-val"},e.toDisplayString(s.value),1)]),e.createElementVNode("view",{class:"status-box"},[e.createElementVNode("text",{class:"status-label"},"å½“å‰çŠ¶æ€"),e.createElementVNode("text",{class:e.normalizeClass(["status-val",c.value])},e.toDisplayString(n.value),3)])]),e.createElementVNode("view",{class:"controls"},[l.value?(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn-stop",onClick:m},"ç»“æŸè®­ç»ƒ")):(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn-start",onClick:d},"å¼€å§‹AIè®¡æ•°")),e.createElementVNode("view",{class:"simulation-tools"},[e.createElementVNode("text",{class:"tool-title"},"å¼€å‘è°ƒè¯•ï¼šæ¨¡æ‹Ÿåœºæ™¯"),e.createElementVNode("view",{class:"tool-btns"},[e.createElementVNode("button",{size:"mini",onClick:v},"æ¨¡æ‹Ÿæœ‰æ•ˆåŠ¨ä½œ"),e.createElementVNode("button",{size:"mini",onClick:a[0]||(a[0]=e=>p("é®æŒ¡"))},"æ¨¡æ‹Ÿé®æŒ¡"),e.createElementVNode("button",{size:"mini",onClick:a[1]||(a[1]=e=>p("å¤šäºº"))},"æ¨¡æ‹Ÿå¤šäºº"),e.createElementVNode("button",{size:"mini",onClick:a[2]||(a[2]=e=>p("éæ´»ä½“"))},"æ¨¡æ‹Ÿç…§ç‰‡æ”»å‡»")])])])]))}},[["__scopeId","data-v-9d1979c6"]]),A={__name:"index",setup(t){const a=e=>{uni.navigateTo({url:e})},l=()=>{uni.clearStorageSync(),uni.reLaunch({url:"/pages/login/login"})};return(t,s)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"ç®¡ç†æ§åˆ¶å°")]),e.createElementVNode("view",{class:"grid-container"},[e.createElementVNode("view",{class:"grid-item",onClick:s[0]||(s[0]=e=>a("/pages/admin/classes/list"))},[e.createElementVNode("text",{class:"icon"},"ğŸ«"),e.createElementVNode("text",{class:"label"},"ç­çº§ç®¡ç†"),e.createElementVNode("text",{class:"desc"},"åˆ›å»º/åˆ é™¤ç­çº§")]),e.createElementVNode("view",{class:"grid-item",onClick:s[1]||(s[1]=e=>a("/pages/admin/users/list"))},[e.createElementVNode("text",{class:"icon"},"ğŸ‘¥"),e.createElementVNode("text",{class:"label"},"è´¦å·ç®¡ç†"),e.createElementVNode("text",{class:"desc"},"å­¦ç”Ÿ/æ•™å¸ˆè´¦å·ç»´æŠ¤")]),e.createElementVNode("view",{class:"grid-item",onClick:s[2]||(s[2]=e=>a("/pages/admin/import/index"))},[e.createElementVNode("text",{class:"icon"},"ğŸ“¥"),e.createElementVNode("text",{class:"label"},"æ‰¹é‡å¯¼å…¥"),e.createElementVNode("text",{class:"desc"},"Excelå¯¼å…¥æ•°æ®")])]),e.createElementVNode("view",{class:"footer"},[e.createElementVNode("button",{type:"warn",onClick:l},"é€€å‡ºç™»å½•")])]))}},U={__name:"list",setup(a){const l=e.ref([]),s=e.ref(!1),n=e.ref(""),c=async()=>{try{const e=await d({url:"/admin/classes"});l.value=e}catch(e){t("error","at pages/admin/classes/list.vue:54",e)}},o=async()=>{if(n.value)try{await d({url:"/admin/classes",method:"POST",data:{name:n.value}}),s.value=!1,n.value="",c()}catch(e){t("error","at pages/admin/classes/list.vue:70",e)}};return e.onMounted((()=>{c()})),(a,i)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"ç­çº§ç®¡ç†"),e.createElementVNode("button",{size:"mini",type:"primary",onClick:i[0]||(i[0]=e=>s.value=!0)},"+ æ–°å¢ç­çº§")]),e.createElementVNode("view",{class:"list"},[e.createElementVNode("view",{class:"list-item header-row"},[e.createElementVNode("text",{class:"col id"},"ID"),e.createElementVNode("text",{class:"col name"},"ç­çº§åç§°"),e.createElementVNode("text",{class:"col teacher"},"ç»‘å®šæ•™å¸ˆID"),e.createElementVNode("text",{class:"col count"},"äººæ•°"),e.createElementVNode("text",{class:"col action"},"æ“ä½œ")]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"list-item"},[e.createElementVNode("text",{class:"col id"},e.toDisplayString(a.id),1),e.createElementVNode("text",{class:"col name"},e.toDisplayString(a.name),1),e.createElementVNode("text",{class:"col teacher"},e.toDisplayString(a.teacher_id||"-"),1),e.createElementVNode("text",{class:"col count"},e.toDisplayString(a.student_count),1),e.createElementVNode("view",{class:"col action"},[e.createElementVNode("text",{class:"delete-btn",onClick:e=>(async e=>{uni.showModal({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦åˆ é™¤ ${e.name} å—ï¼Ÿ`,success:async a=>{if(a.confirm)try{await d({url:`/admin/classes/${e.id}`,method:"DELETE"}),c()}catch(l){t("error","at pages/admin/classes/list.vue:87",l)}}})})(a)},"åˆ é™¤",8,["onClick"])])])))),128))]),s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal-overlay"},[e.createElementVNode("view",{class:"modal"},[e.createElementVNode("view",{class:"modal-header"},"æ–°å¢ç­çº§"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":i[1]||(i[1]=e=>n.value=e),placeholder:"è¯·è¾“å…¥ç­çº§åç§°"},null,512),[[e.vModelText,n.value]]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("button",{size:"mini",onClick:i[2]||(i[2]=e=>s.value=!1)},"å–æ¶ˆ"),e.createElementVNode("button",{size:"mini",type:"primary",onClick:o},"ç¡®å®š")])])])):e.createCommentVNode("",!0)]))}},q={__name:"list",setup(a){const l=e.ref("student"),s=e.ref([]),n=async()=>{try{const e=await d({url:"/admin/users",data:{role:l.value}});s.value=e}catch(e){t("error","at pages/admin/users/list.vue:44",e)}};return e.onMounted((()=>{n()})),(a,c)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"tabs"},[e.createElementVNode("view",{class:e.normalizeClass(["tab",{active:"student"===l.value}]),onClick:c[0]||(c[0]=e=>{l.value="student",n()})},"å­¦ç”Ÿ",2),e.createElementVNode("view",{class:e.normalizeClass(["tab",{active:"teacher"===l.value}]),onClick:c[1]||(c[1]=e=>{l.value="teacher",n()})},"æ•™å¸ˆ",2)]),e.createElementVNode("view",{class:"list"},[e.createElementVNode("view",{class:"list-item header-row"},[e.createElementVNode("text",{class:"col name"},"å§“å"),e.createElementVNode("text",{class:"col phone"},"æ‰‹æœºå·"),"student"===l.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"col info"},"ç­çº§")):(e.openBlock(),e.createElementBlock("text",{key:1,class:"col info"},"å·¥å·")),e.createElementVNode("text",{class:"col action"},"æ“ä½œ")]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,(a=>(e.openBlock(),e.createElementBlock("view",{key:a.id,class:"list-item"},[e.createElementVNode("text",{class:"col name"},e.toDisplayString(a.name),1),e.createElementVNode("text",{class:"col phone"},e.toDisplayString(a.phone),1),e.createElementVNode("text",{class:"col info"},e.toDisplayString("student"===l.value?a.class_name:a.student_id),1),e.createElementVNode("view",{class:"col action"},[e.createElementVNode("text",{class:"btn reset",onClick:e=>(async e=>{uni.showModal({title:"é‡ç½®å¯†ç ",content:`ç¡®å®šè¦é‡ç½® ${e.name} çš„å¯†ç ä¸º 123456 å—ï¼Ÿ`,success:async a=>{if(a.confirm)try{await d({url:`/admin/users/${e.id}/reset-password`,method:"POST"}),uni.showToast({title:"é‡ç½®æˆåŠŸ",icon:"success"})}catch(l){t("error","at pages/admin/users/list.vue:81",l)}}})})(a)},"é‡ç½®",8,["onClick"]),e.createElementVNode("text",{class:"btn delete",onClick:e=>(async e=>{uni.showModal({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· ${e.name} å—ï¼Ÿ`,success:async a=>{if(a.confirm)try{await d({url:`/admin/users/${e.id}`,method:"DELETE"}),n()}catch(l){t("error","at pages/admin/users/list.vue:61",l)}}})})(a)},"åˆ é™¤",8,["onClick"])])])))),128))])]))}},j={__name:"index",setup(a){const l=e=>{uni.showToast({title:"è¯·åœ¨Webç«¯ä½¿ç”¨å¯¼å…¥åŠŸèƒ½",icon:"none"})},s=e=>{const a=uni.getStorageSync("token"),l=r+("student"===e?"/admin/import/template/students":"/admin/import/template/teachers");uni.showLoading({title:"å‡†å¤‡ä¸‹è½½..."}),uni.downloadFile({url:l,header:{Authorization:`Bearer ${a}`},success:e=>{uni.hideLoading(),200===e.statusCode?uni.saveFile({tempFilePath:e.tempFilePath,success:function(e){uni.showToast({title:"ä¿å­˜æˆåŠŸ",icon:"success"}),setTimeout((()=>{uni.openDocument({filePath:e.savedFilePath,showMenu:!0})}),1e3)},fail:()=>{uni.showToast({title:"ä¿å­˜å¤±è´¥",icon:"none"})}}):uni.showToast({title:"ä¸‹è½½å¤±è´¥: "+e.statusCode,icon:"none"})},fail:e=>{uni.hideLoading(),uni.showToast({title:"è¯·æ±‚å¤±è´¥",icon:"none"}),t("error","at pages/admin/import/index.vue:141",e)}})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"header"},"æ‰¹é‡å¯¼å…¥å­¦ç”Ÿ (å«æ¨¡æ¿ä¸‹è½½)"),e.createElementVNode("view",{class:"desc"},"è¯·ä¸Šä¼ Excelæ–‡ä»¶ï¼ŒåŒ…å«åˆ—ï¼šå§“å, æ‰‹æœºå·, å¯†ç , å­¦å·, æ‰€å±ç­çº§åç§°"),e.createElementVNode("view",{class:"actions"},[e.createElementVNode("button",{type:"primary",size:"mini",class:"btn",onClick:a[0]||(a[0]=e=>l())},"é€‰æ‹©æ–‡ä»¶å¹¶å¯¼å…¥"),e.createElementVNode("button",{type:"default",size:"mini",class:"btn",onClick:a[1]||(a[1]=e=>s("student"))},"ä¸‹è½½æ¨¡æ¿")])]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"header"},"æ‰¹é‡å¯¼å…¥æ•™å¸ˆ (å«æ¨¡æ¿ä¸‹è½½)"),e.createElementVNode("view",{class:"desc"},"è¯·ä¸Šä¼ Excelæ–‡ä»¶ï¼ŒåŒ…å«åˆ—ï¼šå§“å, æ‰‹æœºå·, å¯†ç , å·¥å·"),e.createElementVNode("view",{class:"actions"},[e.createElementVNode("button",{type:"primary",size:"mini",class:"btn",onClick:a[2]||(a[2]=e=>l())},"é€‰æ‹©æ–‡ä»¶å¹¶å¯¼å…¥"),e.createElementVNode("button",{type:"default",size:"mini",class:"btn",onClick:a[3]||(a[3]=e=>s("teacher"))},"ä¸‹è½½æ¨¡æ¿")])])]))}};__definePage("pages/home/home",u),__definePage("pages/run/run",p),__definePage("pages/mine/mine",N),__definePage("pages/result/result",g),__definePage("pages/login/login",V),__definePage("pages/register/register",w),__definePage("pages/student/tasks/list",h),__definePage("pages/health/request",k),__definePage("pages/teacher/home/home",y),__definePage("pages/teacher/manage/manage",x),__definePage("pages/teacher/mine/mine",f),__definePage("pages/teacher/students/students",b),__definePage("pages/teacher/students/detail",S),__definePage("pages/teacher/tasks/tasks",B),__definePage("pages/teacher/tasks/detail",C),__definePage("pages/teacher/tasks/create",D),__definePage("pages/teacher/exceptions/exceptions",T),__definePage("pages/teacher/tests/tests",_),__definePage("pages/teacher/approve/approve",z),__definePage("pages/teacher/approve/student-detail",F),__definePage("pages/teacher/class/class-list",I),__definePage("pages/teacher/class/class-detail",M),__definePage("pages/activity/list",$),__definePage("pages/activity/detail",L),__definePage("pages/ai-police/ai-police",P),__definePage("pages/admin/dashboard/index",A),__definePage("pages/admin/classes/list",U),__definePage("pages/admin/users/list",q),__definePage("pages/admin/import/index",j);const O={onLaunch:function(){try{uni.getStorageSync("userInfo")||uni.reLaunch({url:"/pages/login/login",success:()=>{},fail:e=>{t("error","at App.vue:20","è·³è½¬ç™»å½•é¡µå¤±è´¥:",e)}})}catch(e){t("error","at App.vue:27","è¯»å–ç¼“å­˜å¤±è´¥:",e),uni.reLaunch({url:"/pages/login/login"})}},onShow:function(){},onHide:function(){}};const{app:R,Vuex:G,Pinia:J}={app:e.createVueApp(O)};uni.Vuex=G,uni.Pinia=J,R.provide("__globalStyles",__uniConfig.styles),R._component.mpType="app",R._component.render=()=>{},R.mount("#app")}(Vue);
