{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["// 基础配置\nconst BASE_URL = 'http://127.0.0.1:8000'; // 开发环境地址，真机调试请换成局域网IP\n\n// 请求封装\nconst request = (options) => {\n  return new Promise((resolve, reject) => {\n    // 获取 Token\n    const token = uni.getStorageSync('token');\n    \n    // 组装 Header\n    const header = {\n      'Content-Type': 'application/json',\n      ...options.header\n    };\n    \n    if (token) {\n      header['Authorization'] = `Bearer ${token}`;\n    }\n\n    uni.request({\n      url: `${BASE_URL}${options.url}`,\n      method: options.method || 'GET',\n      data: options.data || {},\n      header: header,\n      success: (res) => {\n        if (res.statusCode >= 200 && res.statusCode < 300) {\n          resolve(res.data);\n        } else if (res.statusCode === 401) {\n          // Token 失效，跳转登录\n          uni.removeStorageSync('token');\n          uni.removeStorageSync('userInfo');\n          uni.showToast({\n            title: '登录已过期，请重新登录',\n            icon: 'none'\n          });\n          setTimeout(() => {\n            uni.reLaunch({\n              url: '/pages/login/login'\n            });\n          }, 1500);\n          reject(res.data);\n        } else {\n          // 其他错误\n          uni.showToast({\n            title: res.data.detail || '请求失败',\n            icon: 'none'\n          });\n          reject(res.data);\n        }\n      },\n      fail: (err) => {\n        uni.showToast({\n          title: '网络请求失败',\n          icon: 'none'\n        });\n        reject(err);\n      }\n    });\n  });\n};\n\n// API 接口定义\n\n// Auth\nexport const login = (data) => {\n  return request({\n    url: '/auth/login',\n    method: 'POST',\n    data\n  });\n};\n\nexport const register = (data) => {\n  return request({\n    url: '/auth/register',\n    method: 'POST',\n    data\n  });\n};\n\n// Activity\nexport const submitActivity = (data) => {\n  return request({\n    url: '/activity/finish',\n    method: 'POST',\n    data\n  });\n};\n\nexport const getActivityHistory = (params) => {\n  // params: { page, size }\n  let queryString = '';\n  if (params) {\n    queryString = `?page=${params.page}&size=${params.size}`;\n  }\n  return request({\n    url: `/activity/history${queryString}`,\n    method: 'GET'\n  });\n};\n\n// Teacher\nexport const getTeacherActivities = (params) => {\n  let queryString = '';\n  if (params) {\n    queryString = `?page=${params.page}&size=${params.size}`;\n  }\n  return request({\n    url: `/teacher/activities${queryString}`,\n    method: 'GET'\n  });\n};\n\nexport const approveActivity = (activityId) => {\n  return request({\n    url: `/teacher/activity/${activityId}/approve`,\n    method: 'POST'\n  });\n};\n\nexport const createTeacherTask = (data) => {\n  return request({\n    url: '/teacher/tasks',\n    method: 'POST',\n    data\n  });\n};\n\nexport const deleteTask = (taskId) => {\n  return request({\n    url: `/teacher/tasks/${taskId}`,\n    method: 'DELETE'\n  });\n};\n\nexport const getTeacherTasks = (params) => {\n  let queryString = '';\n  if (params) {\n    queryString = `?page=${params.page}&size=${params.size}`;\n  }\n  return request({\n    url: `/teacher/tasks${queryString}`,\n    method: 'GET'\n  });\n};\n\nexport const getStudentTasks = (params) => {\n  let queryString = '';\n  if (params) {\n    queryString = `?page=${params.page}&size=${params.size}`;\n  }\n  return request({\n    url: `/student/tasks${queryString}`,\n    method: 'GET'\n  });\n};\n\nexport const getTeacherStudentActivities = (studentId, params) => {\n  return request({\n    url: `/teacher/student/${studentId}/activities`,\n    method: 'GET',\n    data: params\n  });\n};\n\nexport const getTeacherTaskDetail = (taskId) => {\n  return request({\n    url: `/teacher/tasks/${taskId}`,\n    method: 'GET'\n  });\n};\n\nexport const getCheckpoints = () => {\n  return request({\n    url: '/checkpoints',\n    method: 'GET'\n  });\n};\n\nexport const checkIn = (data) => {\n  return request({\n    url: '/activity/checkin',\n    method: 'POST',\n    data\n  });\n};\n\nexport default {\n  login,\n  register,\n  submitActivity,\n  getActivityHistory,\n  getTeacherActivities,\n  approveActivity,\n  createTeacherTask,\n  getTeacherTasks,\n  getStudentTasks,\n  getTeacherTaskDetail,\n  getCheckpoints,\n  checkIn\n};\n"],"names":["uni"],"mappings":"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"}