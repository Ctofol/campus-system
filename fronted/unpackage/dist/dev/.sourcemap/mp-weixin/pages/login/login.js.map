{"version":3,"file":"login.js","sources":["pages/login/login.vue","E:/HBuilderX/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\n  <view class=\"login-container\">\n    <!-- 1. 顶部 Logo 与 标题 -->\n    <view class=\"header-section\">\n      <view class=\"logo-circle\">\n        <text class=\"logo-text\">校</text>\n      </view>\n      <text class=\"app-name\">大学生运动健康管理平台</text>\n      <text class=\"app-sub-name\">Professional Sports Management System</text>\n    </view>\n\n    <!-- 2. 登录卡片 -->\n    <view class=\"login-card\">\n      <!-- 角色切换 Tab -->\n      <view class=\"role-tabs\">\n        <view \n          class=\"role-tab\" \n          :class=\"{active: currentRole === 'student'}\" \n          @click=\"currentRole = 'student'\"\n        >\n          <text>学生端</text>\n        </view>\n        <view \n          class=\"role-tab\" \n          :class=\"{active: currentRole === 'teacher'}\" \n          @click=\"currentRole = 'teacher'\"\n        >\n          <text>教师端</text>\n        </view>\n      </view>\n\n      <!-- 表单区域 -->\n      <view class=\"form-area\">\n        <view class=\"input-group\">\n          <text class=\"input-label\">{{ currentRole === 'student' ? '学号 / 手机号' : '工号 / 手机号' }}</text>\n          <input \n            class=\"input-field\" \n            v-model=\"loginForm.account\" \n            :placeholder=\"currentRole === 'student' ? '请输入学号/手机号' : '请输入工号/手机号'\"\n            placeholder-class=\"placeholder-style\"\n          />\n        </view>\n        <view class=\"input-group\">\n          <text class=\"input-label\">密码</text>\n          <input \n            class=\"input-field\" \n            v-model=\"loginForm.password\" \n            type=\"password\" \n            placeholder=\"请输入密码\"\n            placeholder-class=\"placeholder-style\"\n          />\n        </view>\n\n        <!-- 登录按钮 -->\n        <button \n          class=\"submit-btn\" \n          :class=\"{disabled: !canSubmit}\" \n          @click=\"handleLogin\"\n          :loading=\"loading\"\n        >\n          登录\n        </button>\n\n        <!-- 底部链接 -->\n        <view class=\"footer-links\">\n          <text class=\"link-text\" @click=\"goToRegister\">注册新账号</text>\n          <text class=\"divider\">|</text>\n          <text class=\"link-text\" @click=\"forgotPassword\">忘记密码？</text>\n        </view>\n      </view>\n    </view>\n\n    <!-- 底部版权 -->\n    <view class=\"copyright\">\n      <text>Copyright © 2026 Campus Sports System</text>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue';\nimport { login } from '@/utils/request.js';\n\n// 状态管理\nconst currentRole = ref('student'); // student | teacher\nconst loading = ref(false);\nconst loginForm = ref({\n  account: '',\n  password: ''\n});\n\n// 计算属性：是否可提交\nconst canSubmit = computed(() => {\n  return loginForm.value.account.length > 0 && loginForm.value.password.length > 0;\n});\n\n// 验证函数\nconst validateForm = () => {\n  const { account, password } = loginForm.value;\n  \n  if (password.length < 6) {\n    uni.showToast({ title: '密码长度不能少于6位', icon: 'none' });\n    return false;\n  }\n  return true;\n};\n\n// 登录逻辑\nconst handleLogin = async () => {\n  if (!canSubmit.value) return;\n  if (!validateForm()) return;\n\n  loading.value = true;\n  \n  try {\n    const res = await login({\n      phone: loginForm.value.account,\n      password: loginForm.value.password\n    });\n    \n    // 校验角色是否匹配\n    if (res.role !== currentRole.value) {\n      uni.showToast({\n        title: '角色不匹配，请切换角色登录',\n        icon: 'none'\n      });\n      loading.value = false;\n      return;\n    }\n\n    // 构造用户信息\n    const userInfo = {\n      userId: res.user_id,\n      role: res.role,\n      name: res.name,\n      phone: loginForm.value.account,\n      // 兼容字段\n      schoolId: '10001', \n      isPoliceSchool: false\n    };\n\n    // 存储全局状态\n    uni.setStorageSync('token', res.access_token);\n    uni.setStorageSync('userInfo', userInfo);\n    uni.setStorageSync('userRole', res.role);\n\n    uni.showToast({\n      title: '登录成功',\n      icon: 'success'\n    });\n\n    // 角色跳转逻辑\n    setTimeout(() => {\n      if (currentRole.value === 'student') {\n        uni.redirectTo({ url: '/pages/home/home' });\n      } else {\n        uni.redirectTo({ url: '/pages/teacher/home/home' });\n      }\n    }, 1000);\n\n  } catch (error) {\n    console.error('Login failed:', error);\n    // 错误提示已在 request.js 中处理，或者是网络层面的 reject\n  } finally {\n    loading.value = false;\n  }\n};\n\n// 跳转注册\nconst goToRegister = () => {\n  uni.navigateTo({ url: '/pages/register/register' });\n};\n\n// 忘记密码\nconst forgotPassword = () => {\n  uni.showToast({ title: '请联系管理员重置密码', icon: 'none' });\n};\n</script>\n\n<style scoped>\n.login-container {\n  min-height: 100vh;\n  background-color: #F5F7FA;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding-top: 100rpx;\n}\n\n.header-section {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin-bottom: 60rpx;\n}\n\n.logo-circle {\n  width: 120rpx;\n  height: 120rpx;\n  background: linear-gradient(135deg, #20C997 0%, #17a2b8 100%);\n  border-radius: 24rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 24rpx;\n  box-shadow: 0 10rpx 20rpx rgba(32, 201, 151, 0.3);\n}\n\n.logo-text {\n  font-size: 60rpx;\n  color: #fff;\n  font-weight: bold;\n}\n\n.app-name {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #333;\n  margin-bottom: 8rpx;\n}\n\n.app-sub-name {\n  font-size: 20rpx;\n  color: #999;\n  letter-spacing: 2rpx;\n}\n\n.login-card {\n  width: 650rpx;\n  background: #fff;\n  border-radius: 24rpx;\n  box-shadow: 0 4rpx 30rpx rgba(0, 0, 0, 0.05);\n  overflow: hidden;\n}\n\n.role-tabs {\n  display: flex;\n  background: #F8F9FA;\n  border-bottom: 1rpx solid #EEE;\n}\n\n.role-tab {\n  flex: 1;\n  text-align: center;\n  padding: 30rpx 0;\n  font-size: 28rpx;\n  color: #666;\n  position: relative;\n  transition: all 0.3s;\n}\n\n.role-tab.active {\n  color: #20C997;\n  font-weight: bold;\n  background: #fff;\n}\n\n.role-tab.active::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 40rpx;\n  height: 6rpx;\n  background: #20C997;\n  border-radius: 0 0 6rpx 6rpx;\n}\n\n.form-area {\n  padding: 40rpx;\n}\n\n.input-group {\n  margin-bottom: 40rpx;\n}\n\n.input-label {\n  display: block;\n  font-size: 26rpx;\n  color: #333;\n  margin-bottom: 16rpx;\n  font-weight: 500;\n}\n\n.input-field {\n  height: 88rpx;\n  background: #F8F9FA;\n  border-radius: 12rpx;\n  padding: 0 24rpx;\n  font-size: 28rpx;\n  color: #333;\n  border: 2rpx solid transparent;\n  transition: all 0.3s;\n}\n\n.input-field:focus {\n  background: #fff;\n  border-color: #20C997;\n}\n\n.placeholder-style {\n  color: #BBB;\n}\n\n.submit-btn {\n  background: linear-gradient(90deg, #20C997, #17a2b8);\n  color: #fff;\n  font-size: 32rpx;\n  font-weight: bold;\n  height: 88rpx;\n  line-height: 88rpx;\n  border-radius: 44rpx;\n  margin-top: 60rpx;\n  box-shadow: 0 10rpx 20rpx rgba(32, 201, 151, 0.3);\n}\n\n.submit-btn.disabled {\n  background: #E0E0E0;\n  color: #999;\n  box-shadow: none;\n}\n\n.submit-btn::after {\n  border: none;\n}\n\n.footer-links {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin-top: 40rpx;\n}\n\n.link-text {\n  font-size: 26rpx;\n  color: #666;\n  padding: 10rpx;\n}\n\n.divider {\n  color: #ddd;\n  margin: 0 10rpx;\n  font-size: 22rpx;\n}\n\n.copyright {\n  margin-top: auto;\n  margin-bottom: 40rpx;\n  font-size: 20rpx;\n  color: #ccc;\n}\n</style>\n","import MiniProgramPage from 'D:/PC/Document/HBuilderProjects/campus-system/fronted/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","uni","login"],"mappings":";;;;;;AAoFA,UAAM,cAAcA,cAAAA,IAAI,SAAS;AACjC,UAAM,UAAUA,cAAAA,IAAI,KAAK;AACzB,UAAM,YAAYA,cAAAA,IAAI;AAAA,MACpB,SAAS;AAAA,MACT,UAAU;AAAA,IACZ,CAAC;AAGD,UAAM,YAAYC,cAAQ,SAAC,MAAM;AAC/B,aAAO,UAAU,MAAM,QAAQ,SAAS,KAAK,UAAU,MAAM,SAAS,SAAS;AAAA,IACjF,CAAC;AAGD,UAAM,eAAe,MAAM;AACzB,YAAM,EAAE,SAAS,aAAa,UAAU;AAExC,UAAI,SAAS,SAAS,GAAG;AACvBC,sBAAG,MAAC,UAAU,EAAE,OAAO,cAAc,MAAM,OAAM,CAAE;AACnD,eAAO;AAAA,MACR;AACD,aAAO;AAAA,IACT;AAGA,UAAM,cAAc,YAAY;AAC9B,UAAI,CAAC,UAAU;AAAO;AACtB,UAAI,CAAC,aAAY;AAAI;AAErB,cAAQ,QAAQ;AAEhB,UAAI;AACF,cAAM,MAAM,MAAMC,oBAAM;AAAA,UACtB,OAAO,UAAU,MAAM;AAAA,UACvB,UAAU,UAAU,MAAM;AAAA,QAChC,CAAK;AAGD,YAAI,IAAI,SAAS,YAAY,OAAO;AAClCD,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACd,CAAO;AACD,kBAAQ,QAAQ;AAChB;AAAA,QACD;AAGD,cAAM,WAAW;AAAA,UACf,QAAQ,IAAI;AAAA,UACZ,MAAM,IAAI;AAAA,UACV,MAAM,IAAI;AAAA,UACV,OAAO,UAAU,MAAM;AAAA;AAAA,UAEvB,UAAU;AAAA,UACV,gBAAgB;AAAA,QACtB;AAGIA,sBAAAA,MAAI,eAAe,SAAS,IAAI,YAAY;AAC5CA,sBAAAA,MAAI,eAAe,YAAY,QAAQ;AACvCA,sBAAAA,MAAI,eAAe,YAAY,IAAI,IAAI;AAEvCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AAGD,mBAAW,MAAM;AACf,cAAI,YAAY,UAAU,WAAW;AACnCA,0BAAAA,MAAI,WAAW,EAAE,KAAK,mBAAoB,CAAA;AAAA,UAClD,OAAa;AACLA,0BAAAA,MAAI,WAAW,EAAE,KAAK,2BAA4B,CAAA;AAAA,UACnD;AAAA,QACF,GAAE,GAAI;AAAA,MAER,SAAQ,OAAO;AACdA,sBAAc,MAAA,MAAA,SAAA,gCAAA,iBAAiB,KAAK;AAAA,MAExC,UAAY;AACR,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IACH;AAGA,UAAM,eAAe,MAAM;AACzBA,oBAAAA,MAAI,WAAW,EAAE,KAAK,2BAA4B,CAAA;AAAA,IACpD;AAGA,UAAM,iBAAiB,MAAM;AAC3BA,oBAAG,MAAC,UAAU,EAAE,OAAO,cAAc,MAAM,OAAM,CAAE;AAAA,IACrD;;;;;;;;;;;;;;;;;;;;;;;AC/KA,GAAG,WAAW,eAAe;"}