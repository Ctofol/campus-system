{"version":3,"file":"detail.js","sources":["pages/teacher/tasks/detail.vue","E:/HBuilderX/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdGVhY2hlci90YXNrcy9kZXRhaWwudnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- Header Section -->\n    <view class=\"header-card\">\n      <view class=\"title-row\">\n        <text class=\"task-title\">{{ task.title }}</text>\n        <view class=\"status-tag\" :class=\"task.status\">{{ task.statusText }}</view>\n      </view>\n      <text class=\"due-date\">截止日期：{{ task.dueDate }}</text>\n    </view>\n\n    <!-- Task Requirements -->\n    <view class=\"section-card\">\n      <view class=\"section-header\">\n        <text class=\"section-title\">任务要求</text>\n      </view>\n      <view class=\"requirements-list\">\n        <view class=\"req-item\" v-for=\"(req, index) in task.requirements\" :key=\"index\">\n          <text class=\"dot\">•</text>\n          <text class=\"req-text\">{{ req }}</text>\n        </view>\n      </view>\n    </view>\n\n    <!-- Progress Overview -->\n    <view class=\"section-card\">\n      <view class=\"section-header\">\n        <text class=\"section-title\">完成进度</text>\n        <text class=\"progress-stats\">{{ task.completedCount }}/{{ task.totalCount }} 人</text>\n      </view>\n      <view class=\"progress-box\">\n        <view class=\"progress-bar\">\n          <view class=\"progress-fill\" :style=\"{ width: completionPercentage + '%' }\"></view>\n        </view>\n        <text class=\"percentage-text\">{{ completionPercentage }}%</text>\n      </view>\n    </view>\n\n    <!-- Student Participation List -->\n    <view class=\"section-card\">\n      <view class=\"section-header\">\n        <text class=\"section-title\">参与情况</text>\n        <view class=\"filter-tabs\">\n          <text \n            class=\"tab-item\" \n            :class=\"{ active: currentFilter === 'all' }\"\n            @click=\"currentFilter = 'all'\"\n          >全部</text>\n          <text \n            class=\"tab-item\" \n            :class=\"{ active: currentFilter === 'uncompleted' }\"\n            @click=\"currentFilter = 'uncompleted'\"\n          >未完成</text>\n        </view>\n      </view>\n      \n      <scroll-view scroll-y class=\"student-list\">\n        <view class=\"student-item\" v-for=\"student in filteredStudents\" :key=\"student.id\" @click=\"goToStudentDetail(student)\">\n          <view class=\"student-info\">\n            <image class=\"avatar\" :src=\"student.avatar || '/static/avatar.png'\" mode=\"aspectFill\"></image>\n            <view class=\"info-col\">\n              <text class=\"name\">{{ student.name }}</text>\n              <text class=\"id\">{{ student.studentId }}</text>\n              <text v-if=\"student.metricValue && student.metricValue !== '-'\" class=\"metric-val\">成绩: {{ student.metricValue }}</text>\n            </view>\n          </view>\n          <view class=\"status-col\">\n            <text class=\"status-text\" :class=\"student.status\">{{ student.statusText }}</text>\n            <button \n              v-if=\"student.status === 'uncompleted'\" \n              class=\"remind-btn\" \n              size=\"mini\"\n              @click.stop=\"remindStudent(student)\"\n            >提醒</button>\n          </view>\n        </view>\n      </scroll-view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\nimport { getTeacherTaskDetail } from '@/utils/request.js';\n\nconst taskId = ref(null);\nconst loading = ref(true);\n\nconst task = ref({\n  id: 0,\n  title: '',\n  status: '',\n  statusText: '',\n  dueDate: '',\n  requirements: [],\n  completedCount: 0,\n  totalCount: 0\n});\n\nconst students = ref([]);\nconst currentFilter = ref('all');\n\nconst completionPercentage = computed(() => {\n  if (task.value.totalCount === 0) return 0;\n  return Math.round((task.value.completedCount / task.value.totalCount) * 100);\n});\n\nconst filteredStudents = computed(() => {\n  if (currentFilter.value === 'all') return students.value;\n  return students.value.filter(s => s.status === currentFilter.value);\n});\n\nconst remindStudent = (student) => {\n  uni.showToast({\n    title: `已发送提醒给 ${student.name}`,\n    icon: 'success'\n  });\n};\n\nconst goToStudentDetail = (student) => {\n    uni.navigateTo({\n        url: `/pages/teacher/approve/student-detail?studentId=${student.id}&studentName=${student.name}`\n    });\n};\n\nconst fetchTaskDetail = async () => {\n    if (!taskId.value) return;\n    loading.value = true;\n    try {\n        const res = await getTeacherTaskDetail(taskId.value);\n        \n        // Parse Requirements\n        const reqs = [];\n        if (res.type === 'run') {\n            reqs.push('任务类型: 跑步任务');\n            if (res.min_distance) reqs.push(`最低距离: ${res.min_distance} km`);\n            if (res.min_duration) reqs.push(`最低时长: ${res.min_duration} 分钟`);\n        } else {\n            reqs.push('任务类型: 体测任务');\n            if (res.min_count) reqs.push(`最低次数: ${res.min_count} 次`);\n        }\n        if (res.description) reqs.push(`备注: ${res.description}`);\n        \n        // Determine Status\n        const now = new Date();\n        const deadline = res.deadline ? new Date(res.deadline) : null;\n        let status = 'ongoing';\n        let statusText = '进行中';\n        if (deadline && deadline < now) {\n            status = 'ended';\n            statusText = '已结束';\n        }\n\n        task.value = {\n            id: res.id,\n            title: res.title,\n            status: status,\n            statusText: statusText,\n            dueDate: res.deadline ? res.deadline.replace('T', ' ') : '无限制',\n            requirements: reqs,\n            completedCount: res.completed_count,\n            totalCount: res.total_students\n        };\n\n        // Map Students\n        students.value = res.student_statuses.map(s => ({\n            id: s.student_id,\n            name: s.student_name,\n            studentId: `ID:${s.student_id}`, // Mock student ID if not available\n            status: s.status === 'completed' ? 'completed' : 'uncompleted',\n            statusText: s.status === 'completed' ? '已完成' : '未完成',\n            metricValue: s.metric_value,\n            avatar: ''\n        }));\n\n    } catch (e) {\n        console.error(e);\n        uni.showToast({ title: '加载失败', icon: 'none' });\n    } finally {\n        loading.value = false;\n    }\n};\n\nonLoad((options) => {\n    if (options.id) {\n        taskId.value = options.id;\n        fetchTaskDetail();\n    }\n});\n</script>\n\n<style lang=\"scss\">\n.container {\n  padding: 20rpx;\n  background-color: #f5f7fa;\n  min-height: 100vh;\n}\n\n.card-base {\n  background: #ffffff;\n  border-radius: 16rpx;\n  padding: 30rpx;\n  margin-bottom: 20rpx;\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\n}\n\n.header-card {\n  @extend .card-base;\n  \n  .title-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16rpx;\n    \n    .task-title {\n      font-size: 36rpx;\n      font-weight: bold;\n      color: #333;\n    }\n    \n    .status-tag {\n      padding: 6rpx 16rpx;\n      border-radius: 8rpx;\n      font-size: 24rpx;\n      \n      &.ongoing {\n        background: #e6f7ff;\n        color: #1890ff;\n      }\n      &.ended {\n        background: #f5f5f5;\n        color: #999;\n      }\n    }\n  }\n  \n  .due-date {\n    font-size: 26rpx;\n    color: #666;\n  }\n}\n\n.section-card {\n  @extend .card-base;\n  \n  .section-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 24rpx;\n    \n    .section-title {\n      font-size: 30rpx;\n      font-weight: 600;\n      color: #333;\n      position: relative;\n      padding-left: 20rpx;\n      \n      &::before {\n        content: '';\n        position: absolute;\n        left: 0;\n        top: 50%;\n        transform: translateY(-50%);\n        width: 6rpx;\n        height: 28rpx;\n        background: #20C997;\n        border-radius: 3rpx;\n      }\n    }\n    \n    .progress-stats {\n      font-size: 28rpx;\n      color: #666;\n    }\n  }\n}\n\n.requirements-list {\n  .req-item {\n    display: flex;\n    margin-bottom: 12rpx;\n    \n    .dot {\n      color: #20C997;\n      margin-right: 12rpx;\n    }\n    \n    .req-text {\n      font-size: 28rpx;\n      color: #555;\n      line-height: 1.5;\n    }\n  }\n}\n\n.progress-box {\n  .progress-bar {\n    height: 16rpx;\n    background: #f0f0f0;\n    border-radius: 8rpx;\n    overflow: hidden;\n    margin-bottom: 12rpx;\n    \n    .progress-fill {\n      height: 100%;\n      background: linear-gradient(90deg, #20C997, #17a2b8);\n      border-radius: 8rpx;\n      transition: width 0.3s ease;\n    }\n  }\n  \n  .percentage-text {\n    font-size: 24rpx;\n    color: #999;\n    display: block;\n    text-align: right;\n  }\n}\n\n.filter-tabs {\n  display: flex;\n  background: #f5f5f5;\n  border-radius: 8rpx;\n  padding: 4rpx;\n  \n  .tab-item {\n    padding: 6rpx 20rpx;\n    font-size: 24rpx;\n    color: #666;\n    border-radius: 6rpx;\n    \n    &.active {\n      background: #fff;\n      color: #20C997;\n      font-weight: 500;\n      box-shadow: 0 2rpx 6rpx rgba(0,0,0,0.05);\n    }\n  }\n}\n\n.student-list {\n  max-height: 600rpx;\n  \n  .student-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 20rpx 0;\n    border-bottom: 1px solid #f0f0f0;\n    \n    &:last-child {\n      border-bottom: none;\n    }\n    \n    .student-info {\n      display: flex;\n      align-items: center;\n      \n      .avatar {\n        width: 80rpx;\n        height: 80rpx;\n        border-radius: 50%;\n        background: #eee;\n        margin-right: 20rpx;\n      }\n      \n      .info-col {\n        display: flex;\n        flex-direction: column;\n        \n        .name {\n          font-size: 28rpx;\n          color: #333;\n          font-weight: 500;\n        }\n        \n        .id {\n          font-size: 24rpx;\n          color: #999;\n        }\n\n        .metric-val {\n          font-size: 24rpx;\n          color: #20C997;\n          margin-top: 4rpx;\n        }\n      }\n    }\n    \n    .status-col {\n      display: flex;\n      flex-direction: column;\n      align-items: flex-end;\n      \n      .status-text {\n        font-size: 26rpx;\n        margin-bottom: 8rpx;\n        \n        &.completed {\n          color: #20C997;\n        }\n        &.uncompleted {\n          color: #ff4d4f;\n        }\n      }\n      \n      .remind-btn {\n        margin: 0;\n        padding: 0 20rpx;\n        height: 48rpx;\n        line-height: 48rpx;\n        font-size: 24rpx;\n        background: #fff;\n        color: #ff4d4f;\n        border: 1px solid #ff4d4f;\n        \n        &:active {\n          background: #fff1f0;\n        }\n      }\n    }\n  }\n}\n</style>\n","import MiniProgramPage from 'D:/PC/Document/HBuilderProjects/campus-system/fronted/pages/teacher/tasks/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","uni","getTeacherTaskDetail","onLoad","MiniProgramPage"],"mappings":"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"}