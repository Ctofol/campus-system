{"version":3,"file":"list.js","sources":["pages/student/tasks/list.vue","E:/HBuilderX/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc3R1ZGVudC90YXNrcy9saXN0LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- Tabs -->\n    <view class=\"tabs\">\n      <view class=\"tab-item\" :class=\"{ active: currentTab === 0 }\" @click=\"currentTab = 0\">进行中</view>\n      <view class=\"tab-item\" :class=\"{ active: currentTab === 1 }\" @click=\"currentTab = 1\">已结束</view>\n    </view>\n\n    <!-- Task List -->\n    <scroll-view scroll-y class=\"task-list\" @scrolltolower=\"loadMore\">\n      <view class=\"task-card\" v-for=\"item in filteredTasks\" :key=\"item.id\" @click=\"goToDetail(item)\">\n        <view class=\"card-header\">\n          <view class=\"title-row\">\n            <text class=\"tag\" :class=\"getTypeClass(item.type)\">{{ item.type === 'run' ? '跑步' : '体测' }}</text>\n            <text class=\"title\">{{ item.title }}</text>\n          </view>\n          <text class=\"status\" :class=\"getStatusClass(item.status)\">{{ item.statusText }}</text>\n        </view>\n        \n        <view class=\"card-body\">\n          <text class=\"desc\">{{ item.desc }}</text>\n          <view class=\"meta-row\">\n            <text class=\"deadline\">截止: {{ item.deadline }}</text>\n          </view>\n        </view>\n        \n        <view class=\"card-footer\">\n            <button class=\"action-btn\" v-if=\"item.status === 'pending'\" @click.stop=\"doTask(item)\">去完成</button>\n            <text v-else-if=\"item.status === 'completed'\" class=\"completed-text\">✅ 已完成</text>\n            <text v-else class=\"expired-text\">已过期</text>\n        </view>\n      </view>\n      <view class=\"loading-more\" v-if=\"loading\">加载中...</view>\n      <view class=\"no-more\" v-if=\"!loading && filteredTasks.length === 0\">暂无任务</view>\n    </scroll-view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, computed } from 'vue';\nimport { onShow } from '@dcloudio/uni-app';\nimport { getStudentTasks } from '@/utils/request.js';\n\nconst currentTab = ref(0);\nconst tasks = ref([]);\nconst page = ref(1);\nconst size = ref(20);\nconst loading = ref(false);\n\nconst loadTasks = async () => {\n    if (loading.value) return;\n    loading.value = true;\n    try {\n        const res = await getStudentTasks({ page: page.value, size: size.value });\n        if (res.items) {\n            const newTasks = res.items.map(t => ({\n                ...t,\n                statusText: t.status === 'completed' ? '已完成' : (t.status === 'expired' ? '已过期' : '进行中'),\n                desc: t.description || (t.min_distance ? `目标: ${t.min_distance}km` : '无具体描述'),\n                deadline: t.deadline ? t.deadline.split('T')[0] : '无限制'\n            }));\n            if (page.value === 1) tasks.value = newTasks;\n            else tasks.value = [...tasks.value, ...newTasks];\n        }\n    } catch (e) {\n        console.error(e);\n        uni.showToast({ title: '加载任务失败', icon: 'none' });\n    } finally {\n        loading.value = false;\n    }\n};\n\nconst loadMore = () => {\n    // page.value++;\n    // loadTasks();\n};\n\nonShow(() => {\n    page.value = 1;\n    loadTasks();\n});\n\nconst filteredTasks = computed(() => {\n    if (currentTab.value === 0) {\n        return tasks.value.filter(t => t.status === 'pending');\n    } else {\n        return tasks.value.filter(t => t.status !== 'pending');\n    }\n});\n\nconst getTypeClass = (type) => {\n    return type === 'test' ? 'tag-red' : 'tag-blue';\n};\n\nconst getStatusClass = (status) => {\n    if (status === 'completed') return 'text-green';\n    if (status === 'expired') return 'text-gray';\n    return 'text-orange';\n};\n\nconst doTask = (item) => {\n    if (item.type === 'run') {\n        uni.navigateTo({ url: '/pages/run/run' });\n    } else {\n        uni.navigateTo({ url: '/pages/test/test' });\n    }\n};\n\nconst goToDetail = (item) => {\n    // Future: Detail page\n};\n</script>\n\n<style lang=\"scss\">\n.container {\n  padding: 20rpx;\n  background-color: #f5f7fa;\n  min-height: 100vh;\n}\n.tabs {\n  display: flex;\n  background: #fff;\n  padding: 20rpx;\n  border-radius: 16rpx;\n  margin-bottom: 20rpx;\n  .tab-item {\n    flex: 1;\n    text-align: center;\n    font-size: 28rpx;\n    color: #666;\n    padding-bottom: 10rpx;\n    &.active {\n      color: #20C997;\n      border-bottom: 4rpx solid #20C997;\n      font-weight: bold;\n    }\n  }\n}\n.task-list {\n    height: calc(100vh - 120rpx);\n}\n.task-card {\n  background: #fff;\n  border-radius: 16rpx;\n  padding: 30rpx;\n  margin-bottom: 20rpx;\n  .card-header {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 20rpx;\n    .title-row {\n        display: flex;\n        align-items: center;\n        .tag {\n            font-size: 20rpx;\n            padding: 4rpx 12rpx;\n            border-radius: 8rpx;\n            margin-right: 16rpx;\n            &.tag-red { background: #ffebee; color: #f44336; }\n            &.tag-blue { background: #e3f2fd; color: #2196f3; }\n        }\n        .title { font-size: 32rpx; font-weight: bold; }\n    }\n    .status { font-size: 24rpx; }\n    .text-green { color: #4caf50; }\n    .text-gray { color: #9e9e9e; }\n    .text-orange { color: #ff9800; }\n  }\n  .card-body {\n    margin-bottom: 20rpx;\n    .desc { font-size: 28rpx; color: #666; display: block; margin-bottom: 10rpx; }\n    .meta-row { font-size: 24rpx; color: #999; }\n  }\n  .card-footer {\n    border-top: 1rpx solid #eee;\n    padding-top: 20rpx;\n    display: flex;\n    justify-content: flex-end;\n    .action-btn {\n        background: #20C997;\n        color: #fff;\n        font-size: 24rpx;\n        padding: 10rpx 30rpx;\n        border-radius: 30rpx;\n        margin: 0;\n    }\n    .completed-text {\n        color: #4caf50;\n        font-size: 24rpx;\n    }\n    .expired-text {\n        color: #999;\n        font-size: 24rpx;\n    }\n  }\n}\n.no-more {\n    text-align: center;\n    color: #999;\n    padding: 40rpx;\n}\n</style>","import MiniProgramPage from 'D:/PC/Document/HBuilderProjects/campus-system/fronted/pages/student/tasks/list.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getStudentTasks","uni","onShow","computed","MiniProgramPage"],"mappings":";;;;;;AA2CA,UAAM,aAAaA,cAAAA,IAAI,CAAC;AACxB,UAAM,QAAQA,cAAAA,IAAI,CAAA,CAAE;AACpB,UAAM,OAAOA,cAAAA,IAAI,CAAC;AAClB,UAAM,OAAOA,cAAAA,IAAI,EAAE;AACnB,UAAM,UAAUA,cAAAA,IAAI,KAAK;AAEzB,UAAM,YAAY,YAAY;AAC1B,UAAI,QAAQ;AAAO;AACnB,cAAQ,QAAQ;AAChB,UAAI;AACA,cAAM,MAAM,MAAMC,8BAAgB,EAAE,MAAM,KAAK,OAAO,MAAM,KAAK,MAAK,CAAE;AACxE,YAAI,IAAI,OAAO;AACX,gBAAM,WAAW,IAAI,MAAM,IAAI,QAAM;AAAA,YACjC,GAAG;AAAA,YACH,YAAY,EAAE,WAAW,cAAc,QAAS,EAAE,WAAW,YAAY,QAAQ;AAAA,YACjF,MAAM,EAAE,gBAAgB,EAAE,eAAe,OAAO,EAAE,YAAY,OAAO;AAAA,YACrE,UAAU,EAAE,WAAW,EAAE,SAAS,MAAM,GAAG,EAAE,CAAC,IAAI;AAAA,UACrD,EAAC;AACF,cAAI,KAAK,UAAU;AAAG,kBAAM,QAAQ;AAAA;AAC/B,kBAAM,QAAQ,CAAC,GAAG,MAAM,OAAO,GAAG,QAAQ;AAAA,QAClD;AAAA,MACJ,SAAQ,GAAG;AACRC,sBAAAA,MAAA,MAAA,SAAA,sCAAc,CAAC;AACfA,sBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,OAAM,CAAE;AAAA,MACvD,UAAc;AACN,gBAAQ,QAAQ;AAAA,MACnB;AAAA,IACL;AAEA,UAAM,WAAW,MAAM;AAAA,IAGvB;AAEAC,kBAAAA,OAAO,MAAM;AACT,WAAK,QAAQ;AACb;IACJ,CAAC;AAED,UAAM,gBAAgBC,cAAQ,SAAC,MAAM;AACjC,UAAI,WAAW,UAAU,GAAG;AACxB,eAAO,MAAM,MAAM,OAAO,OAAK,EAAE,WAAW,SAAS;AAAA,MAC7D,OAAW;AACH,eAAO,MAAM,MAAM,OAAO,OAAK,EAAE,WAAW,SAAS;AAAA,MACxD;AAAA,IACL,CAAC;AAED,UAAM,eAAe,CAAC,SAAS;AAC3B,aAAO,SAAS,SAAS,YAAY;AAAA,IACzC;AAEA,UAAM,iBAAiB,CAAC,WAAW;AAC/B,UAAI,WAAW;AAAa,eAAO;AACnC,UAAI,WAAW;AAAW,eAAO;AACjC,aAAO;AAAA,IACX;AAEA,UAAM,SAAS,CAAC,SAAS;AACrB,UAAI,KAAK,SAAS,OAAO;AACrBF,sBAAAA,MAAI,WAAW,EAAE,KAAK,iBAAkB,CAAA;AAAA,MAChD,OAAW;AACHA,sBAAAA,MAAI,WAAW,EAAE,KAAK,mBAAoB,CAAA;AAAA,MAC7C;AAAA,IACL;AAEA,UAAM,aAAa,CAAC,SAAS;AAAA,IAE7B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7GA,GAAG,WAAWG,SAAe;"}